--
-- PostgreSQL database cluster dump
--

\restrict u86D4bcJYWdosbQjgahuIFlOehSEixB9P33At2ljzDflUSYcdWZKCJmItvRnPIm

SET default_transaction_read_only = off;

SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;

--
-- Roles
--

CREATE ROLE anon;
ALTER ROLE anon WITH NOSUPERUSER INHERIT NOCREATEROLE NOCREATEDB NOLOGIN NOREPLICATION NOBYPASSRLS;
CREATE ROLE authenticated;
ALTER ROLE authenticated WITH NOSUPERUSER INHERIT NOCREATEROLE NOCREATEDB NOLOGIN NOREPLICATION NOBYPASSRLS;
CREATE ROLE authenticator;
ALTER ROLE authenticator WITH NOSUPERUSER NOINHERIT NOCREATEROLE NOCREATEDB LOGIN NOREPLICATION NOBYPASSRLS;
CREATE ROLE cli_login_postgres;
ALTER ROLE cli_login_postgres WITH NOSUPERUSER NOINHERIT NOCREATEROLE NOCREATEDB LOGIN NOREPLICATION NOBYPASSRLS VALID UNTIL '2025-12-10 13:52:11.706637+00';
CREATE ROLE dashboard_user;
ALTER ROLE dashboard_user WITH NOSUPERUSER INHERIT CREATEROLE CREATEDB NOLOGIN REPLICATION NOBYPASSRLS;
CREATE ROLE pgbouncer;
ALTER ROLE pgbouncer WITH NOSUPERUSER INHERIT NOCREATEROLE NOCREATEDB LOGIN NOREPLICATION NOBYPASSRLS;
CREATE ROLE postgres;
ALTER ROLE postgres WITH NOSUPERUSER INHERIT CREATEROLE CREATEDB LOGIN REPLICATION BYPASSRLS;
CREATE ROLE service_role;
ALTER ROLE service_role WITH NOSUPERUSER INHERIT NOCREATEROLE NOCREATEDB NOLOGIN NOREPLICATION BYPASSRLS;
CREATE ROLE supabase_admin;
ALTER ROLE supabase_admin WITH SUPERUSER INHERIT CREATEROLE CREATEDB LOGIN REPLICATION BYPASSRLS;
CREATE ROLE supabase_auth_admin;
ALTER ROLE supabase_auth_admin WITH NOSUPERUSER NOINHERIT CREATEROLE NOCREATEDB LOGIN NOREPLICATION NOBYPASSRLS;
CREATE ROLE supabase_etl_admin;
ALTER ROLE supabase_etl_admin WITH NOSUPERUSER INHERIT NOCREATEROLE NOCREATEDB LOGIN REPLICATION NOBYPASSRLS;
CREATE ROLE supabase_read_only_user;
ALTER ROLE supabase_read_only_user WITH NOSUPERUSER INHERIT NOCREATEROLE NOCREATEDB LOGIN NOREPLICATION BYPASSRLS;
CREATE ROLE supabase_realtime_admin;
ALTER ROLE supabase_realtime_admin WITH NOSUPERUSER NOINHERIT NOCREATEROLE NOCREATEDB NOLOGIN NOREPLICATION NOBYPASSRLS;
CREATE ROLE supabase_replication_admin;
ALTER ROLE supabase_replication_admin WITH NOSUPERUSER INHERIT NOCREATEROLE NOCREATEDB LOGIN REPLICATION NOBYPASSRLS;
CREATE ROLE supabase_storage_admin;
ALTER ROLE supabase_storage_admin WITH NOSUPERUSER NOINHERIT CREATEROLE NOCREATEDB LOGIN NOREPLICATION NOBYPASSRLS;

--
-- User Configurations
--

--
-- User Config "anon"
--

ALTER ROLE anon SET statement_timeout TO '3s';

--
-- User Config "authenticated"
--

ALTER ROLE authenticated SET statement_timeout TO '8s';

--
-- User Config "authenticator"
--

ALTER ROLE authenticator SET session_preload_libraries TO 'safeupdate';
ALTER ROLE authenticator SET statement_timeout TO '8s';
ALTER ROLE authenticator SET lock_timeout TO '8s';

--
-- User Config "postgres"
--

ALTER ROLE postgres SET search_path TO E'\\$user', 'public', 'extensions';

--
-- User Config "supabase_admin"
--

ALTER ROLE supabase_admin SET search_path TO '$user', 'public', 'auth', 'extensions';
ALTER ROLE supabase_admin SET log_statement TO 'none';

--
-- User Config "supabase_auth_admin"
--

ALTER ROLE supabase_auth_admin SET search_path TO 'auth';
ALTER ROLE supabase_auth_admin SET idle_in_transaction_session_timeout TO '60000';
ALTER ROLE supabase_auth_admin SET log_statement TO 'none';

--
-- User Config "supabase_read_only_user"
--

ALTER ROLE supabase_read_only_user SET default_transaction_read_only TO 'on';

--
-- User Config "supabase_storage_admin"
--

ALTER ROLE supabase_storage_admin SET search_path TO 'storage';
ALTER ROLE supabase_storage_admin SET log_statement TO 'none';


--
-- Role memberships
--

GRANT anon TO authenticator WITH INHERIT FALSE GRANTED BY supabase_admin;
GRANT anon TO postgres WITH ADMIN OPTION, INHERIT TRUE GRANTED BY supabase_admin;
GRANT authenticated TO authenticator WITH INHERIT FALSE GRANTED BY supabase_admin;
GRANT authenticated TO postgres WITH ADMIN OPTION, INHERIT TRUE GRANTED BY supabase_admin;
GRANT authenticator TO postgres WITH ADMIN OPTION, INHERIT TRUE GRANTED BY supabase_admin;
GRANT authenticator TO supabase_storage_admin WITH INHERIT FALSE GRANTED BY supabase_admin;
GRANT pg_create_subscription TO postgres WITH ADMIN OPTION, INHERIT TRUE GRANTED BY supabase_admin;
GRANT pg_monitor TO postgres WITH ADMIN OPTION, INHERIT TRUE GRANTED BY supabase_admin;
GRANT pg_monitor TO supabase_etl_admin WITH INHERIT TRUE GRANTED BY supabase_admin;
GRANT pg_monitor TO supabase_read_only_user WITH INHERIT TRUE GRANTED BY supabase_admin;
GRANT pg_read_all_data TO postgres WITH ADMIN OPTION, INHERIT TRUE GRANTED BY supabase_admin;
GRANT pg_read_all_data TO supabase_etl_admin WITH INHERIT TRUE GRANTED BY supabase_admin;
GRANT pg_read_all_data TO supabase_read_only_user WITH INHERIT TRUE GRANTED BY supabase_admin;
GRANT pg_signal_backend TO postgres WITH ADMIN OPTION, INHERIT TRUE GRANTED BY supabase_admin;
GRANT postgres TO cli_login_postgres WITH INHERIT FALSE GRANTED BY supabase_admin;
GRANT service_role TO authenticator WITH INHERIT FALSE GRANTED BY supabase_admin;
GRANT service_role TO postgres WITH ADMIN OPTION, INHERIT TRUE GRANTED BY supabase_admin;
GRANT supabase_realtime_admin TO postgres WITH INHERIT TRUE GRANTED BY supabase_admin;






\unrestrict u86D4bcJYWdosbQjgahuIFlOehSEixB9P33At2ljzDflUSYcdWZKCJmItvRnPIm

--
-- Databases
--

--
-- Database "template1" dump
--

\connect template1

--
-- PostgreSQL database dump
--

\restrict 2Vfyd2Rc9geS9MaNa8pCXVhpCazWoc7HivaW9Q1Br2IffL2XixeGb0XEq0Q0Cvv

-- Dumped from database version 17.4
-- Dumped by pg_dump version 17.7 (Debian 17.7-3.pgdg12+1)

SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET transaction_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET xmloption = content;
SET client_min_messages = warning;
SET row_security = off;

--
-- PostgreSQL database dump complete
--

\unrestrict 2Vfyd2Rc9geS9MaNa8pCXVhpCazWoc7HivaW9Q1Br2IffL2XixeGb0XEq0Q0Cvv

--
-- Database "postgres" dump
--

\connect postgres

--
-- PostgreSQL database dump
--

\restrict CleUPxhcCZthHjtTkWu6qWEdD6cSwofYKP74xy8BLTAw1If4p6blDQITGBtBOVo

-- Dumped from database version 17.4
-- Dumped by pg_dump version 17.7 (Debian 17.7-3.pgdg12+1)

SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET transaction_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET xmloption = content;
SET client_min_messages = warning;
SET row_security = off;

--
-- Name: auth; Type: SCHEMA; Schema: -; Owner: supabase_admin
--

CREATE SCHEMA auth;


ALTER SCHEMA auth OWNER TO supabase_admin;

--
-- Name: extensions; Type: SCHEMA; Schema: -; Owner: postgres
--

CREATE SCHEMA extensions;


ALTER SCHEMA extensions OWNER TO postgres;

--
-- Name: graphql; Type: SCHEMA; Schema: -; Owner: supabase_admin
--

CREATE SCHEMA graphql;


ALTER SCHEMA graphql OWNER TO supabase_admin;

--
-- Name: graphql_public; Type: SCHEMA; Schema: -; Owner: supabase_admin
--

CREATE SCHEMA graphql_public;


ALTER SCHEMA graphql_public OWNER TO supabase_admin;

--
-- Name: pgbouncer; Type: SCHEMA; Schema: -; Owner: pgbouncer
--

CREATE SCHEMA pgbouncer;


ALTER SCHEMA pgbouncer OWNER TO pgbouncer;

--
-- Name: realtime; Type: SCHEMA; Schema: -; Owner: supabase_admin
--

CREATE SCHEMA realtime;


ALTER SCHEMA realtime OWNER TO supabase_admin;

--
-- Name: storage; Type: SCHEMA; Schema: -; Owner: supabase_admin
--

CREATE SCHEMA storage;


ALTER SCHEMA storage OWNER TO supabase_admin;

--
-- Name: supabase_migrations; Type: SCHEMA; Schema: -; Owner: postgres
--

CREATE SCHEMA supabase_migrations;


ALTER SCHEMA supabase_migrations OWNER TO postgres;

--
-- Name: vault; Type: SCHEMA; Schema: -; Owner: supabase_admin
--

CREATE SCHEMA vault;


ALTER SCHEMA vault OWNER TO supabase_admin;

--
-- Name: pg_graphql; Type: EXTENSION; Schema: -; Owner: -
--

CREATE EXTENSION IF NOT EXISTS pg_graphql WITH SCHEMA graphql;


--
-- Name: EXTENSION pg_graphql; Type: COMMENT; Schema: -; Owner: 
--

COMMENT ON EXTENSION pg_graphql IS 'pg_graphql: GraphQL support';


--
-- Name: pg_stat_statements; Type: EXTENSION; Schema: -; Owner: -
--

CREATE EXTENSION IF NOT EXISTS pg_stat_statements WITH SCHEMA extensions;


--
-- Name: EXTENSION pg_stat_statements; Type: COMMENT; Schema: -; Owner: 
--

COMMENT ON EXTENSION pg_stat_statements IS 'track planning and execution statistics of all SQL statements executed';


--
-- Name: pgcrypto; Type: EXTENSION; Schema: -; Owner: -
--

CREATE EXTENSION IF NOT EXISTS pgcrypto WITH SCHEMA extensions;


--
-- Name: EXTENSION pgcrypto; Type: COMMENT; Schema: -; Owner: 
--

COMMENT ON EXTENSION pgcrypto IS 'cryptographic functions';


--
-- Name: supabase_vault; Type: EXTENSION; Schema: -; Owner: -
--

CREATE EXTENSION IF NOT EXISTS supabase_vault WITH SCHEMA vault;


--
-- Name: EXTENSION supabase_vault; Type: COMMENT; Schema: -; Owner: 
--

COMMENT ON EXTENSION supabase_vault IS 'Supabase Vault Extension';


--
-- Name: uuid-ossp; Type: EXTENSION; Schema: -; Owner: -
--

CREATE EXTENSION IF NOT EXISTS "uuid-ossp" WITH SCHEMA extensions;


--
-- Name: EXTENSION "uuid-ossp"; Type: COMMENT; Schema: -; Owner: 
--

COMMENT ON EXTENSION "uuid-ossp" IS 'generate universally unique identifiers (UUIDs)';


--
-- Name: aal_level; Type: TYPE; Schema: auth; Owner: supabase_auth_admin
--

CREATE TYPE auth.aal_level AS ENUM (
    'aal1',
    'aal2',
    'aal3'
);


ALTER TYPE auth.aal_level OWNER TO supabase_auth_admin;

--
-- Name: code_challenge_method; Type: TYPE; Schema: auth; Owner: supabase_auth_admin
--

CREATE TYPE auth.code_challenge_method AS ENUM (
    's256',
    'plain'
);


ALTER TYPE auth.code_challenge_method OWNER TO supabase_auth_admin;

--
-- Name: factor_status; Type: TYPE; Schema: auth; Owner: supabase_auth_admin
--

CREATE TYPE auth.factor_status AS ENUM (
    'unverified',
    'verified'
);


ALTER TYPE auth.factor_status OWNER TO supabase_auth_admin;

--
-- Name: factor_type; Type: TYPE; Schema: auth; Owner: supabase_auth_admin
--

CREATE TYPE auth.factor_type AS ENUM (
    'totp',
    'webauthn',
    'phone'
);


ALTER TYPE auth.factor_type OWNER TO supabase_auth_admin;

--
-- Name: oauth_authorization_status; Type: TYPE; Schema: auth; Owner: supabase_auth_admin
--

CREATE TYPE auth.oauth_authorization_status AS ENUM (
    'pending',
    'approved',
    'denied',
    'expired'
);


ALTER TYPE auth.oauth_authorization_status OWNER TO supabase_auth_admin;

--
-- Name: oauth_client_type; Type: TYPE; Schema: auth; Owner: supabase_auth_admin
--

CREATE TYPE auth.oauth_client_type AS ENUM (
    'public',
    'confidential'
);


ALTER TYPE auth.oauth_client_type OWNER TO supabase_auth_admin;

--
-- Name: oauth_registration_type; Type: TYPE; Schema: auth; Owner: supabase_auth_admin
--

CREATE TYPE auth.oauth_registration_type AS ENUM (
    'dynamic',
    'manual'
);


ALTER TYPE auth.oauth_registration_type OWNER TO supabase_auth_admin;

--
-- Name: oauth_response_type; Type: TYPE; Schema: auth; Owner: supabase_auth_admin
--

CREATE TYPE auth.oauth_response_type AS ENUM (
    'code'
);


ALTER TYPE auth.oauth_response_type OWNER TO supabase_auth_admin;

--
-- Name: one_time_token_type; Type: TYPE; Schema: auth; Owner: supabase_auth_admin
--

CREATE TYPE auth.one_time_token_type AS ENUM (
    'confirmation_token',
    'reauthentication_token',
    'recovery_token',
    'email_change_token_new',
    'email_change_token_current',
    'phone_change_token'
);


ALTER TYPE auth.one_time_token_type OWNER TO supabase_auth_admin;

--
-- Name: membership_status; Type: TYPE; Schema: public; Owner: postgres
--

CREATE TYPE public.membership_status AS ENUM (
    'active',
    'inactive',
    'frozen',
    'cancelled',
    'past_due'
);


ALTER TYPE public.membership_status OWNER TO postgres;

--
-- Name: user_role; Type: TYPE; Schema: public; Owner: postgres
--

CREATE TYPE public.user_role AS ENUM (
    'owner',
    'manager',
    'staff',
    'trainer',
    'member'
);


ALTER TYPE public.user_role OWNER TO postgres;

--
-- Name: action; Type: TYPE; Schema: realtime; Owner: supabase_admin
--

CREATE TYPE realtime.action AS ENUM (
    'INSERT',
    'UPDATE',
    'DELETE',
    'TRUNCATE',
    'ERROR'
);


ALTER TYPE realtime.action OWNER TO supabase_admin;

--
-- Name: equality_op; Type: TYPE; Schema: realtime; Owner: supabase_admin
--

CREATE TYPE realtime.equality_op AS ENUM (
    'eq',
    'neq',
    'lt',
    'lte',
    'gt',
    'gte',
    'in'
);


ALTER TYPE realtime.equality_op OWNER TO supabase_admin;

--
-- Name: user_defined_filter; Type: TYPE; Schema: realtime; Owner: supabase_admin
--

CREATE TYPE realtime.user_defined_filter AS (
	column_name text,
	op realtime.equality_op,
	value text
);


ALTER TYPE realtime.user_defined_filter OWNER TO supabase_admin;

--
-- Name: wal_column; Type: TYPE; Schema: realtime; Owner: supabase_admin
--

CREATE TYPE realtime.wal_column AS (
	name text,
	type_name text,
	type_oid oid,
	value jsonb,
	is_pkey boolean,
	is_selectable boolean
);


ALTER TYPE realtime.wal_column OWNER TO supabase_admin;

--
-- Name: wal_rls; Type: TYPE; Schema: realtime; Owner: supabase_admin
--

CREATE TYPE realtime.wal_rls AS (
	wal jsonb,
	is_rls_enabled boolean,
	subscription_ids uuid[],
	errors text[]
);


ALTER TYPE realtime.wal_rls OWNER TO supabase_admin;

--
-- Name: buckettype; Type: TYPE; Schema: storage; Owner: supabase_storage_admin
--

CREATE TYPE storage.buckettype AS ENUM (
    'STANDARD',
    'ANALYTICS',
    'VECTOR'
);


ALTER TYPE storage.buckettype OWNER TO supabase_storage_admin;

--
-- Name: email(); Type: FUNCTION; Schema: auth; Owner: supabase_auth_admin
--

CREATE FUNCTION auth.email() RETURNS text
    LANGUAGE sql STABLE
    AS $$
  select 
  coalesce(
    nullif(current_setting('request.jwt.claim.email', true), ''),
    (nullif(current_setting('request.jwt.claims', true), '')::jsonb ->> 'email')
  )::text
$$;


ALTER FUNCTION auth.email() OWNER TO supabase_auth_admin;

--
-- Name: FUNCTION email(); Type: COMMENT; Schema: auth; Owner: supabase_auth_admin
--

COMMENT ON FUNCTION auth.email() IS 'Deprecated. Use auth.jwt() -> ''email'' instead.';


--
-- Name: jwt(); Type: FUNCTION; Schema: auth; Owner: supabase_auth_admin
--

CREATE FUNCTION auth.jwt() RETURNS jsonb
    LANGUAGE sql STABLE
    AS $$
  select 
    coalesce(
        nullif(current_setting('request.jwt.claim', true), ''),
        nullif(current_setting('request.jwt.claims', true), '')
    )::jsonb
$$;


ALTER FUNCTION auth.jwt() OWNER TO supabase_auth_admin;

--
-- Name: role(); Type: FUNCTION; Schema: auth; Owner: supabase_auth_admin
--

CREATE FUNCTION auth.role() RETURNS text
    LANGUAGE sql STABLE
    AS $$
  select 
  coalesce(
    nullif(current_setting('request.jwt.claim.role', true), ''),
    (nullif(current_setting('request.jwt.claims', true), '')::jsonb ->> 'role')
  )::text
$$;


ALTER FUNCTION auth.role() OWNER TO supabase_auth_admin;

--
-- Name: FUNCTION role(); Type: COMMENT; Schema: auth; Owner: supabase_auth_admin
--

COMMENT ON FUNCTION auth.role() IS 'Deprecated. Use auth.jwt() -> ''role'' instead.';


--
-- Name: uid(); Type: FUNCTION; Schema: auth; Owner: supabase_auth_admin
--

CREATE FUNCTION auth.uid() RETURNS uuid
    LANGUAGE sql STABLE
    AS $$
  select 
  coalesce(
    nullif(current_setting('request.jwt.claim.sub', true), ''),
    (nullif(current_setting('request.jwt.claims', true), '')::jsonb ->> 'sub')
  )::uuid
$$;


ALTER FUNCTION auth.uid() OWNER TO supabase_auth_admin;

--
-- Name: FUNCTION uid(); Type: COMMENT; Schema: auth; Owner: supabase_auth_admin
--

COMMENT ON FUNCTION auth.uid() IS 'Deprecated. Use auth.jwt() -> ''sub'' instead.';


--
-- Name: grant_pg_cron_access(); Type: FUNCTION; Schema: extensions; Owner: supabase_admin
--

CREATE FUNCTION extensions.grant_pg_cron_access() RETURNS event_trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  IF EXISTS (
    SELECT
    FROM pg_event_trigger_ddl_commands() AS ev
    JOIN pg_extension AS ext
    ON ev.objid = ext.oid
    WHERE ext.extname = 'pg_cron'
  )
  THEN
    grant usage on schema cron to postgres with grant option;

    alter default privileges in schema cron grant all on tables to postgres with grant option;
    alter default privileges in schema cron grant all on functions to postgres with grant option;
    alter default privileges in schema cron grant all on sequences to postgres with grant option;

    alter default privileges for user supabase_admin in schema cron grant all
        on sequences to postgres with grant option;
    alter default privileges for user supabase_admin in schema cron grant all
        on tables to postgres with grant option;
    alter default privileges for user supabase_admin in schema cron grant all
        on functions to postgres with grant option;

    grant all privileges on all tables in schema cron to postgres with grant option;
    revoke all on table cron.job from postgres;
    grant select on table cron.job to postgres with grant option;
  END IF;
END;
$$;


ALTER FUNCTION extensions.grant_pg_cron_access() OWNER TO supabase_admin;

--
-- Name: FUNCTION grant_pg_cron_access(); Type: COMMENT; Schema: extensions; Owner: supabase_admin
--

COMMENT ON FUNCTION extensions.grant_pg_cron_access() IS 'Grants access to pg_cron';


--
-- Name: grant_pg_graphql_access(); Type: FUNCTION; Schema: extensions; Owner: supabase_admin
--

CREATE FUNCTION extensions.grant_pg_graphql_access() RETURNS event_trigger
    LANGUAGE plpgsql
    AS $_$
DECLARE
    func_is_graphql_resolve bool;
BEGIN
    func_is_graphql_resolve = (
        SELECT n.proname = 'resolve'
        FROM pg_event_trigger_ddl_commands() AS ev
        LEFT JOIN pg_catalog.pg_proc AS n
        ON ev.objid = n.oid
    );

    IF func_is_graphql_resolve
    THEN
        -- Update public wrapper to pass all arguments through to the pg_graphql resolve func
        DROP FUNCTION IF EXISTS graphql_public.graphql;
        create or replace function graphql_public.graphql(
            "operationName" text default null,
            query text default null,
            variables jsonb default null,
            extensions jsonb default null
        )
            returns jsonb
            language sql
        as $$
            select graphql.resolve(
                query := query,
                variables := coalesce(variables, '{}'),
                "operationName" := "operationName",
                extensions := extensions
            );
        $$;

        -- This hook executes when `graphql.resolve` is created. That is not necessarily the last
        -- function in the extension so we need to grant permissions on existing entities AND
        -- update default permissions to any others that are created after `graphql.resolve`
        grant usage on schema graphql to postgres, anon, authenticated, service_role;
        grant select on all tables in schema graphql to postgres, anon, authenticated, service_role;
        grant execute on all functions in schema graphql to postgres, anon, authenticated, service_role;
        grant all on all sequences in schema graphql to postgres, anon, authenticated, service_role;
        alter default privileges in schema graphql grant all on tables to postgres, anon, authenticated, service_role;
        alter default privileges in schema graphql grant all on functions to postgres, anon, authenticated, service_role;
        alter default privileges in schema graphql grant all on sequences to postgres, anon, authenticated, service_role;

        -- Allow postgres role to allow granting usage on graphql and graphql_public schemas to custom roles
        grant usage on schema graphql_public to postgres with grant option;
        grant usage on schema graphql to postgres with grant option;
    END IF;

END;
$_$;


ALTER FUNCTION extensions.grant_pg_graphql_access() OWNER TO supabase_admin;

--
-- Name: FUNCTION grant_pg_graphql_access(); Type: COMMENT; Schema: extensions; Owner: supabase_admin
--

COMMENT ON FUNCTION extensions.grant_pg_graphql_access() IS 'Grants access to pg_graphql';


--
-- Name: grant_pg_net_access(); Type: FUNCTION; Schema: extensions; Owner: supabase_admin
--

CREATE FUNCTION extensions.grant_pg_net_access() RETURNS event_trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  IF EXISTS (
    SELECT 1
    FROM pg_event_trigger_ddl_commands() AS ev
    JOIN pg_extension AS ext
    ON ev.objid = ext.oid
    WHERE ext.extname = 'pg_net'
  )
  THEN
    IF NOT EXISTS (
      SELECT 1
      FROM pg_roles
      WHERE rolname = 'supabase_functions_admin'
    )
    THEN
      CREATE USER supabase_functions_admin NOINHERIT CREATEROLE LOGIN NOREPLICATION;
    END IF;

    GRANT USAGE ON SCHEMA net TO supabase_functions_admin, postgres, anon, authenticated, service_role;

    IF EXISTS (
      SELECT FROM pg_extension
      WHERE extname = 'pg_net'
      -- all versions in use on existing projects as of 2025-02-20
      -- version 0.12.0 onwards don't need these applied
      AND extversion IN ('0.2', '0.6', '0.7', '0.7.1', '0.8', '0.10.0', '0.11.0')
    ) THEN
      ALTER function net.http_get(url text, params jsonb, headers jsonb, timeout_milliseconds integer) SECURITY DEFINER;
      ALTER function net.http_post(url text, body jsonb, params jsonb, headers jsonb, timeout_milliseconds integer) SECURITY DEFINER;

      ALTER function net.http_get(url text, params jsonb, headers jsonb, timeout_milliseconds integer) SET search_path = net;
      ALTER function net.http_post(url text, body jsonb, params jsonb, headers jsonb, timeout_milliseconds integer) SET search_path = net;

      REVOKE ALL ON FUNCTION net.http_get(url text, params jsonb, headers jsonb, timeout_milliseconds integer) FROM PUBLIC;
      REVOKE ALL ON FUNCTION net.http_post(url text, body jsonb, params jsonb, headers jsonb, timeout_milliseconds integer) FROM PUBLIC;

      GRANT EXECUTE ON FUNCTION net.http_get(url text, params jsonb, headers jsonb, timeout_milliseconds integer) TO supabase_functions_admin, postgres, anon, authenticated, service_role;
      GRANT EXECUTE ON FUNCTION net.http_post(url text, body jsonb, params jsonb, headers jsonb, timeout_milliseconds integer) TO supabase_functions_admin, postgres, anon, authenticated, service_role;
    END IF;
  END IF;
END;
$$;


ALTER FUNCTION extensions.grant_pg_net_access() OWNER TO supabase_admin;

--
-- Name: FUNCTION grant_pg_net_access(); Type: COMMENT; Schema: extensions; Owner: supabase_admin
--

COMMENT ON FUNCTION extensions.grant_pg_net_access() IS 'Grants access to pg_net';


--
-- Name: pgrst_ddl_watch(); Type: FUNCTION; Schema: extensions; Owner: supabase_admin
--

CREATE FUNCTION extensions.pgrst_ddl_watch() RETURNS event_trigger
    LANGUAGE plpgsql
    AS $$
DECLARE
  cmd record;
BEGIN
  FOR cmd IN SELECT * FROM pg_event_trigger_ddl_commands()
  LOOP
    IF cmd.command_tag IN (
      'CREATE SCHEMA', 'ALTER SCHEMA'
    , 'CREATE TABLE', 'CREATE TABLE AS', 'SELECT INTO', 'ALTER TABLE'
    , 'CREATE FOREIGN TABLE', 'ALTER FOREIGN TABLE'
    , 'CREATE VIEW', 'ALTER VIEW'
    , 'CREATE MATERIALIZED VIEW', 'ALTER MATERIALIZED VIEW'
    , 'CREATE FUNCTION', 'ALTER FUNCTION'
    , 'CREATE TRIGGER'
    , 'CREATE TYPE', 'ALTER TYPE'
    , 'CREATE RULE'
    , 'COMMENT'
    )
    -- don't notify in case of CREATE TEMP table or other objects created on pg_temp
    AND cmd.schema_name is distinct from 'pg_temp'
    THEN
      NOTIFY pgrst, 'reload schema';
    END IF;
  END LOOP;
END; $$;


ALTER FUNCTION extensions.pgrst_ddl_watch() OWNER TO supabase_admin;

--
-- Name: pgrst_drop_watch(); Type: FUNCTION; Schema: extensions; Owner: supabase_admin
--

CREATE FUNCTION extensions.pgrst_drop_watch() RETURNS event_trigger
    LANGUAGE plpgsql
    AS $$
DECLARE
  obj record;
BEGIN
  FOR obj IN SELECT * FROM pg_event_trigger_dropped_objects()
  LOOP
    IF obj.object_type IN (
      'schema'
    , 'table'
    , 'foreign table'
    , 'view'
    , 'materialized view'
    , 'function'
    , 'trigger'
    , 'type'
    , 'rule'
    )
    AND obj.is_temporary IS false -- no pg_temp objects
    THEN
      NOTIFY pgrst, 'reload schema';
    END IF;
  END LOOP;
END; $$;


ALTER FUNCTION extensions.pgrst_drop_watch() OWNER TO supabase_admin;

--
-- Name: set_graphql_placeholder(); Type: FUNCTION; Schema: extensions; Owner: supabase_admin
--

CREATE FUNCTION extensions.set_graphql_placeholder() RETURNS event_trigger
    LANGUAGE plpgsql
    AS $_$
    DECLARE
    graphql_is_dropped bool;
    BEGIN
    graphql_is_dropped = (
        SELECT ev.schema_name = 'graphql_public'
        FROM pg_event_trigger_dropped_objects() AS ev
        WHERE ev.schema_name = 'graphql_public'
    );

    IF graphql_is_dropped
    THEN
        create or replace function graphql_public.graphql(
            "operationName" text default null,
            query text default null,
            variables jsonb default null,
            extensions jsonb default null
        )
            returns jsonb
            language plpgsql
        as $$
            DECLARE
                server_version float;
            BEGIN
                server_version = (SELECT (SPLIT_PART((select version()), ' ', 2))::float);

                IF server_version >= 14 THEN
                    RETURN jsonb_build_object(
                        'errors', jsonb_build_array(
                            jsonb_build_object(
                                'message', 'pg_graphql extension is not enabled.'
                            )
                        )
                    );
                ELSE
                    RETURN jsonb_build_object(
                        'errors', jsonb_build_array(
                            jsonb_build_object(
                                'message', 'pg_graphql is only available on projects running Postgres 14 onwards.'
                            )
                        )
                    );
                END IF;
            END;
        $$;
    END IF;

    END;
$_$;


ALTER FUNCTION extensions.set_graphql_placeholder() OWNER TO supabase_admin;

--
-- Name: FUNCTION set_graphql_placeholder(); Type: COMMENT; Schema: extensions; Owner: supabase_admin
--

COMMENT ON FUNCTION extensions.set_graphql_placeholder() IS 'Reintroduces placeholder function for graphql_public.graphql';


--
-- Name: get_auth(text); Type: FUNCTION; Schema: pgbouncer; Owner: supabase_admin
--

CREATE FUNCTION pgbouncer.get_auth(p_usename text) RETURNS TABLE(username text, password text)
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO ''
    AS $_$
  BEGIN
      RAISE DEBUG 'PgBouncer auth request: %', p_usename;

      RETURN QUERY
      SELECT
          rolname::text,
          CASE WHEN rolvaliduntil < now()
              THEN null
              ELSE rolpassword::text
          END
      FROM pg_authid
      WHERE rolname=$1 and rolcanlogin;
  END;
  $_$;


ALTER FUNCTION pgbouncer.get_auth(p_usename text) OWNER TO supabase_admin;

--
-- Name: calculate_child_age_months(date); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.calculate_child_age_months(birth_date date) RETURNS integer
    LANGUAGE plpgsql STABLE
    SET search_path TO 'public'
    AS $$
BEGIN
  RETURN EXTRACT(YEAR FROM age(CURRENT_DATE, birth_date)) * 12 + 
         EXTRACT(MONTH FROM age(CURRENT_DATE, birth_date));
END;
$$;


ALTER FUNCTION public.calculate_child_age_months(birth_date date) OWNER TO postgres;

--
-- Name: calculate_next_payment_due(); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.calculate_next_payment_due() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'public'
    AS $$
BEGIN
  IF NEW.rental_type = 'monthly' THEN
    NEW.next_payment_due := NEW.start_date + INTERVAL '1 month';
  ELSIF NEW.rental_type = 'quarterly' THEN
    NEW.next_payment_due := NEW.start_date + INTERVAL '3 months';
  ELSIF NEW.rental_type = 'annual' THEN
    NEW.next_payment_due := NEW.start_date + INTERVAL '1 year';
  END IF;
  
  RETURN NEW;
END;
$$;


ALTER FUNCTION public.calculate_next_payment_due() OWNER TO postgres;

--
-- Name: create_class_reminder_notifications(); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.create_class_reminder_notifications() RETURNS void
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'public'
    AS $$
DECLARE
  class_record RECORD;
  booking_record RECORD;
BEGIN
  -- Find classes starting in 2 hours that need reminders
  FOR class_record IN 
    SELECT 
      c.id as class_id,
      c.name as class_name,
      c.scheduled_at,
      c.organization_id,
      l.name as location_name
    FROM classes c
    LEFT JOIN locations l ON c.location_id = l.id
    WHERE c.scheduled_at BETWEEN 
      (now() + INTERVAL '1 hour 45 minutes') AND 
      (now() + INTERVAL '2 hours 15 minutes')
  LOOP
    -- Create notifications for all booked members
    FOR booking_record IN
      SELECT cb.member_id, p.first_name, p.last_name
      FROM class_bookings cb
      JOIN profiles p ON cb.member_id = p.id
      JOIN notification_preferences np ON p.id = np.member_id
      WHERE cb.class_id = class_record.class_id
      AND cb.status = 'booked'
      AND np.class_reminders = true
      AND NOT EXISTS (
        SELECT 1 FROM notifications n 
        WHERE n.member_id = cb.member_id 
        AND n.type = 'class_reminder'
        AND n.metadata->>'class_id' = class_record.class_id::text
      )
    LOOP
      INSERT INTO notifications (
        organization_id,
        member_id,
        type,
        title,
        message,
        metadata,
        scheduled_for
      ) VALUES (
        class_record.organization_id,
        booking_record.member_id,
        'class_reminder',
        'Class Reminder: ' || class_record.class_name,
        'Don''t forget! Your class "' || class_record.class_name || '" starts at ' || 
        to_char(class_record.scheduled_at, 'HH24:MI') || 
        COALESCE(' at ' || class_record.location_name, '') || '. See you there!',
        jsonb_build_object(
          'class_id', class_record.class_id,
          'class_name', class_record.class_name,
          'scheduled_at', class_record.scheduled_at
        ),
        now()
      );
    END LOOP;
  END LOOP;
END;
$$;


ALTER FUNCTION public.create_class_reminder_notifications() OWNER TO postgres;

--
-- Name: create_default_notification_preferences(); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.create_default_notification_preferences() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'public'
    AS $$
BEGIN
  -- Only create for members
  IF NEW.role = 'member' THEN
    INSERT INTO public.notification_preferences (member_id)
    VALUES (NEW.id)
    ON CONFLICT (member_id) DO NOTHING;
  END IF;
  
  RETURN NEW;
END;
$$;


ALTER FUNCTION public.create_default_notification_preferences() OWNER TO postgres;

--
-- Name: create_waitlist_promotion_notification(); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.create_waitlist_promotion_notification() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'public'
    AS $$
DECLARE
  class_info RECORD;
  member_info RECORD;
  org_id UUID;
BEGIN
  -- Only process waitlist promotions
  IF TG_OP = 'UPDATE' AND OLD.status = 'waiting' AND NEW.status = 'promoted' THEN
    -- Get class and member information
    SELECT c.name, c.scheduled_at, c.organization_id, l.name as location_name
    INTO class_info
    FROM classes c
    LEFT JOIN locations l ON c.location_id = l.id
    WHERE c.id = NEW.class_id;
    
    SELECT first_name, last_name, organization_id
    INTO member_info
    FROM profiles
    WHERE id = NEW.member_id;
    
    -- Create promotion notification
    INSERT INTO notifications (
      organization_id,
      member_id,
      type,
      title,
      message,
      priority,
      metadata,
      scheduled_for
    ) VALUES (
      class_info.organization_id,
      NEW.member_id,
      'waitlist_promotion',
      'Great News! You''re Off the Waitlist',
      'A spot opened up in "' || class_info.name || '" on ' || 
      to_char(class_info.scheduled_at, 'Mon, DD FMMonth at HH24:MI') ||
      COALESCE(' at ' || class_info.location_name, '') || 
      '. You''ve been automatically booked!',
      'high',
      jsonb_build_object(
        'class_id', NEW.class_id,
        'class_name', class_info.name,
        'scheduled_at', class_info.scheduled_at,
        'waitlist_id', NEW.id
      ),
      now()
    );
  END IF;
  
  RETURN NEW;
END;
$$;


ALTER FUNCTION public.create_waitlist_promotion_notification() OWNER TO postgres;

--
-- Name: generate_corporate_invoice_number(); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.generate_corporate_invoice_number() RETURNS text
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'public'
    AS $$
DECLARE
  new_number TEXT;
  number_exists BOOLEAN;
BEGIN
  LOOP
    -- Generate invoice number: CORP + YYYYMM + 6 random digits
    new_number := 'CORP' || to_char(CURRENT_DATE, 'YYYYMM') || LPAD(FLOOR(RANDOM() * 1000000)::TEXT, 6, '0');
    
    -- Check if number already exists
    SELECT EXISTS(SELECT 1 FROM public.corporate_invoices WHERE invoice_number = new_number) INTO number_exists;
    
    IF NOT number_exists THEN
      EXIT;
    END IF;
  END LOOP;
  
  RETURN new_number;
END;
$$;


ALTER FUNCTION public.generate_corporate_invoice_number() OWNER TO postgres;

--
-- Name: generate_member_barcode(); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.generate_member_barcode() RETURNS text
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'public'
    AS $$
DECLARE
    new_barcode TEXT;
    barcode_exists BOOLEAN;
BEGIN
    LOOP
        -- Generate 12-digit barcode: 2 digits for gym + 10 random digits
        new_barcode := '01' || LPAD(FLOOR(RANDOM() * 10000000000)::TEXT, 10, '0');
        
        -- Check if barcode already exists
        SELECT EXISTS(SELECT 1 FROM public.profiles WHERE barcode = new_barcode) INTO barcode_exists;
        
        IF NOT barcode_exists THEN
            EXIT;
        END IF;
    END LOOP;
    
    RETURN new_barcode;
END;
$$;


ALTER FUNCTION public.generate_member_barcode() OWNER TO postgres;

--
-- Name: generate_member_card_number(); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.generate_member_card_number() RETURNS text
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
DECLARE
    new_card_number TEXT;
    card_exists BOOLEAN;
BEGIN
    LOOP
        -- Generate 16-digit card number starting with gym prefix
        new_card_number := '4567' || LPAD(FLOOR(RANDOM() * 1000000000000)::TEXT, 12, '0');
        
        -- Check if card number already exists
        SELECT EXISTS(SELECT 1 FROM public.member_cards WHERE card_number = new_card_number) INTO card_exists;
        
        IF NOT card_exists THEN
            EXIT;
        END IF;
    END LOOP;
    
    RETURN new_card_number;
END;
$$;


ALTER FUNCTION public.generate_member_card_number() OWNER TO postgres;

--
-- Name: generate_pos_sale_number(); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.generate_pos_sale_number() RETURNS text
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'public'
    AS $$
DECLARE
  new_number TEXT;
  number_exists BOOLEAN;
BEGIN
  LOOP
    -- Generate sale number: POS + current date + 4 random digits
    new_number := 'POS' || to_char(CURRENT_DATE, 'YYYYMMDD') || LPAD(FLOOR(RANDOM() * 10000)::TEXT, 4, '0');
    
    -- Check if number already exists
    SELECT EXISTS(SELECT 1 FROM public.pos_sales WHERE sale_number = new_number) INTO number_exists;
    
    IF NOT number_exists THEN
      EXIT;
    END IF;
  END LOOP;
  
  RETURN new_number;
END;
$$;


ALTER FUNCTION public.generate_pos_sale_number() OWNER TO postgres;

--
-- Name: generate_referral_code(); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.generate_referral_code() RETURNS text
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'public'
    AS $$
DECLARE
    new_code TEXT;
    code_exists BOOLEAN;
BEGIN
    LOOP
        -- Generate 8-character alphanumeric code
        new_code := upper(substring(md5(random()::text) from 1 for 8));
        
        -- Check if code already exists
        SELECT EXISTS(SELECT 1 FROM public.salesperson_referral_links WHERE referral_code = new_code) INTO code_exists;
        
        IF NOT code_exists THEN
            EXIT;
        END IF;
    END LOOP;
    
    RETURN new_code;
END;
$$;


ALTER FUNCTION public.generate_referral_code() OWNER TO postgres;

--
-- Name: generate_transaction_number(); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.generate_transaction_number() RETURNS text
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'public'
    AS $$
DECLARE
  new_number TEXT;
  number_exists BOOLEAN;
BEGIN
  LOOP
    -- Generate transaction number: current date + 6 random digits
    new_number := to_char(CURRENT_DATE, 'YYYYMMDD') || LPAD(FLOOR(RANDOM() * 1000000)::TEXT, 6, '0');
    
    -- Check if number already exists
    SELECT EXISTS(SELECT 1 FROM public.retail_transactions WHERE transaction_number = new_number) INTO number_exists;
    
    IF NOT number_exists THEN
      EXIT;
    END IF;
  END LOOP;
  
  RETURN new_number;
END;
$$;


ALTER FUNCTION public.generate_transaction_number() OWNER TO postgres;

--
-- Name: get_user_organization_id(uuid); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.get_user_organization_id(user_id uuid) RETURNS uuid
    LANGUAGE sql STABLE SECURITY DEFINER
    SET search_path TO 'public'
    AS $$
  SELECT organization_id FROM public.profiles WHERE id = user_id;
$$;


ALTER FUNCTION public.get_user_organization_id(user_id uuid) OWNER TO postgres;

--
-- Name: handle_cleaning_completion(); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.handle_cleaning_completion() RETURNS trigger
    LANGUAGE plpgsql
    SET search_path TO 'public'
    AS $$
BEGIN
  -- When cleaning is completed, move towels from cleaning back to available
  IF TG_OP = 'UPDATE' AND OLD.cleaning_status != 'completed' AND NEW.cleaning_status = 'completed' AND NEW.quality_check_passed = true THEN
    UPDATE public.towel_inventory 
    SET 
      in_cleaning = GREATEST(in_cleaning - NEW.quantity_cleaned, 0),
      available_quantity = available_quantity + NEW.quantity_cleaned,
      updated_at = now()
    WHERE id = NEW.towel_inventory_id;
  END IF;
  
  RETURN NEW;
END;
$$;


ALTER FUNCTION public.handle_cleaning_completion() OWNER TO postgres;

--
-- Name: handle_member_barcode_generation(); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.handle_member_barcode_generation() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'public'
    AS $$
BEGIN
    -- Only generate barcode for members without one
    IF NEW.role = 'member' AND (NEW.barcode IS NULL OR NEW.barcode = '') THEN
        NEW.barcode := public.generate_member_barcode();
        NEW.barcode_generated_at := now();
    END IF;
    
    RETURN NEW;
END;
$$;


ALTER FUNCTION public.handle_member_barcode_generation() OWNER TO postgres;

--
-- Name: handle_new_user(); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.handle_new_user() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'public'
    AS $$
BEGIN
  -- This will be called after user signs up via auth
  -- The organization_id will need to be set via a separate process
  RETURN NEW;
END;
$$;


ALTER FUNCTION public.handle_new_user() OWNER TO postgres;

--
-- Name: promote_from_waitlist(); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.promote_from_waitlist() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'public'
    AS $$
DECLARE
  next_member_id UUID;
  class_capacity INTEGER;
  current_bookings INTEGER;
BEGIN
  -- Only process when a booking is cancelled
  IF TG_OP = 'UPDATE' AND OLD.status = 'booked' AND NEW.status = 'cancelled' THEN
    -- Check if there are people on the waitlist for this class
    SELECT member_id INTO next_member_id
    FROM class_waitlists 
    WHERE class_id = NEW.class_id 
    AND status = 'waiting'
    ORDER BY priority_order ASC, joined_at ASC
    LIMIT 1;
    
    IF next_member_id IS NOT NULL THEN
      -- Get class capacity and current bookings
      SELECT max_capacity INTO class_capacity
      FROM classes 
      WHERE id = NEW.class_id;
      
      SELECT COUNT(*) INTO current_bookings
      FROM class_bookings 
      WHERE class_id = NEW.class_id 
      AND status = 'booked';
      
      -- If there's space, promote the first person from waitlist
      IF current_bookings < class_capacity THEN
        -- Create booking for waitlisted member
        INSERT INTO class_bookings (class_id, member_id, status, booked_at)
        VALUES (NEW.class_id, next_member_id, 'booked', now());
        
        -- Update waitlist status
        UPDATE class_waitlists 
        SET status = 'promoted', notified_at = now()
        WHERE class_id = NEW.class_id 
        AND member_id = next_member_id;
      END IF;
    END IF;
  END IF;
  
  RETURN NEW;
END;
$$;


ALTER FUNCTION public.promote_from_waitlist() OWNER TO postgres;

--
-- Name: recalculate_lead_scores(uuid); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.recalculate_lead_scores(org_id uuid) RETURNS void
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'public'
    AS $$
BEGIN
  -- Reset all lead scores for the organization
  UPDATE public.leads 
  SET lead_score = 0, qualification_status = 'unqualified'
  WHERE organization_id = org_id;
  
  -- This is a placeholder for the actual scoring logic
  -- In a real implementation, you would loop through scoring rules
  -- and apply them to calculate scores for each lead
  
  -- Update qualification status based on score ranges
  UPDATE public.leads 
  SET qualification_status = CASE 
    WHEN lead_score >= 80 THEN 'qualified'
    WHEN lead_score >= 60 THEN 'hot'
    WHEN lead_score >= 40 THEN 'warm'
    WHEN lead_score >= 20 THEN 'cold'
    ELSE 'unqualified'
  END
  WHERE organization_id = org_id;
END;
$$;


ALTER FUNCTION public.recalculate_lead_scores(org_id uuid) OWNER TO postgres;

--
-- Name: schedule_next_inspection(); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.schedule_next_inspection() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'public'
    AS $$
DECLARE
  checklist_frequency INTEGER;
BEGIN
  -- Only schedule when inspection is completed
  IF NEW.completed_at IS NOT NULL AND (OLD.completed_at IS NULL OR OLD.completed_at != NEW.completed_at) THEN
    -- Get checklist frequency
    SELECT frequency_days INTO checklist_frequency
    FROM inspection_checklists 
    WHERE id = NEW.checklist_id;
    
    -- Calculate and set next inspection date
    NEW.next_inspection_date := NEW.completed_at::date + (checklist_frequency || ' days')::interval;
    
    -- Update equipment's next inspection date
    UPDATE equipment 
    SET next_maintenance_date = NEW.next_inspection_date
    WHERE id = NEW.equipment_id;
  END IF;
  
  RETURN NEW;
END;
$$;


ALTER FUNCTION public.schedule_next_inspection() OWNER TO postgres;

--
-- Name: set_corporate_invoice_number(); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.set_corporate_invoice_number() RETURNS trigger
    LANGUAGE plpgsql
    SET search_path TO 'public'
    AS $$
BEGIN
  IF NEW.invoice_number IS NULL OR NEW.invoice_number = '' THEN
    NEW.invoice_number := public.generate_corporate_invoice_number();
  END IF;
  RETURN NEW;
END;
$$;


ALTER FUNCTION public.set_corporate_invoice_number() OWNER TO postgres;

--
-- Name: set_pos_sale_number(); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.set_pos_sale_number() RETURNS trigger
    LANGUAGE plpgsql
    SET search_path TO 'public'
    AS $$
BEGIN
  IF NEW.sale_number IS NULL OR NEW.sale_number = '' THEN
    NEW.sale_number := public.generate_pos_sale_number();
  END IF;
  RETURN NEW;
END;
$$;


ALTER FUNCTION public.set_pos_sale_number() OWNER TO postgres;

--
-- Name: set_transaction_number(); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.set_transaction_number() RETURNS trigger
    LANGUAGE plpgsql
    SET search_path TO 'public'
    AS $$
BEGIN
  IF NEW.transaction_number IS NULL OR NEW.transaction_number = '' THEN
    NEW.transaction_number := public.generate_transaction_number();
  END IF;
  RETURN NEW;
END;
$$;


ALTER FUNCTION public.set_transaction_number() OWNER TO postgres;

--
-- Name: setup_default_lead_stages(uuid); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.setup_default_lead_stages(org_id uuid) RETURNS void
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'public'
    AS $$
BEGIN
  -- Only create stages if none exist for the organization
  IF NOT EXISTS (SELECT 1 FROM lead_stages WHERE organization_id = org_id) THEN
    INSERT INTO lead_stages (name, organization_id, order_index, color, description, is_closed) VALUES
      ('New Lead', org_id, 1, '#3b82f6', 'Initial contact made', false),
      ('Qualified', org_id, 2, '#8b5cf6', 'Lead shows genuine interest', false),
      ('Tour Scheduled', org_id, 3, '#f59e0b', 'Facility tour booked', false),
      ('Tour Completed', org_id, 4, '#10b981', 'Completed facility tour', false),
      ('Proposal Sent', org_id, 5, '#f97316', 'Membership proposal provided', false),
      ('Negotiating', org_id, 6, '#ef4444', 'Discussing terms and pricing', false),
      ('Closed Won', org_id, 7, '#22c55e', 'Converted to member', true),
      ('Closed Lost', org_id, 8, '#6b7280', 'Lead did not convert', true);
  END IF;
END;
$$;


ALTER FUNCTION public.setup_default_lead_stages(org_id uuid) OWNER TO postgres;

--
-- Name: trigger_setup_lead_stages(); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.trigger_setup_lead_stages() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'public'
    AS $$
BEGIN
  -- Set up default lead stages for the user's organization
  IF NEW.organization_id IS NOT NULL THEN
    PERFORM setup_default_lead_stages(NEW.organization_id);
  END IF;
  RETURN NEW;
END;
$$;


ALTER FUNCTION public.trigger_setup_lead_stages() OWNER TO postgres;

--
-- Name: update_ai_automation_updated_at(); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.update_ai_automation_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    SET search_path TO 'public'
    AS $$
BEGIN
  NEW.updated_at = now();
  RETURN NEW;
END;
$$;


ALTER FUNCTION public.update_ai_automation_updated_at() OWNER TO postgres;

--
-- Name: update_corporate_member_allocation(); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.update_corporate_member_allocation() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'public'
    AS $$
BEGIN
  -- Update used allocation count when members are added/removed/changed
  IF TG_OP = 'INSERT' AND NEW.is_active = true THEN
    UPDATE public.corporate_accounts 
    SET used_member_allocation = used_member_allocation + 1
    WHERE id = NEW.corporate_account_id;
  ELSIF TG_OP = 'UPDATE' THEN
    -- Member became active
    IF OLD.is_active = false AND NEW.is_active = true THEN
      UPDATE public.corporate_accounts 
      SET used_member_allocation = used_member_allocation + 1
      WHERE id = NEW.corporate_account_id;
    -- Member became inactive
    ELSIF OLD.is_active = true AND NEW.is_active = false THEN
      UPDATE public.corporate_accounts 
      SET used_member_allocation = GREATEST(used_member_allocation - 1, 0)
      WHERE id = NEW.corporate_account_id;
    END IF;
  ELSIF TG_OP = 'DELETE' AND OLD.is_active = true THEN
    UPDATE public.corporate_accounts 
    SET used_member_allocation = GREATEST(used_member_allocation - 1, 0)
    WHERE id = OLD.corporate_account_id;
  END IF;
  
  RETURN COALESCE(NEW, OLD);
END;
$$;


ALTER FUNCTION public.update_corporate_member_allocation() OWNER TO postgres;

--
-- Name: update_equipment_maintenance_schedule(); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.update_equipment_maintenance_schedule() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'public'
    AS $$
BEGIN
  -- Update equipment's last maintenance date and calculate next maintenance date
  UPDATE public.equipment 
  SET 
    last_maintenance_date = NEW.maintenance_date::date,
    next_maintenance_date = (NEW.maintenance_date::date + INTERVAL '1 day' * COALESCE(maintenance_interval_days, 90))
  WHERE id = NEW.equipment_id;
  
  RETURN NEW;
END;
$$;


ALTER FUNCTION public.update_equipment_maintenance_schedule() OWNER TO postgres;

--
-- Name: update_inspection_statistics(); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.update_inspection_statistics() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'public'
    AS $$
BEGIN
  -- Update inspection totals based on results
  UPDATE public.safety_inspections 
  SET 
    total_items = (
      SELECT COUNT(*) FROM inspection_results 
      WHERE inspection_id = NEW.inspection_id
    ),
    passed_items = (
      SELECT COUNT(*) FROM inspection_results 
      WHERE inspection_id = NEW.inspection_id AND result_status = 'pass'
    ),
    failed_items = (
      SELECT COUNT(*) FROM inspection_results 
      WHERE inspection_id = NEW.inspection_id AND result_status IN ('fail', 'needs_repair')
    ),
    critical_failures = (
      SELECT COUNT(*) FROM inspection_results ir
      JOIN inspection_checklist_items ici ON ir.checklist_item_id = ici.id
      WHERE ir.inspection_id = NEW.inspection_id 
      AND ir.result_status IN ('fail', 'needs_repair')
      AND ici.is_critical = true
    )
  WHERE id = NEW.inspection_id;
  
  -- Update overall status
  UPDATE public.safety_inspections 
  SET overall_status = CASE
    WHEN critical_failures > 0 THEN 'failed'
    WHEN failed_items > 0 THEN 'needs_attention'
    WHEN total_items > 0 AND passed_items = total_items THEN 'passed'
    ELSE 'pending'
  END
  WHERE id = NEW.inspection_id;
  
  RETURN NEW;
END;
$$;


ALTER FUNCTION public.update_inspection_statistics() OWNER TO postgres;

--
-- Name: update_integration_updated_at(); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.update_integration_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    SET search_path TO 'public'
    AS $$
BEGIN
  NEW.updated_at = now();
  RETURN NEW;
END;
$$;


ALTER FUNCTION public.update_integration_updated_at() OWNER TO postgres;

--
-- Name: update_inventory_on_transaction(); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.update_inventory_on_transaction() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'public'
    AS $$
BEGIN
  -- Update stock when transaction item is inserted (sale)
  IF TG_OP = 'INSERT' THEN
    UPDATE public.inventory_items 
    SET current_stock = current_stock - NEW.quantity
    WHERE product_id = NEW.product_id;
    
    -- Create stock movement record
    INSERT INTO public.stock_movements (
      organization_id,
      inventory_item_id,
      transaction_id,
      movement_type,
      quantity_change,
      performed_by
    )
    SELECT 
      rt.organization_id,
      ii.id,
      NEW.transaction_id,
      'sale',
      -NEW.quantity,
      rt.cashier_id
    FROM retail_transactions rt
    JOIN inventory_items ii ON ii.product_id = NEW.product_id
    WHERE rt.id = NEW.transaction_id;
    
    RETURN NEW;
  END IF;
  
  RETURN NULL;
END;
$$;


ALTER FUNCTION public.update_inventory_on_transaction() OWNER TO postgres;

--
-- Name: update_towel_inventory_quantities(); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.update_towel_inventory_quantities() RETURNS trigger
    LANGUAGE plpgsql
    SET search_path TO 'public'
    AS $$
BEGIN
  -- Update inventory quantities based on rental status changes
  IF TG_OP = 'INSERT' THEN
    -- New rental: decrease available, increase rented
    UPDATE public.towel_inventory 
    SET 
      available_quantity = available_quantity - 1,
      rented_quantity = rented_quantity + 1,
      updated_at = now()
    WHERE id = NEW.towel_inventory_id;
    
  ELSIF TG_OP = 'UPDATE' THEN
    -- Status changed from active to returned
    IF OLD.status = 'active' AND NEW.status = 'returned' THEN
      -- Check if towel needs cleaning or is ready for rent
      IF NEW.towel_condition_in IN ('excellent', 'good') THEN
        UPDATE public.towel_inventory 
        SET 
          available_quantity = available_quantity + 1,
          rented_quantity = rented_quantity - 1,
          updated_at = now()
        WHERE id = NEW.towel_inventory_id;
      ELSE
        -- Towel needs cleaning or is damaged
        UPDATE public.towel_inventory 
        SET 
          rented_quantity = rented_quantity - 1,
          in_cleaning = in_cleaning + 1,
          updated_at = now()
        WHERE id = NEW.towel_inventory_id;
      END IF;
    
    -- Status changed to lost or damaged
    ELSIF OLD.status = 'active' AND NEW.status IN ('lost', 'damaged') THEN
      UPDATE public.towel_inventory 
      SET 
        rented_quantity = rented_quantity - 1,
        damaged_quantity = damaged_quantity + 1,
        updated_at = now()
      WHERE id = NEW.towel_inventory_id;
    END IF;
  END IF;
  
  RETURN COALESCE(NEW, OLD);
END;
$$;


ALTER FUNCTION public.update_towel_inventory_quantities() OWNER TO postgres;

--
-- Name: update_updated_at_column(); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.update_updated_at_column() RETURNS trigger
    LANGUAGE plpgsql
    SET search_path TO 'public'
    AS $$
BEGIN
  NEW.updated_at = now();
  RETURN NEW;
END;
$$;


ALTER FUNCTION public.update_updated_at_column() OWNER TO postgres;

--
-- Name: update_waitlist_priority(); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.update_waitlist_priority() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'public'
    AS $$
BEGIN
  -- Set priority order based on join time
  IF TG_OP = 'INSERT' THEN
    NEW.priority_order := COALESCE(
      (SELECT MAX(priority_order) + 1 FROM class_waitlists WHERE class_id = NEW.class_id),
      1
    );
    RETURN NEW;
  END IF;
  RETURN NULL;
END;
$$;


ALTER FUNCTION public.update_waitlist_priority() OWNER TO postgres;

--
-- Name: apply_rls(jsonb, integer); Type: FUNCTION; Schema: realtime; Owner: supabase_admin
--

CREATE FUNCTION realtime.apply_rls(wal jsonb, max_record_bytes integer DEFAULT (1024 * 1024)) RETURNS SETOF realtime.wal_rls
    LANGUAGE plpgsql
    AS $$
declare
-- Regclass of the table e.g. public.notes
entity_ regclass = (quote_ident(wal ->> 'schema') || '.' || quote_ident(wal ->> 'table'))::regclass;

-- I, U, D, T: insert, update ...
action realtime.action = (
    case wal ->> 'action'
        when 'I' then 'INSERT'
        when 'U' then 'UPDATE'
        when 'D' then 'DELETE'
        else 'ERROR'
    end
);

-- Is row level security enabled for the table
is_rls_enabled bool = relrowsecurity from pg_class where oid = entity_;

subscriptions realtime.subscription[] = array_agg(subs)
    from
        realtime.subscription subs
    where
        subs.entity = entity_;

-- Subscription vars
roles regrole[] = array_agg(distinct us.claims_role::text)
    from
        unnest(subscriptions) us;

working_role regrole;
claimed_role regrole;
claims jsonb;

subscription_id uuid;
subscription_has_access bool;
visible_to_subscription_ids uuid[] = '{}';

-- structured info for wal's columns
columns realtime.wal_column[];
-- previous identity values for update/delete
old_columns realtime.wal_column[];

error_record_exceeds_max_size boolean = octet_length(wal::text) > max_record_bytes;

-- Primary jsonb output for record
output jsonb;

begin
perform set_config('role', null, true);

columns =
    array_agg(
        (
            x->>'name',
            x->>'type',
            x->>'typeoid',
            realtime.cast(
                (x->'value') #>> '{}',
                coalesce(
                    (x->>'typeoid')::regtype, -- null when wal2json version <= 2.4
                    (x->>'type')::regtype
                )
            ),
            (pks ->> 'name') is not null,
            true
        )::realtime.wal_column
    )
    from
        jsonb_array_elements(wal -> 'columns') x
        left join jsonb_array_elements(wal -> 'pk') pks
            on (x ->> 'name') = (pks ->> 'name');

old_columns =
    array_agg(
        (
            x->>'name',
            x->>'type',
            x->>'typeoid',
            realtime.cast(
                (x->'value') #>> '{}',
                coalesce(
                    (x->>'typeoid')::regtype, -- null when wal2json version <= 2.4
                    (x->>'type')::regtype
                )
            ),
            (pks ->> 'name') is not null,
            true
        )::realtime.wal_column
    )
    from
        jsonb_array_elements(wal -> 'identity') x
        left join jsonb_array_elements(wal -> 'pk') pks
            on (x ->> 'name') = (pks ->> 'name');

for working_role in select * from unnest(roles) loop

    -- Update `is_selectable` for columns and old_columns
    columns =
        array_agg(
            (
                c.name,
                c.type_name,
                c.type_oid,
                c.value,
                c.is_pkey,
                pg_catalog.has_column_privilege(working_role, entity_, c.name, 'SELECT')
            )::realtime.wal_column
        )
        from
            unnest(columns) c;

    old_columns =
            array_agg(
                (
                    c.name,
                    c.type_name,
                    c.type_oid,
                    c.value,
                    c.is_pkey,
                    pg_catalog.has_column_privilege(working_role, entity_, c.name, 'SELECT')
                )::realtime.wal_column
            )
            from
                unnest(old_columns) c;

    if action <> 'DELETE' and count(1) = 0 from unnest(columns) c where c.is_pkey then
        return next (
            jsonb_build_object(
                'schema', wal ->> 'schema',
                'table', wal ->> 'table',
                'type', action
            ),
            is_rls_enabled,
            -- subscriptions is already filtered by entity
            (select array_agg(s.subscription_id) from unnest(subscriptions) as s where claims_role = working_role),
            array['Error 400: Bad Request, no primary key']
        )::realtime.wal_rls;

    -- The claims role does not have SELECT permission to the primary key of entity
    elsif action <> 'DELETE' and sum(c.is_selectable::int) <> count(1) from unnest(columns) c where c.is_pkey then
        return next (
            jsonb_build_object(
                'schema', wal ->> 'schema',
                'table', wal ->> 'table',
                'type', action
            ),
            is_rls_enabled,
            (select array_agg(s.subscription_id) from unnest(subscriptions) as s where claims_role = working_role),
            array['Error 401: Unauthorized']
        )::realtime.wal_rls;

    else
        output = jsonb_build_object(
            'schema', wal ->> 'schema',
            'table', wal ->> 'table',
            'type', action,
            'commit_timestamp', to_char(
                ((wal ->> 'timestamp')::timestamptz at time zone 'utc'),
                'YYYY-MM-DD"T"HH24:MI:SS.MS"Z"'
            ),
            'columns', (
                select
                    jsonb_agg(
                        jsonb_build_object(
                            'name', pa.attname,
                            'type', pt.typname
                        )
                        order by pa.attnum asc
                    )
                from
                    pg_attribute pa
                    join pg_type pt
                        on pa.atttypid = pt.oid
                where
                    attrelid = entity_
                    and attnum > 0
                    and pg_catalog.has_column_privilege(working_role, entity_, pa.attname, 'SELECT')
            )
        )
        -- Add "record" key for insert and update
        || case
            when action in ('INSERT', 'UPDATE') then
                jsonb_build_object(
                    'record',
                    (
                        select
                            jsonb_object_agg(
                                -- if unchanged toast, get column name and value from old record
                                coalesce((c).name, (oc).name),
                                case
                                    when (c).name is null then (oc).value
                                    else (c).value
                                end
                            )
                        from
                            unnest(columns) c
                            full outer join unnest(old_columns) oc
                                on (c).name = (oc).name
                        where
                            coalesce((c).is_selectable, (oc).is_selectable)
                            and ( not error_record_exceeds_max_size or (octet_length((c).value::text) <= 64))
                    )
                )
            else '{}'::jsonb
        end
        -- Add "old_record" key for update and delete
        || case
            when action = 'UPDATE' then
                jsonb_build_object(
                        'old_record',
                        (
                            select jsonb_object_agg((c).name, (c).value)
                            from unnest(old_columns) c
                            where
                                (c).is_selectable
                                and ( not error_record_exceeds_max_size or (octet_length((c).value::text) <= 64))
                        )
                    )
            when action = 'DELETE' then
                jsonb_build_object(
                    'old_record',
                    (
                        select jsonb_object_agg((c).name, (c).value)
                        from unnest(old_columns) c
                        where
                            (c).is_selectable
                            and ( not error_record_exceeds_max_size or (octet_length((c).value::text) <= 64))
                            and ( not is_rls_enabled or (c).is_pkey ) -- if RLS enabled, we can't secure deletes so filter to pkey
                    )
                )
            else '{}'::jsonb
        end;

        -- Create the prepared statement
        if is_rls_enabled and action <> 'DELETE' then
            if (select 1 from pg_prepared_statements where name = 'walrus_rls_stmt' limit 1) > 0 then
                deallocate walrus_rls_stmt;
            end if;
            execute realtime.build_prepared_statement_sql('walrus_rls_stmt', entity_, columns);
        end if;

        visible_to_subscription_ids = '{}';

        for subscription_id, claims in (
                select
                    subs.subscription_id,
                    subs.claims
                from
                    unnest(subscriptions) subs
                where
                    subs.entity = entity_
                    and subs.claims_role = working_role
                    and (
                        realtime.is_visible_through_filters(columns, subs.filters)
                        or (
                          action = 'DELETE'
                          and realtime.is_visible_through_filters(old_columns, subs.filters)
                        )
                    )
        ) loop

            if not is_rls_enabled or action = 'DELETE' then
                visible_to_subscription_ids = visible_to_subscription_ids || subscription_id;
            else
                -- Check if RLS allows the role to see the record
                perform
                    -- Trim leading and trailing quotes from working_role because set_config
                    -- doesn't recognize the role as valid if they are included
                    set_config('role', trim(both '"' from working_role::text), true),
                    set_config('request.jwt.claims', claims::text, true);

                execute 'execute walrus_rls_stmt' into subscription_has_access;

                if subscription_has_access then
                    visible_to_subscription_ids = visible_to_subscription_ids || subscription_id;
                end if;
            end if;
        end loop;

        perform set_config('role', null, true);

        return next (
            output,
            is_rls_enabled,
            visible_to_subscription_ids,
            case
                when error_record_exceeds_max_size then array['Error 413: Payload Too Large']
                else '{}'
            end
        )::realtime.wal_rls;

    end if;
end loop;

perform set_config('role', null, true);
end;
$$;


ALTER FUNCTION realtime.apply_rls(wal jsonb, max_record_bytes integer) OWNER TO supabase_admin;

--
-- Name: broadcast_changes(text, text, text, text, text, record, record, text); Type: FUNCTION; Schema: realtime; Owner: supabase_admin
--

CREATE FUNCTION realtime.broadcast_changes(topic_name text, event_name text, operation text, table_name text, table_schema text, new record, old record, level text DEFAULT 'ROW'::text) RETURNS void
    LANGUAGE plpgsql
    AS $$
DECLARE
    -- Declare a variable to hold the JSONB representation of the row
    row_data jsonb := '{}'::jsonb;
BEGIN
    IF level = 'STATEMENT' THEN
        RAISE EXCEPTION 'function can only be triggered for each row, not for each statement';
    END IF;
    -- Check the operation type and handle accordingly
    IF operation = 'INSERT' OR operation = 'UPDATE' OR operation = 'DELETE' THEN
        row_data := jsonb_build_object('old_record', OLD, 'record', NEW, 'operation', operation, 'table', table_name, 'schema', table_schema);
        PERFORM realtime.send (row_data, event_name, topic_name);
    ELSE
        RAISE EXCEPTION 'Unexpected operation type: %', operation;
    END IF;
EXCEPTION
    WHEN OTHERS THEN
        RAISE EXCEPTION 'Failed to process the row: %', SQLERRM;
END;

$$;


ALTER FUNCTION realtime.broadcast_changes(topic_name text, event_name text, operation text, table_name text, table_schema text, new record, old record, level text) OWNER TO supabase_admin;

--
-- Name: build_prepared_statement_sql(text, regclass, realtime.wal_column[]); Type: FUNCTION; Schema: realtime; Owner: supabase_admin
--

CREATE FUNCTION realtime.build_prepared_statement_sql(prepared_statement_name text, entity regclass, columns realtime.wal_column[]) RETURNS text
    LANGUAGE sql
    AS $$
      /*
      Builds a sql string that, if executed, creates a prepared statement to
      tests retrive a row from *entity* by its primary key columns.
      Example
          select realtime.build_prepared_statement_sql('public.notes', '{"id"}'::text[], '{"bigint"}'::text[])
      */
          select
      'prepare ' || prepared_statement_name || ' as
          select
              exists(
                  select
                      1
                  from
                      ' || entity || '
                  where
                      ' || string_agg(quote_ident(pkc.name) || '=' || quote_nullable(pkc.value #>> '{}') , ' and ') || '
              )'
          from
              unnest(columns) pkc
          where
              pkc.is_pkey
          group by
              entity
      $$;


ALTER FUNCTION realtime.build_prepared_statement_sql(prepared_statement_name text, entity regclass, columns realtime.wal_column[]) OWNER TO supabase_admin;

--
-- Name: cast(text, regtype); Type: FUNCTION; Schema: realtime; Owner: supabase_admin
--

CREATE FUNCTION realtime."cast"(val text, type_ regtype) RETURNS jsonb
    LANGUAGE plpgsql IMMUTABLE
    AS $$
    declare
      res jsonb;
    begin
      execute format('select to_jsonb(%L::'|| type_::text || ')', val)  into res;
      return res;
    end
    $$;


ALTER FUNCTION realtime."cast"(val text, type_ regtype) OWNER TO supabase_admin;

--
-- Name: check_equality_op(realtime.equality_op, regtype, text, text); Type: FUNCTION; Schema: realtime; Owner: supabase_admin
--

CREATE FUNCTION realtime.check_equality_op(op realtime.equality_op, type_ regtype, val_1 text, val_2 text) RETURNS boolean
    LANGUAGE plpgsql IMMUTABLE
    AS $$
      /*
      Casts *val_1* and *val_2* as type *type_* and check the *op* condition for truthiness
      */
      declare
          op_symbol text = (
              case
                  when op = 'eq' then '='
                  when op = 'neq' then '!='
                  when op = 'lt' then '<'
                  when op = 'lte' then '<='
                  when op = 'gt' then '>'
                  when op = 'gte' then '>='
                  when op = 'in' then '= any'
                  else 'UNKNOWN OP'
              end
          );
          res boolean;
      begin
          execute format(
              'select %L::'|| type_::text || ' ' || op_symbol
              || ' ( %L::'
              || (
                  case
                      when op = 'in' then type_::text || '[]'
                      else type_::text end
              )
              || ')', val_1, val_2) into res;
          return res;
      end;
      $$;


ALTER FUNCTION realtime.check_equality_op(op realtime.equality_op, type_ regtype, val_1 text, val_2 text) OWNER TO supabase_admin;

--
-- Name: is_visible_through_filters(realtime.wal_column[], realtime.user_defined_filter[]); Type: FUNCTION; Schema: realtime; Owner: supabase_admin
--

CREATE FUNCTION realtime.is_visible_through_filters(columns realtime.wal_column[], filters realtime.user_defined_filter[]) RETURNS boolean
    LANGUAGE sql IMMUTABLE
    AS $_$
    /*
    Should the record be visible (true) or filtered out (false) after *filters* are applied
    */
        select
            -- Default to allowed when no filters present
            $2 is null -- no filters. this should not happen because subscriptions has a default
            or array_length($2, 1) is null -- array length of an empty array is null
            or bool_and(
                coalesce(
                    realtime.check_equality_op(
                        op:=f.op,
                        type_:=coalesce(
                            col.type_oid::regtype, -- null when wal2json version <= 2.4
                            col.type_name::regtype
                        ),
                        -- cast jsonb to text
                        val_1:=col.value #>> '{}',
                        val_2:=f.value
                    ),
                    false -- if null, filter does not match
                )
            )
        from
            unnest(filters) f
            join unnest(columns) col
                on f.column_name = col.name;
    $_$;


ALTER FUNCTION realtime.is_visible_through_filters(columns realtime.wal_column[], filters realtime.user_defined_filter[]) OWNER TO supabase_admin;

--
-- Name: list_changes(name, name, integer, integer); Type: FUNCTION; Schema: realtime; Owner: supabase_admin
--

CREATE FUNCTION realtime.list_changes(publication name, slot_name name, max_changes integer, max_record_bytes integer) RETURNS SETOF realtime.wal_rls
    LANGUAGE sql
    SET log_min_messages TO 'fatal'
    AS $$
      with pub as (
        select
          concat_ws(
            ',',
            case when bool_or(pubinsert) then 'insert' else null end,
            case when bool_or(pubupdate) then 'update' else null end,
            case when bool_or(pubdelete) then 'delete' else null end
          ) as w2j_actions,
          coalesce(
            string_agg(
              realtime.quote_wal2json(format('%I.%I', schemaname, tablename)::regclass),
              ','
            ) filter (where ppt.tablename is not null and ppt.tablename not like '% %'),
            ''
          ) w2j_add_tables
        from
          pg_publication pp
          left join pg_publication_tables ppt
            on pp.pubname = ppt.pubname
        where
          pp.pubname = publication
        group by
          pp.pubname
        limit 1
      ),
      w2j as (
        select
          x.*, pub.w2j_add_tables
        from
          pub,
          pg_logical_slot_get_changes(
            slot_name, null, max_changes,
            'include-pk', 'true',
            'include-transaction', 'false',
            'include-timestamp', 'true',
            'include-type-oids', 'true',
            'format-version', '2',
            'actions', pub.w2j_actions,
            'add-tables', pub.w2j_add_tables
          ) x
      )
      select
        xyz.wal,
        xyz.is_rls_enabled,
        xyz.subscription_ids,
        xyz.errors
      from
        w2j,
        realtime.apply_rls(
          wal := w2j.data::jsonb,
          max_record_bytes := max_record_bytes
        ) xyz(wal, is_rls_enabled, subscription_ids, errors)
      where
        w2j.w2j_add_tables <> ''
        and xyz.subscription_ids[1] is not null
    $$;


ALTER FUNCTION realtime.list_changes(publication name, slot_name name, max_changes integer, max_record_bytes integer) OWNER TO supabase_admin;

--
-- Name: quote_wal2json(regclass); Type: FUNCTION; Schema: realtime; Owner: supabase_admin
--

CREATE FUNCTION realtime.quote_wal2json(entity regclass) RETURNS text
    LANGUAGE sql IMMUTABLE STRICT
    AS $$
      select
        (
          select string_agg('' || ch,'')
          from unnest(string_to_array(nsp.nspname::text, null)) with ordinality x(ch, idx)
          where
            not (x.idx = 1 and x.ch = '"')
            and not (
              x.idx = array_length(string_to_array(nsp.nspname::text, null), 1)
              and x.ch = '"'
            )
        )
        || '.'
        || (
          select string_agg('' || ch,'')
          from unnest(string_to_array(pc.relname::text, null)) with ordinality x(ch, idx)
          where
            not (x.idx = 1 and x.ch = '"')
            and not (
              x.idx = array_length(string_to_array(nsp.nspname::text, null), 1)
              and x.ch = '"'
            )
          )
      from
        pg_class pc
        join pg_namespace nsp
          on pc.relnamespace = nsp.oid
      where
        pc.oid = entity
    $$;


ALTER FUNCTION realtime.quote_wal2json(entity regclass) OWNER TO supabase_admin;

--
-- Name: send(jsonb, text, text, boolean); Type: FUNCTION; Schema: realtime; Owner: supabase_admin
--

CREATE FUNCTION realtime.send(payload jsonb, event text, topic text, private boolean DEFAULT true) RETURNS void
    LANGUAGE plpgsql
    AS $$
DECLARE
  generated_id uuid;
  final_payload jsonb;
BEGIN
  BEGIN
    -- Generate a new UUID for the id
    generated_id := gen_random_uuid();

    -- Check if payload has an 'id' key, if not, add the generated UUID
    IF payload ? 'id' THEN
      final_payload := payload;
    ELSE
      final_payload := jsonb_set(payload, '{id}', to_jsonb(generated_id));
    END IF;

    -- Set the topic configuration
    EXECUTE format('SET LOCAL realtime.topic TO %L', topic);

    -- Attempt to insert the message
    INSERT INTO realtime.messages (id, payload, event, topic, private, extension)
    VALUES (generated_id, final_payload, event, topic, private, 'broadcast');
  EXCEPTION
    WHEN OTHERS THEN
      -- Capture and notify the error
      RAISE WARNING 'ErrorSendingBroadcastMessage: %', SQLERRM;
  END;
END;
$$;


ALTER FUNCTION realtime.send(payload jsonb, event text, topic text, private boolean) OWNER TO supabase_admin;

--
-- Name: subscription_check_filters(); Type: FUNCTION; Schema: realtime; Owner: supabase_admin
--

CREATE FUNCTION realtime.subscription_check_filters() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
    /*
    Validates that the user defined filters for a subscription:
    - refer to valid columns that the claimed role may access
    - values are coercable to the correct column type
    */
    declare
        col_names text[] = coalesce(
                array_agg(c.column_name order by c.ordinal_position),
                '{}'::text[]
            )
            from
                information_schema.columns c
            where
                format('%I.%I', c.table_schema, c.table_name)::regclass = new.entity
                and pg_catalog.has_column_privilege(
                    (new.claims ->> 'role'),
                    format('%I.%I', c.table_schema, c.table_name)::regclass,
                    c.column_name,
                    'SELECT'
                );
        filter realtime.user_defined_filter;
        col_type regtype;

        in_val jsonb;
    begin
        for filter in select * from unnest(new.filters) loop
            -- Filtered column is valid
            if not filter.column_name = any(col_names) then
                raise exception 'invalid column for filter %', filter.column_name;
            end if;

            -- Type is sanitized and safe for string interpolation
            col_type = (
                select atttypid::regtype
                from pg_catalog.pg_attribute
                where attrelid = new.entity
                      and attname = filter.column_name
            );
            if col_type is null then
                raise exception 'failed to lookup type for column %', filter.column_name;
            end if;

            -- Set maximum number of entries for in filter
            if filter.op = 'in'::realtime.equality_op then
                in_val = realtime.cast(filter.value, (col_type::text || '[]')::regtype);
                if coalesce(jsonb_array_length(in_val), 0) > 100 then
                    raise exception 'too many values for `in` filter. Maximum 100';
                end if;
            else
                -- raises an exception if value is not coercable to type
                perform realtime.cast(filter.value, col_type);
            end if;

        end loop;

        -- Apply consistent order to filters so the unique constraint on
        -- (subscription_id, entity, filters) can't be tricked by a different filter order
        new.filters = coalesce(
            array_agg(f order by f.column_name, f.op, f.value),
            '{}'
        ) from unnest(new.filters) f;

        return new;
    end;
    $$;


ALTER FUNCTION realtime.subscription_check_filters() OWNER TO supabase_admin;

--
-- Name: to_regrole(text); Type: FUNCTION; Schema: realtime; Owner: supabase_admin
--

CREATE FUNCTION realtime.to_regrole(role_name text) RETURNS regrole
    LANGUAGE sql IMMUTABLE
    AS $$ select role_name::regrole $$;


ALTER FUNCTION realtime.to_regrole(role_name text) OWNER TO supabase_admin;

--
-- Name: topic(); Type: FUNCTION; Schema: realtime; Owner: supabase_realtime_admin
--

CREATE FUNCTION realtime.topic() RETURNS text
    LANGUAGE sql STABLE
    AS $$
select nullif(current_setting('realtime.topic', true), '')::text;
$$;


ALTER FUNCTION realtime.topic() OWNER TO supabase_realtime_admin;

--
-- Name: add_prefixes(text, text); Type: FUNCTION; Schema: storage; Owner: supabase_storage_admin
--

CREATE FUNCTION storage.add_prefixes(_bucket_id text, _name text) RETURNS void
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
DECLARE
    prefixes text[];
BEGIN
    prefixes := "storage"."get_prefixes"("_name");

    IF array_length(prefixes, 1) > 0 THEN
        INSERT INTO storage.prefixes (name, bucket_id)
        SELECT UNNEST(prefixes) as name, "_bucket_id" ON CONFLICT DO NOTHING;
    END IF;
END;
$$;


ALTER FUNCTION storage.add_prefixes(_bucket_id text, _name text) OWNER TO supabase_storage_admin;

--
-- Name: can_insert_object(text, text, uuid, jsonb); Type: FUNCTION; Schema: storage; Owner: supabase_storage_admin
--

CREATE FUNCTION storage.can_insert_object(bucketid text, name text, owner uuid, metadata jsonb) RETURNS void
    LANGUAGE plpgsql
    AS $$
BEGIN
  INSERT INTO "storage"."objects" ("bucket_id", "name", "owner", "metadata") VALUES (bucketid, name, owner, metadata);
  -- hack to rollback the successful insert
  RAISE sqlstate 'PT200' using
  message = 'ROLLBACK',
  detail = 'rollback successful insert';
END
$$;


ALTER FUNCTION storage.can_insert_object(bucketid text, name text, owner uuid, metadata jsonb) OWNER TO supabase_storage_admin;

--
-- Name: delete_leaf_prefixes(text[], text[]); Type: FUNCTION; Schema: storage; Owner: supabase_storage_admin
--

CREATE FUNCTION storage.delete_leaf_prefixes(bucket_ids text[], names text[]) RETURNS void
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
DECLARE
    v_rows_deleted integer;
BEGIN
    LOOP
        WITH candidates AS (
            SELECT DISTINCT
                t.bucket_id,
                unnest(storage.get_prefixes(t.name)) AS name
            FROM unnest(bucket_ids, names) AS t(bucket_id, name)
        ),
        uniq AS (
             SELECT
                 bucket_id,
                 name,
                 storage.get_level(name) AS level
             FROM candidates
             WHERE name <> ''
             GROUP BY bucket_id, name
        ),
        leaf AS (
             SELECT
                 p.bucket_id,
                 p.name,
                 p.level
             FROM storage.prefixes AS p
                  JOIN uniq AS u
                       ON u.bucket_id = p.bucket_id
                           AND u.name = p.name
                           AND u.level = p.level
             WHERE NOT EXISTS (
                 SELECT 1
                 FROM storage.objects AS o
                 WHERE o.bucket_id = p.bucket_id
                   AND o.level = p.level + 1
                   AND o.name COLLATE "C" LIKE p.name || '/%'
             )
             AND NOT EXISTS (
                 SELECT 1
                 FROM storage.prefixes AS c
                 WHERE c.bucket_id = p.bucket_id
                   AND c.level = p.level + 1
                   AND c.name COLLATE "C" LIKE p.name || '/%'
             )
        )
        DELETE
        FROM storage.prefixes AS p
            USING leaf AS l
        WHERE p.bucket_id = l.bucket_id
          AND p.name = l.name
          AND p.level = l.level;

        GET DIAGNOSTICS v_rows_deleted = ROW_COUNT;
        EXIT WHEN v_rows_deleted = 0;
    END LOOP;
END;
$$;


ALTER FUNCTION storage.delete_leaf_prefixes(bucket_ids text[], names text[]) OWNER TO supabase_storage_admin;

--
-- Name: delete_prefix(text, text); Type: FUNCTION; Schema: storage; Owner: supabase_storage_admin
--

CREATE FUNCTION storage.delete_prefix(_bucket_id text, _name text) RETURNS boolean
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
BEGIN
    -- Check if we can delete the prefix
    IF EXISTS(
        SELECT FROM "storage"."prefixes"
        WHERE "prefixes"."bucket_id" = "_bucket_id"
          AND level = "storage"."get_level"("_name") + 1
          AND "prefixes"."name" COLLATE "C" LIKE "_name" || '/%'
        LIMIT 1
    )
    OR EXISTS(
        SELECT FROM "storage"."objects"
        WHERE "objects"."bucket_id" = "_bucket_id"
          AND "storage"."get_level"("objects"."name") = "storage"."get_level"("_name") + 1
          AND "objects"."name" COLLATE "C" LIKE "_name" || '/%'
        LIMIT 1
    ) THEN
    -- There are sub-objects, skip deletion
    RETURN false;
    ELSE
        DELETE FROM "storage"."prefixes"
        WHERE "prefixes"."bucket_id" = "_bucket_id"
          AND level = "storage"."get_level"("_name")
          AND "prefixes"."name" = "_name";
        RETURN true;
    END IF;
END;
$$;


ALTER FUNCTION storage.delete_prefix(_bucket_id text, _name text) OWNER TO supabase_storage_admin;

--
-- Name: delete_prefix_hierarchy_trigger(); Type: FUNCTION; Schema: storage; Owner: supabase_storage_admin
--

CREATE FUNCTION storage.delete_prefix_hierarchy_trigger() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
DECLARE
    prefix text;
BEGIN
    prefix := "storage"."get_prefix"(OLD."name");

    IF coalesce(prefix, '') != '' THEN
        PERFORM "storage"."delete_prefix"(OLD."bucket_id", prefix);
    END IF;

    RETURN OLD;
END;
$$;


ALTER FUNCTION storage.delete_prefix_hierarchy_trigger() OWNER TO supabase_storage_admin;

--
-- Name: enforce_bucket_name_length(); Type: FUNCTION; Schema: storage; Owner: supabase_storage_admin
--

CREATE FUNCTION storage.enforce_bucket_name_length() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
begin
    if length(new.name) > 100 then
        raise exception 'bucket name "%" is too long (% characters). Max is 100.', new.name, length(new.name);
    end if;
    return new;
end;
$$;


ALTER FUNCTION storage.enforce_bucket_name_length() OWNER TO supabase_storage_admin;

--
-- Name: extension(text); Type: FUNCTION; Schema: storage; Owner: supabase_storage_admin
--

CREATE FUNCTION storage.extension(name text) RETURNS text
    LANGUAGE plpgsql IMMUTABLE
    AS $$
DECLARE
    _parts text[];
    _filename text;
BEGIN
    SELECT string_to_array(name, '/') INTO _parts;
    SELECT _parts[array_length(_parts,1)] INTO _filename;
    RETURN reverse(split_part(reverse(_filename), '.', 1));
END
$$;


ALTER FUNCTION storage.extension(name text) OWNER TO supabase_storage_admin;

--
-- Name: filename(text); Type: FUNCTION; Schema: storage; Owner: supabase_storage_admin
--

CREATE FUNCTION storage.filename(name text) RETURNS text
    LANGUAGE plpgsql
    AS $$
DECLARE
_parts text[];
BEGIN
	select string_to_array(name, '/') into _parts;
	return _parts[array_length(_parts,1)];
END
$$;


ALTER FUNCTION storage.filename(name text) OWNER TO supabase_storage_admin;

--
-- Name: foldername(text); Type: FUNCTION; Schema: storage; Owner: supabase_storage_admin
--

CREATE FUNCTION storage.foldername(name text) RETURNS text[]
    LANGUAGE plpgsql IMMUTABLE
    AS $$
DECLARE
    _parts text[];
BEGIN
    -- Split on "/" to get path segments
    SELECT string_to_array(name, '/') INTO _parts;
    -- Return everything except the last segment
    RETURN _parts[1 : array_length(_parts,1) - 1];
END
$$;


ALTER FUNCTION storage.foldername(name text) OWNER TO supabase_storage_admin;

--
-- Name: get_level(text); Type: FUNCTION; Schema: storage; Owner: supabase_storage_admin
--

CREATE FUNCTION storage.get_level(name text) RETURNS integer
    LANGUAGE sql IMMUTABLE STRICT
    AS $$
SELECT array_length(string_to_array("name", '/'), 1);
$$;


ALTER FUNCTION storage.get_level(name text) OWNER TO supabase_storage_admin;

--
-- Name: get_prefix(text); Type: FUNCTION; Schema: storage; Owner: supabase_storage_admin
--

CREATE FUNCTION storage.get_prefix(name text) RETURNS text
    LANGUAGE sql IMMUTABLE STRICT
    AS $_$
SELECT
    CASE WHEN strpos("name", '/') > 0 THEN
             regexp_replace("name", '[\/]{1}[^\/]+\/?$', '')
         ELSE
             ''
        END;
$_$;


ALTER FUNCTION storage.get_prefix(name text) OWNER TO supabase_storage_admin;

--
-- Name: get_prefixes(text); Type: FUNCTION; Schema: storage; Owner: supabase_storage_admin
--

CREATE FUNCTION storage.get_prefixes(name text) RETURNS text[]
    LANGUAGE plpgsql IMMUTABLE STRICT
    AS $$
DECLARE
    parts text[];
    prefixes text[];
    prefix text;
BEGIN
    -- Split the name into parts by '/'
    parts := string_to_array("name", '/');
    prefixes := '{}';

    -- Construct the prefixes, stopping one level below the last part
    FOR i IN 1..array_length(parts, 1) - 1 LOOP
            prefix := array_to_string(parts[1:i], '/');
            prefixes := array_append(prefixes, prefix);
    END LOOP;

    RETURN prefixes;
END;
$$;


ALTER FUNCTION storage.get_prefixes(name text) OWNER TO supabase_storage_admin;

--
-- Name: get_size_by_bucket(); Type: FUNCTION; Schema: storage; Owner: supabase_storage_admin
--

CREATE FUNCTION storage.get_size_by_bucket() RETURNS TABLE(size bigint, bucket_id text)
    LANGUAGE plpgsql STABLE
    AS $$
BEGIN
    return query
        select sum((metadata->>'size')::bigint) as size, obj.bucket_id
        from "storage".objects as obj
        group by obj.bucket_id;
END
$$;


ALTER FUNCTION storage.get_size_by_bucket() OWNER TO supabase_storage_admin;

--
-- Name: list_multipart_uploads_with_delimiter(text, text, text, integer, text, text); Type: FUNCTION; Schema: storage; Owner: supabase_storage_admin
--

CREATE FUNCTION storage.list_multipart_uploads_with_delimiter(bucket_id text, prefix_param text, delimiter_param text, max_keys integer DEFAULT 100, next_key_token text DEFAULT ''::text, next_upload_token text DEFAULT ''::text) RETURNS TABLE(key text, id text, created_at timestamp with time zone)
    LANGUAGE plpgsql
    AS $_$
BEGIN
    RETURN QUERY EXECUTE
        'SELECT DISTINCT ON(key COLLATE "C") * from (
            SELECT
                CASE
                    WHEN position($2 IN substring(key from length($1) + 1)) > 0 THEN
                        substring(key from 1 for length($1) + position($2 IN substring(key from length($1) + 1)))
                    ELSE
                        key
                END AS key, id, created_at
            FROM
                storage.s3_multipart_uploads
            WHERE
                bucket_id = $5 AND
                key ILIKE $1 || ''%'' AND
                CASE
                    WHEN $4 != '''' AND $6 = '''' THEN
                        CASE
                            WHEN position($2 IN substring(key from length($1) + 1)) > 0 THEN
                                substring(key from 1 for length($1) + position($2 IN substring(key from length($1) + 1))) COLLATE "C" > $4
                            ELSE
                                key COLLATE "C" > $4
                            END
                    ELSE
                        true
                END AND
                CASE
                    WHEN $6 != '''' THEN
                        id COLLATE "C" > $6
                    ELSE
                        true
                    END
            ORDER BY
                key COLLATE "C" ASC, created_at ASC) as e order by key COLLATE "C" LIMIT $3'
        USING prefix_param, delimiter_param, max_keys, next_key_token, bucket_id, next_upload_token;
END;
$_$;


ALTER FUNCTION storage.list_multipart_uploads_with_delimiter(bucket_id text, prefix_param text, delimiter_param text, max_keys integer, next_key_token text, next_upload_token text) OWNER TO supabase_storage_admin;

--
-- Name: list_objects_with_delimiter(text, text, text, integer, text, text); Type: FUNCTION; Schema: storage; Owner: supabase_storage_admin
--

CREATE FUNCTION storage.list_objects_with_delimiter(bucket_id text, prefix_param text, delimiter_param text, max_keys integer DEFAULT 100, start_after text DEFAULT ''::text, next_token text DEFAULT ''::text) RETURNS TABLE(name text, id uuid, metadata jsonb, updated_at timestamp with time zone)
    LANGUAGE plpgsql
    AS $_$
BEGIN
    RETURN QUERY EXECUTE
        'SELECT DISTINCT ON(name COLLATE "C") * from (
            SELECT
                CASE
                    WHEN position($2 IN substring(name from length($1) + 1)) > 0 THEN
                        substring(name from 1 for length($1) + position($2 IN substring(name from length($1) + 1)))
                    ELSE
                        name
                END AS name, id, metadata, updated_at
            FROM
                storage.objects
            WHERE
                bucket_id = $5 AND
                name ILIKE $1 || ''%'' AND
                CASE
                    WHEN $6 != '''' THEN
                    name COLLATE "C" > $6
                ELSE true END
                AND CASE
                    WHEN $4 != '''' THEN
                        CASE
                            WHEN position($2 IN substring(name from length($1) + 1)) > 0 THEN
                                substring(name from 1 for length($1) + position($2 IN substring(name from length($1) + 1))) COLLATE "C" > $4
                            ELSE
                                name COLLATE "C" > $4
                            END
                    ELSE
                        true
                END
            ORDER BY
                name COLLATE "C" ASC) as e order by name COLLATE "C" LIMIT $3'
        USING prefix_param, delimiter_param, max_keys, next_token, bucket_id, start_after;
END;
$_$;


ALTER FUNCTION storage.list_objects_with_delimiter(bucket_id text, prefix_param text, delimiter_param text, max_keys integer, start_after text, next_token text) OWNER TO supabase_storage_admin;

--
-- Name: lock_top_prefixes(text[], text[]); Type: FUNCTION; Schema: storage; Owner: supabase_storage_admin
--

CREATE FUNCTION storage.lock_top_prefixes(bucket_ids text[], names text[]) RETURNS void
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
DECLARE
    v_bucket text;
    v_top text;
BEGIN
    FOR v_bucket, v_top IN
        SELECT DISTINCT t.bucket_id,
            split_part(t.name, '/', 1) AS top
        FROM unnest(bucket_ids, names) AS t(bucket_id, name)
        WHERE t.name <> ''
        ORDER BY 1, 2
        LOOP
            PERFORM pg_advisory_xact_lock(hashtextextended(v_bucket || '/' || v_top, 0));
        END LOOP;
END;
$$;


ALTER FUNCTION storage.lock_top_prefixes(bucket_ids text[], names text[]) OWNER TO supabase_storage_admin;

--
-- Name: objects_delete_cleanup(); Type: FUNCTION; Schema: storage; Owner: supabase_storage_admin
--

CREATE FUNCTION storage.objects_delete_cleanup() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
DECLARE
    v_bucket_ids text[];
    v_names      text[];
BEGIN
    IF current_setting('storage.gc.prefixes', true) = '1' THEN
        RETURN NULL;
    END IF;

    PERFORM set_config('storage.gc.prefixes', '1', true);

    SELECT COALESCE(array_agg(d.bucket_id), '{}'),
           COALESCE(array_agg(d.name), '{}')
    INTO v_bucket_ids, v_names
    FROM deleted AS d
    WHERE d.name <> '';

    PERFORM storage.lock_top_prefixes(v_bucket_ids, v_names);
    PERFORM storage.delete_leaf_prefixes(v_bucket_ids, v_names);

    RETURN NULL;
END;
$$;


ALTER FUNCTION storage.objects_delete_cleanup() OWNER TO supabase_storage_admin;

--
-- Name: objects_insert_prefix_trigger(); Type: FUNCTION; Schema: storage; Owner: supabase_storage_admin
--

CREATE FUNCTION storage.objects_insert_prefix_trigger() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    PERFORM "storage"."add_prefixes"(NEW."bucket_id", NEW."name");
    NEW.level := "storage"."get_level"(NEW."name");

    RETURN NEW;
END;
$$;


ALTER FUNCTION storage.objects_insert_prefix_trigger() OWNER TO supabase_storage_admin;

--
-- Name: objects_update_cleanup(); Type: FUNCTION; Schema: storage; Owner: supabase_storage_admin
--

CREATE FUNCTION storage.objects_update_cleanup() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
DECLARE
    -- NEW - OLD (destinations to create prefixes for)
    v_add_bucket_ids text[];
    v_add_names      text[];

    -- OLD - NEW (sources to prune)
    v_src_bucket_ids text[];
    v_src_names      text[];
BEGIN
    IF TG_OP <> 'UPDATE' THEN
        RETURN NULL;
    END IF;

    -- 1) Compute NEWOLD (added paths) and OLDNEW (moved-away paths)
    WITH added AS (
        SELECT n.bucket_id, n.name
        FROM new_rows n
        WHERE n.name <> '' AND position('/' in n.name) > 0
        EXCEPT
        SELECT o.bucket_id, o.name FROM old_rows o WHERE o.name <> ''
    ),
    moved AS (
         SELECT o.bucket_id, o.name
         FROM old_rows o
         WHERE o.name <> ''
         EXCEPT
         SELECT n.bucket_id, n.name FROM new_rows n WHERE n.name <> ''
    )
    SELECT
        -- arrays for ADDED (dest) in stable order
        COALESCE( (SELECT array_agg(a.bucket_id ORDER BY a.bucket_id, a.name) FROM added a), '{}' ),
        COALESCE( (SELECT array_agg(a.name      ORDER BY a.bucket_id, a.name) FROM added a), '{}' ),
        -- arrays for MOVED (src) in stable order
        COALESCE( (SELECT array_agg(m.bucket_id ORDER BY m.bucket_id, m.name) FROM moved m), '{}' ),
        COALESCE( (SELECT array_agg(m.name      ORDER BY m.bucket_id, m.name) FROM moved m), '{}' )
    INTO v_add_bucket_ids, v_add_names, v_src_bucket_ids, v_src_names;

    -- Nothing to do?
    IF (array_length(v_add_bucket_ids, 1) IS NULL) AND (array_length(v_src_bucket_ids, 1) IS NULL) THEN
        RETURN NULL;
    END IF;

    -- 2) Take per-(bucket, top) locks: ALL prefixes in consistent global order to prevent deadlocks
    DECLARE
        v_all_bucket_ids text[];
        v_all_names text[];
    BEGIN
        -- Combine source and destination arrays for consistent lock ordering
        v_all_bucket_ids := COALESCE(v_src_bucket_ids, '{}') || COALESCE(v_add_bucket_ids, '{}');
        v_all_names := COALESCE(v_src_names, '{}') || COALESCE(v_add_names, '{}');

        -- Single lock call ensures consistent global ordering across all transactions
        IF array_length(v_all_bucket_ids, 1) IS NOT NULL THEN
            PERFORM storage.lock_top_prefixes(v_all_bucket_ids, v_all_names);
        END IF;
    END;

    -- 3) Create destination prefixes (NEWOLD) BEFORE pruning sources
    IF array_length(v_add_bucket_ids, 1) IS NOT NULL THEN
        WITH candidates AS (
            SELECT DISTINCT t.bucket_id, unnest(storage.get_prefixes(t.name)) AS name
            FROM unnest(v_add_bucket_ids, v_add_names) AS t(bucket_id, name)
            WHERE name <> ''
        )
        INSERT INTO storage.prefixes (bucket_id, name)
        SELECT c.bucket_id, c.name
        FROM candidates c
        ON CONFLICT DO NOTHING;
    END IF;

    -- 4) Prune source prefixes bottom-up for OLDNEW
    IF array_length(v_src_bucket_ids, 1) IS NOT NULL THEN
        -- re-entrancy guard so DELETE on prefixes won't recurse
        IF current_setting('storage.gc.prefixes', true) <> '1' THEN
            PERFORM set_config('storage.gc.prefixes', '1', true);
        END IF;

        PERFORM storage.delete_leaf_prefixes(v_src_bucket_ids, v_src_names);
    END IF;

    RETURN NULL;
END;
$$;


ALTER FUNCTION storage.objects_update_cleanup() OWNER TO supabase_storage_admin;

--
-- Name: objects_update_level_trigger(); Type: FUNCTION; Schema: storage; Owner: supabase_storage_admin
--

CREATE FUNCTION storage.objects_update_level_trigger() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    -- Ensure this is an update operation and the name has changed
    IF TG_OP = 'UPDATE' AND (NEW."name" <> OLD."name" OR NEW."bucket_id" <> OLD."bucket_id") THEN
        -- Set the new level
        NEW."level" := "storage"."get_level"(NEW."name");
    END IF;
    RETURN NEW;
END;
$$;


ALTER FUNCTION storage.objects_update_level_trigger() OWNER TO supabase_storage_admin;

--
-- Name: objects_update_prefix_trigger(); Type: FUNCTION; Schema: storage; Owner: supabase_storage_admin
--

CREATE FUNCTION storage.objects_update_prefix_trigger() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
DECLARE
    old_prefixes TEXT[];
BEGIN
    -- Ensure this is an update operation and the name has changed
    IF TG_OP = 'UPDATE' AND (NEW."name" <> OLD."name" OR NEW."bucket_id" <> OLD."bucket_id") THEN
        -- Retrieve old prefixes
        old_prefixes := "storage"."get_prefixes"(OLD."name");

        -- Remove old prefixes that are only used by this object
        WITH all_prefixes as (
            SELECT unnest(old_prefixes) as prefix
        ),
        can_delete_prefixes as (
             SELECT prefix
             FROM all_prefixes
             WHERE NOT EXISTS (
                 SELECT 1 FROM "storage"."objects"
                 WHERE "bucket_id" = OLD."bucket_id"
                   AND "name" <> OLD."name"
                   AND "name" LIKE (prefix || '%')
             )
         )
        DELETE FROM "storage"."prefixes" WHERE name IN (SELECT prefix FROM can_delete_prefixes);

        -- Add new prefixes
        PERFORM "storage"."add_prefixes"(NEW."bucket_id", NEW."name");
    END IF;
    -- Set the new level
    NEW."level" := "storage"."get_level"(NEW."name");

    RETURN NEW;
END;
$$;


ALTER FUNCTION storage.objects_update_prefix_trigger() OWNER TO supabase_storage_admin;

--
-- Name: operation(); Type: FUNCTION; Schema: storage; Owner: supabase_storage_admin
--

CREATE FUNCTION storage.operation() RETURNS text
    LANGUAGE plpgsql STABLE
    AS $$
BEGIN
    RETURN current_setting('storage.operation', true);
END;
$$;


ALTER FUNCTION storage.operation() OWNER TO supabase_storage_admin;

--
-- Name: prefixes_delete_cleanup(); Type: FUNCTION; Schema: storage; Owner: supabase_storage_admin
--

CREATE FUNCTION storage.prefixes_delete_cleanup() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
DECLARE
    v_bucket_ids text[];
    v_names      text[];
BEGIN
    IF current_setting('storage.gc.prefixes', true) = '1' THEN
        RETURN NULL;
    END IF;

    PERFORM set_config('storage.gc.prefixes', '1', true);

    SELECT COALESCE(array_agg(d.bucket_id), '{}'),
           COALESCE(array_agg(d.name), '{}')
    INTO v_bucket_ids, v_names
    FROM deleted AS d
    WHERE d.name <> '';

    PERFORM storage.lock_top_prefixes(v_bucket_ids, v_names);
    PERFORM storage.delete_leaf_prefixes(v_bucket_ids, v_names);

    RETURN NULL;
END;
$$;


ALTER FUNCTION storage.prefixes_delete_cleanup() OWNER TO supabase_storage_admin;

--
-- Name: prefixes_insert_trigger(); Type: FUNCTION; Schema: storage; Owner: supabase_storage_admin
--

CREATE FUNCTION storage.prefixes_insert_trigger() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    PERFORM "storage"."add_prefixes"(NEW."bucket_id", NEW."name");
    RETURN NEW;
END;
$$;


ALTER FUNCTION storage.prefixes_insert_trigger() OWNER TO supabase_storage_admin;

--
-- Name: search(text, text, integer, integer, integer, text, text, text); Type: FUNCTION; Schema: storage; Owner: supabase_storage_admin
--

CREATE FUNCTION storage.search(prefix text, bucketname text, limits integer DEFAULT 100, levels integer DEFAULT 1, offsets integer DEFAULT 0, search text DEFAULT ''::text, sortcolumn text DEFAULT 'name'::text, sortorder text DEFAULT 'asc'::text) RETURNS TABLE(name text, id uuid, updated_at timestamp with time zone, created_at timestamp with time zone, last_accessed_at timestamp with time zone, metadata jsonb)
    LANGUAGE plpgsql
    AS $$
declare
    can_bypass_rls BOOLEAN;
begin
    SELECT rolbypassrls
    INTO can_bypass_rls
    FROM pg_roles
    WHERE rolname = coalesce(nullif(current_setting('role', true), 'none'), current_user);

    IF can_bypass_rls THEN
        RETURN QUERY SELECT * FROM storage.search_v1_optimised(prefix, bucketname, limits, levels, offsets, search, sortcolumn, sortorder);
    ELSE
        RETURN QUERY SELECT * FROM storage.search_legacy_v1(prefix, bucketname, limits, levels, offsets, search, sortcolumn, sortorder);
    END IF;
end;
$$;


ALTER FUNCTION storage.search(prefix text, bucketname text, limits integer, levels integer, offsets integer, search text, sortcolumn text, sortorder text) OWNER TO supabase_storage_admin;

--
-- Name: search_legacy_v1(text, text, integer, integer, integer, text, text, text); Type: FUNCTION; Schema: storage; Owner: supabase_storage_admin
--

CREATE FUNCTION storage.search_legacy_v1(prefix text, bucketname text, limits integer DEFAULT 100, levels integer DEFAULT 1, offsets integer DEFAULT 0, search text DEFAULT ''::text, sortcolumn text DEFAULT 'name'::text, sortorder text DEFAULT 'asc'::text) RETURNS TABLE(name text, id uuid, updated_at timestamp with time zone, created_at timestamp with time zone, last_accessed_at timestamp with time zone, metadata jsonb)
    LANGUAGE plpgsql STABLE
    AS $_$
declare
    v_order_by text;
    v_sort_order text;
begin
    case
        when sortcolumn = 'name' then
            v_order_by = 'name';
        when sortcolumn = 'updated_at' then
            v_order_by = 'updated_at';
        when sortcolumn = 'created_at' then
            v_order_by = 'created_at';
        when sortcolumn = 'last_accessed_at' then
            v_order_by = 'last_accessed_at';
        else
            v_order_by = 'name';
        end case;

    case
        when sortorder = 'asc' then
            v_sort_order = 'asc';
        when sortorder = 'desc' then
            v_sort_order = 'desc';
        else
            v_sort_order = 'asc';
        end case;

    v_order_by = v_order_by || ' ' || v_sort_order;

    return query execute
        'with folders as (
           select path_tokens[$1] as folder
           from storage.objects
             where objects.name ilike $2 || $3 || ''%''
               and bucket_id = $4
               and array_length(objects.path_tokens, 1) <> $1
           group by folder
           order by folder ' || v_sort_order || '
     )
     (select folder as "name",
            null as id,
            null as updated_at,
            null as created_at,
            null as last_accessed_at,
            null as metadata from folders)
     union all
     (select path_tokens[$1] as "name",
            id,
            updated_at,
            created_at,
            last_accessed_at,
            metadata
     from storage.objects
     where objects.name ilike $2 || $3 || ''%''
       and bucket_id = $4
       and array_length(objects.path_tokens, 1) = $1
     order by ' || v_order_by || ')
     limit $5
     offset $6' using levels, prefix, search, bucketname, limits, offsets;
end;
$_$;


ALTER FUNCTION storage.search_legacy_v1(prefix text, bucketname text, limits integer, levels integer, offsets integer, search text, sortcolumn text, sortorder text) OWNER TO supabase_storage_admin;

--
-- Name: search_v1_optimised(text, text, integer, integer, integer, text, text, text); Type: FUNCTION; Schema: storage; Owner: supabase_storage_admin
--

CREATE FUNCTION storage.search_v1_optimised(prefix text, bucketname text, limits integer DEFAULT 100, levels integer DEFAULT 1, offsets integer DEFAULT 0, search text DEFAULT ''::text, sortcolumn text DEFAULT 'name'::text, sortorder text DEFAULT 'asc'::text) RETURNS TABLE(name text, id uuid, updated_at timestamp with time zone, created_at timestamp with time zone, last_accessed_at timestamp with time zone, metadata jsonb)
    LANGUAGE plpgsql STABLE
    AS $_$
declare
    v_order_by text;
    v_sort_order text;
begin
    case
        when sortcolumn = 'name' then
            v_order_by = 'name';
        when sortcolumn = 'updated_at' then
            v_order_by = 'updated_at';
        when sortcolumn = 'created_at' then
            v_order_by = 'created_at';
        when sortcolumn = 'last_accessed_at' then
            v_order_by = 'last_accessed_at';
        else
            v_order_by = 'name';
        end case;

    case
        when sortorder = 'asc' then
            v_sort_order = 'asc';
        when sortorder = 'desc' then
            v_sort_order = 'desc';
        else
            v_sort_order = 'asc';
        end case;

    v_order_by = v_order_by || ' ' || v_sort_order;

    return query execute
        'with folders as (
           select (string_to_array(name, ''/''))[level] as name
           from storage.prefixes
             where lower(prefixes.name) like lower($2 || $3) || ''%''
               and bucket_id = $4
               and level = $1
           order by name ' || v_sort_order || '
     )
     (select name,
            null as id,
            null as updated_at,
            null as created_at,
            null as last_accessed_at,
            null as metadata from folders)
     union all
     (select path_tokens[level] as "name",
            id,
            updated_at,
            created_at,
            last_accessed_at,
            metadata
     from storage.objects
     where lower(objects.name) like lower($2 || $3) || ''%''
       and bucket_id = $4
       and level = $1
     order by ' || v_order_by || ')
     limit $5
     offset $6' using levels, prefix, search, bucketname, limits, offsets;
end;
$_$;


ALTER FUNCTION storage.search_v1_optimised(prefix text, bucketname text, limits integer, levels integer, offsets integer, search text, sortcolumn text, sortorder text) OWNER TO supabase_storage_admin;

--
-- Name: search_v2(text, text, integer, integer, text, text, text, text); Type: FUNCTION; Schema: storage; Owner: supabase_storage_admin
--

CREATE FUNCTION storage.search_v2(prefix text, bucket_name text, limits integer DEFAULT 100, levels integer DEFAULT 1, start_after text DEFAULT ''::text, sort_order text DEFAULT 'asc'::text, sort_column text DEFAULT 'name'::text, sort_column_after text DEFAULT ''::text) RETURNS TABLE(key text, name text, id uuid, updated_at timestamp with time zone, created_at timestamp with time zone, last_accessed_at timestamp with time zone, metadata jsonb)
    LANGUAGE plpgsql STABLE
    AS $_$
DECLARE
    sort_col text;
    sort_ord text;
    cursor_op text;
    cursor_expr text;
    sort_expr text;
BEGIN
    -- Validate sort_order
    sort_ord := lower(sort_order);
    IF sort_ord NOT IN ('asc', 'desc') THEN
        sort_ord := 'asc';
    END IF;

    -- Determine cursor comparison operator
    IF sort_ord = 'asc' THEN
        cursor_op := '>';
    ELSE
        cursor_op := '<';
    END IF;
    
    sort_col := lower(sort_column);
    -- Validate sort column  
    IF sort_col IN ('updated_at', 'created_at') THEN
        cursor_expr := format(
            '($5 = '''' OR ROW(date_trunc(''milliseconds'', %I), name COLLATE "C") %s ROW(COALESCE(NULLIF($6, '''')::timestamptz, ''epoch''::timestamptz), $5))',
            sort_col, cursor_op
        );
        sort_expr := format(
            'COALESCE(date_trunc(''milliseconds'', %I), ''epoch''::timestamptz) %s, name COLLATE "C" %s',
            sort_col, sort_ord, sort_ord
        );
    ELSE
        cursor_expr := format('($5 = '''' OR name COLLATE "C" %s $5)', cursor_op);
        sort_expr := format('name COLLATE "C" %s', sort_ord);
    END IF;

    RETURN QUERY EXECUTE format(
        $sql$
        SELECT * FROM (
            (
                SELECT
                    split_part(name, '/', $4) AS key,
                    name,
                    NULL::uuid AS id,
                    updated_at,
                    created_at,
                    NULL::timestamptz AS last_accessed_at,
                    NULL::jsonb AS metadata
                FROM storage.prefixes
                WHERE name COLLATE "C" LIKE $1 || '%%'
                    AND bucket_id = $2
                    AND level = $4
                    AND %s
                ORDER BY %s
                LIMIT $3
            )
            UNION ALL
            (
                SELECT
                    split_part(name, '/', $4) AS key,
                    name,
                    id,
                    updated_at,
                    created_at,
                    last_accessed_at,
                    metadata
                FROM storage.objects
                WHERE name COLLATE "C" LIKE $1 || '%%'
                    AND bucket_id = $2
                    AND level = $4
                    AND %s
                ORDER BY %s
                LIMIT $3
            )
        ) obj
        ORDER BY %s
        LIMIT $3
        $sql$,
        cursor_expr,    -- prefixes WHERE
        sort_expr,      -- prefixes ORDER BY
        cursor_expr,    -- objects WHERE
        sort_expr,      -- objects ORDER BY
        sort_expr       -- final ORDER BY
    )
    USING prefix, bucket_name, limits, levels, start_after, sort_column_after;
END;
$_$;


ALTER FUNCTION storage.search_v2(prefix text, bucket_name text, limits integer, levels integer, start_after text, sort_order text, sort_column text, sort_column_after text) OWNER TO supabase_storage_admin;

--
-- Name: update_updated_at_column(); Type: FUNCTION; Schema: storage; Owner: supabase_storage_admin
--

CREATE FUNCTION storage.update_updated_at_column() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = now();
    RETURN NEW; 
END;
$$;


ALTER FUNCTION storage.update_updated_at_column() OWNER TO supabase_storage_admin;

SET default_tablespace = '';

SET default_table_access_method = heap;

--
-- Name: audit_log_entries; Type: TABLE; Schema: auth; Owner: supabase_auth_admin
--

CREATE TABLE auth.audit_log_entries (
    instance_id uuid,
    id uuid NOT NULL,
    payload json,
    created_at timestamp with time zone,
    ip_address character varying(64) DEFAULT ''::character varying NOT NULL
);


ALTER TABLE auth.audit_log_entries OWNER TO supabase_auth_admin;

--
-- Name: TABLE audit_log_entries; Type: COMMENT; Schema: auth; Owner: supabase_auth_admin
--

COMMENT ON TABLE auth.audit_log_entries IS 'Auth: Audit trail for user actions.';


--
-- Name: flow_state; Type: TABLE; Schema: auth; Owner: supabase_auth_admin
--

CREATE TABLE auth.flow_state (
    id uuid NOT NULL,
    user_id uuid,
    auth_code text NOT NULL,
    code_challenge_method auth.code_challenge_method NOT NULL,
    code_challenge text NOT NULL,
    provider_type text NOT NULL,
    provider_access_token text,
    provider_refresh_token text,
    created_at timestamp with time zone,
    updated_at timestamp with time zone,
    authentication_method text NOT NULL,
    auth_code_issued_at timestamp with time zone
);


ALTER TABLE auth.flow_state OWNER TO supabase_auth_admin;

--
-- Name: TABLE flow_state; Type: COMMENT; Schema: auth; Owner: supabase_auth_admin
--

COMMENT ON TABLE auth.flow_state IS 'stores metadata for pkce logins';


--
-- Name: identities; Type: TABLE; Schema: auth; Owner: supabase_auth_admin
--

CREATE TABLE auth.identities (
    provider_id text NOT NULL,
    user_id uuid NOT NULL,
    identity_data jsonb NOT NULL,
    provider text NOT NULL,
    last_sign_in_at timestamp with time zone,
    created_at timestamp with time zone,
    updated_at timestamp with time zone,
    email text GENERATED ALWAYS AS (lower((identity_data ->> 'email'::text))) STORED,
    id uuid DEFAULT gen_random_uuid() NOT NULL
);


ALTER TABLE auth.identities OWNER TO supabase_auth_admin;

--
-- Name: TABLE identities; Type: COMMENT; Schema: auth; Owner: supabase_auth_admin
--

COMMENT ON TABLE auth.identities IS 'Auth: Stores identities associated to a user.';


--
-- Name: COLUMN identities.email; Type: COMMENT; Schema: auth; Owner: supabase_auth_admin
--

COMMENT ON COLUMN auth.identities.email IS 'Auth: Email is a generated column that references the optional email property in the identity_data';


--
-- Name: instances; Type: TABLE; Schema: auth; Owner: supabase_auth_admin
--

CREATE TABLE auth.instances (
    id uuid NOT NULL,
    uuid uuid,
    raw_base_config text,
    created_at timestamp with time zone,
    updated_at timestamp with time zone
);


ALTER TABLE auth.instances OWNER TO supabase_auth_admin;

--
-- Name: TABLE instances; Type: COMMENT; Schema: auth; Owner: supabase_auth_admin
--

COMMENT ON TABLE auth.instances IS 'Auth: Manages users across multiple sites.';


--
-- Name: mfa_amr_claims; Type: TABLE; Schema: auth; Owner: supabase_auth_admin
--

CREATE TABLE auth.mfa_amr_claims (
    session_id uuid NOT NULL,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    authentication_method text NOT NULL,
    id uuid NOT NULL
);


ALTER TABLE auth.mfa_amr_claims OWNER TO supabase_auth_admin;

--
-- Name: TABLE mfa_amr_claims; Type: COMMENT; Schema: auth; Owner: supabase_auth_admin
--

COMMENT ON TABLE auth.mfa_amr_claims IS 'auth: stores authenticator method reference claims for multi factor authentication';


--
-- Name: mfa_challenges; Type: TABLE; Schema: auth; Owner: supabase_auth_admin
--

CREATE TABLE auth.mfa_challenges (
    id uuid NOT NULL,
    factor_id uuid NOT NULL,
    created_at timestamp with time zone NOT NULL,
    verified_at timestamp with time zone,
    ip_address inet NOT NULL,
    otp_code text,
    web_authn_session_data jsonb
);


ALTER TABLE auth.mfa_challenges OWNER TO supabase_auth_admin;

--
-- Name: TABLE mfa_challenges; Type: COMMENT; Schema: auth; Owner: supabase_auth_admin
--

COMMENT ON TABLE auth.mfa_challenges IS 'auth: stores metadata about challenge requests made';


--
-- Name: mfa_factors; Type: TABLE; Schema: auth; Owner: supabase_auth_admin
--

CREATE TABLE auth.mfa_factors (
    id uuid NOT NULL,
    user_id uuid NOT NULL,
    friendly_name text,
    factor_type auth.factor_type NOT NULL,
    status auth.factor_status NOT NULL,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    secret text,
    phone text,
    last_challenged_at timestamp with time zone,
    web_authn_credential jsonb,
    web_authn_aaguid uuid,
    last_webauthn_challenge_data jsonb
);


ALTER TABLE auth.mfa_factors OWNER TO supabase_auth_admin;

--
-- Name: TABLE mfa_factors; Type: COMMENT; Schema: auth; Owner: supabase_auth_admin
--

COMMENT ON TABLE auth.mfa_factors IS 'auth: stores metadata about factors';


--
-- Name: COLUMN mfa_factors.last_webauthn_challenge_data; Type: COMMENT; Schema: auth; Owner: supabase_auth_admin
--

COMMENT ON COLUMN auth.mfa_factors.last_webauthn_challenge_data IS 'Stores the latest WebAuthn challenge data including attestation/assertion for customer verification';


--
-- Name: oauth_authorizations; Type: TABLE; Schema: auth; Owner: supabase_auth_admin
--

CREATE TABLE auth.oauth_authorizations (
    id uuid NOT NULL,
    authorization_id text NOT NULL,
    client_id uuid NOT NULL,
    user_id uuid,
    redirect_uri text NOT NULL,
    scope text NOT NULL,
    state text,
    resource text,
    code_challenge text,
    code_challenge_method auth.code_challenge_method,
    response_type auth.oauth_response_type DEFAULT 'code'::auth.oauth_response_type NOT NULL,
    status auth.oauth_authorization_status DEFAULT 'pending'::auth.oauth_authorization_status NOT NULL,
    authorization_code text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    expires_at timestamp with time zone DEFAULT (now() + '00:03:00'::interval) NOT NULL,
    approved_at timestamp with time zone,
    nonce text,
    CONSTRAINT oauth_authorizations_authorization_code_length CHECK ((char_length(authorization_code) <= 255)),
    CONSTRAINT oauth_authorizations_code_challenge_length CHECK ((char_length(code_challenge) <= 128)),
    CONSTRAINT oauth_authorizations_expires_at_future CHECK ((expires_at > created_at)),
    CONSTRAINT oauth_authorizations_nonce_length CHECK ((char_length(nonce) <= 255)),
    CONSTRAINT oauth_authorizations_redirect_uri_length CHECK ((char_length(redirect_uri) <= 2048)),
    CONSTRAINT oauth_authorizations_resource_length CHECK ((char_length(resource) <= 2048)),
    CONSTRAINT oauth_authorizations_scope_length CHECK ((char_length(scope) <= 4096)),
    CONSTRAINT oauth_authorizations_state_length CHECK ((char_length(state) <= 4096))
);


ALTER TABLE auth.oauth_authorizations OWNER TO supabase_auth_admin;

--
-- Name: oauth_client_states; Type: TABLE; Schema: auth; Owner: supabase_auth_admin
--

CREATE TABLE auth.oauth_client_states (
    id uuid NOT NULL,
    provider_type text NOT NULL,
    code_verifier text,
    created_at timestamp with time zone NOT NULL
);


ALTER TABLE auth.oauth_client_states OWNER TO supabase_auth_admin;

--
-- Name: TABLE oauth_client_states; Type: COMMENT; Schema: auth; Owner: supabase_auth_admin
--

COMMENT ON TABLE auth.oauth_client_states IS 'Stores OAuth states for third-party provider authentication flows where Supabase acts as the OAuth client.';


--
-- Name: oauth_clients; Type: TABLE; Schema: auth; Owner: supabase_auth_admin
--

CREATE TABLE auth.oauth_clients (
    id uuid NOT NULL,
    client_secret_hash text,
    registration_type auth.oauth_registration_type NOT NULL,
    redirect_uris text NOT NULL,
    grant_types text NOT NULL,
    client_name text,
    client_uri text,
    logo_uri text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    deleted_at timestamp with time zone,
    client_type auth.oauth_client_type DEFAULT 'confidential'::auth.oauth_client_type NOT NULL,
    CONSTRAINT oauth_clients_client_name_length CHECK ((char_length(client_name) <= 1024)),
    CONSTRAINT oauth_clients_client_uri_length CHECK ((char_length(client_uri) <= 2048)),
    CONSTRAINT oauth_clients_logo_uri_length CHECK ((char_length(logo_uri) <= 2048))
);


ALTER TABLE auth.oauth_clients OWNER TO supabase_auth_admin;

--
-- Name: oauth_consents; Type: TABLE; Schema: auth; Owner: supabase_auth_admin
--

CREATE TABLE auth.oauth_consents (
    id uuid NOT NULL,
    user_id uuid NOT NULL,
    client_id uuid NOT NULL,
    scopes text NOT NULL,
    granted_at timestamp with time zone DEFAULT now() NOT NULL,
    revoked_at timestamp with time zone,
    CONSTRAINT oauth_consents_revoked_after_granted CHECK (((revoked_at IS NULL) OR (revoked_at >= granted_at))),
    CONSTRAINT oauth_consents_scopes_length CHECK ((char_length(scopes) <= 2048)),
    CONSTRAINT oauth_consents_scopes_not_empty CHECK ((char_length(TRIM(BOTH FROM scopes)) > 0))
);


ALTER TABLE auth.oauth_consents OWNER TO supabase_auth_admin;

--
-- Name: one_time_tokens; Type: TABLE; Schema: auth; Owner: supabase_auth_admin
--

CREATE TABLE auth.one_time_tokens (
    id uuid NOT NULL,
    user_id uuid NOT NULL,
    token_type auth.one_time_token_type NOT NULL,
    token_hash text NOT NULL,
    relates_to text NOT NULL,
    created_at timestamp without time zone DEFAULT now() NOT NULL,
    updated_at timestamp without time zone DEFAULT now() NOT NULL,
    CONSTRAINT one_time_tokens_token_hash_check CHECK ((char_length(token_hash) > 0))
);


ALTER TABLE auth.one_time_tokens OWNER TO supabase_auth_admin;

--
-- Name: refresh_tokens; Type: TABLE; Schema: auth; Owner: supabase_auth_admin
--

CREATE TABLE auth.refresh_tokens (
    instance_id uuid,
    id bigint NOT NULL,
    token character varying(255),
    user_id character varying(255),
    revoked boolean,
    created_at timestamp with time zone,
    updated_at timestamp with time zone,
    parent character varying(255),
    session_id uuid
);


ALTER TABLE auth.refresh_tokens OWNER TO supabase_auth_admin;

--
-- Name: TABLE refresh_tokens; Type: COMMENT; Schema: auth; Owner: supabase_auth_admin
--

COMMENT ON TABLE auth.refresh_tokens IS 'Auth: Store of tokens used to refresh JWT tokens once they expire.';


--
-- Name: refresh_tokens_id_seq; Type: SEQUENCE; Schema: auth; Owner: supabase_auth_admin
--

CREATE SEQUENCE auth.refresh_tokens_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE auth.refresh_tokens_id_seq OWNER TO supabase_auth_admin;

--
-- Name: refresh_tokens_id_seq; Type: SEQUENCE OWNED BY; Schema: auth; Owner: supabase_auth_admin
--

ALTER SEQUENCE auth.refresh_tokens_id_seq OWNED BY auth.refresh_tokens.id;


--
-- Name: saml_providers; Type: TABLE; Schema: auth; Owner: supabase_auth_admin
--

CREATE TABLE auth.saml_providers (
    id uuid NOT NULL,
    sso_provider_id uuid NOT NULL,
    entity_id text NOT NULL,
    metadata_xml text NOT NULL,
    metadata_url text,
    attribute_mapping jsonb,
    created_at timestamp with time zone,
    updated_at timestamp with time zone,
    name_id_format text,
    CONSTRAINT "entity_id not empty" CHECK ((char_length(entity_id) > 0)),
    CONSTRAINT "metadata_url not empty" CHECK (((metadata_url = NULL::text) OR (char_length(metadata_url) > 0))),
    CONSTRAINT "metadata_xml not empty" CHECK ((char_length(metadata_xml) > 0))
);


ALTER TABLE auth.saml_providers OWNER TO supabase_auth_admin;

--
-- Name: TABLE saml_providers; Type: COMMENT; Schema: auth; Owner: supabase_auth_admin
--

COMMENT ON TABLE auth.saml_providers IS 'Auth: Manages SAML Identity Provider connections.';


--
-- Name: saml_relay_states; Type: TABLE; Schema: auth; Owner: supabase_auth_admin
--

CREATE TABLE auth.saml_relay_states (
    id uuid NOT NULL,
    sso_provider_id uuid NOT NULL,
    request_id text NOT NULL,
    for_email text,
    redirect_to text,
    created_at timestamp with time zone,
    updated_at timestamp with time zone,
    flow_state_id uuid,
    CONSTRAINT "request_id not empty" CHECK ((char_length(request_id) > 0))
);


ALTER TABLE auth.saml_relay_states OWNER TO supabase_auth_admin;

--
-- Name: TABLE saml_relay_states; Type: COMMENT; Schema: auth; Owner: supabase_auth_admin
--

COMMENT ON TABLE auth.saml_relay_states IS 'Auth: Contains SAML Relay State information for each Service Provider initiated login.';


--
-- Name: schema_migrations; Type: TABLE; Schema: auth; Owner: supabase_auth_admin
--

CREATE TABLE auth.schema_migrations (
    version character varying(255) NOT NULL
);


ALTER TABLE auth.schema_migrations OWNER TO supabase_auth_admin;

--
-- Name: TABLE schema_migrations; Type: COMMENT; Schema: auth; Owner: supabase_auth_admin
--

COMMENT ON TABLE auth.schema_migrations IS 'Auth: Manages updates to the auth system.';


--
-- Name: sessions; Type: TABLE; Schema: auth; Owner: supabase_auth_admin
--

CREATE TABLE auth.sessions (
    id uuid NOT NULL,
    user_id uuid NOT NULL,
    created_at timestamp with time zone,
    updated_at timestamp with time zone,
    factor_id uuid,
    aal auth.aal_level,
    not_after timestamp with time zone,
    refreshed_at timestamp without time zone,
    user_agent text,
    ip inet,
    tag text,
    oauth_client_id uuid,
    refresh_token_hmac_key text,
    refresh_token_counter bigint,
    scopes text,
    CONSTRAINT sessions_scopes_length CHECK ((char_length(scopes) <= 4096))
);


ALTER TABLE auth.sessions OWNER TO supabase_auth_admin;

--
-- Name: TABLE sessions; Type: COMMENT; Schema: auth; Owner: supabase_auth_admin
--

COMMENT ON TABLE auth.sessions IS 'Auth: Stores session data associated to a user.';


--
-- Name: COLUMN sessions.not_after; Type: COMMENT; Schema: auth; Owner: supabase_auth_admin
--

COMMENT ON COLUMN auth.sessions.not_after IS 'Auth: Not after is a nullable column that contains a timestamp after which the session should be regarded as expired.';


--
-- Name: COLUMN sessions.refresh_token_hmac_key; Type: COMMENT; Schema: auth; Owner: supabase_auth_admin
--

COMMENT ON COLUMN auth.sessions.refresh_token_hmac_key IS 'Holds a HMAC-SHA256 key used to sign refresh tokens for this session.';


--
-- Name: COLUMN sessions.refresh_token_counter; Type: COMMENT; Schema: auth; Owner: supabase_auth_admin
--

COMMENT ON COLUMN auth.sessions.refresh_token_counter IS 'Holds the ID (counter) of the last issued refresh token.';


--
-- Name: sso_domains; Type: TABLE; Schema: auth; Owner: supabase_auth_admin
--

CREATE TABLE auth.sso_domains (
    id uuid NOT NULL,
    sso_provider_id uuid NOT NULL,
    domain text NOT NULL,
    created_at timestamp with time zone,
    updated_at timestamp with time zone,
    CONSTRAINT "domain not empty" CHECK ((char_length(domain) > 0))
);


ALTER TABLE auth.sso_domains OWNER TO supabase_auth_admin;

--
-- Name: TABLE sso_domains; Type: COMMENT; Schema: auth; Owner: supabase_auth_admin
--

COMMENT ON TABLE auth.sso_domains IS 'Auth: Manages SSO email address domain mapping to an SSO Identity Provider.';


--
-- Name: sso_providers; Type: TABLE; Schema: auth; Owner: supabase_auth_admin
--

CREATE TABLE auth.sso_providers (
    id uuid NOT NULL,
    resource_id text,
    created_at timestamp with time zone,
    updated_at timestamp with time zone,
    disabled boolean,
    CONSTRAINT "resource_id not empty" CHECK (((resource_id = NULL::text) OR (char_length(resource_id) > 0)))
);


ALTER TABLE auth.sso_providers OWNER TO supabase_auth_admin;

--
-- Name: TABLE sso_providers; Type: COMMENT; Schema: auth; Owner: supabase_auth_admin
--

COMMENT ON TABLE auth.sso_providers IS 'Auth: Manages SSO identity provider information; see saml_providers for SAML.';


--
-- Name: COLUMN sso_providers.resource_id; Type: COMMENT; Schema: auth; Owner: supabase_auth_admin
--

COMMENT ON COLUMN auth.sso_providers.resource_id IS 'Auth: Uniquely identifies a SSO provider according to a user-chosen resource ID (case insensitive), useful in infrastructure as code.';


--
-- Name: users; Type: TABLE; Schema: auth; Owner: supabase_auth_admin
--

CREATE TABLE auth.users (
    instance_id uuid,
    id uuid NOT NULL,
    aud character varying(255),
    role character varying(255),
    email character varying(255),
    encrypted_password character varying(255),
    email_confirmed_at timestamp with time zone,
    invited_at timestamp with time zone,
    confirmation_token character varying(255),
    confirmation_sent_at timestamp with time zone,
    recovery_token character varying(255),
    recovery_sent_at timestamp with time zone,
    email_change_token_new character varying(255),
    email_change character varying(255),
    email_change_sent_at timestamp with time zone,
    last_sign_in_at timestamp with time zone,
    raw_app_meta_data jsonb,
    raw_user_meta_data jsonb,
    is_super_admin boolean,
    created_at timestamp with time zone,
    updated_at timestamp with time zone,
    phone text DEFAULT NULL::character varying,
    phone_confirmed_at timestamp with time zone,
    phone_change text DEFAULT ''::character varying,
    phone_change_token character varying(255) DEFAULT ''::character varying,
    phone_change_sent_at timestamp with time zone,
    confirmed_at timestamp with time zone GENERATED ALWAYS AS (LEAST(email_confirmed_at, phone_confirmed_at)) STORED,
    email_change_token_current character varying(255) DEFAULT ''::character varying,
    email_change_confirm_status smallint DEFAULT 0,
    banned_until timestamp with time zone,
    reauthentication_token character varying(255) DEFAULT ''::character varying,
    reauthentication_sent_at timestamp with time zone,
    is_sso_user boolean DEFAULT false NOT NULL,
    deleted_at timestamp with time zone,
    is_anonymous boolean DEFAULT false NOT NULL,
    CONSTRAINT users_email_change_confirm_status_check CHECK (((email_change_confirm_status >= 0) AND (email_change_confirm_status <= 2)))
);


ALTER TABLE auth.users OWNER TO supabase_auth_admin;

--
-- Name: TABLE users; Type: COMMENT; Schema: auth; Owner: supabase_auth_admin
--

COMMENT ON TABLE auth.users IS 'Auth: Stores user login data within a secure schema.';


--
-- Name: COLUMN users.is_sso_user; Type: COMMENT; Schema: auth; Owner: supabase_auth_admin
--

COMMENT ON COLUMN auth.users.is_sso_user IS 'Auth: Set this column to true when the account comes from SSO. These accounts can have duplicate emails.';


--
-- Name: ai_model_settings; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.ai_model_settings (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    primary_provider text DEFAULT 'claude'::text,
    primary_model text DEFAULT 'claude-sonnet-4-5'::text,
    fallback_provider text DEFAULT 'claude'::text,
    fallback_model text DEFAULT 'claude-opus-4-1-20250805'::text,
    temperature numeric(3,2) DEFAULT 0.7,
    max_tokens integer DEFAULT 4096,
    claude_version text DEFAULT '2023-06-01'::text,
    openai_organization_id text,
    last_used_at timestamp with time zone,
    total_requests integer DEFAULT 0,
    total_tokens_used bigint DEFAULT 0,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    created_by uuid
);


ALTER TABLE public.ai_model_settings OWNER TO postgres;

--
-- Name: TABLE ai_model_settings; Type: COMMENT; Schema: public; Owner: postgres
--

COMMENT ON TABLE public.ai_model_settings IS 'Centralized AI model configuration for all content generation - single source of truth';


--
-- Name: announcements; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.announcements (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    title text NOT NULL,
    content text NOT NULL,
    announcement_type text DEFAULT 'general'::text NOT NULL,
    target_audience text DEFAULT 'all_members'::text NOT NULL,
    custom_recipients uuid[],
    priority text DEFAULT 'normal'::text NOT NULL,
    scheduled_for timestamp with time zone,
    published_at timestamp with time zone,
    expires_at timestamp with time zone,
    is_published boolean DEFAULT false NOT NULL,
    created_by uuid NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT announcements_announcement_type_check CHECK ((announcement_type = ANY (ARRAY['general'::text, 'maintenance'::text, 'event'::text, 'policy'::text, 'emergency'::text]))),
    CONSTRAINT announcements_priority_check CHECK ((priority = ANY (ARRAY['low'::text, 'normal'::text, 'high'::text, 'urgent'::text]))),
    CONSTRAINT announcements_target_audience_check CHECK ((target_audience = ANY (ARRAY['all_members'::text, 'active_members'::text, 'staff'::text, 'trainers'::text, 'custom'::text])))
);


ALTER TABLE public.announcements OWNER TO postgres;

--
-- Name: api_keys; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.api_keys (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    name text NOT NULL,
    key_hash text NOT NULL,
    key_preview text NOT NULL,
    permissions text[] DEFAULT '{}'::text[] NOT NULL,
    last_used_at timestamp with time zone,
    expires_at timestamp with time zone,
    status text DEFAULT 'active'::text NOT NULL,
    created_by uuid NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT api_keys_status_check CHECK ((status = ANY (ARRAY['active'::text, 'inactive'::text, 'revoked'::text])))
);


ALTER TABLE public.api_keys OWNER TO postgres;

--
-- Name: blog_auto_generation_settings; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.blog_auto_generation_settings (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    is_enabled boolean DEFAULT false,
    generation_frequency text DEFAULT 'weekly'::text,
    generation_time time without time zone DEFAULT '09:00:00'::time without time zone,
    generation_timezone text DEFAULT 'America/New_York'::text,
    last_generation_at timestamp with time zone,
    next_generation_at timestamp with time zone,
    target_word_count integer DEFAULT 1200,
    content_style text DEFAULT 'professional'::text,
    industry_focus text[] DEFAULT '{fitness,health,wellness}'::text[],
    target_keywords text[] DEFAULT '{}'::text[],
    optimize_for_geographic boolean DEFAULT false,
    target_locations text[] DEFAULT '{}'::text[],
    seo_focus text DEFAULT 'balanced'::text,
    geo_optimization boolean DEFAULT true,
    perplexity_optimization boolean DEFAULT true,
    ai_search_optimization boolean DEFAULT true,
    topic_diversity_enabled boolean DEFAULT true,
    minimum_topic_gap_days integer DEFAULT 30,
    content_analysis_depth text DEFAULT 'excerpt'::text,
    auto_publish boolean DEFAULT false,
    publish_as_draft boolean DEFAULT true,
    require_review boolean DEFAULT true,
    notify_on_generation boolean DEFAULT true,
    notification_emails text[] DEFAULT '{}'::text[],
    content_template text,
    custom_instructions text,
    brand_voice_guidelines text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    created_by uuid
);


ALTER TABLE public.blog_auto_generation_settings OWNER TO postgres;

--
-- Name: TABLE blog_auto_generation_settings; Type: COMMENT; Schema: public; Owner: postgres
--

COMMENT ON TABLE public.blog_auto_generation_settings IS 'Configuration for automated blog content generation with AI';


--
-- Name: blog_categories; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.blog_categories (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    name text NOT NULL,
    slug text NOT NULL,
    description text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.blog_categories OWNER TO postgres;

--
-- Name: blog_generation_queue; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.blog_generation_queue (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    scheduled_for timestamp with time zone NOT NULL,
    status text DEFAULT 'pending'::text,
    priority integer DEFAULT 5,
    suggested_topic text,
    target_keywords text[] DEFAULT '{}'::text[],
    custom_parameters jsonb DEFAULT '{}'::jsonb,
    processing_started_at timestamp with time zone,
    processing_completed_at timestamp with time zone,
    error_message text,
    retry_count integer DEFAULT 0,
    max_retries integer DEFAULT 3,
    blog_post_id uuid,
    generation_metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


ALTER TABLE public.blog_generation_queue OWNER TO postgres;

--
-- Name: TABLE blog_generation_queue; Type: COMMENT; Schema: public; Owner: postgres
--

COMMENT ON TABLE public.blog_generation_queue IS 'Queue for scheduled blog generation jobs with retry logic';


--
-- Name: blog_post_tags; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.blog_post_tags (
    post_id uuid NOT NULL,
    tag_id uuid NOT NULL
);


ALTER TABLE public.blog_post_tags OWNER TO postgres;

--
-- Name: blog_posts; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.blog_posts (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    slug text NOT NULL,
    title text NOT NULL,
    excerpt text,
    content text NOT NULL,
    featured_image text,
    category_id uuid,
    read_time integer,
    status text DEFAULT 'draft'::text NOT NULL,
    published_at timestamp with time zone,
    created_by uuid,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    meta_title text,
    meta_description text,
    meta_keywords text
);


ALTER TABLE public.blog_posts OWNER TO postgres;

--
-- Name: blog_tags; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.blog_tags (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    name text NOT NULL,
    slug text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.blog_tags OWNER TO postgres;

--
-- Name: blog_topic_history; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.blog_topic_history (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    blog_post_id uuid,
    primary_topic text NOT NULL,
    secondary_topics text[] DEFAULT '{}'::text[],
    keywords_used text[] DEFAULT '{}'::text[],
    topic_category text,
    content_type text DEFAULT 'article'::text,
    target_keywords text[] DEFAULT '{}'::text[],
    geo_targets text[] DEFAULT '{}'::text[],
    seo_score numeric(5,2),
    readability_score numeric(5,2),
    generation_model text,
    generation_time_seconds integer,
    ai_confidence_score numeric(5,2),
    created_at timestamp with time zone DEFAULT now()
);


ALTER TABLE public.blog_topic_history OWNER TO postgres;

--
-- Name: TABLE blog_topic_history; Type: COMMENT; Schema: public; Owner: postgres
--

COMMENT ON TABLE public.blog_topic_history IS 'Tracks generated topics to prevent repetitive content';


--
-- Name: bulk_member_operations; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.bulk_member_operations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    corporate_account_id uuid,
    operation_type text NOT NULL,
    initiated_by uuid NOT NULL,
    total_members integer DEFAULT 0,
    processed_members integer DEFAULT 0,
    failed_members integer DEFAULT 0,
    operation_data jsonb DEFAULT '{}'::jsonb,
    error_log jsonb DEFAULT '[]'::jsonb,
    status text DEFAULT 'pending'::text NOT NULL,
    started_at timestamp with time zone,
    completed_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT bulk_member_operations_operation_type_check CHECK ((operation_type = ANY (ARRAY['bulk_add'::text, 'bulk_update'::text, 'bulk_suspend'::text, 'bulk_terminate'::text, 'bulk_transfer'::text]))),
    CONSTRAINT bulk_member_operations_status_check CHECK ((status = ANY (ARRAY['pending'::text, 'processing'::text, 'completed'::text, 'failed'::text, 'cancelled'::text])))
);


ALTER TABLE public.bulk_member_operations OWNER TO postgres;

--
-- Name: campaign_executions; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.campaign_executions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    campaign_id uuid NOT NULL,
    member_id uuid NOT NULL,
    executed_at timestamp with time zone DEFAULT now() NOT NULL,
    status text DEFAULT 'sent'::text NOT NULL,
    reward_claimed boolean DEFAULT false,
    reward_claimed_at timestamp with time zone,
    notes text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    message_type text DEFAULT 'email'::text,
    template_id uuid,
    delivery_status text DEFAULT 'pending'::text,
    CONSTRAINT campaign_executions_delivery_status_check CHECK ((delivery_status = ANY (ARRAY['pending'::text, 'sent'::text, 'delivered'::text, 'failed'::text]))),
    CONSTRAINT campaign_executions_message_type_check CHECK ((message_type = ANY (ARRAY['sms'::text, 'email'::text, 'push'::text]))),
    CONSTRAINT campaign_executions_status_check CHECK ((status = ANY (ARRAY['sent'::text, 'opened'::text, 'clicked'::text, 'redeemed'::text, 'expired'::text])))
);


ALTER TABLE public.campaign_executions OWNER TO postgres;

--
-- Name: certification_requirements; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.certification_requirements (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    certification_name text NOT NULL,
    description text,
    validity_period_months integer DEFAULT 12 NOT NULL,
    is_required boolean DEFAULT true,
    required_for_roles text[] DEFAULT ARRAY['staff'::text],
    renewal_notice_days integer DEFAULT 30,
    training_provider text,
    cost_estimate numeric(10,2),
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.certification_requirements OWNER TO postgres;

--
-- Name: check_ins; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.check_ins (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    member_id uuid NOT NULL,
    location_id uuid NOT NULL,
    checked_in_at timestamp with time zone DEFAULT now() NOT NULL,
    checked_out_at timestamp with time zone,
    guest_name text,
    guest_email text,
    guest_phone text,
    is_guest boolean DEFAULT false,
    lead_id uuid
);


ALTER TABLE public.check_ins OWNER TO postgres;

--
-- Name: child_profiles; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.child_profiles (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    parent_member_id uuid NOT NULL,
    child_first_name text NOT NULL,
    child_last_name text NOT NULL,
    date_of_birth date NOT NULL,
    gender text,
    emergency_contact_name text,
    emergency_contact_phone text,
    medical_conditions text,
    allergies text,
    dietary_restrictions text,
    special_instructions text,
    authorized_pickup_contacts jsonb DEFAULT '[]'::jsonb,
    photo_url text,
    is_active boolean DEFAULT true,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT child_profiles_gender_check CHECK ((gender = ANY (ARRAY['male'::text, 'female'::text, 'other'::text, 'prefer_not_to_say'::text])))
);


ALTER TABLE public.child_profiles OWNER TO postgres;

--
-- Name: childcare_activities; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.childcare_activities (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    activity_name text NOT NULL,
    description text,
    age_group_min_months integer DEFAULT 0 NOT NULL,
    age_group_max_months integer DEFAULT 144 NOT NULL,
    max_participants integer DEFAULT 15,
    staff_ratio_requirement integer DEFAULT 8,
    activity_date date NOT NULL,
    start_time time without time zone NOT NULL,
    end_time time without time zone NOT NULL,
    duration_minutes integer NOT NULL,
    location_room text,
    equipment_needed text[] DEFAULT '{}'::text[],
    activity_fee numeric(10,2) DEFAULT 0.00,
    requires_registration boolean DEFAULT true,
    registration_deadline timestamp with time zone,
    activity_type text DEFAULT 'play'::text,
    is_recurring boolean DEFAULT false,
    recurring_pattern text,
    assigned_staff uuid[] DEFAULT '{}'::uuid[],
    status text DEFAULT 'scheduled'::text,
    created_by uuid NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT childcare_activities_status_check CHECK ((status = ANY (ARRAY['scheduled'::text, 'in_progress'::text, 'completed'::text, 'cancelled'::text]))),
    CONSTRAINT childcare_activities_type_check CHECK ((activity_type = ANY (ARRAY['play'::text, 'education'::text, 'arts_crafts'::text, 'story_time'::text, 'outdoor'::text, 'free_play'::text])))
);


ALTER TABLE public.childcare_activities OWNER TO postgres;

--
-- Name: childcare_activity_registrations; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.childcare_activity_registrations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    activity_id uuid NOT NULL,
    child_id uuid NOT NULL,
    parent_member_id uuid NOT NULL,
    registration_date timestamp with time zone DEFAULT now() NOT NULL,
    attended boolean DEFAULT false,
    payment_status text DEFAULT 'pending'::text,
    special_requests text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT childcare_registrations_payment_check CHECK ((payment_status = ANY (ARRAY['pending'::text, 'paid'::text, 'waived'::text, 'refunded'::text])))
);


ALTER TABLE public.childcare_activity_registrations OWNER TO postgres;

--
-- Name: childcare_checkins; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.childcare_checkins (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    child_id uuid NOT NULL,
    activity_id uuid,
    parent_member_id uuid NOT NULL,
    check_in_time timestamp with time zone DEFAULT now() NOT NULL,
    check_out_time timestamp with time zone,
    checked_in_by uuid NOT NULL,
    checked_out_by uuid,
    drop_off_notes text,
    pick_up_notes text,
    child_condition_checkin text DEFAULT 'good'::text,
    child_condition_checkout text,
    authorized_pickup_person text,
    pickup_person_id text,
    incident_occurred boolean DEFAULT false,
    incident_description text,
    diaper_changes integer DEFAULT 0,
    meals_eaten text[],
    nap_start_time timestamp with time zone,
    nap_end_time timestamp with time zone,
    mood_rating integer,
    activities_participated text[],
    status text DEFAULT 'checked_in'::text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT childcare_checkins_condition_check CHECK (((child_condition_checkin = ANY (ARRAY['excellent'::text, 'good'::text, 'fair'::text, 'sick'::text, 'upset'::text])) AND ((child_condition_checkout IS NULL) OR (child_condition_checkout = ANY (ARRAY['excellent'::text, 'good'::text, 'fair'::text, 'sick'::text, 'upset'::text]))))),
    CONSTRAINT childcare_checkins_mood_rating_check CHECK (((mood_rating >= 1) AND (mood_rating <= 5))),
    CONSTRAINT childcare_checkins_status_check CHECK ((status = ANY (ARRAY['checked_in'::text, 'checked_out'::text, 'emergency_pickup'::text])))
);


ALTER TABLE public.childcare_checkins OWNER TO postgres;

--
-- Name: childcare_daily_reports; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.childcare_daily_reports (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    child_id uuid NOT NULL,
    report_date date DEFAULT CURRENT_DATE NOT NULL,
    arrival_time timestamp with time zone,
    departure_time timestamp with time zone,
    meals json DEFAULT '[]'::json,
    naps json DEFAULT '[]'::json,
    diaper_changes json DEFAULT '[]'::json,
    activities json DEFAULT '[]'::json,
    mood_observations text,
    learning_milestones text,
    social_interactions text,
    parent_communication text,
    photos_taken integer DEFAULT 0,
    incidents json DEFAULT '[]'::json,
    overall_rating integer,
    staff_notes text,
    parent_signature_required boolean DEFAULT false,
    parent_signed_at timestamp with time zone,
    created_by uuid NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT childcare_daily_reports_overall_rating_check CHECK (((overall_rating >= 1) AND (overall_rating <= 5)))
);


ALTER TABLE public.childcare_daily_reports OWNER TO postgres;

--
-- Name: childcare_staff_schedules; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.childcare_staff_schedules (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    staff_id uuid NOT NULL,
    schedule_date date NOT NULL,
    start_time time without time zone NOT NULL,
    end_time time without time zone NOT NULL,
    break_start time without time zone,
    break_end time without time zone,
    max_children_capacity integer DEFAULT 8,
    current_children_count integer DEFAULT 0,
    room_assignment text,
    age_group_specialization text[] DEFAULT '{}'::text[],
    certifications text[] DEFAULT '{}'::text[],
    is_available boolean DEFAULT true,
    notes text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.childcare_staff_schedules OWNER TO postgres;

--
-- Name: class_analytics; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.class_analytics (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    class_id uuid,
    instructor_id uuid,
    class_date date NOT NULL,
    class_name text NOT NULL,
    instructor_name text,
    capacity integer DEFAULT 0 NOT NULL,
    bookings integer DEFAULT 0 NOT NULL,
    attendance integer DEFAULT 0 NOT NULL,
    no_shows integer DEFAULT 0 NOT NULL,
    cancellations integer DEFAULT 0 NOT NULL,
    utilization_rate numeric(5,2) DEFAULT 0 NOT NULL,
    attendance_rate numeric(5,2) DEFAULT 0 NOT NULL,
    revenue numeric(10,2) DEFAULT 0,
    created_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.class_analytics OWNER TO postgres;

--
-- Name: class_bookings; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.class_bookings (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    class_id uuid NOT NULL,
    member_id uuid NOT NULL,
    status text DEFAULT 'booked'::text NOT NULL,
    booked_at timestamp with time zone DEFAULT now() NOT NULL,
    attended_at timestamp with time zone,
    CONSTRAINT class_bookings_status_check CHECK ((status = ANY (ARRAY['booked'::text, 'attended'::text, 'no_show'::text, 'cancelled'::text])))
);


ALTER TABLE public.class_bookings OWNER TO postgres;

--
-- Name: class_categories; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.class_categories (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    name text NOT NULL,
    description text,
    color text DEFAULT '#6b7280'::text,
    created_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.class_categories OWNER TO postgres;

--
-- Name: class_waitlists; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.class_waitlists (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    class_id uuid NOT NULL,
    member_id uuid NOT NULL,
    joined_at timestamp with time zone DEFAULT now() NOT NULL,
    priority_order integer DEFAULT 1 NOT NULL,
    status text DEFAULT 'waiting'::text NOT NULL,
    notified_at timestamp with time zone,
    expires_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.class_waitlists OWNER TO postgres;

--
-- Name: classes; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.classes (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    location_id uuid NOT NULL,
    category_id uuid,
    instructor_id uuid,
    name text NOT NULL,
    description text,
    duration_minutes integer DEFAULT 60 NOT NULL,
    max_capacity integer DEFAULT 20 NOT NULL,
    scheduled_at timestamp with time zone NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.classes OWNER TO postgres;

--
-- Name: cleaning_schedules; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.cleaning_schedules (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    area_id uuid NOT NULL,
    task_name text NOT NULL,
    frequency text DEFAULT 'daily'::text NOT NULL,
    assigned_to uuid,
    estimated_duration_minutes integer DEFAULT 30,
    last_completed timestamp with time zone,
    next_due date NOT NULL,
    status text DEFAULT 'pending'::text NOT NULL,
    priority text DEFAULT 'normal'::text NOT NULL,
    supplies_needed text[],
    instructions text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.cleaning_schedules OWNER TO postgres;

--
-- Name: commission_calculations; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.commission_calculations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    lead_id uuid NOT NULL,
    salesperson_id uuid NOT NULL,
    membership_id uuid,
    commission_amount numeric NOT NULL,
    commission_type text NOT NULL,
    revenue_basis text NOT NULL,
    payment_period_start date,
    payment_period_end date,
    status text DEFAULT 'pending'::text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT commission_calculations_status_check CHECK ((status = ANY (ARRAY['pending'::text, 'paid'::text, 'cancelled'::text])))
);


ALTER TABLE public.commission_calculations OWNER TO postgres;

--
-- Name: communication_providers; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.communication_providers (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    provider_type text NOT NULL,
    provider_name text NOT NULL,
    configuration jsonb DEFAULT '{}'::jsonb NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    is_default boolean DEFAULT false NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT communication_providers_provider_type_check CHECK ((provider_type = ANY (ARRAY['sms'::text, 'email'::text])))
);


ALTER TABLE public.communication_providers OWNER TO postgres;

--
-- Name: communication_templates; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.communication_templates (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    name text NOT NULL,
    template_type text NOT NULL,
    category text DEFAULT 'general'::text NOT NULL,
    subject text,
    content text NOT NULL,
    variables jsonb DEFAULT '[]'::jsonb,
    is_active boolean DEFAULT true NOT NULL,
    created_by uuid NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT communication_templates_template_type_check CHECK ((template_type = ANY (ARRAY['sms'::text, 'email'::text])))
);


ALTER TABLE public.communication_templates OWNER TO postgres;

--
-- Name: corporate_accounts; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.corporate_accounts (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    company_name text NOT NULL,
    contact_person text NOT NULL,
    contact_email text NOT NULL,
    contact_phone text,
    billing_address text,
    tax_id text,
    contract_start_date date NOT NULL,
    contract_end_date date,
    total_member_allocation integer DEFAULT 0 NOT NULL,
    used_member_allocation integer DEFAULT 0 NOT NULL,
    monthly_rate_per_member numeric(10,2) NOT NULL,
    setup_fee numeric(10,2) DEFAULT 0,
    discount_percentage numeric(5,2) DEFAULT 0,
    billing_cycle text DEFAULT 'monthly'::text NOT NULL,
    auto_billing boolean DEFAULT true,
    status text DEFAULT 'active'::text NOT NULL,
    account_manager_id uuid,
    payment_terms text DEFAULT '30 days'::text,
    special_terms text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT corporate_accounts_billing_cycle_check CHECK ((billing_cycle = ANY (ARRAY['monthly'::text, 'quarterly'::text, 'annual'::text]))),
    CONSTRAINT corporate_accounts_status_check CHECK ((status = ANY (ARRAY['active'::text, 'suspended'::text, 'cancelled'::text, 'pending'::text])))
);


ALTER TABLE public.corporate_accounts OWNER TO postgres;

--
-- Name: corporate_invoice_items; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.corporate_invoice_items (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    invoice_id uuid NOT NULL,
    member_id uuid,
    item_type text NOT NULL,
    description text NOT NULL,
    quantity integer DEFAULT 1,
    unit_price numeric(10,2) NOT NULL,
    total_price numeric(10,2) NOT NULL,
    billing_period_start date,
    billing_period_end date,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT corporate_invoice_items_item_type_check CHECK ((item_type = ANY (ARRAY['membership'::text, 'personal_training'::text, 'classes'::text, 'retail'::text, 'fee'::text, 'other'::text])))
);


ALTER TABLE public.corporate_invoice_items OWNER TO postgres;

--
-- Name: corporate_invoices; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.corporate_invoices (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    corporate_account_id uuid NOT NULL,
    invoice_number text NOT NULL,
    billing_period_start date NOT NULL,
    billing_period_end date NOT NULL,
    member_count integer DEFAULT 0 NOT NULL,
    base_amount numeric(10,2) DEFAULT 0 NOT NULL,
    discount_amount numeric(10,2) DEFAULT 0,
    tax_amount numeric(10,2) DEFAULT 0,
    additional_charges numeric(10,2) DEFAULT 0,
    total_amount numeric(10,2) DEFAULT 0 NOT NULL,
    payment_due_date date,
    payment_received_date date,
    payment_method text,
    payment_reference text,
    late_fee numeric(10,2) DEFAULT 0,
    status text DEFAULT 'draft'::text NOT NULL,
    sent_at timestamp with time zone,
    created_by uuid NOT NULL,
    notes text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT corporate_invoices_status_check CHECK ((status = ANY (ARRAY['draft'::text, 'sent'::text, 'paid'::text, 'overdue'::text, 'cancelled'::text])))
);


ALTER TABLE public.corporate_invoices OWNER TO postgres;

--
-- Name: corporate_members; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.corporate_members (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    corporate_account_id uuid NOT NULL,
    member_id uuid NOT NULL,
    corporate_plan_id uuid,
    employee_id text,
    department text,
    job_title text,
    manager_member_id uuid,
    start_date date DEFAULT CURRENT_DATE NOT NULL,
    end_date date,
    is_active boolean DEFAULT true,
    billing_responsibility text DEFAULT 'corporate'::text,
    employee_contribution numeric(10,2) DEFAULT 0,
    notes text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT corporate_members_billing_responsibility_check CHECK ((billing_responsibility = ANY (ARRAY['corporate'::text, 'employee'::text, 'shared'::text])))
);


ALTER TABLE public.corporate_members OWNER TO postgres;

--
-- Name: corporate_membership_plans; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.corporate_membership_plans (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    corporate_account_id uuid NOT NULL,
    plan_name text NOT NULL,
    description text,
    monthly_rate numeric(10,2) NOT NULL,
    access_level text DEFAULT 'standard'::text NOT NULL,
    included_services jsonb DEFAULT '[]'::jsonb,
    excluded_services jsonb DEFAULT '[]'::jsonb,
    guest_privileges integer DEFAULT 0,
    class_booking_priority boolean DEFAULT false,
    personal_training_discount numeric(5,2) DEFAULT 0,
    retail_discount numeric(5,2) DEFAULT 0,
    parking_included boolean DEFAULT false,
    locker_included boolean DEFAULT false,
    is_active boolean DEFAULT true,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT corporate_membership_plans_access_level_check CHECK ((access_level = ANY (ARRAY['basic'::text, 'standard'::text, 'premium'::text, 'executive'::text])))
);


ALTER TABLE public.corporate_membership_plans OWNER TO postgres;

--
-- Name: cost_allocations; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.cost_allocations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    department_name text NOT NULL,
    cost_category text NOT NULL,
    period_start date NOT NULL,
    period_end date NOT NULL,
    allocated_amount numeric DEFAULT 0 NOT NULL,
    allocation_basis text NOT NULL,
    allocation_percentage numeric DEFAULT 0,
    notes text,
    created_by uuid NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.cost_allocations OWNER TO postgres;

--
-- Name: court_reservations; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.court_reservations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    court_id uuid NOT NULL,
    member_id uuid NOT NULL,
    reservation_date date NOT NULL,
    start_time time without time zone NOT NULL,
    end_time time without time zone NOT NULL,
    duration_minutes integer DEFAULT 60 NOT NULL,
    hourly_rate numeric NOT NULL,
    total_cost numeric NOT NULL,
    payment_status text DEFAULT 'pending'::text,
    payment_method text,
    additional_players text[],
    special_requests text,
    checked_in_at timestamp with time zone,
    cancelled_at timestamp with time zone,
    cancellation_reason text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    status text DEFAULT 'confirmed'::text NOT NULL
);


ALTER TABLE public.court_reservations OWNER TO postgres;

--
-- Name: cross_location_assignments; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.cross_location_assignments (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    staff_id uuid NOT NULL,
    location_id uuid NOT NULL,
    assignment_type text DEFAULT 'primary'::text NOT NULL,
    start_date date DEFAULT CURRENT_DATE NOT NULL,
    end_date date,
    permissions jsonb DEFAULT '{}'::jsonb,
    hourly_rate numeric(10,2),
    is_active boolean DEFAULT true,
    created_by uuid NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.cross_location_assignments OWNER TO postgres;

--
-- Name: cross_location_transfers; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.cross_location_transfers (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    transfer_type text NOT NULL,
    entity_id uuid NOT NULL,
    from_location_id uuid NOT NULL,
    to_location_id uuid NOT NULL,
    transfer_date date DEFAULT CURRENT_DATE NOT NULL,
    effective_date date DEFAULT CURRENT_DATE NOT NULL,
    reason text,
    transfer_fee numeric(10,2) DEFAULT 0.00,
    approval_required boolean DEFAULT true,
    approved_by uuid,
    approved_at timestamp with time zone,
    initiated_by uuid NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    status text DEFAULT 'pending'::text NOT NULL
);


ALTER TABLE public.cross_location_transfers OWNER TO postgres;

--
-- Name: daily_analytics_snapshots; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.daily_analytics_snapshots (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    snapshot_date date DEFAULT CURRENT_DATE NOT NULL,
    total_members integer DEFAULT 0 NOT NULL,
    active_members integer DEFAULT 0 NOT NULL,
    new_members_today integer DEFAULT 0 NOT NULL,
    total_check_ins integer DEFAULT 0 NOT NULL,
    total_revenue numeric(10,2) DEFAULT 0 NOT NULL,
    classes_scheduled integer DEFAULT 0 NOT NULL,
    class_bookings integer DEFAULT 0 NOT NULL,
    class_attendance_rate numeric(5,2) DEFAULT 0 NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.daily_analytics_snapshots OWNER TO postgres;

--
-- Name: department_budgets; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.department_budgets (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    department_name text NOT NULL,
    budget_year integer NOT NULL,
    budget_month integer,
    revenue_budget numeric DEFAULT 0,
    expense_budget numeric DEFAULT 0,
    profit_target numeric DEFAULT 0,
    created_by uuid NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.department_budgets OWNER TO postgres;

--
-- Name: department_revenues; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.department_revenues (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    department_name text NOT NULL,
    revenue_source text NOT NULL,
    period_start date NOT NULL,
    period_end date NOT NULL,
    revenue_amount numeric DEFAULT 0 NOT NULL,
    transaction_count integer DEFAULT 0,
    average_transaction_value numeric DEFAULT 0,
    created_by uuid NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.department_revenues OWNER TO postgres;

--
-- Name: early_access_requests; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.early_access_requests (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    name text NOT NULL,
    email text NOT NULL,
    company text,
    phone text,
    business_type text NOT NULL,
    current_members text NOT NULL,
    message text,
    status text DEFAULT 'pending'::text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT early_access_requests_status_check CHECK ((status = ANY (ARRAY['pending'::text, 'approved'::text, 'contacted'::text, 'converted'::text])))
);


ALTER TABLE public.early_access_requests OWNER TO postgres;

--
-- Name: email_messages; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.email_messages (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    thread_id uuid NOT NULL,
    external_id text NOT NULL,
    to_email text NOT NULL,
    from_name text,
    from_email text NOT NULL,
    subject text,
    body text,
    received_date timestamp with time zone NOT NULL,
    status text DEFAULT 'open'::text,
    assigned_to uuid,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT email_messages_status_check CHECK ((status = ANY (ARRAY['open'::text, 'closed'::text, 'disregarded'::text])))
);


ALTER TABLE public.email_messages OWNER TO postgres;

--
-- Name: email_responses; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.email_responses (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    message_id uuid NOT NULL,
    sent_by uuid NOT NULL,
    response_body text NOT NULL,
    sent_at timestamp with time zone DEFAULT now(),
    created_at timestamp with time zone DEFAULT now()
);


ALTER TABLE public.email_responses OWNER TO postgres;

--
-- Name: email_templates; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.email_templates (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    name text NOT NULL,
    subject text NOT NULL,
    content text NOT NULL,
    template_type text DEFAULT 'general'::text NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    created_by uuid NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.email_templates OWNER TO postgres;

--
-- Name: email_threads; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.email_threads (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    domain text NOT NULL,
    display_name text NOT NULL,
    is_active boolean DEFAULT true,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


ALTER TABLE public.email_threads OWNER TO postgres;

--
-- Name: equipment; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.equipment (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    name text NOT NULL,
    equipment_type text DEFAULT 'cardio'::text NOT NULL,
    brand text,
    model text,
    serial_number text,
    purchase_date date,
    purchase_price numeric,
    warranty_expiry date,
    location_id uuid,
    status text DEFAULT 'active'::text NOT NULL,
    last_maintenance_date date,
    next_maintenance_date date,
    maintenance_interval_days integer DEFAULT 90,
    usage_hours integer DEFAULT 0,
    notes text,
    specifications jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.equipment OWNER TO postgres;

--
-- Name: equipment_checkout; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.equipment_checkout (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    equipment_item_id uuid NOT NULL,
    member_id uuid NOT NULL,
    checked_out_by uuid,
    checked_out_at timestamp with time zone DEFAULT now() NOT NULL,
    due_back_at timestamp with time zone NOT NULL,
    checked_in_at timestamp with time zone,
    checked_in_by uuid,
    rental_fee numeric DEFAULT 0.00,
    deposit_amount numeric DEFAULT 0.00,
    damage_fee numeric DEFAULT 0.00,
    condition_out text DEFAULT 'good'::text,
    condition_in text,
    damage_notes text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    status text DEFAULT 'checked_out'::text NOT NULL
);


ALTER TABLE public.equipment_checkout OWNER TO postgres;

--
-- Name: expense_categories; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.expense_categories (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    name text NOT NULL,
    description text,
    budget_amount numeric,
    is_active boolean DEFAULT true,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.expense_categories OWNER TO postgres;

--
-- Name: expense_vendors; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.expense_vendors (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    name text NOT NULL,
    contact_person text,
    email text,
    phone text,
    address text,
    payment_terms text DEFAULT '30'::text,
    tax_id text,
    is_active boolean DEFAULT true,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.expense_vendors OWNER TO postgres;

--
-- Name: expenses; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.expenses (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    vendor_id uuid,
    category_id uuid NOT NULL,
    expense_date date NOT NULL,
    amount numeric NOT NULL,
    description text NOT NULL,
    receipt_url text,
    receipt_filename text,
    payment_method text DEFAULT 'check'::text,
    payment_status text DEFAULT 'pending'::text,
    payment_date date,
    check_number text,
    reference_number text,
    approved_by uuid,
    approved_at timestamp with time zone,
    recurring boolean DEFAULT false,
    recurring_frequency text,
    created_by uuid NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.expenses OWNER TO postgres;

--
-- Name: facility_areas; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.facility_areas (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    location_id uuid NOT NULL,
    name text NOT NULL,
    area_type text DEFAULT 'general'::text NOT NULL,
    square_footage integer,
    max_capacity integer,
    equipment_count integer DEFAULT 0,
    cleaning_frequency text DEFAULT 'daily'::text,
    last_cleaned timestamp with time zone,
    temperature_range text,
    special_requirements text,
    safety_notes text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.facility_areas OWNER TO postgres;

--
-- Name: facility_tours; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.facility_tours (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    lead_id uuid NOT NULL,
    scheduled_date date NOT NULL,
    scheduled_time text NOT NULL,
    tour_type text DEFAULT 'general'::text NOT NULL,
    guide_id uuid,
    status text DEFAULT 'scheduled'::text NOT NULL,
    outcome text,
    notes text,
    follow_up_date date,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.facility_tours OWNER TO postgres;

--
-- Name: fitness_assessments; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.fitness_assessments (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    member_id uuid NOT NULL,
    fitness_goals text[] DEFAULT '{}'::text[] NOT NULL,
    experience_level text NOT NULL,
    workout_preferences text[] DEFAULT '{}'::text[] NOT NULL,
    workout_frequency text NOT NULL,
    specific_goals text,
    health_conditions text,
    previous_injuries text,
    assessment_date timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT fitness_assessments_experience_level_check CHECK ((experience_level = ANY (ARRAY['beginner'::text, 'intermediate'::text, 'advanced'::text]))),
    CONSTRAINT fitness_assessments_workout_frequency_check CHECK ((workout_frequency = ANY (ARRAY['1-2'::text, '3-4'::text, '5-6'::text, 'daily'::text])))
);


ALTER TABLE public.fitness_assessments OWNER TO postgres;

--
-- Name: guest_pass_types; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.guest_pass_types (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    name text NOT NULL,
    description text,
    price numeric DEFAULT 0 NOT NULL,
    validity_hours integer DEFAULT 24 NOT NULL,
    includes_amenities text[] DEFAULT '{}'::text[],
    max_uses_per_member integer DEFAULT 1,
    is_active boolean DEFAULT true,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.guest_pass_types OWNER TO postgres;

--
-- Name: guest_passes; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.guest_passes (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    pass_type_id uuid NOT NULL,
    purchased_by uuid,
    guest_name text NOT NULL,
    guest_email text,
    guest_phone text,
    purchase_date timestamp with time zone DEFAULT now() NOT NULL,
    valid_until timestamp with time zone NOT NULL,
    amount_paid numeric NOT NULL,
    payment_method text DEFAULT 'cash'::text,
    used_at timestamp with time zone,
    status text DEFAULT 'active'::text NOT NULL,
    notes text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.guest_passes OWNER TO postgres;

--
-- Name: incident_follow_ups; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.incident_follow_ups (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    incident_report_id uuid NOT NULL,
    task_type text DEFAULT 'follow_up_call'::text NOT NULL,
    task_description text NOT NULL,
    assigned_to uuid,
    due_date date NOT NULL,
    completed_at timestamp with time zone,
    completed_by uuid,
    completion_notes text,
    priority text DEFAULT 'medium'::text NOT NULL,
    status text DEFAULT 'pending'::text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.incident_follow_ups OWNER TO postgres;

--
-- Name: incident_investigations; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.incident_investigations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    incident_report_id uuid NOT NULL,
    investigator_id uuid NOT NULL,
    investigation_date timestamp with time zone DEFAULT now() NOT NULL,
    findings text NOT NULL,
    recommendations text,
    contributing_factors text[],
    preventability text DEFAULT 'unknown'::text,
    investigation_status text DEFAULT 'ongoing'::text NOT NULL,
    photos text[],
    documents text[],
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.incident_investigations OWNER TO postgres;

--
-- Name: incident_reports; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.incident_reports (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    location_id uuid,
    reported_by uuid NOT NULL,
    incident_date timestamp with time zone NOT NULL,
    incident_type text DEFAULT 'injury'::text NOT NULL,
    severity text DEFAULT 'minor'::text NOT NULL,
    description text NOT NULL,
    injured_person_name text,
    injured_person_type text,
    injured_person_id uuid,
    equipment_involved uuid,
    area_involved uuid,
    witnesses text[],
    actions_taken text,
    medical_attention_required boolean DEFAULT false,
    medical_provider text,
    follow_up_required boolean DEFAULT false,
    follow_up_date date,
    insurance_notified boolean DEFAULT false,
    insurance_claim_number text,
    status text DEFAULT 'open'::text NOT NULL,
    resolved_by uuid,
    resolved_at timestamp with time zone,
    resolution_notes text,
    photos text[],
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.incident_reports OWNER TO postgres;

--
-- Name: inspection_checklist_items; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.inspection_checklist_items (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    checklist_id uuid NOT NULL,
    item_number integer NOT NULL,
    item_description text NOT NULL,
    is_critical boolean DEFAULT false,
    expected_condition text,
    inspection_method text,
    pass_criteria text,
    fail_criteria text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.inspection_checklist_items OWNER TO postgres;

--
-- Name: inspection_checklists; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.inspection_checklists (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    checklist_name text NOT NULL,
    equipment_type text NOT NULL,
    description text,
    frequency_days integer DEFAULT 30 NOT NULL,
    is_active boolean DEFAULT true,
    requires_certification boolean DEFAULT false,
    created_by uuid NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.inspection_checklists OWNER TO postgres;

--
-- Name: inspection_results; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.inspection_results (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    inspection_id uuid NOT NULL,
    checklist_item_id uuid NOT NULL,
    result_status text NOT NULL,
    inspector_notes text,
    photo_urls text[],
    measurements jsonb,
    action_required text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT inspection_results_result_status_check CHECK ((result_status = ANY (ARRAY['pass'::text, 'fail'::text, 'not_applicable'::text, 'needs_repair'::text])))
);


ALTER TABLE public.inspection_results OWNER TO postgres;

--
-- Name: instructor_availability; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.instructor_availability (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    instructor_id uuid NOT NULL,
    day_of_week integer NOT NULL,
    start_time time without time zone NOT NULL,
    end_time time without time zone NOT NULL,
    is_available boolean DEFAULT true NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT instructor_availability_day_of_week_check CHECK (((day_of_week >= 0) AND (day_of_week <= 6)))
);


ALTER TABLE public.instructor_availability OWNER TO postgres;

--
-- Name: insurance_claims; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.insurance_claims (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    incident_report_id uuid NOT NULL,
    claim_number text NOT NULL,
    insurance_company text NOT NULL,
    policy_number text,
    claim_type text DEFAULT 'liability'::text NOT NULL,
    claim_amount numeric,
    claim_status text DEFAULT 'filed'::text NOT NULL,
    filed_date date DEFAULT CURRENT_DATE NOT NULL,
    adjuster_name text,
    adjuster_contact text,
    settlement_amount numeric,
    settlement_date date,
    claim_notes text,
    documents text[],
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.insurance_claims OWNER TO postgres;

--
-- Name: integration_logs; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.integration_logs (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    integration_id uuid,
    api_key_id uuid,
    event_type text NOT NULL,
    details jsonb DEFAULT '{}'::jsonb,
    status text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT integration_logs_status_check CHECK ((status = ANY (ARRAY['success'::text, 'error'::text, 'warning'::text])))
);


ALTER TABLE public.integration_logs OWNER TO postgres;

--
-- Name: integrations; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.integrations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    name text NOT NULL,
    integration_type text NOT NULL,
    status text DEFAULT 'inactive'::text NOT NULL,
    config jsonb DEFAULT '{}'::jsonb,
    last_sync_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT integrations_status_check CHECK ((status = ANY (ARRAY['active'::text, 'inactive'::text, 'error'::text])))
);


ALTER TABLE public.integrations OWNER TO postgres;

--
-- Name: inventory_items; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.inventory_items (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    product_id uuid NOT NULL,
    location_id uuid,
    current_stock integer DEFAULT 0 NOT NULL,
    min_stock_level integer DEFAULT 0,
    max_stock_level integer,
    reorder_point integer DEFAULT 0,
    last_restocked_at timestamp with time zone,
    last_count_date date,
    cost_per_unit numeric(10,2),
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.inventory_items OWNER TO postgres;

--
-- Name: kpi_metrics; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.kpi_metrics (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    metric_name text NOT NULL,
    metric_category text NOT NULL,
    metric_value numeric(15,2) NOT NULL,
    target_value numeric(15,2),
    metric_unit text,
    period_start date NOT NULL,
    period_end date NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT kpi_metrics_metric_category_check CHECK ((metric_category = ANY (ARRAY['financial'::text, 'operational'::text, 'marketing'::text, 'member_engagement'::text, 'staff'::text])))
);


ALTER TABLE public.kpi_metrics OWNER TO postgres;

--
-- Name: lead_activities; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.lead_activities (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    lead_id uuid NOT NULL,
    activity_type text NOT NULL,
    title text NOT NULL,
    description text,
    scheduled_at timestamp with time zone,
    completed_at timestamp with time zone,
    created_by uuid NOT NULL,
    outcome text,
    next_action text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.lead_activities OWNER TO postgres;

--
-- Name: lead_attribution_disputes; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.lead_attribution_disputes (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    lead_id uuid NOT NULL,
    disputing_salesperson_id uuid NOT NULL,
    current_salesperson_id uuid,
    dispute_reason text NOT NULL,
    evidence text,
    status text DEFAULT 'pending'::text NOT NULL,
    reviewed_by uuid,
    reviewed_at timestamp with time zone,
    resolution_notes text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT lead_attribution_disputes_status_check CHECK ((status = ANY (ARRAY['pending'::text, 'approved'::text, 'rejected'::text])))
);


ALTER TABLE public.lead_attribution_disputes OWNER TO postgres;

--
-- Name: lead_scoring_rules; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.lead_scoring_rules (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    rule_name text NOT NULL,
    criteria_type text NOT NULL,
    criteria_field text NOT NULL,
    criteria_operator text NOT NULL,
    criteria_value text NOT NULL,
    score_points integer DEFAULT 0 NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT lead_scoring_rules_criteria_operator_check CHECK ((criteria_operator = ANY (ARRAY['equals'::text, 'contains'::text, 'greater_than'::text, 'less_than'::text, 'exists'::text]))),
    CONSTRAINT lead_scoring_rules_criteria_type_check CHECK ((criteria_type = ANY (ARRAY['source'::text, 'demographic'::text, 'behavioral'::text, 'engagement'::text])))
);


ALTER TABLE public.lead_scoring_rules OWNER TO postgres;

--
-- Name: lead_sources; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.lead_sources (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    name text NOT NULL,
    description text,
    source_type text DEFAULT 'digital'::text NOT NULL,
    tracking_url text,
    utm_parameters jsonb,
    cost_per_lead numeric(10,2),
    conversion_rate numeric(5,2),
    is_active boolean DEFAULT true NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.lead_sources OWNER TO postgres;

--
-- Name: lead_split_commissions; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.lead_split_commissions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    lead_id uuid NOT NULL,
    salesperson_id uuid NOT NULL,
    commission_percentage numeric NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_by uuid,
    CONSTRAINT lead_split_commissions_commission_percentage_check CHECK (((commission_percentage > (0)::numeric) AND (commission_percentage <= (100)::numeric)))
);


ALTER TABLE public.lead_split_commissions OWNER TO postgres;

--
-- Name: lead_stages; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.lead_stages (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    name text NOT NULL,
    description text,
    order_index integer NOT NULL,
    color text DEFAULT '#6b7280'::text,
    is_closed boolean DEFAULT false,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.lead_stages OWNER TO postgres;

--
-- Name: leads; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.leads (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    email text NOT NULL,
    first_name text,
    last_name text,
    phone text,
    status text DEFAULT 'lead'::text,
    stage_id uuid,
    assigned_to uuid,
    source text,
    interest_level text DEFAULT 'cold'::text,
    estimated_value numeric,
    last_contact_date timestamp with time zone,
    next_follow_up_date timestamp with time zone,
    notes text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    entered_by uuid,
    assigned_salesperson uuid,
    referral_code text,
    attribution_status text DEFAULT 'confirmed'::text,
    lead_score integer DEFAULT 0,
    qualification_status text DEFAULT 'unqualified'::text,
    CONSTRAINT leads_attribution_status_check CHECK ((attribution_status = ANY (ARRAY['confirmed'::text, 'disputed'::text, 'pending_approval'::text]))),
    CONSTRAINT leads_qualification_status_check CHECK ((qualification_status = ANY (ARRAY['unqualified'::text, 'cold'::text, 'warm'::text, 'hot'::text, 'qualified'::text])))
);


ALTER TABLE public.leads OWNER TO postgres;

--
-- Name: liability_waivers; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.liability_waivers (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    visitor_checkin_id uuid,
    signee_name text NOT NULL,
    signee_email text,
    signature_data text,
    waiver_content text NOT NULL,
    signed_at timestamp with time zone DEFAULT now() NOT NULL,
    witness_staff_id uuid,
    ip_address text,
    created_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.liability_waivers OWNER TO postgres;

--
-- Name: lifeguard_schedules; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.lifeguard_schedules (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    pool_id uuid NOT NULL,
    lifeguard_id uuid NOT NULL,
    scheduled_date date NOT NULL,
    start_time time without time zone NOT NULL,
    end_time time without time zone NOT NULL,
    shift_type text DEFAULT 'regular'::text,
    is_head_lifeguard boolean DEFAULT false,
    certification_expires date,
    created_by uuid NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    status text DEFAULT 'scheduled'::text,
    notes text
);


ALTER TABLE public.lifeguard_schedules OWNER TO postgres;

--
-- Name: location_analytics; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.location_analytics (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    location_id uuid NOT NULL,
    analytics_date date DEFAULT CURRENT_DATE NOT NULL,
    total_members integer DEFAULT 0,
    active_members integer DEFAULT 0,
    new_members integer DEFAULT 0,
    cancelled_members integer DEFAULT 0,
    daily_checkins integer DEFAULT 0,
    peak_hour_checkins integer DEFAULT 0,
    revenue_total numeric(12,2) DEFAULT 0.00,
    revenue_memberships numeric(12,2) DEFAULT 0.00,
    revenue_classes numeric(12,2) DEFAULT 0.00,
    revenue_personal_training numeric(12,2) DEFAULT 0.00,
    revenue_retail numeric(12,2) DEFAULT 0.00,
    classes_held integer DEFAULT 0,
    equipment_maintenance_requests integer DEFAULT 0,
    staff_hours_worked numeric(8,2) DEFAULT 0.00,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.location_analytics OWNER TO postgres;

--
-- Name: location_hierarchies; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.location_hierarchies (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    parent_location_id uuid,
    child_location_id uuid NOT NULL,
    hierarchy_type text DEFAULT 'branch'::text NOT NULL,
    relationship_start_date date DEFAULT CURRENT_DATE NOT NULL,
    relationship_end_date date,
    is_active boolean DEFAULT true,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.location_hierarchies OWNER TO postgres;

--
-- Name: locations; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.locations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    name text NOT NULL,
    address text,
    phone text,
    email text,
    timezone text DEFAULT 'America/New_York'::text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    is_headquarters boolean DEFAULT false,
    location_code text,
    region text,
    district text,
    manager_id uuid,
    operating_hours jsonb DEFAULT '{}'::jsonb,
    max_capacity integer,
    square_footage integer,
    parking_spaces integer,
    amenities jsonb DEFAULT '[]'::jsonb,
    status text DEFAULT 'active'::text
);


ALTER TABLE public.locations OWNER TO postgres;

--
-- Name: locker_access_log; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.locker_access_log (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    locker_id uuid NOT NULL,
    member_id uuid,
    staff_id uuid,
    access_type text DEFAULT 'member_access'::text NOT NULL,
    access_time timestamp with time zone DEFAULT now() NOT NULL,
    access_method text DEFAULT 'combination'::text,
    notes text,
    created_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.locker_access_log OWNER TO postgres;

--
-- Name: locker_maintenance; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.locker_maintenance (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    locker_id uuid NOT NULL,
    maintenance_type text DEFAULT 'inspection'::text NOT NULL,
    performed_by uuid,
    maintenance_date timestamp with time zone DEFAULT now() NOT NULL,
    issue_description text,
    resolution_notes text,
    parts_replaced text[],
    labor_time_minutes integer,
    cost numeric DEFAULT 0,
    follow_up_required boolean DEFAULT false,
    follow_up_date date,
    status text DEFAULT 'completed'::text NOT NULL,
    photos text[],
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.locker_maintenance OWNER TO postgres;

--
-- Name: locker_rentals; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.locker_rentals (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    locker_id uuid NOT NULL,
    member_id uuid NOT NULL,
    rental_type text DEFAULT 'monthly'::text NOT NULL,
    start_date date DEFAULT CURRENT_DATE NOT NULL,
    end_date date,
    monthly_rate numeric NOT NULL,
    deposit_paid numeric DEFAULT 0,
    deposit_refunded boolean DEFAULT false,
    auto_renew boolean DEFAULT true,
    status text DEFAULT 'active'::text NOT NULL,
    payment_method text DEFAULT 'auto'::text,
    last_payment_date date,
    next_payment_due date,
    notes text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.locker_rentals OWNER TO postgres;

--
-- Name: lockers; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.lockers (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    location_id uuid,
    locker_number text NOT NULL,
    locker_type text DEFAULT 'standard'::text NOT NULL,
    size_category text DEFAULT 'medium'::text NOT NULL,
    has_lock boolean DEFAULT true,
    lock_type text DEFAULT 'combination'::text,
    lock_combination text,
    key_number text,
    monthly_rate numeric DEFAULT 10.00,
    daily_rate numeric DEFAULT 2.00,
    deposit_amount numeric DEFAULT 25.00,
    is_available boolean DEFAULT true,
    is_out_of_order boolean DEFAULT false,
    maintenance_notes text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.lockers OWNER TO postgres;

--
-- Name: loyalty_points; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.loyalty_points (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    member_id uuid NOT NULL,
    points_earned integer DEFAULT 0 NOT NULL,
    points_redeemed integer DEFAULT 0 NOT NULL,
    current_balance integer DEFAULT 0 NOT NULL,
    reason text NOT NULL,
    activity_type text NOT NULL,
    reference_id uuid,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT loyalty_points_activity_type_check CHECK ((activity_type = ANY (ARRAY['check_in'::text, 'referral'::text, 'class_attendance'::text, 'milestone'::text, 'bonus'::text, 'redemption'::text])))
);


ALTER TABLE public.loyalty_points OWNER TO postgres;

--
-- Name: loyalty_program_rules; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.loyalty_program_rules (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    activity_type text NOT NULL,
    points_awarded integer DEFAULT 0 NOT NULL,
    description text,
    is_active boolean DEFAULT true,
    conditions jsonb,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.loyalty_program_rules OWNER TO postgres;

--
-- Name: loyalty_redemptions; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.loyalty_redemptions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    member_id uuid NOT NULL,
    reward_id uuid NOT NULL,
    points_used integer NOT NULL,
    status text DEFAULT 'pending'::text NOT NULL,
    redeemed_at timestamp with time zone DEFAULT now() NOT NULL,
    fulfilled_at timestamp with time zone,
    fulfilled_by uuid,
    notes text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT loyalty_redemptions_status_check CHECK ((status = ANY (ARRAY['pending'::text, 'approved'::text, 'completed'::text, 'cancelled'::text])))
);


ALTER TABLE public.loyalty_redemptions OWNER TO postgres;

--
-- Name: loyalty_rewards; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.loyalty_rewards (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    name text NOT NULL,
    description text,
    category text DEFAULT 'general'::text NOT NULL,
    points_cost integer NOT NULL,
    is_active boolean DEFAULT true,
    stock_quantity integer,
    redemption_limit integer,
    expiry_date date,
    terms_conditions text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.loyalty_rewards OWNER TO postgres;

--
-- Name: maintenance_logs; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.maintenance_logs (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    equipment_id uuid NOT NULL,
    maintenance_schedule_id uuid,
    performed_by uuid NOT NULL,
    maintenance_date timestamp with time zone DEFAULT now() NOT NULL,
    maintenance_type text NOT NULL,
    description text NOT NULL,
    parts_used text[],
    labor_hours numeric,
    cost numeric,
    next_maintenance_date date,
    photos text[],
    notes text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.maintenance_logs OWNER TO postgres;

--
-- Name: maintenance_schedules; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.maintenance_schedules (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    equipment_id uuid NOT NULL,
    maintenance_type text DEFAULT 'routine'::text NOT NULL,
    title text NOT NULL,
    description text,
    scheduled_date date NOT NULL,
    estimated_duration_minutes integer DEFAULT 60,
    assigned_to uuid,
    priority text DEFAULT 'medium'::text NOT NULL,
    status text DEFAULT 'scheduled'::text NOT NULL,
    completion_date timestamp with time zone,
    completion_notes text,
    cost numeric,
    vendor_id uuid,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.maintenance_schedules OWNER TO postgres;

--
-- Name: marketing_analytics; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.marketing_analytics (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    campaign_id uuid,
    campaign_type text NOT NULL,
    campaign_name text NOT NULL,
    period_start date NOT NULL,
    period_end date NOT NULL,
    impressions integer DEFAULT 0,
    clicks integer DEFAULT 0,
    conversions integer DEFAULT 0,
    leads_generated integer DEFAULT 0,
    cost numeric(10,2) DEFAULT 0,
    revenue numeric(10,2) DEFAULT 0,
    roi numeric(8,2) DEFAULT 0,
    click_through_rate numeric(5,2) DEFAULT 0,
    conversion_rate numeric(5,2) DEFAULT 0,
    cost_per_lead numeric(10,2) DEFAULT 0,
    customer_acquisition_cost numeric(10,2) DEFAULT 0,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.marketing_analytics OWNER TO postgres;

--
-- Name: marketing_campaigns; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.marketing_campaigns (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    name text NOT NULL,
    campaign_type text NOT NULL,
    status text DEFAULT 'draft'::text NOT NULL,
    subject text,
    content text NOT NULL,
    target_segment text DEFAULT 'all_members'::text NOT NULL,
    custom_recipients uuid[],
    scheduled_at timestamp with time zone,
    sent_at timestamp with time zone,
    sent_count integer DEFAULT 0,
    delivered_count integer DEFAULT 0,
    opened_count integer DEFAULT 0,
    clicked_count integer DEFAULT 0,
    unsubscribed_count integer DEFAULT 0,
    bounced_count integer DEFAULT 0,
    created_by uuid NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT marketing_campaigns_campaign_type_check CHECK ((campaign_type = ANY (ARRAY['email'::text, 'sms'::text, 'push'::text, 'in_app'::text]))),
    CONSTRAINT marketing_campaigns_status_check CHECK ((status = ANY (ARRAY['draft'::text, 'scheduled'::text, 'active'::text, 'paused'::text, 'completed'::text, 'cancelled'::text]))),
    CONSTRAINT marketing_campaigns_target_segment_check CHECK ((target_segment = ANY (ARRAY['all_members'::text, 'new_members'::text, 'active_members'::text, 'at_risk_members'::text, 'vip_members'::text, 'custom'::text])))
);


ALTER TABLE public.marketing_campaigns OWNER TO postgres;

--
-- Name: member_analytics_snapshots; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.member_analytics_snapshots (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    snapshot_date date NOT NULL,
    total_members integer DEFAULT 0 NOT NULL,
    active_members integer DEFAULT 0 NOT NULL,
    new_members integer DEFAULT 0 NOT NULL,
    churned_members integer DEFAULT 0 NOT NULL,
    average_visits_per_member numeric(5,2) DEFAULT 0,
    retention_rate numeric(5,2) DEFAULT 0,
    created_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.member_analytics_snapshots OWNER TO postgres;

--
-- Name: profiles; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.profiles (
    id uuid NOT NULL,
    organization_id uuid NOT NULL,
    location_id uuid,
    email text NOT NULL,
    first_name text,
    last_name text,
    phone text,
    role public.user_role DEFAULT 'member'::public.user_role NOT NULL,
    avatar_url text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    barcode text,
    barcode_generated_at timestamp with time zone DEFAULT now(),
    address_line1 text,
    address_line2 text,
    city text,
    state text,
    postal_code text,
    country text DEFAULT 'US'::text,
    date_of_birth date,
    gender text,
    emergency_contact_name text,
    emergency_contact_phone text,
    interests text[] DEFAULT '{}'::text[],
    join_date date,
    member_notes text,
    parent_member_id uuid,
    relationship_type text,
    family_notes text,
    hire_date date,
    hourly_rate numeric(10,2),
    status text DEFAULT 'active'::text,
    certifications text[],
    employee_id text,
    department text,
    onboarding_state jsonb,
    dashboard_preferences jsonb,
    CONSTRAINT profiles_relationship_type_check CHECK ((relationship_type = ANY (ARRAY['parent'::text, 'child'::text, 'spouse'::text, 'guardian'::text, 'dependent'::text]))),
    CONSTRAINT profiles_status_check CHECK ((status = ANY (ARRAY['active'::text, 'inactive'::text, 'on_leave'::text])))
);


ALTER TABLE public.profiles OWNER TO postgres;

--
-- Name: COLUMN profiles.onboarding_state; Type: COMMENT; Schema: public; Owner: postgres
--

COMMENT ON COLUMN public.profiles.onboarding_state IS 'Stores user onboarding tour progress and state';


--
-- Name: COLUMN profiles.dashboard_preferences; Type: COMMENT; Schema: public; Owner: postgres
--

COMMENT ON COLUMN public.profiles.dashboard_preferences IS 'Stores user dashboard widget preferences and layout';


--
-- Name: member_attendance_summary; Type: VIEW; Schema: public; Owner: postgres
--

CREATE VIEW public.member_attendance_summary WITH (security_invoker='true') AS
 SELECT p.id AS member_id,
    p.first_name,
    p.last_name,
    p.email,
    count(c.id) AS total_visits,
    count(
        CASE
            WHEN (c.checked_in_at >= (CURRENT_DATE - '30 days'::interval)) THEN 1
            ELSE NULL::integer
        END) AS visits_last_30_days,
    count(
        CASE
            WHEN (c.checked_in_at >= (CURRENT_DATE - '7 days'::interval)) THEN 1
            ELSE NULL::integer
        END) AS visits_last_7_days,
    max(c.checked_in_at) AS last_visit,
    avg((EXTRACT(epoch FROM (c.checked_out_at - c.checked_in_at)) / (60)::numeric)) AS avg_duration_minutes
   FROM (public.profiles p
     LEFT JOIN public.check_ins c ON (((p.id = c.member_id) AND (c.is_guest = false))))
  WHERE (p.role = 'member'::public.user_role)
  GROUP BY p.id, p.first_name, p.last_name, p.email;


ALTER VIEW public.member_attendance_summary OWNER TO postgres;

--
-- Name: member_cards; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.member_cards (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    member_id uuid NOT NULL,
    card_number text NOT NULL,
    nfc_enabled boolean DEFAULT false,
    nfc_uid text,
    barcode text,
    qr_code text,
    status text DEFAULT 'active'::text,
    issued_at timestamp with time zone DEFAULT now() NOT NULL,
    expires_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT member_cards_status_check CHECK ((status = ANY (ARRAY['active'::text, 'suspended'::text, 'lost'::text, 'damaged'::text])))
);


ALTER TABLE public.member_cards OWNER TO postgres;

--
-- Name: member_cohorts; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.member_cohorts (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    cohort_period text NOT NULL,
    cohort_size integer DEFAULT 0 NOT NULL,
    month_1_retained integer DEFAULT 0,
    month_2_retained integer DEFAULT 0,
    month_3_retained integer DEFAULT 0,
    month_6_retained integer DEFAULT 0,
    month_12_retained integer DEFAULT 0,
    month_1_rate numeric(5,2) DEFAULT 0,
    month_2_rate numeric(5,2) DEFAULT 0,
    month_3_rate numeric(5,2) DEFAULT 0,
    month_6_rate numeric(5,2) DEFAULT 0,
    month_12_rate numeric(5,2) DEFAULT 0,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.member_cohorts OWNER TO postgres;

--
-- Name: member_documents; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.member_documents (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    member_id uuid NOT NULL,
    document_name text NOT NULL,
    document_type text NOT NULL,
    file_url text,
    file_size integer,
    uploaded_by uuid,
    notes text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT member_documents_document_type_check CHECK ((document_type = ANY (ARRAY['waiver'::text, 'medical'::text, 'contract'::text, 'photo_id'::text, 'payment'::text, 'other'::text])))
);


ALTER TABLE public.member_documents OWNER TO postgres;

--
-- Name: member_engagement_history; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.member_engagement_history (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    member_id uuid NOT NULL,
    engagement_type text NOT NULL,
    engagement_value numeric DEFAULT 1,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT member_engagement_history_engagement_type_check CHECK ((engagement_type = ANY (ARRAY['check_in'::text, 'class_booking'::text, 'message_sent'::text, 'message_opened'::text, 'announcement_viewed'::text, 'app_usage'::text, 'payment'::text, 'referral'::text])))
);


ALTER TABLE public.member_engagement_history OWNER TO postgres;

--
-- Name: member_engagement_summary; Type: VIEW; Schema: public; Owner: postgres
--

CREATE VIEW public.member_engagement_summary WITH (security_invoker='true') AS
 SELECT p.id AS member_id,
    p.first_name,
    p.last_name,
    p.email,
    p.organization_id,
    p.join_date,
    COALESCE(visit_stats.total_visits, (0)::bigint) AS total_visits,
    COALESCE(visit_stats.visits_last_30_days, (0)::bigint) AS visits_last_30_days,
    COALESCE(visit_stats.avg_visit_duration, (0)::numeric) AS avg_visit_duration_minutes,
    COALESCE(class_stats.classes_attended, (0)::bigint) AS classes_attended,
    COALESCE(class_stats.classes_booked_last_30, (0)::bigint) AS classes_booked_last_30,
        CASE
            WHEN (visit_stats.last_visit_date >= (CURRENT_DATE - '7 days'::interval)) THEN 'active'::text
            WHEN (visit_stats.last_visit_date >= (CURRENT_DATE - '30 days'::interval)) THEN 'at_risk'::text
            ELSE 'inactive'::text
        END AS engagement_status,
    visit_stats.last_visit_date
   FROM ((public.profiles p
     LEFT JOIN ( SELECT check_ins.member_id,
            count(*) AS total_visits,
            count(
                CASE
                    WHEN (check_ins.checked_in_at >= (CURRENT_DATE - '30 days'::interval)) THEN 1
                    ELSE NULL::integer
                END) AS visits_last_30_days,
            avg((EXTRACT(epoch FROM (check_ins.checked_out_at - check_ins.checked_in_at)) / (60)::numeric)) AS avg_visit_duration,
            max(check_ins.checked_in_at) AS last_visit_date
           FROM public.check_ins
          WHERE (check_ins.is_guest = false)
          GROUP BY check_ins.member_id) visit_stats ON ((p.id = visit_stats.member_id)))
     LEFT JOIN ( SELECT class_bookings.member_id,
            count(*) AS classes_attended,
            count(
                CASE
                    WHEN (class_bookings.booked_at >= (CURRENT_DATE - '30 days'::interval)) THEN 1
                    ELSE NULL::integer
                END) AS classes_booked_last_30
           FROM public.class_bookings
          WHERE (class_bookings.status = 'booked'::text)
          GROUP BY class_bookings.member_id) class_stats ON ((p.id = class_stats.member_id)))
  WHERE (p.role = 'member'::public.user_role);


ALTER VIEW public.member_engagement_summary OWNER TO postgres;

--
-- Name: member_feedback; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.member_feedback (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    member_id uuid NOT NULL,
    feedback_type text NOT NULL,
    rating integer,
    title text NOT NULL,
    content text NOT NULL,
    is_anonymous boolean DEFAULT false,
    status text DEFAULT 'pending'::text NOT NULL,
    assigned_to uuid,
    response text,
    responded_by uuid,
    responded_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT member_feedback_feedback_type_check CHECK ((feedback_type = ANY (ARRAY['general'::text, 'service'::text, 'facility'::text, 'equipment'::text, 'staff'::text, 'class'::text, 'suggestion'::text, 'complaint'::text]))),
    CONSTRAINT member_feedback_rating_check CHECK (((rating >= 1) AND (rating <= 5))),
    CONSTRAINT member_feedback_status_check CHECK ((status = ANY (ARRAY['pending'::text, 'in_review'::text, 'resolved'::text, 'closed'::text])))
);


ALTER TABLE public.member_feedback OWNER TO postgres;

--
-- Name: member_location_access; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.member_location_access (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    member_id uuid NOT NULL,
    location_id uuid NOT NULL,
    access_type text DEFAULT 'full'::text NOT NULL,
    access_start_date date DEFAULT CURRENT_DATE NOT NULL,
    access_end_date date,
    visit_limit integer,
    visits_used integer DEFAULT 0,
    additional_fee numeric(10,2) DEFAULT 0.00,
    is_active boolean DEFAULT true,
    granted_by uuid NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.member_location_access OWNER TO postgres;

--
-- Name: member_messages; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.member_messages (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    sender_id uuid NOT NULL,
    recipient_id uuid NOT NULL,
    subject text NOT NULL,
    content text NOT NULL,
    message_type text DEFAULT 'general'::text NOT NULL,
    status text DEFAULT 'sent'::text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT member_messages_message_type_check CHECK ((message_type = ANY (ARRAY['general'::text, 'reminder'::text, 'announcement'::text, 'support'::text]))),
    CONSTRAINT member_messages_status_check CHECK ((status = ANY (ARRAY['sent'::text, 'delivered'::text, 'read'::text])))
);


ALTER TABLE public.member_messages OWNER TO postgres;

--
-- Name: member_milestones; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.member_milestones (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    member_id uuid NOT NULL,
    milestone_type text NOT NULL,
    title text NOT NULL,
    description text,
    achievement_date date NOT NULL,
    recognition_sent boolean DEFAULT false NOT NULL,
    recognition_sent_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT member_milestones_milestone_type_check CHECK ((milestone_type = ANY (ARRAY['membership_anniversary'::text, 'birthday'::text, 'fitness_goal'::text, 'attendance'::text, 'referral'::text])))
);


ALTER TABLE public.member_milestones OWNER TO postgres;

--
-- Name: member_orientations; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.member_orientations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    member_id uuid NOT NULL,
    orientation_type text NOT NULL,
    scheduled_date date NOT NULL,
    scheduled_time text NOT NULL,
    special_requests text,
    status text DEFAULT 'scheduled'::text NOT NULL,
    completed_at timestamp with time zone,
    staff_notes text,
    created_by uuid,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT member_orientations_orientation_type_check CHECK ((orientation_type = ANY (ARRAY['gym_tour'::text, 'personal_training'::text, 'group_orientation'::text]))),
    CONSTRAINT member_orientations_status_check CHECK ((status = ANY (ARRAY['scheduled'::text, 'completed'::text, 'cancelled'::text, 'no_show'::text])))
);


ALTER TABLE public.member_orientations OWNER TO postgres;

--
-- Name: member_referrals; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.member_referrals (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    program_id uuid NOT NULL,
    referrer_id uuid NOT NULL,
    referee_email text NOT NULL,
    referee_name text,
    referral_code text,
    status text DEFAULT 'pending'::text NOT NULL,
    signup_date timestamp with time zone,
    conversion_date timestamp with time zone,
    reward_given_date timestamp with time zone,
    notes text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT member_referrals_status_check CHECK ((status = ANY (ARRAY['pending'::text, 'signed_up'::text, 'converted'::text, 'rewarded'::text, 'expired'::text])))
);


ALTER TABLE public.member_referrals OWNER TO postgres;

--
-- Name: member_segments; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.member_segments (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    name text NOT NULL,
    description text,
    criteria jsonb NOT NULL,
    member_count integer DEFAULT 0,
    last_calculated_at timestamp with time zone,
    is_dynamic boolean DEFAULT true,
    created_by uuid NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.member_segments OWNER TO postgres;

--
-- Name: member_training_packages; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.member_training_packages (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    member_id uuid NOT NULL,
    package_id uuid NOT NULL,
    sessions_remaining integer NOT NULL,
    purchased_at timestamp with time zone DEFAULT now() NOT NULL,
    expires_at timestamp with time zone NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.member_training_packages OWNER TO postgres;

--
-- Name: membership_agreement_templates; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.membership_agreement_templates (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    name text NOT NULL,
    content text NOT NULL,
    is_default boolean DEFAULT false,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.membership_agreement_templates OWNER TO postgres;

--
-- Name: membership_agreements; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.membership_agreements (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    member_id uuid NOT NULL,
    template_id uuid,
    agreement_content text NOT NULL,
    signed_at timestamp with time zone DEFAULT now() NOT NULL,
    signature_data text,
    witness_id uuid,
    created_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.membership_agreements OWNER TO postgres;

--
-- Name: membership_plans; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.membership_plans (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    name text NOT NULL,
    description text,
    price numeric(10,2) NOT NULL,
    billing_interval text NOT NULL,
    access_level text DEFAULT 'single_location'::text,
    max_classes_per_month integer,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    plan_type text DEFAULT 'individual'::text,
    requires_commitment boolean DEFAULT false,
    commitment_months integer,
    signup_fee numeric DEFAULT 0,
    annual_maintenance_fee numeric DEFAULT 0,
    is_prepaid boolean DEFAULT false,
    prepaid_months integer,
    features text[] DEFAULT '{}'::text[],
    CONSTRAINT membership_plans_billing_interval_check CHECK ((billing_interval = ANY (ARRAY['monthly'::text, 'weekly'::text, 'yearly'::text]))),
    CONSTRAINT membership_plans_plan_type_check CHECK ((plan_type = ANY (ARRAY['individual'::text, 'couple'::text, 'family'::text, 'corporate'::text])))
);


ALTER TABLE public.membership_plans OWNER TO postgres;

--
-- Name: memberships; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.memberships (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    member_id uuid NOT NULL,
    plan_id uuid NOT NULL,
    status public.membership_status DEFAULT 'active'::public.membership_status NOT NULL,
    start_date timestamp with time zone DEFAULT now() NOT NULL,
    end_date timestamp with time zone,
    next_billing_date timestamp with time zone,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.memberships OWNER TO postgres;

--
-- Name: message_history; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.message_history (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    recipient_type text NOT NULL,
    recipient_id uuid NOT NULL,
    message_type text NOT NULL,
    template_id uuid,
    subject text,
    content text NOT NULL,
    status text DEFAULT 'pending'::text NOT NULL,
    sent_at timestamp with time zone,
    delivered_at timestamp with time zone,
    error_message text,
    metadata jsonb DEFAULT '{}'::jsonb,
    sent_by uuid NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT message_history_message_type_check CHECK ((message_type = ANY (ARRAY['sms'::text, 'email'::text, 'push'::text]))),
    CONSTRAINT message_history_recipient_type_check CHECK ((recipient_type = ANY (ARRAY['member'::text, 'staff'::text, 'lead'::text]))),
    CONSTRAINT message_history_status_check CHECK ((status = ANY (ARRAY['pending'::text, 'sent'::text, 'delivered'::text, 'failed'::text])))
);


ALTER TABLE public.message_history OWNER TO postgres;

--
-- Name: messages; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.messages (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    sender_id uuid NOT NULL,
    recipient_id uuid NOT NULL,
    subject text NOT NULL,
    content text NOT NULL,
    is_read boolean DEFAULT false NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.messages OWNER TO postgres;

--
-- Name: notification_preferences; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.notification_preferences (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    member_id uuid NOT NULL,
    email_enabled boolean DEFAULT true NOT NULL,
    sms_enabled boolean DEFAULT false NOT NULL,
    push_enabled boolean DEFAULT true NOT NULL,
    class_reminders boolean DEFAULT true NOT NULL,
    waitlist_updates boolean DEFAULT true NOT NULL,
    membership_updates boolean DEFAULT true NOT NULL,
    marketing_notifications boolean DEFAULT false NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.notification_preferences OWNER TO postgres;

--
-- Name: notification_templates; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.notification_templates (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    name text NOT NULL,
    template_type text NOT NULL,
    subject text NOT NULL,
    content text NOT NULL,
    variables jsonb DEFAULT '{}'::jsonb,
    is_active boolean DEFAULT true NOT NULL,
    created_by uuid NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.notification_templates OWNER TO postgres;

--
-- Name: notifications; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.notifications (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    member_id uuid NOT NULL,
    type text DEFAULT 'general'::text NOT NULL,
    title text NOT NULL,
    message text NOT NULL,
    status text DEFAULT 'unread'::text NOT NULL,
    priority text DEFAULT 'normal'::text NOT NULL,
    scheduled_for timestamp with time zone,
    sent_at timestamp with time zone,
    read_at timestamp with time zone,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.notifications OWNER TO postgres;

--
-- Name: organization_commission_settings; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.organization_commission_settings (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    default_commission_type text NOT NULL,
    default_commission_value numeric NOT NULL,
    default_revenue_basis text NOT NULL,
    default_duration_months integer,
    allow_split_commissions boolean DEFAULT false,
    max_split_salespeople integer DEFAULT 2,
    require_manager_approval_for_attribution boolean DEFAULT true,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT organization_commission_settings_default_commission_type_check CHECK ((default_commission_type = ANY (ARRAY['percentage'::text, 'flat_rate'::text]))),
    CONSTRAINT organization_commission_settings_default_revenue_basis_check CHECK ((default_revenue_basis = ANY (ARRAY['total_contract'::text, 'monthly_recurring'::text, 'first_payment'::text])))
);


ALTER TABLE public.organization_commission_settings OWNER TO postgres;

--
-- Name: organizations; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.organizations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    name text NOT NULL,
    slug text NOT NULL,
    logo_url text,
    primary_color text DEFAULT '#2563eb'::text,
    secondary_color text DEFAULT '#f97316'::text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    custom_domain text,
    custom_domain_verified boolean DEFAULT false
);


ALTER TABLE public.organizations OWNER TO postgres;

--
-- Name: payment_transactions; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.payment_transactions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    member_id uuid NOT NULL,
    membership_id uuid,
    amount numeric NOT NULL,
    currency text DEFAULT 'USD'::text,
    payment_method text NOT NULL,
    payment_status text DEFAULT 'pending'::text,
    transaction_reference text,
    stripe_payment_intent_id text,
    processed_by uuid,
    notes text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT payment_transactions_payment_method_check CHECK ((payment_method = ANY (ARRAY['cash'::text, 'card'::text, 'bank_transfer'::text, 'stripe'::text, 'nfc'::text]))),
    CONSTRAINT payment_transactions_payment_status_check CHECK ((payment_status = ANY (ARRAY['pending'::text, 'completed'::text, 'failed'::text, 'refunded'::text])))
);


ALTER TABLE public.payment_transactions OWNER TO postgres;

--
-- Name: payroll_periods; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.payroll_periods (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    start_date date NOT NULL,
    end_date date NOT NULL,
    status text DEFAULT 'draft'::text,
    total_amount numeric(12,2),
    notes text,
    created_by uuid NOT NULL,
    processed_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT payroll_periods_status_check CHECK ((status = ANY (ARRAY['draft'::text, 'processing'::text, 'completed'::text, 'paid'::text])))
);


ALTER TABLE public.payroll_periods OWNER TO postgres;

--
-- Name: personal_training_sessions; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.personal_training_sessions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    trainer_id uuid NOT NULL,
    member_id uuid NOT NULL,
    session_date date NOT NULL,
    start_time time without time zone NOT NULL,
    end_time time without time zone NOT NULL,
    duration_minutes integer DEFAULT 60 NOT NULL,
    session_type text DEFAULT 'individual'::text NOT NULL,
    status text DEFAULT 'scheduled'::text NOT NULL,
    price numeric(10,2) DEFAULT 0.00 NOT NULL,
    notes text,
    cancellation_reason text,
    cancelled_at timestamp with time zone,
    cancelled_by uuid,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.personal_training_sessions OWNER TO postgres;

--
-- Name: pool_facilities; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.pool_facilities (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    location_id uuid,
    pool_name text NOT NULL,
    pool_type text DEFAULT 'indoor'::text NOT NULL,
    length_meters numeric,
    width_meters numeric,
    depth_min numeric,
    depth_max numeric,
    lane_count integer DEFAULT 6,
    temperature_target numeric DEFAULT 78.0,
    is_heated boolean DEFAULT true,
    has_diving_board boolean DEFAULT false,
    has_slides boolean DEFAULT false,
    capacity_max integer DEFAULT 50,
    is_available boolean DEFAULT true,
    is_closed_for_maintenance boolean DEFAULT false,
    operating_hours_start time without time zone DEFAULT '06:00:00'::time without time zone,
    operating_hours_end time without time zone DEFAULT '22:00:00'::time without time zone,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    description text,
    safety_notes text,
    amenities text[]
);


ALTER TABLE public.pool_facilities OWNER TO postgres;

--
-- Name: pool_lane_reservations; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.pool_lane_reservations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    pool_id uuid NOT NULL,
    lane_number integer NOT NULL,
    member_id uuid NOT NULL,
    reservation_date date NOT NULL,
    start_time time without time zone NOT NULL,
    end_time time without time zone NOT NULL,
    duration_minutes integer DEFAULT 60 NOT NULL,
    purpose text DEFAULT 'lap_swimming'::text,
    hourly_rate numeric NOT NULL,
    total_cost numeric NOT NULL,
    payment_status text DEFAULT 'pending'::text,
    payment_method text,
    special_equipment text[],
    special_requests text,
    checked_in_at timestamp with time zone,
    cancelled_at timestamp with time zone,
    cancellation_reason text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    status text DEFAULT 'confirmed'::text NOT NULL
);


ALTER TABLE public.pool_lane_reservations OWNER TO postgres;

--
-- Name: pool_maintenance_logs; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.pool_maintenance_logs (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    pool_id uuid NOT NULL,
    maintenance_type text NOT NULL,
    performed_by uuid NOT NULL,
    maintenance_date date DEFAULT CURRENT_DATE NOT NULL,
    start_time time without time zone NOT NULL,
    end_time time without time zone,
    scheduled_duration_minutes integer,
    actual_duration_minutes integer,
    equipment_used text[],
    chemicals_used jsonb,
    issues_found text,
    actions_performed text NOT NULL,
    followup_required boolean DEFAULT false,
    followup_due_date date,
    cost_estimate numeric,
    actual_cost numeric,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    maintenance_status text DEFAULT 'completed'::text,
    priority_level text DEFAULT 'medium'::text,
    notes text
);


ALTER TABLE public.pool_maintenance_logs OWNER TO postgres;

--
-- Name: pool_maintenance_schedules; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.pool_maintenance_schedules (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    pool_id uuid NOT NULL,
    maintenance_type text NOT NULL,
    title text NOT NULL,
    description text,
    frequency_days integer DEFAULT 7 NOT NULL,
    estimated_duration_minutes integer DEFAULT 60,
    priority text DEFAULT 'medium'::text NOT NULL,
    assigned_to uuid,
    next_due_date date NOT NULL,
    last_completed_date date,
    is_active boolean DEFAULT true,
    requires_pool_closure boolean DEFAULT false,
    equipment_needed jsonb DEFAULT '[]'::jsonb,
    safety_requirements jsonb DEFAULT '[]'::jsonb,
    created_by uuid NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.pool_maintenance_schedules OWNER TO postgres;

--
-- Name: pos_products; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.pos_products (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    name text NOT NULL,
    description text,
    price numeric(10,2) NOT NULL,
    cost numeric(10,2),
    barcode text,
    category text DEFAULT 'general'::text NOT NULL,
    stock_quantity integer DEFAULT 0,
    low_stock_threshold integer DEFAULT 5,
    is_active boolean DEFAULT true,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.pos_products OWNER TO postgres;

--
-- Name: pos_sale_items; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.pos_sale_items (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    sale_id uuid NOT NULL,
    product_id uuid NOT NULL,
    quantity integer DEFAULT 1 NOT NULL,
    unit_price numeric(10,2) NOT NULL,
    total_price numeric(10,2) NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.pos_sale_items OWNER TO postgres;

--
-- Name: pos_sales; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.pos_sales (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    sale_number text NOT NULL,
    cashier_id uuid NOT NULL,
    customer_id uuid,
    subtotal numeric(10,2) DEFAULT 0 NOT NULL,
    tax_amount numeric(10,2) DEFAULT 0 NOT NULL,
    discount_amount numeric(10,2) DEFAULT 0,
    total_amount numeric(10,2) NOT NULL,
    payment_method text DEFAULT 'cash'::text NOT NULL,
    payment_status text DEFAULT 'completed'::text NOT NULL,
    location_id uuid,
    created_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.pos_sales OWNER TO postgres;

--
-- Name: promotions; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.promotions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    name text NOT NULL,
    description text,
    discount_type text NOT NULL,
    discount_value numeric NOT NULL,
    valid_from timestamp with time zone DEFAULT now() NOT NULL,
    valid_until timestamp with time zone,
    applicable_plans text[],
    max_uses integer,
    current_uses integer DEFAULT 0,
    is_active boolean DEFAULT true,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT promotions_discount_type_check CHECK ((discount_type = ANY (ARRAY['percentage'::text, 'fixed_amount'::text, 'free_months'::text])))
);


ALTER TABLE public.promotions OWNER TO postgres;

--
-- Name: quote_line_items; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.quote_line_items (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    quote_id uuid NOT NULL,
    item_type text NOT NULL,
    item_id uuid,
    item_name text NOT NULL,
    description text,
    quantity integer DEFAULT 1 NOT NULL,
    unit_price numeric(10,2) NOT NULL,
    total_price numeric(10,2) NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.quote_line_items OWNER TO postgres;

--
-- Name: referral_programs; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.referral_programs (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    name text NOT NULL,
    description text,
    referrer_reward_type text NOT NULL,
    referrer_reward_value numeric NOT NULL,
    referee_reward_type text,
    referee_reward_value numeric,
    max_referrals_per_member integer,
    program_start_date date NOT NULL,
    program_end_date date,
    is_active boolean DEFAULT true NOT NULL,
    created_by uuid NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT referral_programs_referee_reward_type_check CHECK ((referee_reward_type = ANY (ARRAY['discount'::text, 'free_classes'::text, 'cash_credit'::text, 'loyalty_points'::text, 'merchandise'::text]))),
    CONSTRAINT referral_programs_referrer_reward_type_check CHECK ((referrer_reward_type = ANY (ARRAY['discount'::text, 'free_classes'::text, 'cash_credit'::text, 'loyalty_points'::text, 'merchandise'::text])))
);


ALTER TABLE public.referral_programs OWNER TO postgres;

--
-- Name: resource_bookings; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.resource_bookings (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    resource_id uuid NOT NULL,
    resource_type text NOT NULL,
    booked_by uuid NOT NULL,
    start_time timestamp with time zone NOT NULL,
    end_time timestamp with time zone NOT NULL,
    status text DEFAULT 'confirmed'::text NOT NULL,
    purpose text,
    notes text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT resource_bookings_resource_type_check CHECK ((resource_type = ANY (ARRAY['equipment'::text, 'room'::text]))),
    CONSTRAINT resource_bookings_status_check CHECK ((status = ANY (ARRAY['confirmed'::text, 'cancelled'::text, 'completed'::text])))
);


ALTER TABLE public.resource_bookings OWNER TO postgres;

--
-- Name: retail_products; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.retail_products (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    sku text NOT NULL,
    name text NOT NULL,
    description text,
    category text DEFAULT 'general'::text NOT NULL,
    brand text,
    supplier text,
    cost_price numeric(10,2),
    sale_price numeric(10,2) NOT NULL,
    tax_rate numeric(5,2) DEFAULT 0.00,
    is_active boolean DEFAULT true,
    requires_age_verification boolean DEFAULT false,
    weight_grams integer,
    dimensions text,
    image_url text,
    barcode text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.retail_products OWNER TO postgres;

--
-- Name: retail_transaction_items; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.retail_transaction_items (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    transaction_id uuid NOT NULL,
    product_id uuid NOT NULL,
    quantity integer DEFAULT 1 NOT NULL,
    unit_price numeric(10,2) NOT NULL,
    discount_amount numeric(10,2) DEFAULT 0,
    tax_rate numeric(5,2) DEFAULT 0,
    line_total numeric(10,2) NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.retail_transaction_items OWNER TO postgres;

--
-- Name: retail_transactions; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.retail_transactions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    transaction_number text NOT NULL,
    member_id uuid,
    cashier_id uuid NOT NULL,
    location_id uuid,
    subtotal numeric(10,2) DEFAULT 0 NOT NULL,
    tax_amount numeric(10,2) DEFAULT 0 NOT NULL,
    discount_amount numeric(10,2) DEFAULT 0,
    total_amount numeric(10,2) NOT NULL,
    amount_tendered numeric(10,2),
    change_given numeric(10,2) DEFAULT 0,
    payment_method text DEFAULT 'cash'::text NOT NULL,
    payment_reference text,
    transaction_date timestamp with time zone DEFAULT now() NOT NULL,
    void_reason text,
    voided_by uuid,
    voided_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    status text DEFAULT 'completed'::text NOT NULL,
    notes text
);


ALTER TABLE public.retail_transactions OWNER TO postgres;

--
-- Name: retention_campaigns; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.retention_campaigns (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    name text NOT NULL,
    description text,
    campaign_type text NOT NULL,
    trigger_conditions jsonb DEFAULT '{}'::jsonb NOT NULL,
    message_template text NOT NULL,
    reward_type text,
    reward_value numeric,
    is_active boolean DEFAULT true NOT NULL,
    start_date date,
    end_date date,
    created_by uuid NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT retention_campaigns_campaign_type_check CHECK ((campaign_type = ANY (ARRAY['win_back'::text, 'at_risk'::text, 'loyalty_reward'::text, 'milestone_celebration'::text, 'birthday'::text, 'anniversary'::text]))),
    CONSTRAINT retention_campaigns_reward_type_check CHECK ((reward_type = ANY (ARRAY['discount'::text, 'free_classes'::text, 'merchandise'::text, 'loyalty_points'::text, 'guest_pass'::text])))
);


ALTER TABLE public.retention_campaigns OWNER TO postgres;

--
-- Name: revenue_analytics; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.revenue_analytics (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    period_start date NOT NULL,
    period_end date NOT NULL,
    period_type text NOT NULL,
    total_revenue numeric(10,2) DEFAULT 0 NOT NULL,
    membership_revenue numeric(10,2) DEFAULT 0 NOT NULL,
    class_revenue numeric(10,2) DEFAULT 0 NOT NULL,
    other_revenue numeric(10,2) DEFAULT 0 NOT NULL,
    refunds numeric(10,2) DEFAULT 0 NOT NULL,
    net_revenue numeric(10,2) DEFAULT 0 NOT NULL,
    transaction_count integer DEFAULT 0 NOT NULL,
    average_transaction_value numeric(10,2) DEFAULT 0 NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT revenue_analytics_period_type_check CHECK ((period_type = ANY (ARRAY['daily'::text, 'weekly'::text, 'monthly'::text, 'quarterly'::text, 'yearly'::text])))
);


ALTER TABLE public.revenue_analytics OWNER TO postgres;

--
-- Name: safety_inspections; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.safety_inspections (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    equipment_id uuid NOT NULL,
    checklist_id uuid NOT NULL,
    inspector_id uuid NOT NULL,
    scheduled_date date NOT NULL,
    completed_at timestamp with time zone,
    overall_status text DEFAULT 'pending'::text NOT NULL,
    total_items integer DEFAULT 0,
    passed_items integer DEFAULT 0,
    failed_items integer DEFAULT 0,
    critical_failures integer DEFAULT 0,
    next_inspection_date date,
    estimated_duration_minutes integer DEFAULT 30,
    actual_duration_minutes integer,
    inspection_notes text,
    recommendations text,
    requires_immediate_attention boolean DEFAULT false,
    equipment_taken_offline boolean DEFAULT false,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT safety_inspections_overall_status_check CHECK ((overall_status = ANY (ARRAY['pending'::text, 'passed'::text, 'failed'::text, 'needs_attention'::text])))
);


ALTER TABLE public.safety_inspections OWNER TO postgres;

--
-- Name: safety_violations; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.safety_violations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    inspection_id uuid NOT NULL,
    equipment_id uuid NOT NULL,
    violation_type text NOT NULL,
    severity_level text NOT NULL,
    description text NOT NULL,
    photo_documentation text[],
    immediate_action_taken text,
    corrective_action_required text,
    assigned_to uuid,
    target_resolution_date date,
    resolved_at timestamp with time zone,
    resolution_notes text,
    follow_up_required boolean DEFAULT false,
    follow_up_date date,
    compliance_impact text,
    created_by uuid NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    status text DEFAULT 'open'::text NOT NULL,
    CONSTRAINT safety_violations_severity_level_check CHECK ((severity_level = ANY (ARRAY['low'::text, 'medium'::text, 'high'::text, 'critical'::text]))),
    CONSTRAINT safety_violations_status_check CHECK ((status = ANY (ARRAY['open'::text, 'in_progress'::text, 'resolved'::text, 'closed'::text])))
);


ALTER TABLE public.safety_violations OWNER TO postgres;

--
-- Name: sales_quotes; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.sales_quotes (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    lead_id uuid NOT NULL,
    quote_number text NOT NULL,
    created_by uuid NOT NULL,
    status text DEFAULT 'draft'::text NOT NULL,
    valid_until date,
    subtotal numeric(10,2) DEFAULT 0 NOT NULL,
    discount_amount numeric(10,2) DEFAULT 0,
    tax_amount numeric(10,2) DEFAULT 0,
    total_amount numeric(10,2) DEFAULT 0 NOT NULL,
    notes text,
    terms_conditions text,
    sent_at timestamp with time zone,
    accepted_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.sales_quotes OWNER TO postgres;

--
-- Name: salesperson_commissions; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.salesperson_commissions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    salesperson_id uuid NOT NULL,
    commission_type text NOT NULL,
    commission_value numeric NOT NULL,
    revenue_basis text NOT NULL,
    duration_months integer,
    is_active boolean DEFAULT true,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    created_by uuid,
    CONSTRAINT salesperson_commissions_commission_type_check CHECK ((commission_type = ANY (ARRAY['percentage'::text, 'flat_rate'::text]))),
    CONSTRAINT salesperson_commissions_revenue_basis_check CHECK ((revenue_basis = ANY (ARRAY['total_contract'::text, 'monthly_recurring'::text, 'first_payment'::text])))
);


ALTER TABLE public.salesperson_commissions OWNER TO postgres;

--
-- Name: salesperson_referral_links; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.salesperson_referral_links (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    salesperson_id uuid NOT NULL,
    referral_code text NOT NULL,
    link_url text NOT NULL,
    is_active boolean DEFAULT true,
    click_count integer DEFAULT 0,
    conversion_count integer DEFAULT 0,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.salesperson_referral_links OWNER TO postgres;

--
-- Name: sms_campaign_recipients; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.sms_campaign_recipients (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    campaign_id uuid NOT NULL,
    recipient_id uuid NOT NULL,
    recipient_phone text NOT NULL,
    recipient_name text,
    sent_at timestamp with time zone,
    delivered_at timestamp with time zone,
    status text DEFAULT 'pending'::text NOT NULL,
    error_message text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT sms_campaign_recipients_status_check CHECK ((status = ANY (ARRAY['pending'::text, 'sent'::text, 'delivered'::text, 'failed'::text])))
);


ALTER TABLE public.sms_campaign_recipients OWNER TO postgres;

--
-- Name: sms_campaigns; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.sms_campaigns (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    campaign_name text NOT NULL,
    message_content text NOT NULL,
    recipient_type text NOT NULL,
    recipient_count integer DEFAULT 0,
    scheduled_at timestamp with time zone,
    sent_at timestamp with time zone,
    delivery_count integer DEFAULT 0,
    failure_count integer DEFAULT 0,
    status text DEFAULT 'draft'::text NOT NULL,
    created_by uuid NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT sms_campaigns_recipient_type_check CHECK ((recipient_type = ANY (ARRAY['all_members'::text, 'active_members'::text, 'leads'::text, 'staff'::text, 'custom'::text]))),
    CONSTRAINT sms_campaigns_status_check CHECK ((status = ANY (ARRAY['draft'::text, 'scheduled'::text, 'sending'::text, 'sent'::text, 'failed'::text])))
);


ALTER TABLE public.sms_campaigns OWNER TO postgres;

--
-- Name: social_media_automation_logs; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.social_media_automation_logs (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    blog_post_id uuid,
    trigger_type text NOT NULL,
    platforms_processed jsonb DEFAULT '[]'::jsonb,
    posts_created integer DEFAULT 0,
    webhook_sent boolean DEFAULT false,
    webhook_url text,
    webhook_response jsonb DEFAULT '{}'::jsonb,
    webhook_response_status integer,
    generated_content jsonb DEFAULT '{}'::jsonb,
    status text DEFAULT 'pending'::text,
    error_message text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


ALTER TABLE public.social_media_automation_logs OWNER TO postgres;

--
-- Name: TABLE social_media_automation_logs; Type: COMMENT; Schema: public; Owner: postgres
--

COMMENT ON TABLE public.social_media_automation_logs IS 'Execution logs for social media automation and debugging';


--
-- Name: social_media_automation_settings; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.social_media_automation_settings (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    is_active boolean DEFAULT true,
    auto_post_on_publish boolean DEFAULT false,
    webhook_url text,
    webhook_secret text,
    webhook_enabled boolean DEFAULT false,
    ai_content_generation boolean DEFAULT true,
    platforms_enabled jsonb DEFAULT '["linkedin", "twitter", "facebook", "instagram"]'::jsonb,
    posting_schedule jsonb DEFAULT '{}'::jsonb,
    content_templates jsonb DEFAULT '{}'::jsonb,
    twitter_character_limit integer DEFAULT 280,
    linkedin_character_limit integer DEFAULT 3000,
    facebook_character_limit integer DEFAULT 63206,
    instagram_character_limit integer DEFAULT 2200,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    created_by uuid
);


ALTER TABLE public.social_media_automation_settings OWNER TO postgres;

--
-- Name: TABLE social_media_automation_settings; Type: COMMENT; Schema: public; Owner: postgres
--

COMMENT ON TABLE public.social_media_automation_settings IS 'Social media automation configuration and webhook settings';


--
-- Name: spa_appointments; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.spa_appointments (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    service_id uuid NOT NULL,
    member_id uuid NOT NULL,
    therapist_id uuid NOT NULL,
    appointment_date date NOT NULL,
    start_time time without time zone NOT NULL,
    end_time time without time zone NOT NULL,
    duration_minutes integer NOT NULL,
    total_price numeric(10,2) NOT NULL,
    deposit_paid numeric(10,2) DEFAULT 0.00,
    payment_status text DEFAULT 'pending'::text,
    status text DEFAULT 'scheduled'::text,
    special_requests text,
    preparation_notes text,
    post_service_notes text,
    cancelled_at timestamp with time zone,
    cancellation_reason text,
    cancelled_by uuid,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT spa_appointments_payment_status_check CHECK ((payment_status = ANY (ARRAY['pending'::text, 'partial'::text, 'paid'::text, 'refunded'::text]))),
    CONSTRAINT spa_appointments_status_check CHECK ((status = ANY (ARRAY['scheduled'::text, 'confirmed'::text, 'in_progress'::text, 'completed'::text, 'cancelled'::text, 'no_show'::text])))
);


ALTER TABLE public.spa_appointments OWNER TO postgres;

--
-- Name: spa_inventory; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.spa_inventory (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    product_name text NOT NULL,
    product_category text DEFAULT 'oil'::text NOT NULL,
    brand text,
    product_code text,
    description text,
    unit_of_measurement text DEFAULT 'ml'::text,
    current_stock integer DEFAULT 0,
    minimum_stock integer DEFAULT 10,
    maximum_stock integer DEFAULT 100,
    cost_per_unit numeric(10,2) DEFAULT 0.00,
    retail_price numeric(10,2) DEFAULT 0.00,
    supplier_name text,
    supplier_contact text,
    last_restock_date date,
    expiry_date date,
    storage_location text,
    usage_per_service numeric(10,2) DEFAULT 0,
    is_active boolean DEFAULT true,
    requires_certification boolean DEFAULT false,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT spa_inventory_category_check CHECK ((product_category = ANY (ARRAY['oil'::text, 'lotion'::text, 'cream'::text, 'towel'::text, 'equipment'::text, 'supplement'::text, 'retail'::text])))
);


ALTER TABLE public.spa_inventory OWNER TO postgres;

--
-- Name: spa_service_packages; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.spa_service_packages (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    package_name text NOT NULL,
    description text,
    service_ids uuid[] NOT NULL,
    total_duration_minutes integer NOT NULL,
    individual_price numeric(10,2) NOT NULL,
    package_price numeric(10,2) NOT NULL,
    savings_amount numeric(10,2) GENERATED ALWAYS AS ((individual_price - package_price)) STORED,
    max_validity_days integer DEFAULT 90,
    is_active boolean DEFAULT true,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.spa_service_packages OWNER TO postgres;

--
-- Name: spa_services; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.spa_services (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    service_name text NOT NULL,
    service_category text DEFAULT 'massage'::text NOT NULL,
    description text,
    duration_minutes integer DEFAULT 60 NOT NULL,
    base_price numeric(10,2) NOT NULL,
    commission_rate numeric(5,2) DEFAULT 0.00,
    requires_certification text[] DEFAULT '{}'::text[],
    equipment_needed text[] DEFAULT '{}'::text[],
    is_active boolean DEFAULT true,
    max_advance_booking_days integer DEFAULT 30,
    min_advance_booking_hours integer DEFAULT 2,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.spa_services OWNER TO postgres;

--
-- Name: sports_courts; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.sports_courts (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    location_id uuid,
    court_number text NOT NULL,
    court_type text DEFAULT 'tennis'::text NOT NULL,
    surface_type text DEFAULT 'hard'::text,
    is_indoor boolean DEFAULT false,
    max_players integer DEFAULT 4,
    hourly_rate numeric DEFAULT 25.00,
    lighting_available boolean DEFAULT true,
    equipment_included text[] DEFAULT '{}'::text[],
    maintenance_notes text,
    is_available boolean DEFAULT true,
    is_out_of_order boolean DEFAULT false,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.sports_courts OWNER TO postgres;

--
-- Name: sports_equipment; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.sports_equipment (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    location_id uuid,
    equipment_type text NOT NULL,
    sport text NOT NULL,
    brand text,
    model text,
    size_specification text,
    purchase_date date,
    purchase_price numeric,
    rental_rate_hourly numeric DEFAULT 5.00,
    rental_rate_daily numeric DEFAULT 15.00,
    deposit_required numeric DEFAULT 25.00,
    current_condition text DEFAULT 'good'::text,
    maintenance_notes text,
    is_available_for_rental boolean DEFAULT true,
    total_rentals integer DEFAULT 0,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    equipment_code text NOT NULL,
    description text,
    notes text
);


ALTER TABLE public.sports_equipment OWNER TO postgres;

--
-- Name: staff_certifications; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.staff_certifications (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    staff_id uuid NOT NULL,
    requirement_id uuid NOT NULL,
    certification_number text,
    issued_date date NOT NULL,
    expiry_date date NOT NULL,
    issuing_authority text,
    verification_status text DEFAULT 'pending'::text NOT NULL,
    file_url text,
    renewal_cost numeric(10,2),
    renewal_completed_at timestamp with time zone,
    notes text,
    created_by uuid NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.staff_certifications OWNER TO postgres;

--
-- Name: staff_performance_analytics; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.staff_performance_analytics (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    staff_id uuid NOT NULL,
    period_start date NOT NULL,
    period_end date NOT NULL,
    classes_taught integer DEFAULT 0,
    total_class_revenue numeric(10,2) DEFAULT 0,
    average_class_utilization numeric(5,2) DEFAULT 0,
    member_satisfaction_score numeric(3,2) DEFAULT 0,
    leads_converted integer DEFAULT 0,
    tours_conducted integer DEFAULT 0,
    sales_made integer DEFAULT 0,
    total_sales_revenue numeric(10,2) DEFAULT 0,
    commission_earned numeric(10,2) DEFAULT 0,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.staff_performance_analytics OWNER TO postgres;

--
-- Name: staff_schedules; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.staff_schedules (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    staff_id uuid NOT NULL,
    organization_id uuid NOT NULL,
    day_of_week integer NOT NULL,
    start_time time without time zone NOT NULL,
    end_time time without time zone NOT NULL,
    is_available boolean DEFAULT true,
    break_start time without time zone,
    break_end time without time zone,
    notes text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT staff_schedules_day_of_week_check CHECK (((day_of_week >= 0) AND (day_of_week <= 6)))
);


ALTER TABLE public.staff_schedules OWNER TO postgres;

--
-- Name: stock_movements; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.stock_movements (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    inventory_item_id uuid NOT NULL,
    transaction_id uuid,
    movement_type text NOT NULL,
    quantity_change integer NOT NULL,
    reference_number text,
    reason text,
    performed_by uuid NOT NULL,
    movement_date timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    notes text
);


ALTER TABLE public.stock_movements OWNER TO postgres;

--
-- Name: subscribers; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.subscribers (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    user_id uuid,
    email text NOT NULL,
    stripe_customer_id text,
    subscribed boolean DEFAULT false NOT NULL,
    subscription_tier text,
    subscription_end timestamp with time zone,
    membership_plan_id uuid,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.subscribers OWNER TO postgres;

--
-- Name: support_tickets; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.support_tickets (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    member_id uuid NOT NULL,
    assigned_to uuid,
    subject text NOT NULL,
    description text NOT NULL,
    category text DEFAULT 'general'::text NOT NULL,
    priority text DEFAULT 'medium'::text NOT NULL,
    status text DEFAULT 'open'::text NOT NULL,
    resolution_notes text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT support_tickets_category_check CHECK ((category = ANY (ARRAY['general'::text, 'billing'::text, 'technical'::text, 'equipment'::text, 'complaint'::text, 'suggestion'::text]))),
    CONSTRAINT support_tickets_priority_check CHECK ((priority = ANY (ARRAY['low'::text, 'medium'::text, 'high'::text, 'urgent'::text]))),
    CONSTRAINT support_tickets_status_check CHECK ((status = ANY (ARRAY['open'::text, 'in_progress'::text, 'resolved'::text, 'closed'::text])))
);


ALTER TABLE public.support_tickets OWNER TO postgres;

--
-- Name: swim_lesson_enrollments; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.swim_lesson_enrollments (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    lesson_id uuid NOT NULL,
    member_id uuid NOT NULL,
    enrolled_at timestamp with time zone DEFAULT now() NOT NULL,
    enrollment_status text DEFAULT 'enrolled'::text,
    payment_status text DEFAULT 'pending'::text,
    payment_amount numeric NOT NULL,
    special_needs text,
    emergency_contact_name text,
    emergency_contact_phone text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    notes text
);


ALTER TABLE public.swim_lesson_enrollments OWNER TO postgres;

--
-- Name: swim_lessons; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.swim_lessons (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    pool_id uuid NOT NULL,
    instructor_id uuid NOT NULL,
    lesson_name text NOT NULL,
    lesson_type text DEFAULT 'group'::text NOT NULL,
    skill_level text DEFAULT 'beginner'::text NOT NULL,
    max_participants integer DEFAULT 8,
    age_group text DEFAULT 'adult'::text,
    lesson_date date NOT NULL,
    start_time time without time zone NOT NULL,
    end_time time without time zone NOT NULL,
    duration_minutes integer DEFAULT 45 NOT NULL,
    lesson_fee numeric NOT NULL,
    recurring_schedule text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    description text,
    requirements text,
    equipment_provided text[],
    status text DEFAULT 'scheduled'::text NOT NULL
);


ALTER TABLE public.swim_lessons OWNER TO postgres;

--
-- Name: therapist_availability; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.therapist_availability (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    therapist_id uuid NOT NULL,
    day_of_week integer NOT NULL,
    start_time time without time zone NOT NULL,
    end_time time without time zone NOT NULL,
    break_start time without time zone,
    break_end time without time zone,
    is_available boolean DEFAULT true,
    specializations text[] DEFAULT '{}'::text[],
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT therapist_availability_day_of_week_check CHECK (((day_of_week >= 0) AND (day_of_week <= 6)))
);


ALTER TABLE public.therapist_availability OWNER TO postgres;

--
-- Name: time_entries; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.time_entries (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    staff_id uuid NOT NULL,
    organization_id uuid NOT NULL,
    clock_in timestamp with time zone NOT NULL,
    clock_out timestamp with time zone,
    break_start timestamp with time zone,
    break_end timestamp with time zone,
    hours_worked numeric(5,2),
    hourly_rate numeric(10,2),
    total_pay numeric(10,2),
    notes text,
    status text DEFAULT 'active'::text,
    approved_by uuid,
    approved_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT time_entries_status_check CHECK ((status = ANY (ARRAY['active'::text, 'completed'::text, 'reviewed'::text])))
);


ALTER TABLE public.time_entries OWNER TO postgres;

--
-- Name: tournament_matches; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.tournament_matches (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    tournament_id uuid NOT NULL,
    round_number integer NOT NULL,
    match_number integer NOT NULL,
    player1_id uuid,
    player2_id uuid,
    winner_id uuid,
    court_id uuid,
    scheduled_at timestamp with time zone,
    started_at timestamp with time zone,
    completed_at timestamp with time zone,
    score text,
    status text DEFAULT 'pending'::text NOT NULL,
    notes text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.tournament_matches OWNER TO postgres;

--
-- Name: tournament_participants; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.tournament_participants (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    tournament_id uuid NOT NULL,
    member_id uuid NOT NULL,
    partner_id uuid,
    registration_date timestamp with time zone DEFAULT now() NOT NULL,
    seed_number integer,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    status text DEFAULT 'registered'::text NOT NULL
);


ALTER TABLE public.tournament_participants OWNER TO postgres;

--
-- Name: tournaments; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.tournaments (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    tournament_name text NOT NULL,
    sport text NOT NULL,
    tournament_type text DEFAULT 'single_elimination'::text,
    entry_fee numeric DEFAULT 0.00,
    max_participants integer,
    registration_deadline date,
    tournament_start_date date NOT NULL,
    tournament_end_date date NOT NULL,
    prize_pool numeric DEFAULT 0.00,
    winner_id uuid,
    runner_up_id uuid,
    created_by uuid NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    status text DEFAULT 'registration_open'::text NOT NULL,
    description text,
    rules text,
    contact_info text
);


ALTER TABLE public.tournaments OWNER TO postgres;

--
-- Name: towel_cleaning_logs; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.towel_cleaning_logs (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    towel_inventory_id uuid NOT NULL,
    cleaning_date date DEFAULT CURRENT_DATE NOT NULL,
    quantity_cleaned integer DEFAULT 0 NOT NULL,
    cleaning_method text DEFAULT 'machine_wash'::text NOT NULL,
    detergent_used text,
    temperature_celsius integer DEFAULT 60,
    cycle_duration_minutes integer DEFAULT 45,
    staff_assigned uuid NOT NULL,
    quality_check_passed boolean DEFAULT true,
    quality_check_notes text,
    cost numeric(10,2) DEFAULT 0.00,
    next_cleaning_due date,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    batch_number text,
    cleaning_status text DEFAULT 'completed'::text NOT NULL
);


ALTER TABLE public.towel_cleaning_logs OWNER TO postgres;

--
-- Name: towel_inventory; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.towel_inventory (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    towel_type text DEFAULT 'standard'::text NOT NULL,
    size text DEFAULT 'medium'::text NOT NULL,
    color text DEFAULT 'white'::text NOT NULL,
    total_quantity integer DEFAULT 0 NOT NULL,
    available_quantity integer DEFAULT 0 NOT NULL,
    rented_quantity integer DEFAULT 0 NOT NULL,
    in_cleaning integer DEFAULT 0 NOT NULL,
    damaged_quantity integer DEFAULT 0 NOT NULL,
    cost_per_towel numeric(10,2) DEFAULT 0.00,
    rental_price numeric(10,2) DEFAULT 5.00 NOT NULL,
    replacement_cost numeric(10,2) DEFAULT 0.00,
    min_stock_level integer DEFAULT 10,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.towel_inventory OWNER TO postgres;

--
-- Name: towel_rentals; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.towel_rentals (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    member_id uuid NOT NULL,
    towel_inventory_id uuid NOT NULL,
    rental_date date DEFAULT CURRENT_DATE NOT NULL,
    rental_time time without time zone DEFAULT CURRENT_TIME NOT NULL,
    return_date date,
    return_time time without time zone,
    rental_fee numeric(10,2) DEFAULT 0.00 NOT NULL,
    late_fee numeric(10,2) DEFAULT 0.00,
    damage_fee numeric(10,2) DEFAULT 0.00,
    payment_method text DEFAULT 'member_account'::text,
    payment_status text DEFAULT 'pending'::text NOT NULL,
    towel_condition_out text DEFAULT 'good'::text,
    towel_condition_in text,
    staff_out uuid NOT NULL,
    staff_in uuid,
    notes text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    status text DEFAULT 'active'::text NOT NULL
);


ALTER TABLE public.towel_rentals OWNER TO postgres;

--
-- Name: trainer_availability; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.trainer_availability (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    trainer_id uuid NOT NULL,
    day_of_week integer NOT NULL,
    start_time time without time zone NOT NULL,
    end_time time without time zone NOT NULL,
    is_available boolean DEFAULT true NOT NULL,
    location_id uuid,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT trainer_availability_day_of_week_check CHECK (((day_of_week >= 0) AND (day_of_week <= 6)))
);


ALTER TABLE public.trainer_availability OWNER TO postgres;

--
-- Name: training_packages; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.training_packages (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    name text NOT NULL,
    description text,
    session_count integer NOT NULL,
    session_duration_minutes integer DEFAULT 60 NOT NULL,
    price numeric(10,2) NOT NULL,
    expiration_days integer DEFAULT 90 NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.training_packages OWNER TO postgres;

--
-- Name: vendors; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.vendors (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    name text NOT NULL,
    vendor_type text DEFAULT 'maintenance'::text NOT NULL,
    contact_name text,
    email text,
    phone text,
    address text,
    website text,
    license_number text,
    insurance_expiry date,
    rating integer,
    preferred_vendor boolean DEFAULT false,
    notes text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT vendors_rating_check CHECK (((rating >= 1) AND (rating <= 5)))
);


ALTER TABLE public.vendors OWNER TO postgres;

--
-- Name: visitor_checkins; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.visitor_checkins (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    guest_pass_id uuid,
    visitor_name text NOT NULL,
    visitor_email text,
    check_in_time timestamp with time zone DEFAULT now() NOT NULL,
    check_out_time timestamp with time zone,
    purpose text DEFAULT 'day_pass'::text,
    accompanied_by uuid,
    liability_waiver_signed boolean DEFAULT false,
    emergency_contact_name text,
    emergency_contact_phone text,
    created_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.visitor_checkins OWNER TO postgres;

--
-- Name: water_quality_logs; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.water_quality_logs (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    pool_id uuid NOT NULL,
    tested_by uuid NOT NULL,
    test_date date DEFAULT CURRENT_DATE NOT NULL,
    test_time time without time zone DEFAULT CURRENT_TIME NOT NULL,
    ph_level numeric,
    chlorine_ppm numeric,
    alkalinity_ppm numeric,
    temperature_fahrenheit numeric,
    clarity_rating integer,
    bacteria_count integer,
    chemical_balance_ok boolean DEFAULT true,
    action_required text,
    actions_taken text,
    next_test_due timestamp with time zone,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    notes text,
    compliance_status text DEFAULT 'compliant'::text,
    CONSTRAINT water_quality_logs_clarity_rating_check CHECK (((clarity_rating >= 1) AND (clarity_rating <= 5)))
);


ALTER TABLE public.water_quality_logs OWNER TO postgres;

--
-- Name: webhook_endpoints; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.webhook_endpoints (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    name text NOT NULL,
    url text NOT NULL,
    events text[] DEFAULT '{}'::text[] NOT NULL,
    status text DEFAULT 'active'::text NOT NULL,
    secret_key text,
    retry_count integer DEFAULT 3 NOT NULL,
    timeout_seconds integer DEFAULT 30 NOT NULL,
    last_triggered_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT webhook_endpoints_status_check CHECK ((status = ANY (ARRAY['active'::text, 'inactive'::text])))
);


ALTER TABLE public.webhook_endpoints OWNER TO postgres;

--
-- Name: webhook_logs; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.webhook_logs (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    organization_id uuid NOT NULL,
    webhook_endpoint_id uuid NOT NULL,
    event_type text NOT NULL,
    status text NOT NULL,
    response_code integer,
    response_body text,
    attempt_count integer DEFAULT 1 NOT NULL,
    payload jsonb,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT webhook_logs_status_check CHECK ((status = ANY (ARRAY['success'::text, 'failed'::text, 'retry'::text])))
);


ALTER TABLE public.webhook_logs OWNER TO postgres;

--
-- Name: messages; Type: TABLE; Schema: realtime; Owner: supabase_realtime_admin
--

CREATE TABLE realtime.messages (
    topic text NOT NULL,
    extension text NOT NULL,
    payload jsonb,
    event text,
    private boolean DEFAULT false,
    updated_at timestamp without time zone DEFAULT now() NOT NULL,
    inserted_at timestamp without time zone DEFAULT now() NOT NULL,
    id uuid DEFAULT gen_random_uuid() NOT NULL
)
PARTITION BY RANGE (inserted_at);


ALTER TABLE realtime.messages OWNER TO supabase_realtime_admin;

--
-- Name: schema_migrations; Type: TABLE; Schema: realtime; Owner: supabase_admin
--

CREATE TABLE realtime.schema_migrations (
    version bigint NOT NULL,
    inserted_at timestamp(0) without time zone
);


ALTER TABLE realtime.schema_migrations OWNER TO supabase_admin;

--
-- Name: subscription; Type: TABLE; Schema: realtime; Owner: supabase_admin
--

CREATE TABLE realtime.subscription (
    id bigint NOT NULL,
    subscription_id uuid NOT NULL,
    entity regclass NOT NULL,
    filters realtime.user_defined_filter[] DEFAULT '{}'::realtime.user_defined_filter[] NOT NULL,
    claims jsonb NOT NULL,
    claims_role regrole GENERATED ALWAYS AS (realtime.to_regrole((claims ->> 'role'::text))) STORED NOT NULL,
    created_at timestamp without time zone DEFAULT timezone('utc'::text, now()) NOT NULL
);


ALTER TABLE realtime.subscription OWNER TO supabase_admin;

--
-- Name: subscription_id_seq; Type: SEQUENCE; Schema: realtime; Owner: supabase_admin
--

ALTER TABLE realtime.subscription ALTER COLUMN id ADD GENERATED ALWAYS AS IDENTITY (
    SEQUENCE NAME realtime.subscription_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: buckets; Type: TABLE; Schema: storage; Owner: supabase_storage_admin
--

CREATE TABLE storage.buckets (
    id text NOT NULL,
    name text NOT NULL,
    owner uuid,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    public boolean DEFAULT false,
    avif_autodetection boolean DEFAULT false,
    file_size_limit bigint,
    allowed_mime_types text[],
    owner_id text,
    type storage.buckettype DEFAULT 'STANDARD'::storage.buckettype NOT NULL
);


ALTER TABLE storage.buckets OWNER TO supabase_storage_admin;

--
-- Name: COLUMN buckets.owner; Type: COMMENT; Schema: storage; Owner: supabase_storage_admin
--

COMMENT ON COLUMN storage.buckets.owner IS 'Field is deprecated, use owner_id instead';


--
-- Name: buckets_analytics; Type: TABLE; Schema: storage; Owner: supabase_storage_admin
--

CREATE TABLE storage.buckets_analytics (
    name text NOT NULL,
    type storage.buckettype DEFAULT 'ANALYTICS'::storage.buckettype NOT NULL,
    format text DEFAULT 'ICEBERG'::text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    deleted_at timestamp with time zone
);


ALTER TABLE storage.buckets_analytics OWNER TO supabase_storage_admin;

--
-- Name: buckets_vectors; Type: TABLE; Schema: storage; Owner: supabase_storage_admin
--

CREATE TABLE storage.buckets_vectors (
    id text NOT NULL,
    type storage.buckettype DEFAULT 'VECTOR'::storage.buckettype NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE storage.buckets_vectors OWNER TO supabase_storage_admin;

--
-- Name: migrations; Type: TABLE; Schema: storage; Owner: supabase_storage_admin
--

CREATE TABLE storage.migrations (
    id integer NOT NULL,
    name character varying(100) NOT NULL,
    hash character varying(40) NOT NULL,
    executed_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


ALTER TABLE storage.migrations OWNER TO supabase_storage_admin;

--
-- Name: objects; Type: TABLE; Schema: storage; Owner: supabase_storage_admin
--

CREATE TABLE storage.objects (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    bucket_id text,
    name text,
    owner uuid,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    last_accessed_at timestamp with time zone DEFAULT now(),
    metadata jsonb,
    path_tokens text[] GENERATED ALWAYS AS (string_to_array(name, '/'::text)) STORED,
    version text,
    owner_id text,
    user_metadata jsonb,
    level integer
);


ALTER TABLE storage.objects OWNER TO supabase_storage_admin;

--
-- Name: COLUMN objects.owner; Type: COMMENT; Schema: storage; Owner: supabase_storage_admin
--

COMMENT ON COLUMN storage.objects.owner IS 'Field is deprecated, use owner_id instead';


--
-- Name: prefixes; Type: TABLE; Schema: storage; Owner: supabase_storage_admin
--

CREATE TABLE storage.prefixes (
    bucket_id text NOT NULL,
    name text NOT NULL COLLATE pg_catalog."C",
    level integer GENERATED ALWAYS AS (storage.get_level(name)) STORED NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


ALTER TABLE storage.prefixes OWNER TO supabase_storage_admin;

--
-- Name: s3_multipart_uploads; Type: TABLE; Schema: storage; Owner: supabase_storage_admin
--

CREATE TABLE storage.s3_multipart_uploads (
    id text NOT NULL,
    in_progress_size bigint DEFAULT 0 NOT NULL,
    upload_signature text NOT NULL,
    bucket_id text NOT NULL,
    key text NOT NULL COLLATE pg_catalog."C",
    version text NOT NULL,
    owner_id text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    user_metadata jsonb
);


ALTER TABLE storage.s3_multipart_uploads OWNER TO supabase_storage_admin;

--
-- Name: s3_multipart_uploads_parts; Type: TABLE; Schema: storage; Owner: supabase_storage_admin
--

CREATE TABLE storage.s3_multipart_uploads_parts (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    upload_id text NOT NULL,
    size bigint DEFAULT 0 NOT NULL,
    part_number integer NOT NULL,
    bucket_id text NOT NULL,
    key text NOT NULL COLLATE pg_catalog."C",
    etag text NOT NULL,
    owner_id text,
    version text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE storage.s3_multipart_uploads_parts OWNER TO supabase_storage_admin;

--
-- Name: vector_indexes; Type: TABLE; Schema: storage; Owner: supabase_storage_admin
--

CREATE TABLE storage.vector_indexes (
    id text DEFAULT gen_random_uuid() NOT NULL,
    name text NOT NULL COLLATE pg_catalog."C",
    bucket_id text NOT NULL,
    data_type text NOT NULL,
    dimension integer NOT NULL,
    distance_metric text NOT NULL,
    metadata_configuration jsonb,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE storage.vector_indexes OWNER TO supabase_storage_admin;

--
-- Name: schema_migrations; Type: TABLE; Schema: supabase_migrations; Owner: postgres
--

CREATE TABLE supabase_migrations.schema_migrations (
    version text NOT NULL,
    statements text[],
    name text,
    created_by text,
    idempotency_key text,
    rollback text[]
);


ALTER TABLE supabase_migrations.schema_migrations OWNER TO postgres;

--
-- Name: seed_files; Type: TABLE; Schema: supabase_migrations; Owner: postgres
--

CREATE TABLE supabase_migrations.seed_files (
    path text NOT NULL,
    hash text NOT NULL
);


ALTER TABLE supabase_migrations.seed_files OWNER TO postgres;

--
-- Name: refresh_tokens id; Type: DEFAULT; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE ONLY auth.refresh_tokens ALTER COLUMN id SET DEFAULT nextval('auth.refresh_tokens_id_seq'::regclass);


--
-- Data for Name: audit_log_entries; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY auth.audit_log_entries (instance_id, id, payload, created_at, ip_address) FROM stdin;
00000000-0000-0000-0000-000000000000	6cf34d23-abd7-4c9b-b6de-cb203be2be86	{"action":"user_signedup","actor_id":"00000000-0000-0000-0000-000000000000","actor_username":"service_role","actor_via_sso":false,"log_type":"team","traits":{"provider":"email","user_email":"pearsonperformance@gmail.com","user_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","user_phone":""}}	2025-08-26 22:34:34.963549+00	
00000000-0000-0000-0000-000000000000	daf6f128-314a-4201-b659-75f9ff22619c	{"action":"login","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"account","traits":{"provider":"email"}}	2025-08-26 22:35:18.281062+00	
00000000-0000-0000-0000-000000000000	98657df3-b5ba-492c-9ee3-483db515ba8c	{"action":"login","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"account","traits":{"provider":"email"}}	2025-08-26 22:41:07.706099+00	
00000000-0000-0000-0000-000000000000	b99f1ce6-a063-49b7-8f30-6eaf5bbf5ede	{"action":"login","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"account","traits":{"provider":"email"}}	2025-08-27 01:54:29.921024+00	
00000000-0000-0000-0000-000000000000	e823046b-68e3-4bd6-958d-f55ba06ea7fc	{"action":"login","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"account","traits":{"provider":"email"}}	2025-08-27 01:58:38.33933+00	
00000000-0000-0000-0000-000000000000	8ad95677-5e55-4f0e-8505-97e57c648758	{"action":"token_refreshed","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"token"}	2025-08-27 03:07:12.158176+00	
00000000-0000-0000-0000-000000000000	0f073228-4d5e-4f43-b43d-4a86678c01e1	{"action":"token_revoked","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"token"}	2025-08-27 03:07:12.159565+00	
00000000-0000-0000-0000-000000000000	0d94a469-53d2-4fa7-a6d4-24b08c8fb014	{"action":"login","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"account","traits":{"provider":"email"}}	2025-08-27 20:57:33.839861+00	
00000000-0000-0000-0000-000000000000	42c72dd1-440e-4d63-9ff9-3b8d87e24076	{"action":"token_refreshed","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"token"}	2025-08-28 00:26:49.586054+00	
00000000-0000-0000-0000-000000000000	1f56fabe-ec3a-4b7b-ad2c-6597e3b0fc51	{"action":"token_revoked","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"token"}	2025-08-28 00:26:49.58713+00	
00000000-0000-0000-0000-000000000000	9b9ab594-98f3-43a7-8754-16e8d2f4926c	{"action":"token_refreshed","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"token"}	2025-08-28 00:28:06.685936+00	
00000000-0000-0000-0000-000000000000	63a2a723-fffd-4be6-857b-0392ed71f658	{"action":"token_revoked","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"token"}	2025-08-28 00:28:06.687072+00	
00000000-0000-0000-0000-000000000000	01dd7959-8bb3-4bcb-a890-95f576c22893	{"action":"logout","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"account"}	2025-08-28 00:28:19.019624+00	
00000000-0000-0000-0000-000000000000	d2527b2d-ef28-4395-bf29-c878ebcd4edc	{"action":"login","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"account","traits":{"provider":"email"}}	2025-08-28 02:27:05.663242+00	
00000000-0000-0000-0000-000000000000	88689414-43d5-4d5e-a1f1-688a001c7efe	{"action":"login","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"account","traits":{"provider":"email"}}	2025-08-28 02:39:47.326302+00	
00000000-0000-0000-0000-000000000000	98b1eb28-4d5a-4119-829c-cb1bff4be81a	{"action":"token_refreshed","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"token"}	2025-08-28 12:51:50.280359+00	
00000000-0000-0000-0000-000000000000	9c018a9a-2daf-4fe0-a918-243c14bc18a5	{"action":"token_revoked","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"token"}	2025-08-28 12:51:50.282217+00	
00000000-0000-0000-0000-000000000000	4c842d5f-040a-49d4-b021-bea884e54ba6	{"action":"token_refreshed","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"token"}	2025-08-29 11:57:20.717934+00	
00000000-0000-0000-0000-000000000000	5b5a4ea1-7f6f-4bcf-b5b8-494f62507ca2	{"action":"token_revoked","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"token"}	2025-08-29 11:57:20.719772+00	
00000000-0000-0000-0000-000000000000	590f251e-61ff-4762-b47d-2023ec06b473	{"action":"logout","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"account"}	2025-08-29 11:57:24.156105+00	
00000000-0000-0000-0000-000000000000	107221d8-27ad-43fc-91cf-48731aae580c	{"action":"login","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"account","traits":{"provider":"email"}}	2025-08-29 17:28:44.643611+00	
00000000-0000-0000-0000-000000000000	0ecd8e36-b4cd-463d-9200-a606be020c96	{"action":"token_refreshed","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"token"}	2025-08-29 18:26:55.500922+00	
00000000-0000-0000-0000-000000000000	876841d2-a2ec-4238-be92-45a45844302a	{"action":"token_revoked","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"token"}	2025-08-29 18:26:55.50197+00	
00000000-0000-0000-0000-000000000000	33605e1b-2920-4ada-aacf-8f24e8605352	{"action":"token_refreshed","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"token"}	2025-08-29 19:25:21.025536+00	
00000000-0000-0000-0000-000000000000	1ff1316c-08b8-4cfc-b342-46a5209008d9	{"action":"token_revoked","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"token"}	2025-08-29 19:25:21.026716+00	
00000000-0000-0000-0000-000000000000	f16be211-3ef1-47e8-baf8-f80bdce47388	{"action":"logout","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"account"}	2025-08-29 19:45:18.601785+00	
00000000-0000-0000-0000-000000000000	38266212-3104-45a0-a055-62482f23e76a	{"action":"login","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"account","traits":{"provider":"email"}}	2025-09-01 19:08:21.616522+00	
00000000-0000-0000-0000-000000000000	8e421824-f6cb-49ba-af81-afba168e644c	{"action":"login","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"account","traits":{"provider":"email"}}	2025-09-02 23:24:28.092825+00	
00000000-0000-0000-0000-000000000000	148eb1fc-69f2-4aad-bc7b-64ce24cac655	{"action":"token_refreshed","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"token"}	2025-09-03 03:11:22.124728+00	
00000000-0000-0000-0000-000000000000	289af78a-9b52-4112-8011-853c22d52b9f	{"action":"token_revoked","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"token"}	2025-09-03 03:11:22.126077+00	
00000000-0000-0000-0000-000000000000	672abbc3-3028-4d66-b159-eddf47401bb3	{"action":"login","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"account","traits":{"provider":"email"}}	2025-09-09 21:04:09.501547+00	
00000000-0000-0000-0000-000000000000	fbfea997-981a-4243-91e8-5b0d84bd77a3	{"action":"token_refreshed","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"token"}	2025-09-10 13:06:38.663497+00	
00000000-0000-0000-0000-000000000000	ce280522-56d1-49c3-8d05-808f8607f894	{"action":"token_revoked","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"token"}	2025-09-10 13:06:38.665578+00	
00000000-0000-0000-0000-000000000000	ea0aeabb-7f8a-4b72-bae0-912f81bb8a42	{"action":"token_refreshed","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"token"}	2025-09-10 19:18:20.418754+00	
00000000-0000-0000-0000-000000000000	5a3bbedd-8791-4b27-8435-39e51099ea4d	{"action":"token_revoked","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"token"}	2025-09-10 19:18:20.420224+00	
00000000-0000-0000-0000-000000000000	fdc9a7ce-9a2d-4e85-81c4-ce0c2edb85e5	{"action":"token_refreshed","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"token"}	2025-09-17 17:32:59.135046+00	
00000000-0000-0000-0000-000000000000	2b213a9e-d49e-4bed-a976-c8bc15ca7e6c	{"action":"token_revoked","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"token"}	2025-09-17 17:32:59.139977+00	
00000000-0000-0000-0000-000000000000	77cc04ea-d86b-4f8f-8ffb-6cc79aa8de7d	{"action":"token_refreshed","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"token"}	2025-09-18 17:16:19.75812+00	
00000000-0000-0000-0000-000000000000	2cdfa980-469f-40b0-b5a9-01934f2a8ef1	{"action":"token_revoked","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"token"}	2025-09-18 17:16:19.759599+00	
00000000-0000-0000-0000-000000000000	be9bb9a2-9401-4457-b1be-de819acaa963	{"action":"token_refreshed","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"token"}	2025-09-19 16:28:59.806056+00	
00000000-0000-0000-0000-000000000000	b6ed373a-aa62-4a1e-8700-c4cb5308e008	{"action":"token_revoked","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"token"}	2025-09-19 16:28:59.807218+00	
00000000-0000-0000-0000-000000000000	554ad543-9d52-4d40-ba85-5a7b86001677	{"action":"login","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"account","traits":{"provider":"email"}}	2025-09-20 15:04:48.486568+00	
00000000-0000-0000-0000-000000000000	b99f954d-cc86-4790-9d86-246c6b9f5c31	{"action":"login","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"account","traits":{"provider":"email"}}	2025-09-20 16:06:30.706455+00	
00000000-0000-0000-0000-000000000000	a45fa5f2-8e4f-498d-a1ab-cb43add2303a	{"action":"token_refreshed","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"token"}	2025-09-20 20:58:15.784088+00	
00000000-0000-0000-0000-000000000000	16f742e3-986d-4fa6-a287-1607e38e4087	{"action":"token_revoked","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"token"}	2025-09-20 20:58:15.786638+00	
00000000-0000-0000-0000-000000000000	68da63b8-60df-4b87-8bc5-59718a53bd90	{"action":"token_refreshed","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"token"}	2025-09-24 16:07:50.986468+00	
00000000-0000-0000-0000-000000000000	6c1bf702-8c91-4b77-bfe9-1e93a7150a9e	{"action":"token_revoked","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"token"}	2025-09-24 16:07:50.992892+00	
00000000-0000-0000-0000-000000000000	58e604b7-2f26-432e-a37c-ebf70dde2e5b	{"action":"token_refreshed","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"token"}	2025-09-24 17:26:36.985839+00	
00000000-0000-0000-0000-000000000000	045f1617-45df-42d0-b170-5ecf746c699d	{"action":"token_revoked","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"token"}	2025-09-24 17:26:36.986975+00	
00000000-0000-0000-0000-000000000000	e5466fbd-2618-4144-b213-5b8f7f336a99	{"action":"login","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"account","traits":{"provider":"email"}}	2025-09-27 19:29:48.663974+00	
00000000-0000-0000-0000-000000000000	46be956b-1b1a-42d5-92f3-d481c254c525	{"action":"login","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"account","traits":{"provider":"email"}}	2025-09-27 19:36:27.906045+00	
00000000-0000-0000-0000-000000000000	3fbe68d6-ae1b-44d1-8af7-f07be16b0a7f	{"action":"token_refreshed","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"token"}	2025-09-29 17:10:48.793411+00	
00000000-0000-0000-0000-000000000000	05d59cb7-0b86-43a4-b380-479d5f6140af	{"action":"token_revoked","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"token"}	2025-09-29 17:10:48.795492+00	
00000000-0000-0000-0000-000000000000	d9809591-b65a-4f0f-8790-dddda93e2bc3	{"action":"logout","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"account"}	2025-09-29 17:10:54.093573+00	
00000000-0000-0000-0000-000000000000	316b66d0-8b28-4633-a31f-85c02253dafe	{"action":"login","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"account","traits":{"provider":"email"}}	2025-12-02 03:43:01.362642+00	
00000000-0000-0000-0000-000000000000	122c839a-9d80-447f-ade2-11523397af86	{"action":"token_refreshed","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"token"}	2025-12-02 14:04:21.948035+00	
00000000-0000-0000-0000-000000000000	16235bf8-fe03-4013-a3df-41f4c067e835	{"action":"token_revoked","actor_id":"80cb2e43-2acc-4355-b08c-c165cdd5f760","actor_username":"pearsonperformance@gmail.com","actor_via_sso":false,"log_type":"token"}	2025-12-02 14:04:21.95016+00	
\.


--
-- Data for Name: flow_state; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY auth.flow_state (id, user_id, auth_code, code_challenge_method, code_challenge, provider_type, provider_access_token, provider_refresh_token, created_at, updated_at, authentication_method, auth_code_issued_at) FROM stdin;
\.


--
-- Data for Name: identities; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY auth.identities (provider_id, user_id, identity_data, provider, last_sign_in_at, created_at, updated_at, id) FROM stdin;
80cb2e43-2acc-4355-b08c-c165cdd5f760	80cb2e43-2acc-4355-b08c-c165cdd5f760	{"sub": "80cb2e43-2acc-4355-b08c-c165cdd5f760", "email": "pearsonperformance@gmail.com", "email_verified": false, "phone_verified": false}	email	2025-08-26 22:34:34.962113+00	2025-08-26 22:34:34.962186+00	2025-08-26 22:34:34.962186+00	511975ec-a5b3-426c-8fc8-5166a46d93c3
\.


--
-- Data for Name: instances; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY auth.instances (id, uuid, raw_base_config, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: mfa_amr_claims; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY auth.mfa_amr_claims (session_id, created_at, updated_at, authentication_method, id) FROM stdin;
8d163e74-f500-40be-8b55-fbb4f17a2a27	2025-12-02 03:43:01.406943+00	2025-12-02 03:43:01.406943+00	password	ab5e0905-89be-485b-8302-574cc4b3f5fa
\.


--
-- Data for Name: mfa_challenges; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY auth.mfa_challenges (id, factor_id, created_at, verified_at, ip_address, otp_code, web_authn_session_data) FROM stdin;
\.


--
-- Data for Name: mfa_factors; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY auth.mfa_factors (id, user_id, friendly_name, factor_type, status, created_at, updated_at, secret, phone, last_challenged_at, web_authn_credential, web_authn_aaguid, last_webauthn_challenge_data) FROM stdin;
\.


--
-- Data for Name: oauth_authorizations; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY auth.oauth_authorizations (id, authorization_id, client_id, user_id, redirect_uri, scope, state, resource, code_challenge, code_challenge_method, response_type, status, authorization_code, created_at, expires_at, approved_at, nonce) FROM stdin;
\.


--
-- Data for Name: oauth_client_states; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY auth.oauth_client_states (id, provider_type, code_verifier, created_at) FROM stdin;
\.


--
-- Data for Name: oauth_clients; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY auth.oauth_clients (id, client_secret_hash, registration_type, redirect_uris, grant_types, client_name, client_uri, logo_uri, created_at, updated_at, deleted_at, client_type) FROM stdin;
\.


--
-- Data for Name: oauth_consents; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY auth.oauth_consents (id, user_id, client_id, scopes, granted_at, revoked_at) FROM stdin;
\.


--
-- Data for Name: one_time_tokens; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY auth.one_time_tokens (id, user_id, token_type, token_hash, relates_to, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: refresh_tokens; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY auth.refresh_tokens (instance_id, id, token, user_id, revoked, created_at, updated_at, parent, session_id) FROM stdin;
00000000-0000-0000-0000-000000000000	33	uye77v7kftsb	80cb2e43-2acc-4355-b08c-c165cdd5f760	t	2025-12-02 03:43:01.388579+00	2025-12-02 14:04:21.950853+00	\N	8d163e74-f500-40be-8b55-fbb4f17a2a27
00000000-0000-0000-0000-000000000000	34	essx2m27woh4	80cb2e43-2acc-4355-b08c-c165cdd5f760	f	2025-12-02 14:04:21.95417+00	2025-12-02 14:04:21.95417+00	uye77v7kftsb	8d163e74-f500-40be-8b55-fbb4f17a2a27
\.


--
-- Data for Name: saml_providers; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY auth.saml_providers (id, sso_provider_id, entity_id, metadata_xml, metadata_url, attribute_mapping, created_at, updated_at, name_id_format) FROM stdin;
\.


--
-- Data for Name: saml_relay_states; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY auth.saml_relay_states (id, sso_provider_id, request_id, for_email, redirect_to, created_at, updated_at, flow_state_id) FROM stdin;
\.


--
-- Data for Name: schema_migrations; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY auth.schema_migrations (version) FROM stdin;
20171026211738
20171026211808
20171026211834
20180103212743
20180108183307
20180119214651
20180125194653
00
20210710035447
20210722035447
20210730183235
20210909172000
20210927181326
20211122151130
20211124214934
20211202183645
20220114185221
20220114185340
20220224000811
20220323170000
20220429102000
20220531120530
20220614074223
20220811173540
20221003041349
20221003041400
20221011041400
20221020193600
20221021073300
20221021082433
20221027105023
20221114143122
20221114143410
20221125140132
20221208132122
20221215195500
20221215195800
20221215195900
20230116124310
20230116124412
20230131181311
20230322519590
20230402418590
20230411005111
20230508135423
20230523124323
20230818113222
20230914180801
20231027141322
20231114161723
20231117164230
20240115144230
20240214120130
20240306115329
20240314092811
20240427152123
20240612123726
20240729123726
20240802193726
20240806073726
20241009103726
20250717082212
20250731150234
20250804100000
20250901200500
20250903112500
20250904133000
20250925093508
20251007112900
20251104100000
20251111201300
20251201000000
\.


--
-- Data for Name: sessions; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY auth.sessions (id, user_id, created_at, updated_at, factor_id, aal, not_after, refreshed_at, user_agent, ip, tag, oauth_client_id, refresh_token_hmac_key, refresh_token_counter, scopes) FROM stdin;
8d163e74-f500-40be-8b55-fbb4f17a2a27	80cb2e43-2acc-4355-b08c-c165cdd5f760	2025-12-02 03:43:01.375606+00	2025-12-02 14:04:21.957857+00	\N	aal1	\N	2025-12-02 14:04:21.957074	Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36	136.48.47.38	\N	\N	\N	\N	\N
\.


--
-- Data for Name: sso_domains; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY auth.sso_domains (id, sso_provider_id, domain, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: sso_providers; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY auth.sso_providers (id, resource_id, created_at, updated_at, disabled) FROM stdin;
\.


--
-- Data for Name: users; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY auth.users (instance_id, id, aud, role, email, encrypted_password, email_confirmed_at, invited_at, confirmation_token, confirmation_sent_at, recovery_token, recovery_sent_at, email_change_token_new, email_change, email_change_sent_at, last_sign_in_at, raw_app_meta_data, raw_user_meta_data, is_super_admin, created_at, updated_at, phone, phone_confirmed_at, phone_change, phone_change_token, phone_change_sent_at, email_change_token_current, email_change_confirm_status, banned_until, reauthentication_token, reauthentication_sent_at, is_sso_user, deleted_at, is_anonymous) FROM stdin;
00000000-0000-0000-0000-000000000000	80cb2e43-2acc-4355-b08c-c165cdd5f760	authenticated	authenticated	pearsonperformance@gmail.com	$2a$10$DbVUdM1I8e1Un0RTEXEC4ORTiczxQn3fJpBi6z6SEBWMk..DGYUEC	2025-08-26 22:34:34.966815+00	\N		\N		\N			\N	2025-12-02 03:43:01.375465+00	{"provider": "email", "providers": ["email"]}	{"email_verified": true}	\N	2025-08-26 22:34:34.954998+00	2025-12-02 14:04:21.955498+00	\N	\N			\N		0	\N		\N	f	\N	f
\.


--
-- Data for Name: ai_model_settings; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.ai_model_settings (id, organization_id, primary_provider, primary_model, fallback_provider, fallback_model, temperature, max_tokens, claude_version, openai_organization_id, last_used_at, total_requests, total_tokens_used, created_at, updated_at, created_by) FROM stdin;
\.


--
-- Data for Name: announcements; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.announcements (id, organization_id, title, content, announcement_type, target_audience, custom_recipients, priority, scheduled_for, published_at, expires_at, is_published, created_by, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: api_keys; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.api_keys (id, organization_id, name, key_hash, key_preview, permissions, last_used_at, expires_at, status, created_by, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: blog_auto_generation_settings; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.blog_auto_generation_settings (id, organization_id, is_enabled, generation_frequency, generation_time, generation_timezone, last_generation_at, next_generation_at, target_word_count, content_style, industry_focus, target_keywords, optimize_for_geographic, target_locations, seo_focus, geo_optimization, perplexity_optimization, ai_search_optimization, topic_diversity_enabled, minimum_topic_gap_days, content_analysis_depth, auto_publish, publish_as_draft, require_review, notify_on_generation, notification_emails, content_template, custom_instructions, brand_voice_guidelines, created_at, updated_at, created_by) FROM stdin;
\.


--
-- Data for Name: blog_categories; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.blog_categories (id, name, slug, description, created_at, updated_at) FROM stdin;
bedd2e90-a559-44e8-8a96-23f18225dcc8	Equipment Management	equipment-management	\N	2025-09-13 15:59:40.670063+00	2025-09-13 15:59:40.670063+00
d10b923b-97f2-4577-84e1-fe992e3b8b68	Marketing	marketing	\N	2025-09-13 15:59:40.670063+00	2025-09-13 15:59:40.670063+00
690b1e3d-38d0-458f-b755-32b7bdae0eb4	Gym Management	gym-management	Best practices for running a successful fitness facility	2025-09-27 14:33:35.464706+00	2025-09-27 14:33:35.464706+00
b5dd309a-c712-49e8-b28d-673250a4420f	Member Retention	member-retention	Strategies to keep members engaged and reduce churn	2025-09-27 14:33:35.464706+00	2025-09-27 14:33:35.464706+00
ab44f64a-c941-44da-99fc-c88d05adb599	Equipment & Maintenance	equipment-maintenance	Equipment care, safety, and facility management	2025-09-27 14:33:35.464706+00	2025-09-27 14:33:35.464706+00
d0722cd9-99f9-43cf-85de-1d6538698de5	Staff Training	staff-training	Training and development for gym staff	2025-09-27 14:33:35.464706+00	2025-09-27 14:33:35.464706+00
0ef2b2e7-ca82-4d8c-ba7f-b8e3a57697a3	Marketing & Growth	marketing-growth	Marketing strategies and business growth tips	2025-09-27 14:33:35.464706+00	2025-09-27 14:33:35.464706+00
f358994f-3cde-4851-a32c-84eff904e18b	Technology & Innovation	technology-innovation	Latest tech trends in fitness industry	2025-09-27 14:33:35.464706+00	2025-09-27 14:33:35.464706+00
\.


--
-- Data for Name: blog_generation_queue; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.blog_generation_queue (id, organization_id, scheduled_for, status, priority, suggested_topic, target_keywords, custom_parameters, processing_started_at, processing_completed_at, error_message, retry_count, max_retries, blog_post_id, generation_metadata, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: blog_post_tags; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.blog_post_tags (post_id, tag_id) FROM stdin;
fa4be13a-4b43-4c83-884c-36a30e30c3e1	fcd8db5f-b977-4377-b559-439dcf346c88
fa4be13a-4b43-4c83-884c-36a30e30c3e1	d0ffb7dd-c0c6-4b5c-97a4-20b1bade932e
5cc9acac-278e-49de-a8c3-c55f055d7e60	74edff63-8e6f-464c-afbc-bf3be864fa7c
5cc9acac-278e-49de-a8c3-c55f055d7e60	a9aac615-e762-4276-9054-8ecc76777bd2
\.


--
-- Data for Name: blog_posts; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.blog_posts (id, slug, title, excerpt, content, featured_image, category_id, read_time, status, published_at, created_by, created_at, updated_at, meta_title, meta_description, meta_keywords) FROM stdin;
fa4be13a-4b43-4c83-884c-36a30e30c3e1	equipment-maintenance-guide	The Ultimate Equipment Maintenance Guide for Gym Owners	Keep your equipment running smoothly and extend its lifespan with this comprehensive maintenance checklist.	<p>Proper equipment maintenance is crucial for member safety, satisfaction, and your bottom line...</p>	/assets/equipment-maintenance.jpg	bedd2e90-a559-44e8-8a96-23f18225dcc8	12	published	2025-05-16 15:59:40.670063+00	\N	2025-09-13 15:59:40.670063+00	2025-09-13 15:59:40.670063+00	\N	\N	\N
5cc9acac-278e-49de-a8c3-c55f055d7e60	gym-marketing-strategies-2024	Top Gym Marketing Strategies That Actually Work in 2024	Modern marketing tactics to attract new members and build a strong fitness community.	<p>The fitness marketing landscape has evolved dramatically...</p>	/assets/gym-marketing.jpg	d10b923b-97f2-4577-84e1-fe992e3b8b68	10	published	2025-05-26 15:59:40.670063+00	\N	2025-09-13 15:59:40.670063+00	2025-09-13 15:59:40.670063+00	\N	\N	\N
580a5a3d-1b76-4a37-9b4b-363c8fe18bf8	complete-guide-gym-management-software-2024	The Complete Guide to Gym Management Software in 2024	Discover how modern gym management software can revolutionize your fitness business operations, boost member satisfaction, and increase revenue by up to 30%.	<h2>Why Gym Management Software is Essential for Modern Fitness Businesses</h2>\n<p>Running a successful gym in 2024 requires more than just great equipment and trainers. With competition fierce and member expectations higher than ever, gym management software has become the backbone of profitable fitness businesses.</p>\n\n<h2>Key Features Every Gym Management System Should Have</h2>\n<h3>Member Management & CRM</h3>\n<p>A robust member management system tracks member information, visit history, and engagement patterns. This data helps you identify at-risk members and create targeted retention campaigns.</p>\n\n<h3>Billing & Payment Processing</h3>\n<p>Automated billing reduces administrative overhead and ensures consistent cash flow. Look for systems that support multiple payment methods and handle failed payments gracefully.</p>\n\n<h3>Class Scheduling & Booking</h3>\n<p>Online class booking increases member satisfaction and reduces front desk workload. Members can book classes 24/7, and you can track capacity and popularity.</p>\n\n<h3>Staff Management</h3>\n<p>Track staff schedules, certifications, and performance metrics. Good staff management features help reduce turnover and ensure proper coverage.</p>\n\n<h2>ROI: How Management Software Pays for Itself</h2>\n<p>Studies show that gyms using comprehensive management software see:</p>\n<ul>\n<li>25-30% reduction in member churn</li>\n<li>40% decrease in administrative tasks</li>\n<li>20% increase in personal training sales</li>\n<li>15% improvement in overall member satisfaction</li>\n</ul>\n\n<h2>Implementation Best Practices</h2>\n<p>Successfully implementing gym management software requires careful planning. Start with staff training, migrate data gradually, and maintain clear communication with members throughout the transition.</p>\n\n<h2>Choosing the Right Platform</h2>\n<p>Consider factors like scalability, integration capabilities, customer support, and pricing structure. The best system grows with your business and adapts to changing needs.</p>	https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=800&h=400&fit=crop	690b1e3d-38d0-458f-b755-32b7bdae0eb4	8	published	2024-01-15 10:00:00+00	\N	2025-09-27 14:33:35.464706+00	2025-09-27 14:33:35.464706+00	Complete Guide to Gym Management Software 2024 | Rep Club	Discover how gym management software revolutionizes fitness businesses. Boost member satisfaction, reduce churn by 30%, and streamline operations. Free guide.	gym management software, fitness business software, gym CRM, member management, gym billing, class scheduling, fitness center technology
53da21f5-22e8-4776-af23-fae380de9e09	10-proven-strategies-reduce-gym-member-churn-2024	10 Proven Strategies to Reduce Gym Member Churn in 2024	Learn the top 10 evidence-based strategies that successful gyms use to reduce member churn rates by up to 40% and build long-term member loyalty.	<h2>The Hidden Cost of Member Churn</h2>\n<p>Member churn is the silent profit killer in the fitness industry. With average churn rates between 30-40% annually, retaining existing members is 5x more cost-effective than acquiring new ones.</p>\n\n<h2>Strategy 1: Implement a Comprehensive Onboarding Program</h2>\n<p>New members who complete a structured onboarding program are 80% more likely to stay beyond their first year. Your onboarding should include:</p>\n<ul>\n<li>Fitness assessment and goal setting</li>\n<li>Equipment orientation and safety training</li>\n<li>Introduction to staff and trainers</li>\n<li>Customized workout plan creation</li>\n</ul>\n\n<h2>Strategy 2: Use Predictive Analytics to Identify At-Risk Members</h2>\n<p>Track key indicators like visit frequency, class attendance, and engagement metrics. Members who show declining activity patterns are prime candidates for retention interventions.</p>\n\n<h2>Strategy 3: Create a Strong Community Culture</h2>\n<p>Members who feel connected to your gym community are 60% less likely to cancel. Foster community through:</p>\n<ul>\n<li>Group challenges and competitions</li>\n<li>Social events and member appreciation days</li>\n<li>Member Facebook groups or forums</li>\n<li>Partner workout programs</li>\n</ul>\n\n<h2>Strategy 4: Personalize the Member Experience</h2>\n<p>Use member data to create personalized experiences. Send customized workout suggestions, celebrate fitness milestones, and offer relevant services based on member preferences.</p>\n\n<h2>Strategy 5: Optimize Your Cancellation Process</h2>\n<p>Don't make cancellation difficult, but do make it productive. Use exit interviews to understand reasons for leaving and offer alternatives like membership freezes or plan downgrades.</p>\n\n<h2>Strategy 6: Implement Regular Check-ins</h2>\n<p>Proactive communication prevents problems from escalating. Schedule regular check-ins with members, especially during their first 90 days.</p>\n\n<h2>Strategy 7: Offer Flexible Membership Options</h2>\n<p>Life circumstances change. Offer membership pause options, flexible contracts, and seasonal memberships to accommodate member needs.</p>\n\n<h2>Strategy 8: Maintain Exceptional Facility Standards</h2>\n<p>Clean, well-maintained facilities with modern equipment create positive experiences that keep members coming back.</p>\n\n<h2>Strategy 9: Invest in Staff Training</h2>\n<p>Friendly, knowledgeable staff significantly impact member satisfaction. Invest in customer service training and create a culture of member-first thinking.</p>\n\n<h2>Strategy 10: Track and Act on Member Feedback</h2>\n<p>Regular surveys and feedback collection help you address issues before they lead to cancellations. Act quickly on legitimate concerns and communicate changes to members.</p>\n\n<h2>Measuring Success</h2>\n<p>Track key metrics like monthly churn rate, lifetime value, and Net Promoter Score to measure the effectiveness of your retention strategies.</p>	https://images.unsplash.com/photo-1549476464-37392f717541?w=800&h=400&fit=crop	b5dd309a-c712-49e8-b28d-673250a4420f	12	published	2024-01-20 09:00:00+00	\N	2025-09-27 14:33:35.464706+00	2025-09-27 14:33:35.464706+00	10 Proven Strategies to Reduce Gym Member Churn | Rep Club	Reduce gym member churn by 40% with these proven strategies. Expert tips for member retention, onboarding, and building gym community. Free guide.	gym member retention, reduce gym churn, member loyalty, fitness member retention, gym business strategies, member satisfaction
\.


--
-- Data for Name: blog_tags; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.blog_tags (id, name, slug, created_at, updated_at) FROM stdin;
fcd8db5f-b977-4377-b559-439dcf346c88	equipment	equipment	2025-09-13 15:59:40.670063+00	2025-09-13 15:59:40.670063+00
d0ffb7dd-c0c6-4b5c-97a4-20b1bade932e	maintenance	maintenance	2025-09-13 15:59:40.670063+00	2025-09-13 15:59:40.670063+00
74edff63-8e6f-464c-afbc-bf3be864fa7c	marketing	marketing	2025-09-13 15:59:40.670063+00	2025-09-13 15:59:40.670063+00
a9aac615-e762-4276-9054-8ecc76777bd2	social media	social-media	2025-09-13 15:59:40.670063+00	2025-09-13 15:59:40.670063+00
91430aca-78cf-4a20-9a9d-0ada5af1293a	Gym Management	gym-management	2025-09-27 14:33:35.464706+00	2025-09-27 14:33:35.464706+00
e2031b24-98f1-4644-bb93-607308c96a49	Member Retention	member-retention	2025-09-27 14:33:35.464706+00	2025-09-27 14:33:35.464706+00
99ace141-085e-49fc-bf34-61a3e1ceeb1c	Equipment Maintenance	equipment-maintenance	2025-09-27 14:33:35.464706+00	2025-09-27 14:33:35.464706+00
2604e678-5440-44fe-b98b-0ed7f5947578	Staff Training	staff-training	2025-09-27 14:33:35.464706+00	2025-09-27 14:33:35.464706+00
8b07bf23-2f7b-46de-9562-111039dce634	Digital Marketing	digital-marketing	2025-09-27 14:33:35.464706+00	2025-09-27 14:33:35.464706+00
aae4a586-bc81-46f1-9264-682d56a31414	Fitness Technology	fitness-technology	2025-09-27 14:33:35.464706+00	2025-09-27 14:33:35.464706+00
43ff56cb-8301-475b-8fda-2f8facd6bc7d	Business Growth	business-growth	2025-09-27 14:33:35.464706+00	2025-09-27 14:33:35.464706+00
3e35fe8e-380c-4443-a67d-02f3c4b5bc56	Customer Service	customer-service	2025-09-27 14:33:35.464706+00	2025-09-27 14:33:35.464706+00
457d01eb-bea5-44a9-887a-253b20cdadb5	Safety Protocols	safety-protocols	2025-09-27 14:33:35.464706+00	2025-09-27 14:33:35.464706+00
a0cff6e4-7d9a-473e-92ff-5b765ca62579	ROI Optimization	roi-optimization	2025-09-27 14:33:35.464706+00	2025-09-27 14:33:35.464706+00
\.


--
-- Data for Name: blog_topic_history; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.blog_topic_history (id, organization_id, blog_post_id, primary_topic, secondary_topics, keywords_used, topic_category, content_type, target_keywords, geo_targets, seo_score, readability_score, generation_model, generation_time_seconds, ai_confidence_score, created_at) FROM stdin;
\.


--
-- Data for Name: bulk_member_operations; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.bulk_member_operations (id, organization_id, corporate_account_id, operation_type, initiated_by, total_members, processed_members, failed_members, operation_data, error_log, status, started_at, completed_at, created_at) FROM stdin;
\.


--
-- Data for Name: campaign_executions; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.campaign_executions (id, campaign_id, member_id, executed_at, status, reward_claimed, reward_claimed_at, notes, created_at, message_type, template_id, delivery_status) FROM stdin;
\.


--
-- Data for Name: certification_requirements; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.certification_requirements (id, organization_id, certification_name, description, validity_period_months, is_required, required_for_roles, renewal_notice_days, training_provider, cost_estimate, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: check_ins; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.check_ins (id, member_id, location_id, checked_in_at, checked_out_at, guest_name, guest_email, guest_phone, is_guest, lead_id) FROM stdin;
\.


--
-- Data for Name: child_profiles; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.child_profiles (id, organization_id, parent_member_id, child_first_name, child_last_name, date_of_birth, gender, emergency_contact_name, emergency_contact_phone, medical_conditions, allergies, dietary_restrictions, special_instructions, authorized_pickup_contacts, photo_url, is_active, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: childcare_activities; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.childcare_activities (id, organization_id, activity_name, description, age_group_min_months, age_group_max_months, max_participants, staff_ratio_requirement, activity_date, start_time, end_time, duration_minutes, location_room, equipment_needed, activity_fee, requires_registration, registration_deadline, activity_type, is_recurring, recurring_pattern, assigned_staff, status, created_by, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: childcare_activity_registrations; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.childcare_activity_registrations (id, organization_id, activity_id, child_id, parent_member_id, registration_date, attended, payment_status, special_requests, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: childcare_checkins; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.childcare_checkins (id, organization_id, child_id, activity_id, parent_member_id, check_in_time, check_out_time, checked_in_by, checked_out_by, drop_off_notes, pick_up_notes, child_condition_checkin, child_condition_checkout, authorized_pickup_person, pickup_person_id, incident_occurred, incident_description, diaper_changes, meals_eaten, nap_start_time, nap_end_time, mood_rating, activities_participated, status, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: childcare_daily_reports; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.childcare_daily_reports (id, organization_id, child_id, report_date, arrival_time, departure_time, meals, naps, diaper_changes, activities, mood_observations, learning_milestones, social_interactions, parent_communication, photos_taken, incidents, overall_rating, staff_notes, parent_signature_required, parent_signed_at, created_by, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: childcare_staff_schedules; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.childcare_staff_schedules (id, organization_id, staff_id, schedule_date, start_time, end_time, break_start, break_end, max_children_capacity, current_children_count, room_assignment, age_group_specialization, certifications, is_available, notes, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: class_analytics; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.class_analytics (id, organization_id, class_id, instructor_id, class_date, class_name, instructor_name, capacity, bookings, attendance, no_shows, cancellations, utilization_rate, attendance_rate, revenue, created_at) FROM stdin;
\.


--
-- Data for Name: class_bookings; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.class_bookings (id, class_id, member_id, status, booked_at, attended_at) FROM stdin;
\.


--
-- Data for Name: class_categories; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.class_categories (id, organization_id, name, description, color, created_at) FROM stdin;
6a6a48b2-e4cd-4917-bef2-e9be5d5af0e1	550e8400-e29b-41d4-a716-446655440001	Yoga	Mindful movement and flexibility	#10b981	2025-08-26 21:36:12.15123+00
7236d124-029d-4c4e-ab08-207dc1377e39	550e8400-e29b-41d4-a716-446655440001	HIIT	High intensity interval training	#ef4444	2025-08-26 21:36:12.15123+00
c3e9902d-c0b4-4767-8d92-db0714bc7ff9	550e8400-e29b-41d4-a716-446655440001	Strength Training	Weight lifting and muscle building	#3b82f6	2025-08-26 21:36:12.15123+00
c5ce7ea1-0258-47d0-a2cc-2eedfd76ea46	550e8400-e29b-41d4-a716-446655440001	Cardio	Heart-pumping aerobic exercises	#f59e0b	2025-08-26 21:36:12.15123+00
\.


--
-- Data for Name: class_waitlists; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.class_waitlists (id, class_id, member_id, joined_at, priority_order, status, notified_at, expires_at, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: classes; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.classes (id, organization_id, location_id, category_id, instructor_id, name, description, duration_minutes, max_capacity, scheduled_at, created_at, updated_at) FROM stdin;
90b8f83f-42f1-4e38-9222-9b44488a7493	550e8400-e29b-41d4-a716-446655440001	550e8400-e29b-41d4-a716-446655440002	c5ce7ea1-0258-47d0-a2cc-2eedfd76ea46	\N	Morning Yoga Flow	Start your day with energizing yoga poses and mindful breathing	60	15	2025-08-28 04:42:03.250739+00	2025-08-26 21:42:03.250739+00	2025-08-26 21:42:03.250739+00
63f33318-0920-4311-b37b-303cd2b491e1	550e8400-e29b-41d4-a716-446655440001	550e8400-e29b-41d4-a716-446655440002	c5ce7ea1-0258-47d0-a2cc-2eedfd76ea46	\N	HIIT Blast	High-intensity interval training for maximum calorie burn	45	12	2025-08-28 15:42:03.250739+00	2025-08-26 21:42:03.250739+00	2025-08-26 21:42:03.250739+00
673007cb-8384-4cdc-9e9b-eee7146e9b22	550e8400-e29b-41d4-a716-446655440001	550e8400-e29b-41d4-a716-446655440002	c5ce7ea1-0258-47d0-a2cc-2eedfd76ea46	\N	Strength & Conditioning	Build muscle and improve functional fitness	75	10	2025-08-29 06:42:03.250739+00	2025-08-26 21:42:03.250739+00	2025-08-26 21:42:03.250739+00
0634d87e-4f77-4024-87de-4c44983e9e33	550e8400-e29b-41d4-a716-446655440001	550e8400-e29b-41d4-a716-446655440002	c5ce7ea1-0258-47d0-a2cc-2eedfd76ea46	\N	Cardio Kickboxing	Fun cardio workout with martial arts moves	50	20	2025-08-29 16:42:03.250739+00	2025-08-26 21:42:03.250739+00	2025-08-26 21:42:03.250739+00
e6921b6e-06a2-4b60-85ef-38c724b9674b	550e8400-e29b-41d4-a716-446655440001	550e8400-e29b-41d4-a716-446655440002	c5ce7ea1-0258-47d0-a2cc-2eedfd76ea46	\N	Evening Yoga Restore	Gentle yoga to unwind and relax after a long day	60	15	2025-08-30 16:42:03.250739+00	2025-08-26 21:42:03.250739+00	2025-08-26 21:42:03.250739+00
4d082664-8c12-468b-b1d8-d5aa7a89673a	550e8400-e29b-41d4-a716-446655440001	550e8400-e29b-41d4-a716-446655440002	c5ce7ea1-0258-47d0-a2cc-2eedfd76ea46	\N	Morning HIIT	Quick morning workout to energize your day	30	15	2025-08-31 03:42:03.250739+00	2025-08-26 21:42:03.250739+00	2025-08-26 21:42:03.250739+00
71a2beeb-8814-42b5-bb95-3ad67eb72156	550e8400-e29b-41d4-a716-446655440001	550e8400-e29b-41d4-a716-446655440002	c5ce7ea1-0258-47d0-a2cc-2eedfd76ea46	\N	Powerlifting Basics	Introduction to powerlifting fundamentals	90	8	2025-09-01 07:42:03.250739+00	2025-08-26 21:42:03.250739+00	2025-08-26 21:42:03.250739+00
53f2043d-068e-4f76-9787-4134f95812f4	550e8400-e29b-41d4-a716-446655440001	550e8400-e29b-41d4-a716-446655440002	c5ce7ea1-0258-47d0-a2cc-2eedfd76ea46	\N	Spin Class	High-energy cycling workout with motivating music	45	25	2025-09-02 05:42:03.250739+00	2025-08-26 21:42:03.250739+00	2025-08-26 21:42:03.250739+00
\.


--
-- Data for Name: cleaning_schedules; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.cleaning_schedules (id, organization_id, area_id, task_name, frequency, assigned_to, estimated_duration_minutes, last_completed, next_due, status, priority, supplies_needed, instructions, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: commission_calculations; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.commission_calculations (id, lead_id, salesperson_id, membership_id, commission_amount, commission_type, revenue_basis, payment_period_start, payment_period_end, status, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: communication_providers; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.communication_providers (id, organization_id, provider_type, provider_name, configuration, is_active, is_default, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: communication_templates; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.communication_templates (id, organization_id, name, template_type, category, subject, content, variables, is_active, created_by, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: corporate_accounts; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.corporate_accounts (id, organization_id, company_name, contact_person, contact_email, contact_phone, billing_address, tax_id, contract_start_date, contract_end_date, total_member_allocation, used_member_allocation, monthly_rate_per_member, setup_fee, discount_percentage, billing_cycle, auto_billing, status, account_manager_id, payment_terms, special_terms, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: corporate_invoice_items; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.corporate_invoice_items (id, invoice_id, member_id, item_type, description, quantity, unit_price, total_price, billing_period_start, billing_period_end, created_at) FROM stdin;
\.


--
-- Data for Name: corporate_invoices; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.corporate_invoices (id, organization_id, corporate_account_id, invoice_number, billing_period_start, billing_period_end, member_count, base_amount, discount_amount, tax_amount, additional_charges, total_amount, payment_due_date, payment_received_date, payment_method, payment_reference, late_fee, status, sent_at, created_by, notes, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: corporate_members; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.corporate_members (id, corporate_account_id, member_id, corporate_plan_id, employee_id, department, job_title, manager_member_id, start_date, end_date, is_active, billing_responsibility, employee_contribution, notes, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: corporate_membership_plans; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.corporate_membership_plans (id, organization_id, corporate_account_id, plan_name, description, monthly_rate, access_level, included_services, excluded_services, guest_privileges, class_booking_priority, personal_training_discount, retail_discount, parking_included, locker_included, is_active, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: cost_allocations; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.cost_allocations (id, organization_id, department_name, cost_category, period_start, period_end, allocated_amount, allocation_basis, allocation_percentage, notes, created_by, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: court_reservations; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.court_reservations (id, organization_id, court_id, member_id, reservation_date, start_time, end_time, duration_minutes, hourly_rate, total_cost, payment_status, payment_method, additional_players, special_requests, checked_in_at, cancelled_at, cancellation_reason, created_at, updated_at, status) FROM stdin;
\.


--
-- Data for Name: cross_location_assignments; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.cross_location_assignments (id, organization_id, staff_id, location_id, assignment_type, start_date, end_date, permissions, hourly_rate, is_active, created_by, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: cross_location_transfers; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.cross_location_transfers (id, organization_id, transfer_type, entity_id, from_location_id, to_location_id, transfer_date, effective_date, reason, transfer_fee, approval_required, approved_by, approved_at, initiated_by, created_at, updated_at, status) FROM stdin;
\.


--
-- Data for Name: daily_analytics_snapshots; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.daily_analytics_snapshots (id, organization_id, snapshot_date, total_members, active_members, new_members_today, total_check_ins, total_revenue, classes_scheduled, class_bookings, class_attendance_rate, created_at) FROM stdin;
\.


--
-- Data for Name: department_budgets; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.department_budgets (id, organization_id, department_name, budget_year, budget_month, revenue_budget, expense_budget, profit_target, created_by, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: department_revenues; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.department_revenues (id, organization_id, department_name, revenue_source, period_start, period_end, revenue_amount, transaction_count, average_transaction_value, created_by, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: early_access_requests; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.early_access_requests (id, name, email, company, phone, business_type, current_members, message, status, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: email_messages; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.email_messages (id, thread_id, external_id, to_email, from_name, from_email, subject, body, received_date, status, assigned_to, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: email_responses; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.email_responses (id, message_id, sent_by, response_body, sent_at, created_at) FROM stdin;
\.


--
-- Data for Name: email_templates; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.email_templates (id, organization_id, name, subject, content, template_type, is_active, created_by, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: email_threads; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.email_threads (id, organization_id, domain, display_name, is_active, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: equipment; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.equipment (id, organization_id, name, equipment_type, brand, model, serial_number, purchase_date, purchase_price, warranty_expiry, location_id, status, last_maintenance_date, next_maintenance_date, maintenance_interval_days, usage_hours, notes, specifications, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: equipment_checkout; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.equipment_checkout (id, organization_id, equipment_item_id, member_id, checked_out_by, checked_out_at, due_back_at, checked_in_at, checked_in_by, rental_fee, deposit_amount, damage_fee, condition_out, condition_in, damage_notes, created_at, updated_at, status) FROM stdin;
\.


--
-- Data for Name: expense_categories; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.expense_categories (id, organization_id, name, description, budget_amount, is_active, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: expense_vendors; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.expense_vendors (id, organization_id, name, contact_person, email, phone, address, payment_terms, tax_id, is_active, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: expenses; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.expenses (id, organization_id, vendor_id, category_id, expense_date, amount, description, receipt_url, receipt_filename, payment_method, payment_status, payment_date, check_number, reference_number, approved_by, approved_at, recurring, recurring_frequency, created_by, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: facility_areas; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.facility_areas (id, organization_id, location_id, name, area_type, square_footage, max_capacity, equipment_count, cleaning_frequency, last_cleaned, temperature_range, special_requirements, safety_notes, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: facility_tours; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.facility_tours (id, lead_id, scheduled_date, scheduled_time, tour_type, guide_id, status, outcome, notes, follow_up_date, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: fitness_assessments; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.fitness_assessments (id, member_id, fitness_goals, experience_level, workout_preferences, workout_frequency, specific_goals, health_conditions, previous_injuries, assessment_date, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: guest_pass_types; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.guest_pass_types (id, organization_id, name, description, price, validity_hours, includes_amenities, max_uses_per_member, is_active, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: guest_passes; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.guest_passes (id, organization_id, pass_type_id, purchased_by, guest_name, guest_email, guest_phone, purchase_date, valid_until, amount_paid, payment_method, used_at, status, notes, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: incident_follow_ups; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.incident_follow_ups (id, organization_id, incident_report_id, task_type, task_description, assigned_to, due_date, completed_at, completed_by, completion_notes, priority, status, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: incident_investigations; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.incident_investigations (id, organization_id, incident_report_id, investigator_id, investigation_date, findings, recommendations, contributing_factors, preventability, investigation_status, photos, documents, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: incident_reports; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.incident_reports (id, organization_id, location_id, reported_by, incident_date, incident_type, severity, description, injured_person_name, injured_person_type, injured_person_id, equipment_involved, area_involved, witnesses, actions_taken, medical_attention_required, medical_provider, follow_up_required, follow_up_date, insurance_notified, insurance_claim_number, status, resolved_by, resolved_at, resolution_notes, photos, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: inspection_checklist_items; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.inspection_checklist_items (id, checklist_id, item_number, item_description, is_critical, expected_condition, inspection_method, pass_criteria, fail_criteria, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: inspection_checklists; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.inspection_checklists (id, organization_id, checklist_name, equipment_type, description, frequency_days, is_active, requires_certification, created_by, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: inspection_results; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.inspection_results (id, inspection_id, checklist_item_id, result_status, inspector_notes, photo_urls, measurements, action_required, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: instructor_availability; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.instructor_availability (id, instructor_id, day_of_week, start_time, end_time, is_available, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: insurance_claims; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.insurance_claims (id, organization_id, incident_report_id, claim_number, insurance_company, policy_number, claim_type, claim_amount, claim_status, filed_date, adjuster_name, adjuster_contact, settlement_amount, settlement_date, claim_notes, documents, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: integration_logs; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.integration_logs (id, organization_id, integration_id, api_key_id, event_type, details, status, created_at) FROM stdin;
\.


--
-- Data for Name: integrations; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.integrations (id, organization_id, name, integration_type, status, config, last_sync_at, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: inventory_items; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.inventory_items (id, organization_id, product_id, location_id, current_stock, min_stock_level, max_stock_level, reorder_point, last_restocked_at, last_count_date, cost_per_unit, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: kpi_metrics; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.kpi_metrics (id, organization_id, metric_name, metric_category, metric_value, target_value, metric_unit, period_start, period_end, created_at) FROM stdin;
\.


--
-- Data for Name: lead_activities; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.lead_activities (id, lead_id, activity_type, title, description, scheduled_at, completed_at, created_by, outcome, next_action, created_at, updated_at) FROM stdin;
e13f8fcb-a4ea-4404-a259-f3d9ce0d1b6c	44b9df9a-bebb-468d-a4ca-1e4eb4ab643a	call	Call to lead	lead	\N	2025-08-27 01:59:39.246+00	80cb2e43-2acc-4355-b08c-c165cdd5f760	lead	lead	2025-08-27 01:59:39.802004+00	2025-08-27 01:59:39.802004+00
13b4126e-df63-421d-8f0b-9c6be8d4d9bc	44b9df9a-bebb-468d-a4ca-1e4eb4ab643a	appointment	Tour	\N	2025-08-29 23:18:00+00	2025-08-27 02:15:48.608+00	80cb2e43-2acc-4355-b08c-c165cdd5f760	\N	\N	2025-08-27 02:15:48.996683+00	2025-08-27 02:15:48.996683+00
\.


--
-- Data for Name: lead_attribution_disputes; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.lead_attribution_disputes (id, lead_id, disputing_salesperson_id, current_salesperson_id, dispute_reason, evidence, status, reviewed_by, reviewed_at, resolution_notes, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: lead_scoring_rules; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.lead_scoring_rules (id, organization_id, rule_name, criteria_type, criteria_field, criteria_operator, criteria_value, score_points, is_active, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: lead_sources; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.lead_sources (id, organization_id, name, description, source_type, tracking_url, utm_parameters, cost_per_lead, conversion_rate, is_active, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: lead_split_commissions; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.lead_split_commissions (id, lead_id, salesperson_id, commission_percentage, created_at, created_by) FROM stdin;
\.


--
-- Data for Name: lead_stages; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.lead_stages (id, organization_id, name, description, order_index, color, is_closed, created_at, updated_at) FROM stdin;
6a9deee8-0055-4d87-8392-cde54078c87a	00000000-0000-0000-0000-000000000000	New Lead	Initial contact made	1	#3b82f6	f	2025-08-26 22:02:17.36649+00	2025-08-26 22:02:17.36649+00
dc87dc57-ea58-4e8f-a8e7-b37471c78ec3	00000000-0000-0000-0000-000000000000	Qualified	Lead shows genuine interest	2	#8b5cf6	f	2025-08-26 22:02:17.36649+00	2025-08-26 22:02:17.36649+00
1c29d343-3ecb-45cd-8767-4e877fcce20a	00000000-0000-0000-0000-000000000000	Tour Scheduled	Facility tour booked	3	#f59e0b	f	2025-08-26 22:02:17.36649+00	2025-08-26 22:02:17.36649+00
3d916114-57f5-4867-8fc2-bea082f2f8e5	00000000-0000-0000-0000-000000000000	Tour Completed	Completed facility tour	4	#10b981	f	2025-08-26 22:02:17.36649+00	2025-08-26 22:02:17.36649+00
5a23f5f4-561d-4867-b71b-6222de730c73	00000000-0000-0000-0000-000000000000	Proposal Sent	Membership proposal provided	5	#f97316	f	2025-08-26 22:02:17.36649+00	2025-08-26 22:02:17.36649+00
384c1396-6597-462d-b48b-3b66191e06c4	00000000-0000-0000-0000-000000000000	Negotiating	Discussing terms and pricing	6	#ef4444	f	2025-08-26 22:02:17.36649+00	2025-08-26 22:02:17.36649+00
9bb7a840-71ae-4ff2-9270-f43b188b6610	00000000-0000-0000-0000-000000000000	Closed Won	Converted to member	7	#22c55e	t	2025-08-26 22:02:17.36649+00	2025-08-26 22:02:17.36649+00
75b0a8d7-54ab-48d9-9ebe-f583744fa226	00000000-0000-0000-0000-000000000000	Closed Lost	Lead did not convert	8	#6b7280	t	2025-08-26 22:02:17.36649+00	2025-08-26 22:02:17.36649+00
a4843f40-a8a4-49ed-9248-19f707dafe90	6f27d544-adf7-4f56-86c4-d1727662f999	New Lead	Initial contact made	1	#3b82f6	f	2025-08-27 01:56:55.04705+00	2025-08-27 01:56:55.04705+00
c54147ef-4d62-4132-8451-8568b3da6ef6	6f27d544-adf7-4f56-86c4-d1727662f999	Qualified	Lead shows genuine interest	2	#8b5cf6	f	2025-08-27 01:56:55.04705+00	2025-08-27 01:56:55.04705+00
a2e69350-284c-4f59-a878-3954f5102442	6f27d544-adf7-4f56-86c4-d1727662f999	Tour Scheduled	Facility tour booked	3	#f59e0b	f	2025-08-27 01:56:55.04705+00	2025-08-27 01:56:55.04705+00
a0ee20b0-6486-4478-91f3-8bd1a73bfa31	6f27d544-adf7-4f56-86c4-d1727662f999	Tour Completed	Completed facility tour	4	#10b981	f	2025-08-27 01:56:55.04705+00	2025-08-27 01:56:55.04705+00
67ec900e-439e-4b89-b8c1-d9ec71cca9df	6f27d544-adf7-4f56-86c4-d1727662f999	Proposal Sent	Membership proposal provided	5	#f97316	f	2025-08-27 01:56:55.04705+00	2025-08-27 01:56:55.04705+00
10b5ba60-99e8-4f90-819d-a0648082df5b	6f27d544-adf7-4f56-86c4-d1727662f999	Negotiating	Discussing terms and pricing	6	#ef4444	f	2025-08-27 01:56:55.04705+00	2025-08-27 01:56:55.04705+00
fa9c9b1a-05ff-4f74-b789-4ebceb98be44	6f27d544-adf7-4f56-86c4-d1727662f999	Closed Won	Converted to member	7	#22c55e	t	2025-08-27 01:56:55.04705+00	2025-08-27 01:56:55.04705+00
589ef2c6-fcf3-4356-8c2f-5c6acc9ce7b8	6f27d544-adf7-4f56-86c4-d1727662f999	Closed Lost	Lead did not convert	8	#6b7280	t	2025-08-27 01:56:55.04705+00	2025-08-27 01:56:55.04705+00
\.


--
-- Data for Name: leads; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.leads (id, organization_id, email, first_name, last_name, phone, status, stage_id, assigned_to, source, interest_level, estimated_value, last_contact_date, next_follow_up_date, notes, created_at, updated_at, entered_by, assigned_salesperson, referral_code, attribution_status, lead_score, qualification_status) FROM stdin;
44b9df9a-bebb-468d-a4ca-1e4eb4ab643a	6f27d544-adf7-4f56-86c4-d1727662f999	JamesonWhiskey@gmail.com	John	Jameson	5152372352	member	c54147ef-4d62-4132-8451-8568b3da6ef6	\N	referral	warm	650	2025-08-27 02:15:48.699+00	\N		2025-08-27 01:59:18.131979+00	2025-08-27 02:15:49.18833+00	\N	\N	\N	confirmed	0	unqualified
\.


--
-- Data for Name: liability_waivers; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.liability_waivers (id, organization_id, visitor_checkin_id, signee_name, signee_email, signature_data, waiver_content, signed_at, witness_staff_id, ip_address, created_at) FROM stdin;
\.


--
-- Data for Name: lifeguard_schedules; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.lifeguard_schedules (id, organization_id, pool_id, lifeguard_id, scheduled_date, start_time, end_time, shift_type, is_head_lifeguard, certification_expires, created_by, created_at, updated_at, status, notes) FROM stdin;
\.


--
-- Data for Name: location_analytics; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.location_analytics (id, organization_id, location_id, analytics_date, total_members, active_members, new_members, cancelled_members, daily_checkins, peak_hour_checkins, revenue_total, revenue_memberships, revenue_classes, revenue_personal_training, revenue_retail, classes_held, equipment_maintenance_requests, staff_hours_worked, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: location_hierarchies; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.location_hierarchies (id, organization_id, parent_location_id, child_location_id, hierarchy_type, relationship_start_date, relationship_end_date, is_active, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: locations; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.locations (id, organization_id, name, address, phone, email, timezone, created_at, updated_at, is_headquarters, location_code, region, district, manager_id, operating_hours, max_capacity, square_footage, parking_spaces, amenities, status) FROM stdin;
550e8400-e29b-41d4-a716-446655440002	550e8400-e29b-41d4-a716-446655440001	FitCore Main Branch	123 Fitness St, Gym City, GC 12345	(555) 123-4567	info@fitcoregym.com	America/New_York	2025-08-26 21:36:12.15123+00	2025-08-26 21:36:12.15123+00	f	\N	\N	\N	\N	{}	\N	\N	\N	[]	active
9e81478c-ba19-433b-80ed-4aec0a682b6c	6f27d544-adf7-4f56-86c4-d1727662f999	Main Location	123 Fitness Street, City, State 12345	+1 (555) 123-4567	info@repclubfitness.com	America/New_York	2025-08-26 22:53:16.334778+00	2025-08-26 22:53:16.334778+00	f	\N	\N	\N	\N	{}	\N	\N	\N	[]	active
a290f1ee-6c54-4b01-90e6-d701748f0851	d290f1ee-6c54-4b01-90e6-d701748f0851	Main Location	123 Fitness St, Gym City, GC 12345	+1-555-123-4567	info@fitnesspro.com	America/New_York	2025-09-01 04:34:58.964046+00	2025-09-01 04:34:58.964046+00	f	\N	\N	\N	\N	{}	\N	\N	\N	[]	active
\.


--
-- Data for Name: locker_access_log; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.locker_access_log (id, organization_id, locker_id, member_id, staff_id, access_type, access_time, access_method, notes, created_at) FROM stdin;
\.


--
-- Data for Name: locker_maintenance; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.locker_maintenance (id, organization_id, locker_id, maintenance_type, performed_by, maintenance_date, issue_description, resolution_notes, parts_replaced, labor_time_minutes, cost, follow_up_required, follow_up_date, status, photos, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: locker_rentals; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.locker_rentals (id, organization_id, locker_id, member_id, rental_type, start_date, end_date, monthly_rate, deposit_paid, deposit_refunded, auto_renew, status, payment_method, last_payment_date, next_payment_due, notes, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: lockers; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.lockers (id, organization_id, location_id, locker_number, locker_type, size_category, has_lock, lock_type, lock_combination, key_number, monthly_rate, daily_rate, deposit_amount, is_available, is_out_of_order, maintenance_notes, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: loyalty_points; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.loyalty_points (id, member_id, points_earned, points_redeemed, current_balance, reason, activity_type, reference_id, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: loyalty_program_rules; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.loyalty_program_rules (id, organization_id, activity_type, points_awarded, description, is_active, conditions, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: loyalty_redemptions; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.loyalty_redemptions (id, member_id, reward_id, points_used, status, redeemed_at, fulfilled_at, fulfilled_by, notes, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: loyalty_rewards; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.loyalty_rewards (id, organization_id, name, description, category, points_cost, is_active, stock_quantity, redemption_limit, expiry_date, terms_conditions, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: maintenance_logs; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.maintenance_logs (id, organization_id, equipment_id, maintenance_schedule_id, performed_by, maintenance_date, maintenance_type, description, parts_used, labor_hours, cost, next_maintenance_date, photos, notes, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: maintenance_schedules; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.maintenance_schedules (id, organization_id, equipment_id, maintenance_type, title, description, scheduled_date, estimated_duration_minutes, assigned_to, priority, status, completion_date, completion_notes, cost, vendor_id, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: marketing_analytics; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.marketing_analytics (id, organization_id, campaign_id, campaign_type, campaign_name, period_start, period_end, impressions, clicks, conversions, leads_generated, cost, revenue, roi, click_through_rate, conversion_rate, cost_per_lead, customer_acquisition_cost, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: marketing_campaigns; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.marketing_campaigns (id, organization_id, name, campaign_type, status, subject, content, target_segment, custom_recipients, scheduled_at, sent_at, sent_count, delivered_count, opened_count, clicked_count, unsubscribed_count, bounced_count, created_by, created_at, updated_at) FROM stdin;
a73548e9-cd6f-4d80-b804-2a408d91f2fc	6f27d544-adf7-4f56-86c4-d1727662f999	New Member Welcome Series	email	active	Welcome to RepClub! Your fitness journey starts now 	Welcome to our fitness community! We're excited to help you achieve your fitness goals.	new_members	\N	\N	\N	45	0	38	10	0	0	80cb2e43-2acc-4355-b08c-c165cdd5f760	2025-08-27 04:09:25.141972+00	2025-09-01 04:09:25.141972+00
525942f3-5361-45f0-b428-52ef1f5fb2f7	6f27d544-adf7-4f56-86c4-d1727662f999	Class Reminder Campaign	email	scheduled	Don't forget your yoga class tomorrow at 10 AM!	This is a friendly reminder about your upcoming class. We look forward to seeing you there!	active_members	\N	2025-09-02 04:09:25.141972+00	\N	0	0	0	0	0	0	80cb2e43-2acc-4355-b08c-c165cdd5f760	2025-08-30 04:09:25.141972+00	2025-09-01 04:09:25.141972+00
446d4572-2b89-4b00-9d96-1dbabee95a5f	6f27d544-adf7-4f56-86c4-d1727662f999	Member Retention Offer	email	completed	 Special offer just for you - Come back to RepClub	We miss you! Here's a special offer to welcome you back to your fitness journey.	at_risk_members	\N	\N	\N	23	0	15	3	0	0	80cb2e43-2acc-4355-b08c-c165cdd5f760	2025-08-22 04:09:25.141972+00	2025-09-01 04:09:25.141972+00
\.


--
-- Data for Name: member_analytics_snapshots; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.member_analytics_snapshots (id, organization_id, snapshot_date, total_members, active_members, new_members, churned_members, average_visits_per_member, retention_rate, created_at) FROM stdin;
\.


--
-- Data for Name: member_cards; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.member_cards (id, member_id, card_number, nfc_enabled, nfc_uid, barcode, qr_code, status, issued_at, expires_at, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: member_cohorts; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.member_cohorts (id, organization_id, cohort_period, cohort_size, month_1_retained, month_2_retained, month_3_retained, month_6_retained, month_12_retained, month_1_rate, month_2_rate, month_3_rate, month_6_rate, month_12_rate, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: member_documents; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.member_documents (id, member_id, document_name, document_type, file_url, file_size, uploaded_by, notes, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: member_engagement_history; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.member_engagement_history (id, member_id, engagement_type, engagement_value, metadata, created_at) FROM stdin;
\.


--
-- Data for Name: member_feedback; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.member_feedback (id, member_id, feedback_type, rating, title, content, is_anonymous, status, assigned_to, response, responded_by, responded_at, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: member_location_access; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.member_location_access (id, organization_id, member_id, location_id, access_type, access_start_date, access_end_date, visit_limit, visits_used, additional_fee, is_active, granted_by, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: member_messages; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.member_messages (id, sender_id, recipient_id, subject, content, message_type, status, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: member_milestones; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.member_milestones (id, member_id, milestone_type, title, description, achievement_date, recognition_sent, recognition_sent_at, created_at) FROM stdin;
\.


--
-- Data for Name: member_orientations; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.member_orientations (id, member_id, orientation_type, scheduled_date, scheduled_time, special_requests, status, completed_at, staff_notes, created_by, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: member_referrals; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.member_referrals (id, program_id, referrer_id, referee_email, referee_name, referral_code, status, signup_date, conversion_date, reward_given_date, notes, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: member_segments; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.member_segments (id, organization_id, name, description, criteria, member_count, last_calculated_at, is_dynamic, created_by, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: member_training_packages; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.member_training_packages (id, member_id, package_id, sessions_remaining, purchased_at, expires_at, is_active, created_at) FROM stdin;
\.


--
-- Data for Name: membership_agreement_templates; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.membership_agreement_templates (id, organization_id, name, content, is_default, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: membership_agreements; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.membership_agreements (id, member_id, template_id, agreement_content, signed_at, signature_data, witness_id, created_at) FROM stdin;
\.


--
-- Data for Name: membership_plans; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.membership_plans (id, organization_id, name, description, price, billing_interval, access_level, max_classes_per_month, created_at, updated_at, plan_type, requires_commitment, commitment_months, signup_fee, annual_maintenance_fee, is_prepaid, prepaid_months, features) FROM stdin;
fc59083c-4c6b-4049-9bed-136650d1dcb8	550e8400-e29b-41d4-a716-446655440001	Basic Monthly	Basic gym access with limited classes	49.99	monthly	single_location	8	2025-08-26 21:36:12.15123+00	2025-08-26 21:36:12.15123+00	individual	f	\N	0	0	f	\N	{}
b0e36f86-b25b-4e81-b1ba-bd89d543867a	550e8400-e29b-41d4-a716-446655440001	Premium Monthly	Full gym access with unlimited classes	79.99	monthly	single_location	\N	2025-08-26 21:36:12.15123+00	2025-08-26 21:36:12.15123+00	individual	f	\N	0	0	f	\N	{}
f11c008e-6c74-4b00-85aa-48a2547c3bb0	550e8400-e29b-41d4-a716-446655440001	Elite Annual	Premium access across all locations	799.99	yearly	all_locations	\N	2025-08-26 21:36:12.15123+00	2025-08-26 21:36:12.15123+00	individual	f	\N	0	0	f	\N	{}
\.


--
-- Data for Name: memberships; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.memberships (id, member_id, plan_id, status, start_date, end_date, next_billing_date, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: message_history; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.message_history (id, organization_id, recipient_type, recipient_id, message_type, template_id, subject, content, status, sent_at, delivered_at, error_message, metadata, sent_by, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: messages; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.messages (id, sender_id, recipient_id, subject, content, is_read, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: notification_preferences; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.notification_preferences (id, member_id, email_enabled, sms_enabled, push_enabled, class_reminders, waitlist_updates, membership_updates, marketing_notifications, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: notification_templates; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.notification_templates (id, organization_id, name, template_type, subject, content, variables, is_active, created_by, created_at, updated_at) FROM stdin;
2861982c-a99f-4241-aada-8ef3fe682fe6	6f27d544-adf7-4f56-86c4-d1727662f999	Class Reminder	class_reminder	Reminder: {{class_name}} starts soon!	Hi {{member_name}}, your class "{{class_name}}" starts at {{class_time}} today. Don't forget to bring your water bottle and towel!	{"class_name": "Class Name", "class_time": "Class Time", "member_name": "Member Name"}	t	80cb2e43-2acc-4355-b08c-c165cdd5f760	2025-08-27 22:59:58.726464+00	2025-08-27 22:59:58.726464+00
d8d879c9-4919-42d8-b017-dff745fbdb99	6f27d544-adf7-4f56-86c4-d1727662f999	Waitlist Promotion	waitlist_promotion	You're off the waitlist for {{class_name}}!	Great news {{member_name}}! A spot opened up in "{{class_name}}" and you've been automatically enrolled. The class is on {{class_date}} at {{class_time}}.	{"class_date": "Class Date", "class_name": "Class Name", "class_time": "Class Time", "member_name": "Member Name"}	t	80cb2e43-2acc-4355-b08c-c165cdd5f760	2025-08-27 22:59:58.726464+00	2025-08-27 22:59:58.726464+00
\.


--
-- Data for Name: notifications; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.notifications (id, organization_id, member_id, type, title, message, status, priority, scheduled_for, sent_at, read_at, metadata, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: organization_commission_settings; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.organization_commission_settings (id, organization_id, default_commission_type, default_commission_value, default_revenue_basis, default_duration_months, allow_split_commissions, max_split_salespeople, require_manager_approval_for_attribution, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: organizations; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.organizations (id, name, slug, logo_url, primary_color, secondary_color, created_at, updated_at, custom_domain, custom_domain_verified) FROM stdin;
550e8400-e29b-41d4-a716-446655440001	FitCore Gym	fitcore-gym	\N	#2563eb	#f97316	2025-08-26 21:36:12.15123+00	2025-08-26 21:36:12.15123+00	\N	f
6f27d544-adf7-4f56-86c4-d1727662f999	Rep Club Fitness	rep-club-fitness	\N	#2563eb	#f97316	2025-08-26 22:53:16.334778+00	2025-08-26 22:53:16.334778+00	\N	f
d290f1ee-6c54-4b01-90e6-d701748f0851	FitnessPro Gym	fitnesspro	\N	hsl(220, 90%, 60%)	hsl(280, 90%, 65%)	2025-09-01 04:34:58.964046+00	2025-09-01 04:34:58.964046+00	\N	f
\.


--
-- Data for Name: payment_transactions; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.payment_transactions (id, member_id, membership_id, amount, currency, payment_method, payment_status, transaction_reference, stripe_payment_intent_id, processed_by, notes, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: payroll_periods; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.payroll_periods (id, organization_id, start_date, end_date, status, total_amount, notes, created_by, processed_at, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: personal_training_sessions; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.personal_training_sessions (id, organization_id, trainer_id, member_id, session_date, start_time, end_time, duration_minutes, session_type, status, price, notes, cancellation_reason, cancelled_at, cancelled_by, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: pool_facilities; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.pool_facilities (id, organization_id, location_id, pool_name, pool_type, length_meters, width_meters, depth_min, depth_max, lane_count, temperature_target, is_heated, has_diving_board, has_slides, capacity_max, is_available, is_closed_for_maintenance, operating_hours_start, operating_hours_end, created_at, updated_at, description, safety_notes, amenities) FROM stdin;
\.


--
-- Data for Name: pool_lane_reservations; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.pool_lane_reservations (id, organization_id, pool_id, lane_number, member_id, reservation_date, start_time, end_time, duration_minutes, purpose, hourly_rate, total_cost, payment_status, payment_method, special_equipment, special_requests, checked_in_at, cancelled_at, cancellation_reason, created_at, updated_at, status) FROM stdin;
\.


--
-- Data for Name: pool_maintenance_logs; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.pool_maintenance_logs (id, organization_id, pool_id, maintenance_type, performed_by, maintenance_date, start_time, end_time, scheduled_duration_minutes, actual_duration_minutes, equipment_used, chemicals_used, issues_found, actions_performed, followup_required, followup_due_date, cost_estimate, actual_cost, created_at, updated_at, maintenance_status, priority_level, notes) FROM stdin;
\.


--
-- Data for Name: pool_maintenance_schedules; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.pool_maintenance_schedules (id, organization_id, pool_id, maintenance_type, title, description, frequency_days, estimated_duration_minutes, priority, assigned_to, next_due_date, last_completed_date, is_active, requires_pool_closure, equipment_needed, safety_requirements, created_by, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: pos_products; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.pos_products (id, organization_id, name, description, price, cost, barcode, category, stock_quantity, low_stock_threshold, is_active, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: pos_sale_items; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.pos_sale_items (id, sale_id, product_id, quantity, unit_price, total_price, created_at) FROM stdin;
\.


--
-- Data for Name: pos_sales; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.pos_sales (id, organization_id, sale_number, cashier_id, customer_id, subtotal, tax_amount, discount_amount, total_amount, payment_method, payment_status, location_id, created_at) FROM stdin;
\.


--
-- Data for Name: profiles; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.profiles (id, organization_id, location_id, email, first_name, last_name, phone, role, avatar_url, created_at, updated_at, barcode, barcode_generated_at, address_line1, address_line2, city, state, postal_code, country, date_of_birth, gender, emergency_contact_name, emergency_contact_phone, interests, join_date, member_notes, parent_member_id, relationship_type, family_notes, hire_date, hourly_rate, status, certifications, employee_id, department, onboarding_state, dashboard_preferences) FROM stdin;
80cb2e43-2acc-4355-b08c-c165cdd5f760	6f27d544-adf7-4f56-86c4-d1727662f999	9e81478c-ba19-433b-80ed-4aec0a682b6c	pearsonperformance@gmail.com	Test	User	\N	owner	\N	2025-08-26 22:53:16.334778+00	2025-12-02 04:25:42.17577+00	\N	2025-08-27 00:23:44.440497+00	\N	\N	\N	\N	\N	US	\N	\N	\N	\N	{}	\N	\N	\N	\N	\N	\N	\N	active	\N	\N	\N	{"showWizard": false, "currentTour": null, "setupComplete": true, "completedTours": []}	\N
\.


--
-- Data for Name: promotions; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.promotions (id, organization_id, name, description, discount_type, discount_value, valid_from, valid_until, applicable_plans, max_uses, current_uses, is_active, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: quote_line_items; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.quote_line_items (id, quote_id, item_type, item_id, item_name, description, quantity, unit_price, total_price, created_at) FROM stdin;
\.


--
-- Data for Name: referral_programs; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.referral_programs (id, organization_id, name, description, referrer_reward_type, referrer_reward_value, referee_reward_type, referee_reward_value, max_referrals_per_member, program_start_date, program_end_date, is_active, created_by, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: resource_bookings; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.resource_bookings (id, resource_id, resource_type, booked_by, start_time, end_time, status, purpose, notes, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: retail_products; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.retail_products (id, organization_id, sku, name, description, category, brand, supplier, cost_price, sale_price, tax_rate, is_active, requires_age_verification, weight_grams, dimensions, image_url, barcode, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: retail_transaction_items; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.retail_transaction_items (id, transaction_id, product_id, quantity, unit_price, discount_amount, tax_rate, line_total, created_at) FROM stdin;
\.


--
-- Data for Name: retail_transactions; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.retail_transactions (id, organization_id, transaction_number, member_id, cashier_id, location_id, subtotal, tax_amount, discount_amount, total_amount, amount_tendered, change_given, payment_method, payment_reference, transaction_date, void_reason, voided_by, voided_at, created_at, updated_at, status, notes) FROM stdin;
\.


--
-- Data for Name: retention_campaigns; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.retention_campaigns (id, organization_id, name, description, campaign_type, trigger_conditions, message_template, reward_type, reward_value, is_active, start_date, end_date, created_by, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: revenue_analytics; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.revenue_analytics (id, organization_id, period_start, period_end, period_type, total_revenue, membership_revenue, class_revenue, other_revenue, refunds, net_revenue, transaction_count, average_transaction_value, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: safety_inspections; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.safety_inspections (id, organization_id, equipment_id, checklist_id, inspector_id, scheduled_date, completed_at, overall_status, total_items, passed_items, failed_items, critical_failures, next_inspection_date, estimated_duration_minutes, actual_duration_minutes, inspection_notes, recommendations, requires_immediate_attention, equipment_taken_offline, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: safety_violations; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.safety_violations (id, organization_id, inspection_id, equipment_id, violation_type, severity_level, description, photo_documentation, immediate_action_taken, corrective_action_required, assigned_to, target_resolution_date, resolved_at, resolution_notes, follow_up_required, follow_up_date, compliance_impact, created_by, created_at, updated_at, status) FROM stdin;
\.


--
-- Data for Name: sales_quotes; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.sales_quotes (id, lead_id, quote_number, created_by, status, valid_until, subtotal, discount_amount, tax_amount, total_amount, notes, terms_conditions, sent_at, accepted_at, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: salesperson_commissions; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.salesperson_commissions (id, organization_id, salesperson_id, commission_type, commission_value, revenue_basis, duration_months, is_active, created_at, updated_at, created_by) FROM stdin;
\.


--
-- Data for Name: salesperson_referral_links; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.salesperson_referral_links (id, organization_id, salesperson_id, referral_code, link_url, is_active, click_count, conversion_count, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: sms_campaign_recipients; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.sms_campaign_recipients (id, campaign_id, recipient_id, recipient_phone, recipient_name, sent_at, delivered_at, status, error_message, created_at) FROM stdin;
\.


--
-- Data for Name: sms_campaigns; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.sms_campaigns (id, organization_id, campaign_name, message_content, recipient_type, recipient_count, scheduled_at, sent_at, delivery_count, failure_count, status, created_by, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: social_media_automation_logs; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.social_media_automation_logs (id, organization_id, blog_post_id, trigger_type, platforms_processed, posts_created, webhook_sent, webhook_url, webhook_response, webhook_response_status, generated_content, status, error_message, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: social_media_automation_settings; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.social_media_automation_settings (id, organization_id, is_active, auto_post_on_publish, webhook_url, webhook_secret, webhook_enabled, ai_content_generation, platforms_enabled, posting_schedule, content_templates, twitter_character_limit, linkedin_character_limit, facebook_character_limit, instagram_character_limit, created_at, updated_at, created_by) FROM stdin;
\.


--
-- Data for Name: spa_appointments; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.spa_appointments (id, organization_id, service_id, member_id, therapist_id, appointment_date, start_time, end_time, duration_minutes, total_price, deposit_paid, payment_status, status, special_requests, preparation_notes, post_service_notes, cancelled_at, cancellation_reason, cancelled_by, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: spa_inventory; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.spa_inventory (id, organization_id, product_name, product_category, brand, product_code, description, unit_of_measurement, current_stock, minimum_stock, maximum_stock, cost_per_unit, retail_price, supplier_name, supplier_contact, last_restock_date, expiry_date, storage_location, usage_per_service, is_active, requires_certification, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: spa_service_packages; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.spa_service_packages (id, organization_id, package_name, description, service_ids, total_duration_minutes, individual_price, package_price, max_validity_days, is_active, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: spa_services; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.spa_services (id, organization_id, service_name, service_category, description, duration_minutes, base_price, commission_rate, requires_certification, equipment_needed, is_active, max_advance_booking_days, min_advance_booking_hours, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: sports_courts; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.sports_courts (id, organization_id, location_id, court_number, court_type, surface_type, is_indoor, max_players, hourly_rate, lighting_available, equipment_included, maintenance_notes, is_available, is_out_of_order, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: sports_equipment; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.sports_equipment (id, organization_id, location_id, equipment_type, sport, brand, model, size_specification, purchase_date, purchase_price, rental_rate_hourly, rental_rate_daily, deposit_required, current_condition, maintenance_notes, is_available_for_rental, total_rentals, created_at, updated_at, equipment_code, description, notes) FROM stdin;
\.


--
-- Data for Name: staff_certifications; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.staff_certifications (id, organization_id, staff_id, requirement_id, certification_number, issued_date, expiry_date, issuing_authority, verification_status, file_url, renewal_cost, renewal_completed_at, notes, created_by, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: staff_performance_analytics; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.staff_performance_analytics (id, organization_id, staff_id, period_start, period_end, classes_taught, total_class_revenue, average_class_utilization, member_satisfaction_score, leads_converted, tours_conducted, sales_made, total_sales_revenue, commission_earned, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: staff_schedules; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.staff_schedules (id, staff_id, organization_id, day_of_week, start_time, end_time, is_available, break_start, break_end, notes, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: stock_movements; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.stock_movements (id, organization_id, inventory_item_id, transaction_id, movement_type, quantity_change, reference_number, reason, performed_by, movement_date, created_at, notes) FROM stdin;
\.


--
-- Data for Name: subscribers; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.subscribers (id, user_id, email, stripe_customer_id, subscribed, subscription_tier, subscription_end, membership_plan_id, updated_at, created_at) FROM stdin;
3c3cee08-4a41-4957-bd28-874b64e88fef	80cb2e43-2acc-4355-b08c-c165cdd5f760	pearsonperformance@gmail.com	\N	f	\N	\N	\N	2025-08-28 02:29:48.375877+00	2025-08-28 02:29:48.365878+00
\.


--
-- Data for Name: support_tickets; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.support_tickets (id, organization_id, member_id, assigned_to, subject, description, category, priority, status, resolution_notes, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: swim_lesson_enrollments; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.swim_lesson_enrollments (id, lesson_id, member_id, enrolled_at, enrollment_status, payment_status, payment_amount, special_needs, emergency_contact_name, emergency_contact_phone, created_at, updated_at, notes) FROM stdin;
\.


--
-- Data for Name: swim_lessons; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.swim_lessons (id, organization_id, pool_id, instructor_id, lesson_name, lesson_type, skill_level, max_participants, age_group, lesson_date, start_time, end_time, duration_minutes, lesson_fee, recurring_schedule, created_at, updated_at, description, requirements, equipment_provided, status) FROM stdin;
\.


--
-- Data for Name: therapist_availability; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.therapist_availability (id, organization_id, therapist_id, day_of_week, start_time, end_time, break_start, break_end, is_available, specializations, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: time_entries; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.time_entries (id, staff_id, organization_id, clock_in, clock_out, break_start, break_end, hours_worked, hourly_rate, total_pay, notes, status, approved_by, approved_at, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: tournament_matches; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.tournament_matches (id, tournament_id, round_number, match_number, player1_id, player2_id, winner_id, court_id, scheduled_at, started_at, completed_at, score, status, notes, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: tournament_participants; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.tournament_participants (id, tournament_id, member_id, partner_id, registration_date, seed_number, created_at, status) FROM stdin;
\.


--
-- Data for Name: tournaments; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.tournaments (id, organization_id, tournament_name, sport, tournament_type, entry_fee, max_participants, registration_deadline, tournament_start_date, tournament_end_date, prize_pool, winner_id, runner_up_id, created_by, created_at, updated_at, status, description, rules, contact_info) FROM stdin;
\.


--
-- Data for Name: towel_cleaning_logs; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.towel_cleaning_logs (id, organization_id, towel_inventory_id, cleaning_date, quantity_cleaned, cleaning_method, detergent_used, temperature_celsius, cycle_duration_minutes, staff_assigned, quality_check_passed, quality_check_notes, cost, next_cleaning_due, created_at, updated_at, batch_number, cleaning_status) FROM stdin;
\.


--
-- Data for Name: towel_inventory; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.towel_inventory (id, organization_id, towel_type, size, color, total_quantity, available_quantity, rented_quantity, in_cleaning, damaged_quantity, cost_per_towel, rental_price, replacement_cost, min_stock_level, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: towel_rentals; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.towel_rentals (id, organization_id, member_id, towel_inventory_id, rental_date, rental_time, return_date, return_time, rental_fee, late_fee, damage_fee, payment_method, payment_status, towel_condition_out, towel_condition_in, staff_out, staff_in, notes, created_at, updated_at, status) FROM stdin;
\.


--
-- Data for Name: trainer_availability; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.trainer_availability (id, trainer_id, day_of_week, start_time, end_time, is_available, location_id, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: training_packages; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.training_packages (id, organization_id, name, description, session_count, session_duration_minutes, price, expiration_days, is_active, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: vendors; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.vendors (id, organization_id, name, vendor_type, contact_name, email, phone, address, website, license_number, insurance_expiry, rating, preferred_vendor, notes, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: visitor_checkins; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.visitor_checkins (id, organization_id, guest_pass_id, visitor_name, visitor_email, check_in_time, check_out_time, purpose, accompanied_by, liability_waiver_signed, emergency_contact_name, emergency_contact_phone, created_at) FROM stdin;
\.


--
-- Data for Name: water_quality_logs; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.water_quality_logs (id, organization_id, pool_id, tested_by, test_date, test_time, ph_level, chlorine_ppm, alkalinity_ppm, temperature_fahrenheit, clarity_rating, bacteria_count, chemical_balance_ok, action_required, actions_taken, next_test_due, created_at, updated_at, notes, compliance_status) FROM stdin;
\.


--
-- Data for Name: webhook_endpoints; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.webhook_endpoints (id, organization_id, name, url, events, status, secret_key, retry_count, timeout_seconds, last_triggered_at, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: webhook_logs; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.webhook_logs (id, organization_id, webhook_endpoint_id, event_type, status, response_code, response_body, attempt_count, payload, created_at) FROM stdin;
\.


--
-- Data for Name: schema_migrations; Type: TABLE DATA; Schema: realtime; Owner: supabase_admin
--

COPY realtime.schema_migrations (version, inserted_at) FROM stdin;
20211116024918	2025-08-26 21:24:06
20211116045059	2025-08-26 21:24:08
20211116050929	2025-08-26 21:24:11
20211116051442	2025-08-26 21:24:13
20211116212300	2025-08-26 21:24:15
20211116213355	2025-08-26 21:24:18
20211116213934	2025-08-26 21:24:20
20211116214523	2025-08-26 21:24:23
20211122062447	2025-08-26 21:24:25
20211124070109	2025-08-26 21:24:27
20211202204204	2025-08-26 21:24:29
20211202204605	2025-08-26 21:24:31
20211210212804	2025-08-26 21:24:38
20211228014915	2025-08-26 21:24:40
20220107221237	2025-08-26 21:24:42
20220228202821	2025-08-26 21:24:44
20220312004840	2025-08-26 21:24:47
20220603231003	2025-08-26 21:24:50
20220603232444	2025-08-26 21:24:52
20220615214548	2025-08-26 21:24:55
20220712093339	2025-08-26 21:24:57
20220908172859	2025-08-26 21:24:59
20220916233421	2025-08-26 21:25:01
20230119133233	2025-08-26 21:25:03
20230128025114	2025-08-26 21:25:06
20230128025212	2025-08-26 21:25:08
20230227211149	2025-08-26 21:25:10
20230228184745	2025-08-26 21:25:13
20230308225145	2025-08-26 21:25:15
20230328144023	2025-08-26 21:25:17
20231018144023	2025-08-26 21:25:19
20231204144023	2025-08-26 21:25:23
20231204144024	2025-08-26 21:25:25
20231204144025	2025-08-26 21:25:27
20240108234812	2025-08-26 21:25:29
20240109165339	2025-08-26 21:25:31
20240227174441	2025-08-26 21:25:35
20240311171622	2025-08-26 21:25:38
20240321100241	2025-08-26 21:25:43
20240401105812	2025-08-26 21:25:49
20240418121054	2025-08-26 21:25:52
20240523004032	2025-08-26 21:26:00
20240618124746	2025-08-26 21:26:02
20240801235015	2025-08-26 21:26:04
20240805133720	2025-08-26 21:26:06
20240827160934	2025-08-26 21:26:08
20240919163303	2025-08-26 21:26:11
20240919163305	2025-08-26 21:26:13
20241019105805	2025-08-26 21:26:15
20241030150047	2025-08-26 21:26:23
20241108114728	2025-08-26 21:26:26
20241121104152	2025-08-26 21:26:29
20241130184212	2025-08-26 21:26:31
20241220035512	2025-08-26 21:26:33
20241220123912	2025-08-26 21:26:35
20241224161212	2025-08-26 21:26:38
20250107150512	2025-08-26 21:26:40
20250110162412	2025-08-26 21:26:42
20250123174212	2025-08-26 21:26:44
20250128220012	2025-08-26 21:26:46
20250506224012	2025-08-26 21:26:48
20250523164012	2025-08-26 21:26:50
20250714121412	2025-08-26 21:26:52
20250905041441	2025-09-25 20:52:16
20251103001201	2025-11-14 04:06:15
\.


--
-- Data for Name: subscription; Type: TABLE DATA; Schema: realtime; Owner: supabase_admin
--

COPY realtime.subscription (id, subscription_id, entity, filters, claims, created_at) FROM stdin;
\.


--
-- Data for Name: buckets; Type: TABLE DATA; Schema: storage; Owner: supabase_storage_admin
--

COPY storage.buckets (id, name, owner, created_at, updated_at, public, avif_autodetection, file_size_limit, allowed_mime_types, owner_id, type) FROM stdin;
\.


--
-- Data for Name: buckets_analytics; Type: TABLE DATA; Schema: storage; Owner: supabase_storage_admin
--

COPY storage.buckets_analytics (name, type, format, created_at, updated_at, id, deleted_at) FROM stdin;
\.


--
-- Data for Name: buckets_vectors; Type: TABLE DATA; Schema: storage; Owner: supabase_storage_admin
--

COPY storage.buckets_vectors (id, type, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: migrations; Type: TABLE DATA; Schema: storage; Owner: supabase_storage_admin
--

COPY storage.migrations (id, name, hash, executed_at) FROM stdin;
0	create-migrations-table	e18db593bcde2aca2a408c4d1100f6abba2195df	2025-08-26 21:24:02.337712
1	initialmigration	6ab16121fbaa08bbd11b712d05f358f9b555d777	2025-08-26 21:24:02.382953
2	storage-schema	5c7968fd083fcea04050c1b7f6253c9771b99011	2025-08-26 21:24:02.398883
3	pathtoken-column	2cb1b0004b817b29d5b0a971af16bafeede4b70d	2025-08-26 21:24:02.420946
4	add-migrations-rls	427c5b63fe1c5937495d9c635c263ee7a5905058	2025-08-26 21:24:02.442272
5	add-size-functions	79e081a1455b63666c1294a440f8ad4b1e6a7f84	2025-08-26 21:24:02.458384
6	change-column-name-in-get-size	f93f62afdf6613ee5e7e815b30d02dc990201044	2025-08-26 21:24:02.474675
7	add-rls-to-buckets	e7e7f86adbc51049f341dfe8d30256c1abca17aa	2025-08-26 21:24:02.518462
8	add-public-to-buckets	fd670db39ed65f9d08b01db09d6202503ca2bab3	2025-08-26 21:24:02.544189
9	fix-search-function	3a0af29f42e35a4d101c259ed955b67e1bee6825	2025-08-26 21:24:02.564271
10	search-files-search-function	68dc14822daad0ffac3746a502234f486182ef6e	2025-08-26 21:24:02.57714
11	add-trigger-to-auto-update-updated_at-column	7425bdb14366d1739fa8a18c83100636d74dcaa2	2025-08-26 21:24:02.592392
12	add-automatic-avif-detection-flag	8e92e1266eb29518b6a4c5313ab8f29dd0d08df9	2025-08-26 21:24:02.602389
13	add-bucket-custom-limits	cce962054138135cd9a8c4bcd531598684b25e7d	2025-08-26 21:24:02.609277
14	use-bytes-for-max-size	941c41b346f9802b411f06f30e972ad4744dad27	2025-08-26 21:24:02.617261
15	add-can-insert-object-function	934146bc38ead475f4ef4b555c524ee5d66799e5	2025-08-26 21:24:02.63882
16	add-version	76debf38d3fd07dcfc747ca49096457d95b1221b	2025-08-26 21:24:02.646281
17	drop-owner-foreign-key	f1cbb288f1b7a4c1eb8c38504b80ae2a0153d101	2025-08-26 21:24:02.655984
18	add_owner_id_column_deprecate_owner	e7a511b379110b08e2f214be852c35414749fe66	2025-08-26 21:24:02.669446
19	alter-default-value-objects-id	02e5e22a78626187e00d173dc45f58fa66a4f043	2025-08-26 21:24:02.678936
20	list-objects-with-delimiter	cd694ae708e51ba82bf012bba00caf4f3b6393b7	2025-08-26 21:24:02.686164
21	s3-multipart-uploads	8c804d4a566c40cd1e4cc5b3725a664a9303657f	2025-08-26 21:24:02.695423
22	s3-multipart-uploads-big-ints	9737dc258d2397953c9953d9b86920b8be0cdb73	2025-08-26 21:24:02.70952
23	optimize-search-function	9d7e604cddc4b56a5422dc68c9313f4a1b6f132c	2025-08-26 21:24:02.721487
24	operation-function	8312e37c2bf9e76bbe841aa5fda889206d2bf8aa	2025-08-26 21:24:02.729999
25	custom-metadata	d974c6057c3db1c1f847afa0e291e6165693b990	2025-08-26 21:24:02.741998
26	objects-prefixes	ef3f7871121cdc47a65308e6702519e853422ae2	2025-11-11 04:58:19.65728
27	search-v2	33b8f2a7ae53105f028e13e9fcda9dc4f356b4a2	2025-11-11 04:58:19.740543
28	object-bucket-name-sorting	ba85ec41b62c6a30a3f136788227ee47f311c436	2025-11-11 04:58:19.751552
29	create-prefixes	a7b1a22c0dc3ab630e3055bfec7ce7d2045c5b7b	2025-11-11 04:58:19.761396
30	update-object-levels	6c6f6cc9430d570f26284a24cf7b210599032db7	2025-11-11 04:58:19.765921
31	objects-level-index	33f1fef7ec7fea08bb892222f4f0f5d79bab5eb8	2025-11-11 04:58:19.772715
32	backward-compatible-index-on-objects	2d51eeb437a96868b36fcdfb1ddefdf13bef1647	2025-11-11 04:58:19.779837
33	backward-compatible-index-on-prefixes	fe473390e1b8c407434c0e470655945b110507bf	2025-11-11 04:58:19.787543
34	optimize-search-function-v1	82b0e469a00e8ebce495e29bfa70a0797f7ebd2c	2025-11-11 04:58:19.789455
35	add-insert-trigger-prefixes	63bb9fd05deb3dc5e9fa66c83e82b152f0caf589	2025-11-11 04:58:19.795703
36	optimise-existing-functions	81cf92eb0c36612865a18016a38496c530443899	2025-11-11 04:58:19.799629
37	add-bucket-name-length-trigger	3944135b4e3e8b22d6d4cbb568fe3b0b51df15c1	2025-11-11 04:58:19.811528
38	iceberg-catalog-flag-on-buckets	19a8bd89d5dfa69af7f222a46c726b7c41e462c5	2025-11-11 04:58:19.815977
39	add-search-v2-sort-support	39cf7d1e6bf515f4b02e41237aba845a7b492853	2025-11-11 04:58:19.834549
40	fix-prefix-race-conditions-optimized	fd02297e1c67df25a9fc110bf8c8a9af7fb06d1f	2025-11-11 04:58:19.839477
41	add-object-level-update-trigger	44c22478bf01744b2129efc480cd2edc9a7d60e9	2025-11-11 04:58:19.849031
42	rollback-prefix-triggers	f2ab4f526ab7f979541082992593938c05ee4b47	2025-11-11 04:58:19.855326
43	fix-object-level	ab837ad8f1c7d00cc0b7310e989a23388ff29fc6	2025-11-11 04:58:19.861068
44	vector-bucket-type	99c20c0ffd52bb1ff1f32fb992f3b351e3ef8fb3	2025-11-18 16:13:59.022025
45	vector-buckets	049e27196d77a7cb76497a85afae669d8b230953	2025-11-18 16:13:59.03596
46	buckets-objects-grants	fedeb96d60fefd8e02ab3ded9fbde05632f84aed	2025-11-18 16:13:59.05512
47	iceberg-table-metadata	649df56855c24d8b36dd4cc1aeb8251aa9ad42c2	2025-11-18 16:13:59.062397
48	iceberg-catalog-ids	2666dff93346e5d04e0a878416be1d5fec345d6f	2025-11-18 16:13:59.06814
\.


--
-- Data for Name: objects; Type: TABLE DATA; Schema: storage; Owner: supabase_storage_admin
--

COPY storage.objects (id, bucket_id, name, owner, created_at, updated_at, last_accessed_at, metadata, version, owner_id, user_metadata, level) FROM stdin;
\.


--
-- Data for Name: prefixes; Type: TABLE DATA; Schema: storage; Owner: supabase_storage_admin
--

COPY storage.prefixes (bucket_id, name, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: s3_multipart_uploads; Type: TABLE DATA; Schema: storage; Owner: supabase_storage_admin
--

COPY storage.s3_multipart_uploads (id, in_progress_size, upload_signature, bucket_id, key, version, owner_id, created_at, user_metadata) FROM stdin;
\.


--
-- Data for Name: s3_multipart_uploads_parts; Type: TABLE DATA; Schema: storage; Owner: supabase_storage_admin
--

COPY storage.s3_multipart_uploads_parts (id, upload_id, size, part_number, bucket_id, key, etag, owner_id, version, created_at) FROM stdin;
\.


--
-- Data for Name: vector_indexes; Type: TABLE DATA; Schema: storage; Owner: supabase_storage_admin
--

COPY storage.vector_indexes (id, name, bucket_id, data_type, dimension, distance_metric, metadata_configuration, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: schema_migrations; Type: TABLE DATA; Schema: supabase_migrations; Owner: postgres
--

COPY supabase_migrations.schema_migrations (version, statements, name, created_by, idempotency_key, rollback) FROM stdin;
20250826093140	{"-- Enable UUID extension\nCREATE EXTENSION IF NOT EXISTS \\"uuid-ossp\\";\n\n-- Create enum for user roles\nCREATE TYPE public.user_role AS ENUM ('owner', 'manager', 'staff', 'trainer', 'member');\n\n-- Create enum for membership status\nCREATE TYPE public.membership_status AS ENUM ('active', 'inactive', 'frozen', 'cancelled', 'past_due');\n\n-- Create gym organizations (tenants)\nCREATE TABLE public.organizations (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  name TEXT NOT NULL,\n  slug TEXT UNIQUE NOT NULL,\n  logo_url TEXT,\n  primary_color TEXT DEFAULT '#2563eb',\n  secondary_color TEXT DEFAULT '#f97316',\n  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT now()\n);\n\n-- Create locations within organizations\nCREATE TABLE public.locations (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  organization_id UUID NOT NULL REFERENCES public.organizations(id) ON DELETE CASCADE,\n  name TEXT NOT NULL,\n  address TEXT,\n  phone TEXT,\n  email TEXT,\n  timezone TEXT DEFAULT 'America/New_York',\n  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT now()\n);\n\n-- Create user profiles with organization and role\nCREATE TABLE public.profiles (\n  id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,\n  organization_id UUID NOT NULL REFERENCES public.organizations(id) ON DELETE CASCADE,\n  location_id UUID REFERENCES public.locations(id) ON DELETE SET NULL,\n  email TEXT NOT NULL,\n  first_name TEXT,\n  last_name TEXT,\n  phone TEXT,\n  role user_role NOT NULL DEFAULT 'member',\n  avatar_url TEXT,\n  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  UNIQUE(email, organization_id)\n);\n\n-- Create membership plans\nCREATE TABLE public.membership_plans (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  organization_id UUID NOT NULL REFERENCES public.organizations(id) ON DELETE CASCADE,\n  name TEXT NOT NULL,\n  description TEXT,\n  price DECIMAL(10,2) NOT NULL,\n  billing_interval TEXT NOT NULL CHECK (billing_interval IN ('monthly', 'weekly', 'yearly')),\n  access_level TEXT DEFAULT 'single_location',\n  max_classes_per_month INTEGER,\n  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT now()\n);\n\n-- Create member memberships\nCREATE TABLE public.memberships (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  member_id UUID NOT NULL REFERENCES public.profiles(id) ON DELETE CASCADE,\n  plan_id UUID NOT NULL REFERENCES public.membership_plans(id) ON DELETE CASCADE,\n  status membership_status NOT NULL DEFAULT 'active',\n  start_date TIMESTAMPTZ NOT NULL DEFAULT now(),\n  end_date TIMESTAMPTZ,\n  next_billing_date TIMESTAMPTZ,\n  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT now()\n);\n\n-- Create class categories\nCREATE TABLE public.class_categories (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  organization_id UUID NOT NULL REFERENCES public.organizations(id) ON DELETE CASCADE,\n  name TEXT NOT NULL,\n  description TEXT,\n  color TEXT DEFAULT '#6b7280',\n  created_at TIMESTAMPTZ NOT NULL DEFAULT now()\n);\n\n-- Create classes\nCREATE TABLE public.classes (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  organization_id UUID NOT NULL REFERENCES public.organizations(id) ON DELETE CASCADE,\n  location_id UUID NOT NULL REFERENCES public.locations(id) ON DELETE CASCADE,\n  category_id UUID REFERENCES public.class_categories(id) ON DELETE SET NULL,\n  instructor_id UUID REFERENCES public.profiles(id) ON DELETE SET NULL,\n  name TEXT NOT NULL,\n  description TEXT,\n  duration_minutes INTEGER NOT NULL DEFAULT 60,\n  max_capacity INTEGER NOT NULL DEFAULT 20,\n  scheduled_at TIMESTAMPTZ NOT NULL,\n  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT now()\n);\n\n-- Create class bookings\nCREATE TABLE public.class_bookings (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  class_id UUID NOT NULL REFERENCES public.classes(id) ON DELETE CASCADE,\n  member_id UUID NOT NULL REFERENCES public.profiles(id) ON DELETE CASCADE,\n  status TEXT NOT NULL DEFAULT 'booked' CHECK (status IN ('booked', 'attended', 'no_show', 'cancelled')),\n  booked_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  attended_at TIMESTAMPTZ,\n  UNIQUE(class_id, member_id)\n);\n\n-- Create check-ins\nCREATE TABLE public.check_ins (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  member_id UUID NOT NULL REFERENCES public.profiles(id) ON DELETE CASCADE,\n  location_id UUID NOT NULL REFERENCES public.locations(id) ON DELETE CASCADE,\n  checked_in_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  checked_out_at TIMESTAMPTZ\n);\n\n-- Enable RLS on all tables\nALTER TABLE public.organizations ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.locations ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.profiles ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.membership_plans ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.memberships ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.class_categories ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.classes ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.class_bookings ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.check_ins ENABLE ROW LEVEL SECURITY;\n\n-- RLS Policies for multi-tenant access\n-- Organizations: only accessible by members of that org\nCREATE POLICY \\"Users can view their organization\\" ON public.organizations\nFOR SELECT USING (\n  id IN (SELECT organization_id FROM public.profiles WHERE id = auth.uid())\n);\n\n-- Locations: only accessible by members of that org\nCREATE POLICY \\"Users can view locations in their organization\\" ON public.locations\nFOR SELECT USING (\n  organization_id IN (SELECT organization_id FROM public.profiles WHERE id = auth.uid())\n);\n\n-- Profiles: users can view profiles in their org, edit their own\nCREATE POLICY \\"Users can view profiles in their organization\\" ON public.profiles\nFOR SELECT USING (\n  organization_id IN (SELECT organization_id FROM public.profiles WHERE id = auth.uid())\n);\n\nCREATE POLICY \\"Users can update their own profile\\" ON public.profiles\nFOR UPDATE USING (id = auth.uid());\n\n-- Staff can insert new profiles (for member registration)\nCREATE POLICY \\"Staff can insert profiles\\" ON public.profiles\nFOR INSERT WITH CHECK (\n  organization_id IN (\n    SELECT organization_id FROM public.profiles \n    WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n  )\n);\n\n-- Membership plans: viewable by org members, manageable by staff\nCREATE POLICY \\"Users can view membership plans in their organization\\" ON public.membership_plans\nFOR SELECT USING (\n  organization_id IN (SELECT organization_id FROM public.profiles WHERE id = auth.uid())\n);\n\nCREATE POLICY \\"Staff can manage membership plans\\" ON public.membership_plans\nFOR ALL USING (\n  organization_id IN (\n    SELECT organization_id FROM public.profiles \n    WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n  )\n);\n\n-- Memberships: members can view their own, staff can manage all in org\nCREATE POLICY \\"Members can view their own memberships\\" ON public.memberships\nFOR SELECT USING (\n  member_id = auth.uid() OR \n  (SELECT organization_id FROM public.profiles WHERE id = member_id) IN (\n    SELECT organization_id FROM public.profiles \n    WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n  )\n);\n\nCREATE POLICY \\"Staff can manage memberships\\" ON public.memberships\nFOR ALL USING (\n  (SELECT organization_id FROM public.profiles WHERE id = member_id) IN (\n    SELECT organization_id FROM public.profiles \n    WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n  )\n);\n\n-- Class categories: viewable by org members, manageable by staff\nCREATE POLICY \\"Users can view class categories in their organization\\" ON public.class_categories\nFOR SELECT USING (\n  organization_id IN (SELECT organization_id FROM public.profiles WHERE id = auth.uid())\n);\n\nCREATE POLICY \\"Staff can manage class categories\\" ON public.class_categories\nFOR ALL USING (\n  organization_id IN (\n    SELECT organization_id FROM public.profiles \n    WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n  )\n);\n\n-- Classes: viewable by org members, manageable by staff and assigned instructors\nCREATE POLICY \\"Users can view classes in their organization\\" ON public.classes\nFOR SELECT USING (\n  organization_id IN (SELECT organization_id FROM public.profiles WHERE id = auth.uid())\n);\n\nCREATE POLICY \\"Staff and instructors can manage classes\\" ON public.classes\nFOR ALL USING (\n  instructor_id = auth.uid() OR\n  organization_id IN (\n    SELECT organization_id FROM public.profiles \n    WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n  )\n);\n\n-- Class bookings: members can manage their own, staff can see all in org\nCREATE POLICY \\"Members can manage their own bookings\\" ON public.class_bookings\nFOR ALL USING (\n  member_id = auth.uid() OR\n  (SELECT organization_id FROM public.profiles WHERE id = member_id) IN (\n    SELECT organization_id FROM public.profiles \n    WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff', 'trainer')\n  )\n);\n\n-- Check-ins: members can view their own, staff can see all in org\nCREATE POLICY \\"Members can view their own check-ins\\" ON public.check_ins\nFOR SELECT USING (\n  member_id = auth.uid() OR\n  location_id IN (\n    SELECT id FROM public.locations \n    WHERE organization_id IN (\n      SELECT organization_id FROM public.profiles \n      WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n    )\n  )\n);\n\nCREATE POLICY \\"Staff can manage check-ins\\" ON public.check_ins\nFOR ALL USING (\n  location_id IN (\n    SELECT id FROM public.locations \n    WHERE organization_id IN (\n      SELECT organization_id FROM public.profiles \n      WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n    )\n  )\n);\n\n-- Function to handle new user registration\nCREATE OR REPLACE FUNCTION public.handle_new_user()\nRETURNS TRIGGER\nLANGUAGE plpgsql\nSECURITY DEFINER\nAS $$\nBEGIN\n  -- This will be called after user signs up via auth\n  -- The organization_id will need to be set via a separate process\n  RETURN NEW;\nEND;\n$$;\n\n-- Trigger for new user registration\nCREATE OR REPLACE TRIGGER on_auth_user_created\n  AFTER INSERT ON auth.users\n  FOR EACH ROW EXECUTE FUNCTION public.handle_new_user();\n\n-- Function to update updated_at timestamp\nCREATE OR REPLACE FUNCTION public.update_updated_at_column()\nRETURNS TRIGGER AS $$\nBEGIN\n  NEW.updated_at = now();\n  RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql;\n\n-- Add updated_at triggers to all tables\nCREATE TRIGGER update_organizations_updated_at BEFORE UPDATE ON public.organizations FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();\nCREATE TRIGGER update_locations_updated_at BEFORE UPDATE ON public.locations FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();\nCREATE TRIGGER update_profiles_updated_at BEFORE UPDATE ON public.profiles FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();\nCREATE TRIGGER update_membership_plans_updated_at BEFORE UPDATE ON public.membership_plans FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();\nCREATE TRIGGER update_memberships_updated_at BEFORE UPDATE ON public.memberships FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();\nCREATE TRIGGER update_classes_updated_at BEFORE UPDATE ON public.classes FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();"}		pearson.performance@gmail.com	\N	\N
20250826093220	{"-- Fix function security issues by setting search_path\n\n-- Update handle_new_user function with secure search_path\nCREATE OR REPLACE FUNCTION public.handle_new_user()\nRETURNS TRIGGER\nLANGUAGE plpgsql\nSECURITY DEFINER\nSET search_path = public\nAS $$\nBEGIN\n  -- This will be called after user signs up via auth\n  -- The organization_id will need to be set via a separate process\n  RETURN NEW;\nEND;\n$$;\n\n-- Update update_updated_at_column function with secure search_path\nCREATE OR REPLACE FUNCTION public.update_updated_at_column()\nRETURNS TRIGGER\nLANGUAGE plpgsql\nSECURITY DEFINER\nSET search_path = public\nAS $$\nBEGIN\n  NEW.updated_at = now();\n  RETURN NEW;\nEND;\n$$;"}		pearson.performance@gmail.com	\N	\N
20250826093612	{"-- Insert sample data for demo purposes\n\n-- Create a sample organization\nINSERT INTO public.organizations (id, name, slug, primary_color, secondary_color)\nVALUES \n  ('550e8400-e29b-41d4-a716-446655440001', 'FitCore Gym', 'fitcore-gym', '#2563eb', '#f97316');\n\n-- Create a sample location\nINSERT INTO public.locations (id, organization_id, name, address, phone, email)\nVALUES \n  ('550e8400-e29b-41d4-a716-446655440002', '550e8400-e29b-41d4-a716-446655440001', 'FitCore Main Branch', '123 Fitness St, Gym City, GC 12345', '(555) 123-4567', 'info@fitcoregym.com');\n\n-- Create sample membership plans\nINSERT INTO public.membership_plans (organization_id, name, description, price, billing_interval, access_level, max_classes_per_month)\nVALUES \n  ('550e8400-e29b-41d4-a716-446655440001', 'Basic Monthly', 'Basic gym access with limited classes', 49.99, 'monthly', 'single_location', 8),\n  ('550e8400-e29b-41d4-a716-446655440001', 'Premium Monthly', 'Full gym access with unlimited classes', 79.99, 'monthly', 'single_location', NULL),\n  ('550e8400-e29b-41d4-a716-446655440001', 'Elite Annual', 'Premium access across all locations', 799.99, 'yearly', 'all_locations', NULL);\n\n-- Create sample class categories\nINSERT INTO public.class_categories (organization_id, name, description, color)\nVALUES \n  ('550e8400-e29b-41d4-a716-446655440001', 'Yoga', 'Mindful movement and flexibility', '#10b981'),\n  ('550e8400-e29b-41d4-a716-446655440001', 'HIIT', 'High intensity interval training', '#ef4444'),\n  ('550e8400-e29b-41d4-a716-446655440001', 'Strength Training', 'Weight lifting and muscle building', '#3b82f6'),\n  ('550e8400-e29b-41d4-a716-446655440001', 'Cardio', 'Heart-pumping aerobic exercises', '#f59e0b');"}		pearson.performance@gmail.com	\N	\N
20250826094203	{"-- Create sample classes without instructor assignments for now\nINSERT INTO public.classes (organization_id, location_id, category_id, name, description, duration_minutes, max_capacity, scheduled_at)\nSELECT \n  '550e8400-e29b-41d4-a716-446655440001',\n  '550e8400-e29b-41d4-a716-446655440002',\n  categories.id,\n  class_data.name,\n  class_data.description,\n  class_data.duration,\n  class_data.capacity,\n  class_data.scheduled_at\nFROM (\n  SELECT id FROM public.class_categories WHERE organization_id = '550e8400-e29b-41d4-a716-446655440001' ORDER BY name LIMIT 1\n) AS categories\nCROSS JOIN (VALUES\n  ('Morning Yoga Flow', 'Start your day with energizing yoga poses and mindful breathing', 60, 15, (NOW() + INTERVAL '1 day' + INTERVAL '7 hours')::timestamp),\n  ('HIIT Blast', 'High-intensity interval training for maximum calorie burn', 45, 12, (NOW() + INTERVAL '1 day' + INTERVAL '18 hours')::timestamp),\n  ('Strength & Conditioning', 'Build muscle and improve functional fitness', 75, 10, (NOW() + INTERVAL '2 days' + INTERVAL '9 hours')::timestamp),\n  ('Cardio Kickboxing', 'Fun cardio workout with martial arts moves', 50, 20, (NOW() + INTERVAL '2 days' + INTERVAL '19 hours')::timestamp),\n  ('Evening Yoga Restore', 'Gentle yoga to unwind and relax after a long day', 60, 15, (NOW() + INTERVAL '3 days' + INTERVAL '19 hours')::timestamp),\n  ('Morning HIIT', 'Quick morning workout to energize your day', 30, 15, (NOW() + INTERVAL '4 days' + INTERVAL '6 hours')::timestamp),\n  ('Powerlifting Basics', 'Introduction to powerlifting fundamentals', 90, 8, (NOW() + INTERVAL '5 days' + INTERVAL '10 hours')::timestamp),\n  ('Spin Class', 'High-energy cycling workout with motivating music', 45, 25, (NOW() + INTERVAL '6 days' + INTERVAL '8 hours')::timestamp)\n) AS class_data(name, description, duration, capacity, scheduled_at);"}		pearson.performance@gmail.com	\N	\N
20250826100217	{"-- Create lead stages for sales pipeline\nCREATE TABLE public.lead_stages (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  name TEXT NOT NULL,\n  description TEXT,\n  order_index INTEGER NOT NULL,\n  color TEXT DEFAULT '#6b7280',\n  is_closed BOOLEAN DEFAULT FALSE,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Enable RLS\nALTER TABLE public.lead_stages ENABLE ROW LEVEL SECURITY;\n\n-- Create leads table that can convert to members\nCREATE TABLE public.leads (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  email TEXT NOT NULL,\n  first_name TEXT,\n  last_name TEXT,\n  phone TEXT,\n  status TEXT DEFAULT 'lead', -- 'lead' or 'member'\n  stage_id UUID REFERENCES public.lead_stages(id),\n  assigned_to UUID, -- staff member assigned\n  source TEXT, -- how they found us\n  interest_level TEXT DEFAULT 'cold', -- cold, warm, hot\n  estimated_value DECIMAL,\n  last_contact_date TIMESTAMP WITH TIME ZONE,\n  next_follow_up_date TIMESTAMP WITH TIME ZONE,\n  notes TEXT,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  UNIQUE(organization_id, email)\n);\n\n-- Enable RLS\nALTER TABLE public.leads ENABLE ROW LEVEL SECURITY;\n\n-- Create lead activities for tracking all interactions\nCREATE TABLE public.lead_activities (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  lead_id UUID NOT NULL REFERENCES public.leads(id) ON DELETE CASCADE,\n  activity_type TEXT NOT NULL, -- 'call', 'email', 'appointment', 'note', 'follow_up'\n  title TEXT NOT NULL,\n  description TEXT,\n  scheduled_at TIMESTAMP WITH TIME ZONE, -- for appointments/follow-ups\n  completed_at TIMESTAMP WITH TIME ZONE,\n  created_by UUID NOT NULL, -- staff member who created\n  outcome TEXT, -- result of call/meeting\n  next_action TEXT, -- what to do next\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Enable RLS\nALTER TABLE public.lead_activities ENABLE ROW LEVEL SECURITY;\n\n-- Create default lead stages\nINSERT INTO public.lead_stages (organization_id, name, description, order_index, color, is_closed) VALUES\n-- Using a placeholder organization_id - this will need to be updated per organization\n('00000000-0000-0000-0000-000000000000', 'New Lead', 'Initial contact made', 1, '#3b82f6', FALSE),\n('00000000-0000-0000-0000-000000000000', 'Qualified', 'Lead shows genuine interest', 2, '#8b5cf6', FALSE),\n('00000000-0000-0000-0000-000000000000', 'Tour Scheduled', 'Facility tour booked', 3, '#f59e0b', FALSE),\n('00000000-0000-0000-0000-000000000000', 'Tour Completed', 'Completed facility tour', 4, '#10b981', FALSE),\n('00000000-0000-0000-0000-000000000000', 'Proposal Sent', 'Membership proposal provided', 5, '#f97316', FALSE),\n('00000000-0000-0000-0000-000000000000', 'Negotiating', 'Discussing terms and pricing', 6, '#ef4444', FALSE),\n('00000000-0000-0000-0000-000000000000', 'Closed Won', 'Converted to member', 7, '#22c55e', TRUE),\n('00000000-0000-0000-0000-000000000000', 'Closed Lost', 'Lead did not convert', 8, '#6b7280', TRUE);\n\n-- Create RLS policies for lead_stages\nCREATE POLICY \\"Users can view lead stages in their organization\\" \nON public.lead_stages \nFOR SELECT \nUSING (organization_id IN (\n  SELECT profiles.organization_id\n  FROM profiles\n  WHERE profiles.id = auth.uid()\n));\n\nCREATE POLICY \\"Staff can manage lead stages\\" \nON public.lead_stages \nFOR ALL \nUSING (organization_id IN (\n  SELECT profiles.organization_id\n  FROM profiles\n  WHERE profiles.id = auth.uid() \n  AND profiles.role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n));\n\n-- Create RLS policies for leads\nCREATE POLICY \\"Staff can view leads in their organization\\" \nON public.leads \nFOR SELECT \nUSING (organization_id IN (\n  SELECT profiles.organization_id\n  FROM profiles\n  WHERE profiles.id = auth.uid() \n  AND profiles.role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n));\n\nCREATE POLICY \\"Staff can manage leads\\" \nON public.leads \nFOR ALL \nUSING (organization_id IN (\n  SELECT profiles.organization_id\n  FROM profiles\n  WHERE profiles.id = auth.uid() \n  AND profiles.role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n));\n\n-- Create RLS policies for lead_activities\nCREATE POLICY \\"Staff can view lead activities\\" \nON public.lead_activities \nFOR SELECT \nUSING (lead_id IN (\n  SELECT leads.id\n  FROM leads\n  WHERE leads.organization_id IN (\n    SELECT profiles.organization_id\n    FROM profiles\n    WHERE profiles.id = auth.uid() \n    AND profiles.role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n  )\n));\n\nCREATE POLICY \\"Staff can manage lead activities\\" \nON public.lead_activities \nFOR ALL \nUSING (lead_id IN (\n  SELECT leads.id\n  FROM leads\n  WHERE leads.organization_id IN (\n    SELECT profiles.organization_id\n    FROM profiles\n    WHERE profiles.id = auth.uid() \n    AND profiles.role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n  )\n));\n\n-- Create triggers for updated_at\nCREATE TRIGGER update_lead_stages_updated_at\nBEFORE UPDATE ON public.lead_stages\nFOR EACH ROW\nEXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_leads_updated_at\nBEFORE UPDATE ON public.leads\nFOR EACH ROW\nEXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_lead_activities_updated_at\nBEFORE UPDATE ON public.lead_activities\nFOR EACH ROW\nEXECUTE FUNCTION public.update_updated_at_column();"}		pearson.performance@gmail.com	\N	\N
20250826104649	{"-- Fix infinite recursion in profiles RLS policy\nDROP POLICY IF EXISTS \\"Users can view profiles in their organization\\" ON public.profiles;\n\n-- Create a proper policy without recursion\nCREATE POLICY \\"Users can view profiles in their organization\\" \nON public.profiles \nFOR SELECT \nUSING (\n  auth.uid() = id \n  OR organization_id IN (\n    SELECT organization_id \n    FROM public.profiles \n    WHERE id = auth.uid()\n  )\n);"}		pearson.performance@gmail.com	\N	\N
20250826104725	{"-- Create a security definer function to get user's organization_id to avoid recursion\nCREATE OR REPLACE FUNCTION public.get_user_organization_id(user_id uuid)\nRETURNS uuid AS $$\n  SELECT organization_id FROM public.profiles WHERE id = user_id;\n$$ LANGUAGE SQL SECURITY DEFINER STABLE;\n\n-- Drop the problematic policy and recreate it properly\nDROP POLICY IF EXISTS \\"Users can view profiles in their organization\\" ON public.profiles;\n\n-- Create a proper policy using the security definer function\nCREATE POLICY \\"Users can view profiles in their organization\\" \nON public.profiles \nFOR SELECT \nUSING (\n  auth.uid() = id \n  OR organization_id = public.get_user_organization_id(auth.uid())\n);"}		pearson.performance@gmail.com	\N	\N
20250826104745	{"-- Fix the security definer function to include proper search path\nCREATE OR REPLACE FUNCTION public.get_user_organization_id(user_id uuid)\nRETURNS uuid AS $$\n  SELECT organization_id FROM public.profiles WHERE id = user_id;\n$$ LANGUAGE SQL SECURITY DEFINER STABLE SET search_path = public;"}		pearson.performance@gmail.com	\N	\N
20250826105316	{"-- Create a default organization for testing with proper UUID\nINSERT INTO public.organizations (id, name, slug, primary_color, secondary_color)\nVALUES (\n  gen_random_uuid(),\n  'Rep Club Fitness',\n  'rep-club-fitness',\n  '#2563eb',\n  '#f97316'\n) ON CONFLICT DO NOTHING\nRETURNING id;\n\n-- Get or create organization and location, then create profile\nDO $$\nDECLARE\n    org_id UUID;\n    loc_id UUID;\nBEGIN\n    -- Get existing organization or create new one\n    SELECT id INTO org_id FROM public.organizations WHERE slug = 'rep-club-fitness' LIMIT 1;\n    \n    IF org_id IS NULL THEN\n        INSERT INTO public.organizations (name, slug, primary_color, secondary_color)\n        VALUES ('Rep Club Fitness', 'rep-club-fitness', '#2563eb', '#f97316')\n        RETURNING id INTO org_id;\n    END IF;\n    \n    -- Get existing location or create new one\n    SELECT id INTO loc_id FROM public.locations WHERE organization_id = org_id LIMIT 1;\n    \n    IF loc_id IS NULL THEN\n        INSERT INTO public.locations (organization_id, name, address, phone, email, timezone)\n        VALUES (org_id, 'Main Location', '123 Fitness Street, City, State 12345', '+1 (555) 123-4567', 'info@repclubfitness.com', 'America/New_York')\n        RETURNING id INTO loc_id;\n    END IF;\n    \n    -- Create or update the profile for the current user\n    INSERT INTO public.profiles (id, organization_id, location_id, email, first_name, last_name, role)\n    VALUES (\n        '80cb2e43-2acc-4355-b08c-c165cdd5f760',\n        org_id,\n        loc_id,\n        'pearsonperformance@gmail.com',\n        'Test',\n        'User',\n        'owner'\n    ) ON CONFLICT (id) DO UPDATE SET\n        organization_id = EXCLUDED.organization_id,\n        location_id = EXCLUDED.location_id,\n        email = EXCLUDED.email,\n        role = EXCLUDED.role;\n        \nEND $$;"}		pearson.performance@gmail.com	\N	\N
20250827122344	{"-- Add barcode support to profiles table\nALTER TABLE public.profiles \nADD COLUMN barcode TEXT UNIQUE,\nADD COLUMN barcode_generated_at TIMESTAMP WITH TIME ZONE DEFAULT now();\n\n-- Create function to generate unique barcode\nCREATE OR REPLACE FUNCTION public.generate_member_barcode()\nRETURNS TEXT\nLANGUAGE plpgsql\nSECURITY DEFINER\nAS $$\nDECLARE\n    new_barcode TEXT;\n    barcode_exists BOOLEAN;\nBEGIN\n    LOOP\n        -- Generate 12-digit barcode: 2 digits for gym + 10 random digits\n        new_barcode := '01' || LPAD(FLOOR(RANDOM() * 10000000000)::TEXT, 10, '0');\n        \n        -- Check if barcode already exists\n        SELECT EXISTS(SELECT 1 FROM public.profiles WHERE barcode = new_barcode) INTO barcode_exists;\n        \n        IF NOT barcode_exists THEN\n            EXIT;\n        END IF;\n    END LOOP;\n    \n    RETURN new_barcode;\nEND;\n$$;\n\n-- Create function to auto-generate barcode for members\nCREATE OR REPLACE FUNCTION public.handle_member_barcode_generation()\nRETURNS TRIGGER\nLANGUAGE plpgsql\nSECURITY DEFINER\nAS $$\nBEGIN\n    -- Only generate barcode for members without one\n    IF NEW.role = 'member' AND (NEW.barcode IS NULL OR NEW.barcode = '') THEN\n        NEW.barcode := public.generate_member_barcode();\n        NEW.barcode_generated_at := now();\n    END IF;\n    \n    RETURN NEW;\nEND;\n$$;\n\n-- Create trigger to auto-generate barcodes\nCREATE TRIGGER trigger_generate_member_barcode\n    BEFORE INSERT OR UPDATE ON public.profiles\n    FOR EACH ROW\n    EXECUTE FUNCTION public.handle_member_barcode_generation();"}		pearson.performance@gmail.com	\N	\N
20250827122951	{"-- Fix security issues by setting search_path on functions\nCREATE OR REPLACE FUNCTION public.generate_member_barcode()\nRETURNS TEXT\nLANGUAGE plpgsql\nSECURITY DEFINER\nSET search_path = public\nAS $$\nDECLARE\n    new_barcode TEXT;\n    barcode_exists BOOLEAN;\nBEGIN\n    LOOP\n        -- Generate 12-digit barcode: 2 digits for gym + 10 random digits\n        new_barcode := '01' || LPAD(FLOOR(RANDOM() * 10000000000)::TEXT, 10, '0');\n        \n        -- Check if barcode already exists\n        SELECT EXISTS(SELECT 1 FROM public.profiles WHERE barcode = new_barcode) INTO barcode_exists;\n        \n        IF NOT barcode_exists THEN\n            EXIT;\n        END IF;\n    END LOOP;\n    \n    RETURN new_barcode;\nEND;\n$$;\n\n-- Fix trigger function security issue\nCREATE OR REPLACE FUNCTION public.handle_member_barcode_generation()\nRETURNS TRIGGER\nLANGUAGE plpgsql\nSECURITY DEFINER\nSET search_path = public\nAS $$\nBEGIN\n    -- Only generate barcode for members without one\n    IF NEW.role = 'member' AND (NEW.barcode IS NULL OR NEW.barcode = '') THEN\n        NEW.barcode := public.generate_member_barcode();\n        NEW.barcode_generated_at := now();\n    END IF;\n    \n    RETURN NEW;\nEND;\n$$;"}		pearson.performance@gmail.com	\N	\N
20250827011701	{"-- Create subscribers table for Stripe integration\nCREATE TABLE public.subscribers (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,\n  email TEXT NOT NULL UNIQUE,\n  stripe_customer_id TEXT,\n  subscribed BOOLEAN NOT NULL DEFAULT false,\n  subscription_tier TEXT,\n  subscription_end TIMESTAMPTZ,\n  membership_plan_id UUID REFERENCES public.membership_plans(id),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  created_at TIMESTAMPTZ NOT NULL DEFAULT now()\n);\n\n-- Enable Row Level Security\nALTER TABLE public.subscribers ENABLE ROW LEVEL SECURITY;\n\n-- Create policy for users to view their own subscription info\nCREATE POLICY \\"Users can view their own subscription\\" \nON public.subscribers\nFOR SELECT\nUSING (user_id = auth.uid() OR email = auth.email());\n\n-- Create policy for edge functions to update subscription info\nCREATE POLICY \\"Edge functions can update subscriptions\\" \nON public.subscribers\nFOR UPDATE\nUSING (true);\n\n-- Create policy for edge functions to insert subscription info\nCREATE POLICY \\"Edge functions can insert subscriptions\\" \nON public.subscribers\nFOR INSERT\nWITH CHECK (true);\n\n-- Create updated_at trigger\nCREATE TRIGGER update_subscribers_updated_at\nBEFORE UPDATE ON public.subscribers\nFOR EACH ROW\nEXECUTE FUNCTION public.update_updated_at_column();"}		pearson.performance@gmail.com	\N	\N
20250827015655	{"-- Create default lead stages for organizations that don't have them\n-- First, let's create a function to set up default stages for an organization\nCREATE OR REPLACE FUNCTION setup_default_lead_stages(org_id uuid)\nRETURNS void AS $$\nBEGIN\n  -- Only create stages if none exist for the organization\n  IF NOT EXISTS (SELECT 1 FROM lead_stages WHERE organization_id = org_id) THEN\n    INSERT INTO lead_stages (name, organization_id, order_index, color, description, is_closed) VALUES\n      ('New Lead', org_id, 1, '#3b82f6', 'Initial contact made', false),\n      ('Qualified', org_id, 2, '#8b5cf6', 'Lead shows genuine interest', false),\n      ('Tour Scheduled', org_id, 3, '#f59e0b', 'Facility tour booked', false),\n      ('Tour Completed', org_id, 4, '#10b981', 'Completed facility tour', false),\n      ('Proposal Sent', org_id, 5, '#f97316', 'Membership proposal provided', false),\n      ('Negotiating', org_id, 6, '#ef4444', 'Discussing terms and pricing', false),\n      ('Closed Won', org_id, 7, '#22c55e', 'Converted to member', true),\n      ('Closed Lost', org_id, 8, '#6b7280', 'Lead did not convert', true);\n  END IF;\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER;\n\n-- Create a trigger to automatically set up lead stages for new organizations\nCREATE OR REPLACE FUNCTION trigger_setup_lead_stages()\nRETURNS TRIGGER AS $$\nBEGIN\n  -- Set up default lead stages for the user's organization\n  IF NEW.organization_id IS NOT NULL THEN\n    PERFORM setup_default_lead_stages(NEW.organization_id);\n  END IF;\n  RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER;\n\n-- Create trigger that fires when a new profile is created\nDROP TRIGGER IF EXISTS setup_lead_stages_on_profile ON profiles;\nCREATE TRIGGER setup_lead_stages_on_profile\n  AFTER INSERT ON profiles\n  FOR EACH ROW\n  EXECUTE FUNCTION trigger_setup_lead_stages();\n\n-- Set up stages for existing organizations (FitCore Gym)\nDO $$\nDECLARE\n  org_record RECORD;\nBEGIN\n  FOR org_record IN SELECT DISTINCT organization_id FROM profiles WHERE organization_id IS NOT NULL LOOP\n    PERFORM setup_default_lead_stages(org_record.organization_id);\n  END LOOP;\nEND $$;"}		pearson.performance@gmail.com	\N	\N
20250827020736	{"-- Create membership agreement templates table\nCREATE TABLE public.membership_agreement_templates (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  organization_id UUID NOT NULL,\n  name TEXT NOT NULL,\n  content TEXT NOT NULL,\n  is_default BOOLEAN DEFAULT false,\n  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT now()\n);\n\n-- Enable RLS\nALTER TABLE public.membership_agreement_templates ENABLE ROW LEVEL SECURITY;\n\n-- Create policies\nCREATE POLICY \\"Staff can manage agreement templates\\" \nON public.membership_agreement_templates \nFOR ALL \nUSING (organization_id IN (\n  SELECT organization_id FROM profiles \n  WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n));\n\n-- Create promotions table\nCREATE TABLE public.promotions (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  organization_id UUID NOT NULL,\n  name TEXT NOT NULL,\n  description TEXT,\n  discount_type TEXT NOT NULL CHECK (discount_type IN ('percentage', 'fixed_amount', 'free_months')),\n  discount_value NUMERIC NOT NULL,\n  valid_from TIMESTAMPTZ NOT NULL DEFAULT now(),\n  valid_until TIMESTAMPTZ,\n  applicable_plans TEXT[], -- Array of plan IDs or 'all'\n  max_uses INTEGER,\n  current_uses INTEGER DEFAULT 0,\n  is_active BOOLEAN DEFAULT true,\n  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT now()\n);\n\n-- Enable RLS on promotions\nALTER TABLE public.promotions ENABLE ROW LEVEL SECURITY;\n\n-- Create policies for promotions\nCREATE POLICY \\"Staff can manage promotions\\" \nON public.promotions \nFOR ALL \nUSING (organization_id IN (\n  SELECT organization_id FROM profiles \n  WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n));\n\n-- Enhance membership plans table\nALTER TABLE public.membership_plans \nADD COLUMN plan_type TEXT DEFAULT 'individual' CHECK (plan_type IN ('individual', 'couple', 'family', 'corporate')),\nADD COLUMN requires_commitment BOOLEAN DEFAULT false,\nADD COLUMN commitment_months INTEGER,\nADD COLUMN signup_fee NUMERIC DEFAULT 0,\nADD COLUMN annual_maintenance_fee NUMERIC DEFAULT 0,\nADD COLUMN is_prepaid BOOLEAN DEFAULT false,\nADD COLUMN prepaid_months INTEGER,\nADD COLUMN features TEXT[] DEFAULT '{}';\n\n-- Create member cards table\nCREATE TABLE public.member_cards (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  member_id UUID NOT NULL REFERENCES profiles(id) ON DELETE CASCADE,\n  card_number TEXT UNIQUE NOT NULL,\n  nfc_enabled BOOLEAN DEFAULT false,\n  nfc_uid TEXT UNIQUE,\n  barcode TEXT UNIQUE,\n  qr_code TEXT UNIQUE,\n  status TEXT DEFAULT 'active' CHECK (status IN ('active', 'suspended', 'lost', 'damaged')),\n  issued_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  expires_at TIMESTAMPTZ,\n  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT now()\n);\n\n-- Enable RLS on member cards\nALTER TABLE public.member_cards ENABLE ROW LEVEL SECURITY;\n\n-- Create policies for member cards\nCREATE POLICY \\"Members can view their own cards\\" \nON public.member_cards \nFOR SELECT \nUSING (member_id = auth.uid() OR EXISTS (\n  SELECT 1 FROM profiles \n  WHERE profiles.id = auth.uid() \n  AND profiles.organization_id = (SELECT organization_id FROM profiles WHERE id = member_cards.member_id)\n  AND profiles.role IN ('owner', 'manager', 'staff')\n));\n\nCREATE POLICY \\"Staff can manage member cards\\" \nON public.member_cards \nFOR ALL \nUSING (EXISTS (\n  SELECT 1 FROM profiles \n  WHERE profiles.id = auth.uid() \n  AND profiles.organization_id = (SELECT organization_id FROM profiles WHERE id = member_cards.member_id)\n  AND profiles.role IN ('owner', 'manager', 'staff')\n));\n\n-- Create membership agreements table for signed agreements\nCREATE TABLE public.membership_agreements (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  member_id UUID NOT NULL REFERENCES profiles(id) ON DELETE CASCADE,\n  template_id UUID REFERENCES membership_agreement_templates(id),\n  agreement_content TEXT NOT NULL,\n  signed_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  signature_data TEXT, -- For digital signatures\n  witness_id UUID REFERENCES profiles(id),\n  created_at TIMESTAMPTZ NOT NULL DEFAULT now()\n);\n\n-- Enable RLS on membership agreements\nALTER TABLE public.membership_agreements ENABLE ROW LEVEL SECURITY;\n\n-- Create policies for membership agreements\nCREATE POLICY \\"Members can view their own agreements\\" \nON public.membership_agreements \nFOR SELECT \nUSING (member_id = auth.uid() OR EXISTS (\n  SELECT 1 FROM profiles \n  WHERE profiles.id = auth.uid() \n  AND profiles.organization_id = (SELECT organization_id FROM profiles WHERE id = membership_agreements.member_id)\n  AND profiles.role IN ('owner', 'manager', 'staff')\n));\n\nCREATE POLICY \\"Staff can manage agreements\\" \nON public.membership_agreements \nFOR ALL \nUSING (EXISTS (\n  SELECT 1 FROM profiles \n  WHERE profiles.id = auth.uid() \n  AND profiles.organization_id = (SELECT organization_id FROM profiles WHERE id = membership_agreements.member_id)\n  AND profiles.role IN ('owner', 'manager', 'staff')\n));\n\n-- Create payment transactions table\nCREATE TABLE public.payment_transactions (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  member_id UUID NOT NULL REFERENCES profiles(id) ON DELETE CASCADE,\n  membership_id UUID REFERENCES memberships(id),\n  amount NUMERIC NOT NULL,\n  currency TEXT DEFAULT 'USD',\n  payment_method TEXT NOT NULL CHECK (payment_method IN ('cash', 'card', 'bank_transfer', 'stripe', 'nfc')),\n  payment_status TEXT DEFAULT 'pending' CHECK (payment_status IN ('pending', 'completed', 'failed', 'refunded')),\n  transaction_reference TEXT,\n  stripe_payment_intent_id TEXT,\n  processed_by UUID REFERENCES profiles(id),\n  notes TEXT,\n  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT now()\n);\n\n-- Enable RLS on payment transactions\nALTER TABLE public.payment_transactions ENABLE ROW LEVEL SECURITY;\n\n-- Create policies for payment transactions\nCREATE POLICY \\"Members can view their own transactions\\" \nON public.payment_transactions \nFOR SELECT \nUSING (member_id = auth.uid() OR EXISTS (\n  SELECT 1 FROM profiles \n  WHERE profiles.id = auth.uid() \n  AND profiles.organization_id = (SELECT organization_id FROM profiles WHERE id = payment_transactions.member_id)\n  AND profiles.role IN ('owner', 'manager', 'staff')\n));\n\nCREATE POLICY \\"Staff can manage transactions\\" \nON public.payment_transactions \nFOR ALL \nUSING (EXISTS (\n  SELECT 1 FROM profiles \n  WHERE profiles.id = auth.uid() \n  AND profiles.organization_id = (SELECT organization_id FROM profiles WHERE id = payment_transactions.member_id)\n  AND profiles.role IN ('owner', 'manager', 'staff')\n));\n\n-- Add updated_at triggers\nCREATE TRIGGER update_membership_agreement_templates_updated_at\nBEFORE UPDATE ON public.membership_agreement_templates\nFOR EACH ROW\nEXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_promotions_updated_at\nBEFORE UPDATE ON public.promotions\nFOR EACH ROW\nEXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_member_cards_updated_at\nBEFORE UPDATE ON public.member_cards\nFOR EACH ROW\nEXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_payment_transactions_updated_at\nBEFORE UPDATE ON public.payment_transactions\nFOR EACH ROW\nEXECUTE FUNCTION public.update_updated_at_column();\n\n-- Create function to generate unique card numbers\nCREATE OR REPLACE FUNCTION public.generate_member_card_number()\nRETURNS TEXT\nLANGUAGE plpgsql\nSECURITY DEFINER\nAS $$\nDECLARE\n    new_card_number TEXT;\n    card_exists BOOLEAN;\nBEGIN\n    LOOP\n        -- Generate 16-digit card number starting with gym prefix\n        new_card_number := '4567' || LPAD(FLOOR(RANDOM() * 1000000000000)::TEXT, 12, '0');\n        \n        -- Check if card number already exists\n        SELECT EXISTS(SELECT 1 FROM public.member_cards WHERE card_number = new_card_number) INTO card_exists;\n        \n        IF NOT card_exists THEN\n            EXIT;\n        END IF;\n    END LOOP;\n    \n    RETURN new_card_number;\nEND;\n$$;"}		pearson.performance@gmail.com	\N	\N
20250827021837	{"-- Add additional fields to profiles table for complete member information\nALTER TABLE public.profiles \nADD COLUMN address_line1 TEXT,\nADD COLUMN address_line2 TEXT,\nADD COLUMN city TEXT,\nADD COLUMN state TEXT,\nADD COLUMN postal_code TEXT,\nADD COLUMN country TEXT DEFAULT 'US',\nADD COLUMN date_of_birth DATE,\nADD COLUMN gender TEXT,\nADD COLUMN emergency_contact_name TEXT,\nADD COLUMN emergency_contact_phone TEXT,\nADD COLUMN interests TEXT[] DEFAULT '{}',\nADD COLUMN join_date DATE,\nADD COLUMN member_notes TEXT;"}		pearson.performance@gmail.com	\N	\N
20250827022449	{"-- Add salesperson tracking and commission system tables\n\n-- Add salesperson fields to leads table\nALTER TABLE public.leads \nADD COLUMN entered_by UUID REFERENCES public.profiles(id),\nADD COLUMN assigned_salesperson UUID REFERENCES public.profiles(id),\nADD COLUMN referral_code TEXT,\nADD COLUMN attribution_status TEXT DEFAULT 'confirmed' CHECK (attribution_status IN ('confirmed', 'disputed', 'pending_approval'));\n\n-- Create salesperson commission settings table\nCREATE TABLE public.salesperson_commissions (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  organization_id UUID NOT NULL,\n  salesperson_id UUID NOT NULL REFERENCES public.profiles(id),\n  commission_type TEXT NOT NULL CHECK (commission_type IN ('percentage', 'flat_rate')),\n  commission_value NUMERIC NOT NULL,\n  revenue_basis TEXT NOT NULL CHECK (revenue_basis IN ('total_contract', 'monthly_recurring', 'first_payment')),\n  duration_months INTEGER, -- NULL means indefinite\n  is_active BOOLEAN DEFAULT true,\n  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  created_by UUID REFERENCES public.profiles(id)\n);\n\n-- Create organization commission settings table\nCREATE TABLE public.organization_commission_settings (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  organization_id UUID NOT NULL UNIQUE,\n  default_commission_type TEXT NOT NULL CHECK (default_commission_type IN ('percentage', 'flat_rate')),\n  default_commission_value NUMERIC NOT NULL,\n  default_revenue_basis TEXT NOT NULL CHECK (default_revenue_basis IN ('total_contract', 'monthly_recurring', 'first_payment')),\n  default_duration_months INTEGER,\n  allow_split_commissions BOOLEAN DEFAULT false,\n  max_split_salespeople INTEGER DEFAULT 2,\n  require_manager_approval_for_attribution BOOLEAN DEFAULT true,\n  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT now()\n);\n\n-- Create lead split commissions table for multiple salespeople\nCREATE TABLE public.lead_split_commissions (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  lead_id UUID NOT NULL REFERENCES public.leads(id) ON DELETE CASCADE,\n  salesperson_id UUID NOT NULL REFERENCES public.profiles(id),\n  commission_percentage NUMERIC NOT NULL CHECK (commission_percentage > 0 AND commission_percentage <= 100),\n  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  created_by UUID REFERENCES public.profiles(id)\n);\n\n-- Create referral links table\nCREATE TABLE public.salesperson_referral_links (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  organization_id UUID NOT NULL,\n  salesperson_id UUID NOT NULL REFERENCES public.profiles(id),\n  referral_code TEXT NOT NULL UNIQUE,\n  link_url TEXT NOT NULL,\n  is_active BOOLEAN DEFAULT true,\n  click_count INTEGER DEFAULT 0,\n  conversion_count INTEGER DEFAULT 0,\n  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  UNIQUE(organization_id, salesperson_id)\n);\n\n-- Create attribution disputes table\nCREATE TABLE public.lead_attribution_disputes (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  lead_id UUID NOT NULL REFERENCES public.leads(id),\n  disputing_salesperson_id UUID NOT NULL REFERENCES public.profiles(id),\n  current_salesperson_id UUID REFERENCES public.profiles(id),\n  dispute_reason TEXT NOT NULL,\n  evidence TEXT,\n  status TEXT NOT NULL DEFAULT 'pending' CHECK (status IN ('pending', 'approved', 'rejected')),\n  reviewed_by UUID REFERENCES public.profiles(id),\n  reviewed_at TIMESTAMPTZ,\n  resolution_notes TEXT,\n  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT now()\n);\n\n-- Create commission calculations table\nCREATE TABLE public.commission_calculations (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  lead_id UUID NOT NULL REFERENCES public.leads(id),\n  salesperson_id UUID NOT NULL REFERENCES public.profiles(id),\n  membership_id UUID REFERENCES public.memberships(id),\n  commission_amount NUMERIC NOT NULL,\n  commission_type TEXT NOT NULL,\n  revenue_basis TEXT NOT NULL,\n  payment_period_start DATE,\n  payment_period_end DATE,\n  status TEXT NOT NULL DEFAULT 'pending' CHECK (status IN ('pending', 'paid', 'cancelled')),\n  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT now()\n);\n\n-- Enable RLS on all new tables\nALTER TABLE public.salesperson_commissions ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.organization_commission_settings ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.lead_split_commissions ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.salesperson_referral_links ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.lead_attribution_disputes ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.commission_calculations ENABLE ROW LEVEL SECURITY;\n\n-- RLS Policies for salesperson_commissions\nCREATE POLICY \\"Staff can manage salesperson commissions\\" ON public.salesperson_commissions\nFOR ALL USING (organization_id IN (\n  SELECT organization_id FROM public.profiles \n  WHERE id = auth.uid() AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n));\n\nCREATE POLICY \\"Salespeople can view their own commissions\\" ON public.salesperson_commissions\nFOR SELECT USING (salesperson_id = auth.uid());\n\n-- RLS Policies for organization_commission_settings\nCREATE POLICY \\"Staff can manage org commission settings\\" ON public.organization_commission_settings\nFOR ALL USING (organization_id IN (\n  SELECT organization_id FROM public.profiles \n  WHERE id = auth.uid() AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role])\n));\n\n-- RLS Policies for lead_split_commissions\nCREATE POLICY \\"Staff can manage split commissions\\" ON public.lead_split_commissions\nFOR ALL USING (lead_id IN (\n  SELECT id FROM public.leads \n  WHERE organization_id IN (\n    SELECT organization_id FROM public.profiles \n    WHERE id = auth.uid() AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n  )\n));\n\n-- RLS Policies for salesperson_referral_links\nCREATE POLICY \\"Staff can manage referral links\\" ON public.salesperson_referral_links\nFOR ALL USING (organization_id IN (\n  SELECT organization_id FROM public.profiles \n  WHERE id = auth.uid() AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n));\n\nCREATE POLICY \\"Salespeople can view their own referral links\\" ON public.salesperson_referral_links\nFOR SELECT USING (salesperson_id = auth.uid());\n\n-- RLS Policies for lead_attribution_disputes\nCREATE POLICY \\"Staff can manage attribution disputes\\" ON public.lead_attribution_disputes\nFOR ALL USING (lead_id IN (\n  SELECT id FROM public.leads \n  WHERE organization_id IN (\n    SELECT organization_id FROM public.profiles \n    WHERE id = auth.uid() AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n  )\n));\n\n-- RLS Policies for commission_calculations\nCREATE POLICY \\"Staff can manage commission calculations\\" ON public.commission_calculations\nFOR ALL USING (lead_id IN (\n  SELECT id FROM public.leads \n  WHERE organization_id IN (\n    SELECT organization_id FROM public.profiles \n    WHERE id = auth.uid() AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n  )\n));\n\nCREATE POLICY \\"Salespeople can view their own commissions calc\\" ON public.commission_calculations\nFOR SELECT USING (salesperson_id = auth.uid());\n\n-- Function to generate unique referral codes\nCREATE OR REPLACE FUNCTION public.generate_referral_code()\nRETURNS TEXT\nLANGUAGE plpgsql\nSECURITY DEFINER\nSET search_path = public\nAS $$\nDECLARE\n    new_code TEXT;\n    code_exists BOOLEAN;\nBEGIN\n    LOOP\n        -- Generate 8-character alphanumeric code\n        new_code := upper(substring(md5(random()::text) from 1 for 8));\n        \n        -- Check if code already exists\n        SELECT EXISTS(SELECT 1 FROM public.salesperson_referral_links WHERE referral_code = new_code) INTO code_exists;\n        \n        IF NOT code_exists THEN\n            EXIT;\n        END IF;\n    END LOOP;\n    \n    RETURN new_code;\nEND;\n$$;\n\n-- Add triggers for updated_at columns\nCREATE TRIGGER update_salesperson_commissions_updated_at\nBEFORE UPDATE ON public.salesperson_commissions\nFOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_organization_commission_settings_updated_at\nBEFORE UPDATE ON public.organization_commission_settings\nFOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_salesperson_referral_links_updated_at\nBEFORE UPDATE ON public.salesperson_referral_links  \nFOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_lead_attribution_disputes_updated_at\nBEFORE UPDATE ON public.lead_attribution_disputes\nFOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_commission_calculations_updated_at\nBEFORE UPDATE ON public.commission_calculations\nFOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();"}		pearson.performance@gmail.com	\N	\N
20250827033849	{"-- Add family relationship support to profiles\nALTER TABLE public.profiles \nADD COLUMN parent_member_id uuid REFERENCES public.profiles(id),\nADD COLUMN relationship_type text CHECK (relationship_type IN ('parent', 'child', 'spouse', 'guardian', 'dependent')),\nADD COLUMN family_notes text;\n\n-- Create member documents table\nCREATE TABLE public.member_documents (\n  id uuid NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  member_id uuid NOT NULL REFERENCES public.profiles(id) ON DELETE CASCADE,\n  document_name text NOT NULL,\n  document_type text NOT NULL CHECK (document_type IN ('waiver', 'medical', 'contract', 'photo_id', 'payment', 'other')),\n  file_url text,\n  file_size integer,\n  uploaded_by uuid REFERENCES public.profiles(id),\n  notes text,\n  created_at timestamp with time zone NOT NULL DEFAULT now(),\n  updated_at timestamp with time zone NOT NULL DEFAULT now()\n);\n\n-- Enable RLS on member documents\nALTER TABLE public.member_documents ENABLE ROW LEVEL SECURITY;\n\n-- Create policies for member documents\nCREATE POLICY \\"Members can view their own documents\\" \nON public.member_documents \nFOR SELECT \nUSING (\n  member_id = auth.uid() \n  OR EXISTS (\n    SELECT 1 FROM profiles \n    WHERE profiles.id = auth.uid() \n    AND profiles.organization_id = (\n      SELECT profiles.organization_id \n      FROM profiles \n      WHERE profiles.id = member_documents.member_id\n    ) \n    AND profiles.role = ANY (ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n  )\n);\n\nCREATE POLICY \\"Staff can manage member documents\\" \nON public.member_documents \nFOR ALL \nUSING (\n  EXISTS (\n    SELECT 1 FROM profiles \n    WHERE profiles.id = auth.uid() \n    AND profiles.organization_id = (\n      SELECT profiles.organization_id \n      FROM profiles \n      WHERE profiles.id = member_documents.member_id\n    ) \n    AND profiles.role = ANY (ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n  )\n);\n\n-- Modify check_ins table to support guests (leads)\nALTER TABLE public.check_ins \nADD COLUMN guest_name text,\nADD COLUMN guest_email text,\nADD COLUMN guest_phone text,\nADD COLUMN is_guest boolean DEFAULT false,\nADD COLUMN lead_id uuid REFERENCES public.leads(id);\n\n-- Update check_ins policies to handle guests\nDROP POLICY \\"Members can view their own check-ins\\" ON public.check_ins;\nDROP POLICY \\"Staff can manage check-ins\\" ON public.check_ins;\n\n-- Create new policies for check-ins with guest support\nCREATE POLICY \\"Members can view their own check-ins\\" \nON public.check_ins \nFOR SELECT \nUSING (\n  (member_id = auth.uid() AND is_guest = false) \n  OR (location_id IN (\n    SELECT locations.id FROM locations \n    WHERE locations.organization_id IN (\n      SELECT profiles.organization_id FROM profiles \n      WHERE profiles.id = auth.uid() \n      AND profiles.role = ANY (ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n    )\n  ))\n);\n\nCREATE POLICY \\"Staff can manage all check-ins\\" \nON public.check_ins \nFOR ALL \nUSING (\n  location_id IN (\n    SELECT locations.id FROM locations \n    WHERE locations.organization_id IN (\n      SELECT profiles.organization_id FROM profiles \n      WHERE profiles.id = auth.uid() \n      AND profiles.role = ANY (ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n    )\n  )\n);\n\n-- Create member attendance summary view\nCREATE OR REPLACE VIEW member_attendance_summary AS\nSELECT \n  p.id as member_id,\n  p.first_name,\n  p.last_name,\n  p.email,\n  COUNT(c.id) as total_visits,\n  COUNT(CASE WHEN c.checked_in_at >= CURRENT_DATE - INTERVAL '30 days' THEN 1 END) as visits_last_30_days,\n  COUNT(CASE WHEN c.checked_in_at >= CURRENT_DATE - INTERVAL '7 days' THEN 1 END) as visits_last_7_days,\n  MAX(c.checked_in_at) as last_visit,\n  AVG(EXTRACT(EPOCH FROM (c.checked_out_at - c.checked_in_at))/60) as avg_duration_minutes\nFROM profiles p\nLEFT JOIN check_ins c ON p.id = c.member_id AND c.is_guest = false\nWHERE p.role = 'member'\nGROUP BY p.id, p.first_name, p.last_name, p.email;\n\n-- Add trigger for member documents updated_at\nCREATE TRIGGER update_member_documents_updated_at\nBEFORE UPDATE ON public.member_documents\nFOR EACH ROW\nEXECUTE FUNCTION public.update_updated_at_column();"}		pearson.performance@gmail.com	\N	\N
20250827085151	{"-- Create member messages table for in-app messaging\nCREATE TABLE public.member_messages (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  sender_id UUID NOT NULL REFERENCES public.profiles(id) ON DELETE CASCADE,\n  recipient_id UUID NOT NULL REFERENCES public.profiles(id) ON DELETE CASCADE,\n  subject TEXT NOT NULL,\n  content TEXT NOT NULL,\n  message_type TEXT NOT NULL DEFAULT 'general' CHECK (message_type IN ('general', 'reminder', 'announcement', 'support')),\n  status TEXT NOT NULL DEFAULT 'sent' CHECK (status IN ('sent', 'delivered', 'read')),\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Create fitness assessments table\nCREATE TABLE public.fitness_assessments (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  member_id UUID NOT NULL REFERENCES public.profiles(id) ON DELETE CASCADE,\n  fitness_goals TEXT[] NOT NULL DEFAULT '{}',\n  experience_level TEXT NOT NULL CHECK (experience_level IN ('beginner', 'intermediate', 'advanced')),\n  workout_preferences TEXT[] NOT NULL DEFAULT '{}',\n  workout_frequency TEXT NOT NULL CHECK (workout_frequency IN ('1-2', '3-4', '5-6', 'daily')),\n  specific_goals TEXT,\n  health_conditions TEXT,\n  previous_injuries TEXT,\n  assessment_date TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Create member orientations table\nCREATE TABLE public.member_orientations (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  member_id UUID NOT NULL REFERENCES public.profiles(id) ON DELETE CASCADE,\n  orientation_type TEXT NOT NULL CHECK (orientation_type IN ('gym_tour', 'personal_training', 'group_orientation')),\n  scheduled_date DATE NOT NULL,\n  scheduled_time TEXT NOT NULL,\n  special_requests TEXT,\n  status TEXT NOT NULL DEFAULT 'scheduled' CHECK (status IN ('scheduled', 'completed', 'cancelled', 'no_show')),\n  completed_at TIMESTAMP WITH TIME ZONE,\n  staff_notes TEXT,\n  created_by UUID REFERENCES public.profiles(id),\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Create announcements table\nCREATE TABLE public.announcements (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL REFERENCES public.organizations(id) ON DELETE CASCADE,\n  title TEXT NOT NULL,\n  content TEXT NOT NULL,\n  announcement_type TEXT NOT NULL DEFAULT 'general' CHECK (announcement_type IN ('general', 'maintenance', 'event', 'policy', 'emergency')),\n  target_audience TEXT NOT NULL DEFAULT 'all_members' CHECK (target_audience IN ('all_members', 'active_members', 'staff', 'trainers', 'custom')),\n  custom_recipients UUID[],\n  priority TEXT NOT NULL DEFAULT 'normal' CHECK (priority IN ('low', 'normal', 'high', 'urgent')),\n  scheduled_for TIMESTAMP WITH TIME ZONE,\n  published_at TIMESTAMP WITH TIME ZONE,\n  expires_at TIMESTAMP WITH TIME ZONE,\n  is_published BOOLEAN NOT NULL DEFAULT false,\n  created_by UUID NOT NULL REFERENCES public.profiles(id),\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Create support tickets table\nCREATE TABLE public.support_tickets (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL REFERENCES public.organizations(id) ON DELETE CASCADE,\n  member_id UUID NOT NULL REFERENCES public.profiles(id) ON DELETE CASCADE,\n  assigned_to UUID REFERENCES public.profiles(id),\n  subject TEXT NOT NULL,\n  description TEXT NOT NULL,\n  category TEXT NOT NULL DEFAULT 'general' CHECK (category IN ('general', 'billing', 'technical', 'equipment', 'complaint', 'suggestion')),\n  priority TEXT NOT NULL DEFAULT 'medium' CHECK (priority IN ('low', 'medium', 'high', 'urgent')),\n  status TEXT NOT NULL DEFAULT 'open' CHECK (status IN ('open', 'in_progress', 'resolved', 'closed')),\n  resolution_notes TEXT,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Create member milestones table\nCREATE TABLE public.member_milestones (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  member_id UUID NOT NULL REFERENCES public.profiles(id) ON DELETE CASCADE,\n  milestone_type TEXT NOT NULL CHECK (milestone_type IN ('membership_anniversary', 'birthday', 'fitness_goal', 'attendance', 'referral')),\n  title TEXT NOT NULL,\n  description TEXT,\n  achievement_date DATE NOT NULL,\n  recognition_sent BOOLEAN NOT NULL DEFAULT false,\n  recognition_sent_at TIMESTAMP WITH TIME ZONE,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Enable RLS on all tables\nALTER TABLE public.member_messages ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.fitness_assessments ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.member_orientations ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.announcements ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.support_tickets ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.member_milestones ENABLE ROW LEVEL SECURITY;\n\n-- RLS Policies for member_messages\nCREATE POLICY \\"Users can view their own messages\\" ON public.member_messages\n  FOR SELECT USING (sender_id = auth.uid() OR recipient_id = auth.uid());\n\nCREATE POLICY \\"Users can send messages\\" ON public.member_messages\n  FOR INSERT WITH CHECK (sender_id = auth.uid());\n\nCREATE POLICY \\"Staff can manage all messages\\" ON public.member_messages\n  FOR ALL USING (\n    EXISTS (\n      SELECT 1 FROM public.profiles \n      WHERE profiles.id = auth.uid() \n      AND profiles.role IN ('owner', 'manager', 'staff')\n      AND profiles.organization_id IN (\n        SELECT sender_profile.organization_id FROM public.profiles sender_profile WHERE sender_profile.id = member_messages.sender_id\n        UNION\n        SELECT recipient_profile.organization_id FROM public.profiles recipient_profile WHERE recipient_profile.id = member_messages.recipient_id\n      )\n    )\n  );\n\n-- RLS Policies for fitness_assessments\nCREATE POLICY \\"Members can view their own assessments\\" ON public.fitness_assessments\n  FOR SELECT USING (member_id = auth.uid() OR EXISTS (\n    SELECT 1 FROM public.profiles \n    WHERE profiles.id = auth.uid() \n    AND profiles.role IN ('owner', 'manager', 'staff', 'trainer')\n    AND profiles.organization_id = (SELECT organization_id FROM public.profiles WHERE id = fitness_assessments.member_id)\n  ));\n\nCREATE POLICY \\"Members can create their own assessments\\" ON public.fitness_assessments\n  FOR INSERT WITH CHECK (member_id = auth.uid());\n\nCREATE POLICY \\"Staff can manage assessments\\" ON public.fitness_assessments\n  FOR ALL USING (\n    EXISTS (\n      SELECT 1 FROM public.profiles \n      WHERE profiles.id = auth.uid() \n      AND profiles.role IN ('owner', 'manager', 'staff', 'trainer')\n      AND profiles.organization_id = (SELECT organization_id FROM public.profiles WHERE id = fitness_assessments.member_id)\n    )\n  );\n\n-- RLS Policies for member_orientations\nCREATE POLICY \\"Members can view their own orientations\\" ON public.member_orientations\n  FOR SELECT USING (member_id = auth.uid() OR EXISTS (\n    SELECT 1 FROM public.profiles \n    WHERE profiles.id = auth.uid() \n    AND profiles.role IN ('owner', 'manager', 'staff', 'trainer')\n    AND profiles.organization_id = (SELECT organization_id FROM public.profiles WHERE id = member_orientations.member_id)\n  ));\n\nCREATE POLICY \\"Members can create their own orientations\\" ON public.member_orientations\n  FOR INSERT WITH CHECK (member_id = auth.uid());\n\nCREATE POLICY \\"Staff can manage orientations\\" ON public.member_orientations\n  FOR ALL USING (\n    EXISTS (\n      SELECT 1 FROM public.profiles \n      WHERE profiles.id = auth.uid() \n      AND profiles.role IN ('owner', 'manager', 'staff', 'trainer')\n      AND profiles.organization_id = (SELECT organization_id FROM public.profiles WHERE id = member_orientations.member_id)\n    )\n  );\n\n-- RLS Policies for announcements\nCREATE POLICY \\"Staff can manage announcements\\" ON public.announcements\n  FOR ALL USING (\n    organization_id IN (\n      SELECT profiles.organization_id FROM public.profiles \n      WHERE profiles.id = auth.uid() \n      AND profiles.role IN ('owner', 'manager', 'staff')\n    )\n  );\n\nCREATE POLICY \\"Users can view published announcements\\" ON public.announcements\n  FOR SELECT USING (\n    is_published = true \n    AND organization_id IN (\n      SELECT profiles.organization_id FROM public.profiles WHERE profiles.id = auth.uid()\n    )\n  );\n\n-- RLS Policies for support_tickets\nCREATE POLICY \\"Members can manage their own tickets\\" ON public.support_tickets\n  FOR ALL USING (member_id = auth.uid());\n\nCREATE POLICY \\"Staff can manage all tickets\\" ON public.support_tickets\n  FOR ALL USING (\n    organization_id IN (\n      SELECT profiles.organization_id FROM public.profiles \n      WHERE profiles.id = auth.uid() \n      AND profiles.role IN ('owner', 'manager', 'staff')\n    )\n  );\n\n-- RLS Policies for member_milestones\nCREATE POLICY \\"Members can view their own milestones\\" ON public.member_milestones\n  FOR SELECT USING (member_id = auth.uid() OR EXISTS (\n    SELECT 1 FROM public.profiles \n    WHERE profiles.id = auth.uid() \n    AND profiles.role IN ('owner', 'manager', 'staff')\n    AND profiles.organization_id = (SELECT organization_id FROM public.profiles WHERE id = member_milestones.member_id)\n  ));\n\nCREATE POLICY \\"Staff can manage milestones\\" ON public.member_milestones\n  FOR ALL USING (\n    EXISTS (\n      SELECT 1 FROM public.profiles \n      WHERE profiles.id = auth.uid() \n      AND profiles.role IN ('owner', 'manager', 'staff')\n      AND profiles.organization_id = (SELECT organization_id FROM public.profiles WHERE id = member_milestones.member_id)\n    )\n  );\n\n-- Create updated_at triggers\nCREATE TRIGGER update_member_messages_updated_at\n  BEFORE UPDATE ON public.member_messages\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_fitness_assessments_updated_at\n  BEFORE UPDATE ON public.fitness_assessments\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_member_orientations_updated_at\n  BEFORE UPDATE ON public.member_orientations\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_announcements_updated_at\n  BEFORE UPDATE ON public.announcements\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_support_tickets_updated_at\n  BEFORE UPDATE ON public.support_tickets\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();"}		pearson.performance@gmail.com	\N	\N
20250827085745	{"-- Create lead_scoring_rules table\nCREATE TABLE public.lead_scoring_rules (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  rule_name TEXT NOT NULL,\n  criteria_type TEXT NOT NULL CHECK (criteria_type IN ('source', 'demographic', 'behavioral', 'engagement')),\n  criteria_field TEXT NOT NULL,\n  criteria_operator TEXT NOT NULL CHECK (criteria_operator IN ('equals', 'contains', 'greater_than', 'less_than', 'exists')),\n  criteria_value TEXT NOT NULL,\n  score_points INTEGER NOT NULL DEFAULT 0,\n  is_active BOOLEAN NOT NULL DEFAULT true,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Add missing fields to leads table\nALTER TABLE public.leads \nADD COLUMN lead_score INTEGER DEFAULT 0,\nADD COLUMN qualification_status TEXT DEFAULT 'unqualified' CHECK (qualification_status IN ('unqualified', 'cold', 'warm', 'hot', 'qualified'));\n\n-- Enable RLS on lead_scoring_rules table\nALTER TABLE public.lead_scoring_rules ENABLE ROW LEVEL SECURITY;\n\n-- Create policies for lead_scoring_rules\nCREATE POLICY \\"Staff can manage lead scoring rules\\" \nON public.lead_scoring_rules \nFOR ALL \nUSING (organization_id IN (\n  SELECT profiles.organization_id \n  FROM profiles \n  WHERE profiles.id = auth.uid() \n  AND profiles.role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n));\n\n-- Create trigger for updated_at on lead_scoring_rules\nCREATE TRIGGER update_lead_scoring_rules_updated_at\nBEFORE UPDATE ON public.lead_scoring_rules\nFOR EACH ROW\nEXECUTE FUNCTION public.update_updated_at_column();\n\n-- Create function to recalculate lead scores\nCREATE OR REPLACE FUNCTION public.recalculate_lead_scores(org_id UUID)\nRETURNS void\nLANGUAGE plpgsql\nSECURITY DEFINER\nAS $$\nBEGIN\n  -- Reset all lead scores for the organization\n  UPDATE public.leads \n  SET lead_score = 0, qualification_status = 'unqualified'\n  WHERE organization_id = org_id;\n  \n  -- This is a placeholder for the actual scoring logic\n  -- In a real implementation, you would loop through scoring rules\n  -- and apply them to calculate scores for each lead\n  \n  -- Update qualification status based on score ranges\n  UPDATE public.leads \n  SET qualification_status = CASE \n    WHEN lead_score >= 80 THEN 'qualified'\n    WHEN lead_score >= 60 THEN 'hot'\n    WHEN lead_score >= 40 THEN 'warm'\n    WHEN lead_score >= 20 THEN 'cold'\n    ELSE 'unqualified'\n  END\n  WHERE organization_id = org_id;\nEND;\n$$;"}		pearson.performance@gmail.com	\N	\N
20250827091819	{"-- Create lead sources table for tracking where leads come from\nCREATE TABLE public.lead_sources (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  organization_id UUID NOT NULL,\n  name TEXT NOT NULL,\n  description TEXT,\n  source_type TEXT NOT NULL DEFAULT 'digital', -- digital, referral, walk_in, advertising\n  tracking_url TEXT,\n  utm_parameters JSONB,\n  cost_per_lead NUMERIC(10,2),\n  conversion_rate NUMERIC(5,2),\n  is_active BOOLEAN NOT NULL DEFAULT true,\n  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT now()\n);\n\n-- Create facility tours table\nCREATE TABLE public.facility_tours (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  lead_id UUID NOT NULL,\n  scheduled_date DATE NOT NULL,\n  scheduled_time TEXT NOT NULL,\n  tour_type TEXT NOT NULL DEFAULT 'general', -- general, personal_training, group_fitness\n  guide_id UUID, -- staff member conducting tour\n  status TEXT NOT NULL DEFAULT 'scheduled', -- scheduled, completed, cancelled, no_show\n  outcome TEXT, -- interested, not_interested, follow_up_needed\n  notes TEXT,\n  follow_up_date DATE,\n  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT now()\n);\n\n-- Create sales quotes table\nCREATE TABLE public.sales_quotes (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  lead_id UUID NOT NULL,\n  quote_number TEXT NOT NULL,\n  created_by UUID NOT NULL,\n  status TEXT NOT NULL DEFAULT 'draft', -- draft, sent, accepted, expired, rejected\n  valid_until DATE,\n  subtotal NUMERIC(10,2) NOT NULL DEFAULT 0,\n  discount_amount NUMERIC(10,2) DEFAULT 0,\n  tax_amount NUMERIC(10,2) DEFAULT 0,\n  total_amount NUMERIC(10,2) NOT NULL DEFAULT 0,\n  notes TEXT,\n  terms_conditions TEXT,\n  sent_at TIMESTAMPTZ,\n  accepted_at TIMESTAMPTZ,\n  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT now()\n);\n\n-- Create quote line items table\nCREATE TABLE public.quote_line_items (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  quote_id UUID NOT NULL,\n  item_type TEXT NOT NULL, -- membership_plan, personal_training, addon\n  item_id UUID, -- reference to membership_plan or other service\n  item_name TEXT NOT NULL,\n  description TEXT,\n  quantity INTEGER NOT NULL DEFAULT 1,\n  unit_price NUMERIC(10,2) NOT NULL,\n  total_price NUMERIC(10,2) NOT NULL,\n  created_at TIMESTAMPTZ NOT NULL DEFAULT now()\n);\n\n-- Create email templates table\nCREATE TABLE public.email_templates (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  organization_id UUID NOT NULL,\n  name TEXT NOT NULL,\n  subject TEXT NOT NULL,\n  content TEXT NOT NULL,\n  template_type TEXT NOT NULL DEFAULT 'general', -- welcome, follow_up, promotion, reminder\n  is_active BOOLEAN NOT NULL DEFAULT true,\n  created_by UUID NOT NULL,\n  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT now()\n);\n\n-- Enable RLS on all new tables\nALTER TABLE public.lead_sources ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.facility_tours ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.sales_quotes ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.quote_line_items ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.email_templates ENABLE ROW LEVEL SECURITY;\n\n-- Create RLS policies for lead_sources\nCREATE POLICY \\"Staff can manage lead sources\\" ON public.lead_sources\nFOR ALL USING (organization_id IN (\n  SELECT organization_id FROM profiles \n  WHERE id = auth.uid() AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n));\n\n-- Create RLS policies for facility_tours\nCREATE POLICY \\"Staff can manage facility tours\\" ON public.facility_tours\nFOR ALL USING (lead_id IN (\n  SELECT id FROM leads WHERE organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n  )\n));\n\n-- Create RLS policies for sales_quotes\nCREATE POLICY \\"Staff can manage sales quotes\\" ON public.sales_quotes\nFOR ALL USING (lead_id IN (\n  SELECT id FROM leads WHERE organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n  )\n));\n\n-- Create RLS policies for quote_line_items\nCREATE POLICY \\"Staff can manage quote line items\\" ON public.quote_line_items\nFOR ALL USING (quote_id IN (\n  SELECT id FROM sales_quotes WHERE lead_id IN (\n    SELECT id FROM leads WHERE organization_id IN (\n      SELECT organization_id FROM profiles \n      WHERE id = auth.uid() AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n    )\n  )\n));\n\n-- Create RLS policies for email_templates\nCREATE POLICY \\"Staff can manage email templates\\" ON public.email_templates\nFOR ALL USING (organization_id IN (\n  SELECT organization_id FROM profiles \n  WHERE id = auth.uid() AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n));\n\n-- Add triggers for updated_at columns\nCREATE TRIGGER update_lead_sources_updated_at\nBEFORE UPDATE ON public.lead_sources\nFOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_facility_tours_updated_at\nBEFORE UPDATE ON public.facility_tours\nFOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_sales_quotes_updated_at\nBEFORE UPDATE ON public.sales_quotes\nFOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_email_templates_updated_at\nBEFORE UPDATE ON public.email_templates\nFOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();\n\n-- Add unique constraints\nALTER TABLE public.lead_sources ADD CONSTRAINT lead_sources_name_org_unique \nUNIQUE (organization_id, name);\n\nALTER TABLE public.sales_quotes ADD CONSTRAINT sales_quotes_number_unique \nUNIQUE (quote_number);\n\nALTER TABLE public.email_templates ADD CONSTRAINT email_templates_name_org_unique \nUNIQUE (organization_id, name);"}		pearson.performance@gmail.com	\N	\N
20250827092638	{"-- Create member engagement tracking table\nCREATE TABLE public.member_engagement_history (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  member_id UUID NOT NULL,\n  engagement_type TEXT NOT NULL CHECK (engagement_type IN ('check_in', 'class_booking', 'message_sent', 'message_opened', 'announcement_viewed', 'app_usage', 'payment', 'referral')),\n  engagement_value NUMERIC DEFAULT 1,\n  metadata JSONB DEFAULT '{}',\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Create loyalty points table\nCREATE TABLE public.loyalty_points (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  member_id UUID NOT NULL,\n  points_earned INTEGER NOT NULL DEFAULT 0,\n  points_redeemed INTEGER NOT NULL DEFAULT 0,\n  current_balance INTEGER NOT NULL DEFAULT 0,\n  reason TEXT NOT NULL,\n  activity_type TEXT NOT NULL CHECK (activity_type IN ('check_in', 'referral', 'class_attendance', 'milestone', 'bonus', 'redemption')),\n  reference_id UUID,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Create retention campaigns table\nCREATE TABLE public.retention_campaigns (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  name TEXT NOT NULL,\n  description TEXT,\n  campaign_type TEXT NOT NULL CHECK (campaign_type IN ('win_back', 'at_risk', 'loyalty_reward', 'milestone_celebration', 'birthday', 'anniversary')),\n  trigger_conditions JSONB NOT NULL DEFAULT '{}',\n  message_template TEXT NOT NULL,\n  reward_type TEXT CHECK (reward_type IN ('discount', 'free_classes', 'merchandise', 'loyalty_points', 'guest_pass')),\n  reward_value NUMERIC,\n  is_active BOOLEAN NOT NULL DEFAULT true,\n  start_date DATE,\n  end_date DATE,\n  created_by UUID NOT NULL,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Create campaign executions table\nCREATE TABLE public.campaign_executions (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  campaign_id UUID NOT NULL,\n  member_id UUID NOT NULL,\n  executed_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  status TEXT NOT NULL DEFAULT 'sent' CHECK (status IN ('sent', 'opened', 'clicked', 'redeemed', 'expired')),\n  reward_claimed BOOLEAN DEFAULT false,\n  reward_claimed_at TIMESTAMP WITH TIME ZONE,\n  notes TEXT,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Create member feedback table\nCREATE TABLE public.member_feedback (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  member_id UUID NOT NULL,\n  feedback_type TEXT NOT NULL CHECK (feedback_type IN ('general', 'service', 'facility', 'equipment', 'staff', 'class', 'suggestion', 'complaint')),\n  rating INTEGER CHECK (rating >= 1 AND rating <= 5),\n  title TEXT NOT NULL,\n  content TEXT NOT NULL,\n  is_anonymous BOOLEAN DEFAULT false,\n  status TEXT NOT NULL DEFAULT 'pending' CHECK (status IN ('pending', 'in_review', 'resolved', 'closed')),\n  assigned_to UUID,\n  response TEXT,\n  responded_by UUID,\n  responded_at TIMESTAMP WITH TIME ZONE,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Create referral programs table\nCREATE TABLE public.referral_programs (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  name TEXT NOT NULL,\n  description TEXT,\n  referrer_reward_type TEXT NOT NULL CHECK (referrer_reward_type IN ('discount', 'free_classes', 'cash_credit', 'loyalty_points', 'merchandise')),\n  referrer_reward_value NUMERIC NOT NULL,\n  referee_reward_type TEXT CHECK (referee_reward_type IN ('discount', 'free_classes', 'cash_credit', 'loyalty_points', 'merchandise')),\n  referee_reward_value NUMERIC,\n  max_referrals_per_member INTEGER,\n  program_start_date DATE NOT NULL,\n  program_end_date DATE,\n  is_active BOOLEAN NOT NULL DEFAULT true,\n  created_by UUID NOT NULL,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Create referral tracking table\nCREATE TABLE public.member_referrals (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  program_id UUID NOT NULL,\n  referrer_id UUID NOT NULL,\n  referee_email TEXT NOT NULL,\n  referee_name TEXT,\n  referral_code TEXT,\n  status TEXT NOT NULL DEFAULT 'pending' CHECK (status IN ('pending', 'signed_up', 'converted', 'rewarded', 'expired')),\n  signup_date TIMESTAMP WITH TIME ZONE,\n  conversion_date TIMESTAMP WITH TIME ZONE,\n  reward_given_date TIMESTAMP WITH TIME ZONE,\n  notes TEXT,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Enable RLS on all tables\nALTER TABLE public.member_engagement_history ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.loyalty_points ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.retention_campaigns ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.campaign_executions ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.member_feedback ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.referral_programs ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.member_referrals ENABLE ROW LEVEL SECURITY;\n\n-- RLS Policies for member_engagement_history\nCREATE POLICY \\"Members can view their own engagement history\\"\nON public.member_engagement_history\nFOR SELECT\nUSING (\n  member_id = auth.uid() OR\n  EXISTS (\n    SELECT 1 FROM profiles \n    WHERE profiles.id = auth.uid() \n    AND profiles.role IN ('owner', 'manager', 'staff')\n    AND profiles.organization_id = (\n      SELECT organization_id FROM profiles WHERE id = member_engagement_history.member_id\n    )\n  )\n);\n\nCREATE POLICY \\"Staff can manage engagement history\\"\nON public.member_engagement_history\nFOR ALL\nUSING (\n  EXISTS (\n    SELECT 1 FROM profiles \n    WHERE profiles.id = auth.uid() \n    AND profiles.role IN ('owner', 'manager', 'staff')\n    AND profiles.organization_id = (\n      SELECT organization_id FROM profiles WHERE id = member_engagement_history.member_id\n    )\n  )\n);\n\n-- RLS Policies for loyalty_points\nCREATE POLICY \\"Members can view their own loyalty points\\"\nON public.loyalty_points\nFOR SELECT\nUSING (\n  member_id = auth.uid() OR\n  EXISTS (\n    SELECT 1 FROM profiles \n    WHERE profiles.id = auth.uid() \n    AND profiles.role IN ('owner', 'manager', 'staff')\n    AND profiles.organization_id = (\n      SELECT organization_id FROM profiles WHERE id = loyalty_points.member_id\n    )\n  )\n);\n\nCREATE POLICY \\"Staff can manage loyalty points\\"\nON public.loyalty_points\nFOR ALL\nUSING (\n  EXISTS (\n    SELECT 1 FROM profiles \n    WHERE profiles.id = auth.uid() \n    AND profiles.role IN ('owner', 'manager', 'staff')\n    AND profiles.organization_id = (\n      SELECT organization_id FROM profiles WHERE id = loyalty_points.member_id\n    )\n  )\n);\n\n-- RLS Policies for retention_campaigns\nCREATE POLICY \\"Staff can manage retention campaigns\\"\nON public.retention_campaigns\nFOR ALL\nUSING (\n  organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() \n    AND role IN ('owner', 'manager', 'staff')\n  )\n);\n\n-- RLS Policies for campaign_executions\nCREATE POLICY \\"Members can view their campaign executions\\"\nON public.campaign_executions\nFOR SELECT\nUSING (\n  member_id = auth.uid() OR\n  EXISTS (\n    SELECT 1 FROM profiles \n    WHERE profiles.id = auth.uid() \n    AND profiles.role IN ('owner', 'manager', 'staff')\n    AND profiles.organization_id = (\n      SELECT organization_id FROM profiles WHERE id = campaign_executions.member_id\n    )\n  )\n);\n\nCREATE POLICY \\"Staff can manage campaign executions\\"\nON public.campaign_executions\nFOR ALL\nUSING (\n  EXISTS (\n    SELECT 1 FROM profiles \n    WHERE profiles.id = auth.uid() \n    AND profiles.role IN ('owner', 'manager', 'staff')\n    AND profiles.organization_id = (\n      SELECT organization_id FROM profiles WHERE id = campaign_executions.member_id\n    )\n  )\n);\n\n-- RLS Policies for member_feedback\nCREATE POLICY \\"Members can create and view their own feedback\\"\nON public.member_feedback\nFOR ALL\nUSING (\n  member_id = auth.uid() OR\n  EXISTS (\n    SELECT 1 FROM profiles \n    WHERE profiles.id = auth.uid() \n    AND profiles.role IN ('owner', 'manager', 'staff')\n    AND profiles.organization_id = (\n      SELECT organization_id FROM profiles WHERE id = member_feedback.member_id\n    )\n  )\n);\n\n-- RLS Policies for referral_programs\nCREATE POLICY \\"Users can view referral programs in their organization\\"\nON public.referral_programs\nFOR SELECT\nUSING (\n  organization_id IN (\n    SELECT organization_id FROM profiles WHERE id = auth.uid()\n  )\n);\n\nCREATE POLICY \\"Staff can manage referral programs\\"\nON public.referral_programs\nFOR ALL\nUSING (\n  organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() \n    AND role IN ('owner', 'manager', 'staff')\n  )\n);\n\n-- RLS Policies for member_referrals\nCREATE POLICY \\"Members can view their own referrals\\"\nON public.member_referrals\nFOR SELECT\nUSING (\n  referrer_id = auth.uid() OR\n  EXISTS (\n    SELECT 1 FROM profiles \n    WHERE profiles.id = auth.uid() \n    AND profiles.role IN ('owner', 'manager', 'staff')\n    AND profiles.organization_id = (\n      SELECT organization_id FROM profiles WHERE id = member_referrals.referrer_id\n    )\n  )\n);\n\nCREATE POLICY \\"Members can create referrals\\"\nON public.member_referrals\nFOR INSERT\nWITH CHECK (referrer_id = auth.uid());\n\nCREATE POLICY \\"Staff can manage member referrals\\"\nON public.member_referrals\nFOR ALL\nUSING (\n  EXISTS (\n    SELECT 1 FROM profiles \n    WHERE profiles.id = auth.uid() \n    AND profiles.role IN ('owner', 'manager', 'staff')\n    AND profiles.organization_id = (\n      SELECT organization_id FROM profiles WHERE id = member_referrals.referrer_id\n    )\n  )\n);\n\n-- Add updated_at triggers\nCREATE TRIGGER update_loyalty_points_updated_at\nBEFORE UPDATE ON public.loyalty_points\nFOR EACH ROW\nEXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_retention_campaigns_updated_at\nBEFORE UPDATE ON public.retention_campaigns\nFOR EACH ROW\nEXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_member_feedback_updated_at\nBEFORE UPDATE ON public.member_feedback\nFOR EACH ROW\nEXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_referral_programs_updated_at\nBEFORE UPDATE ON public.referral_programs\nFOR EACH ROW\nEXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_member_referrals_updated_at\nBEFORE UPDATE ON public.member_referrals\nFOR EACH ROW\nEXECUTE FUNCTION public.update_updated_at_column();\n\n-- Create indexes for better performance\nCREATE INDEX idx_member_engagement_history_member_id ON public.member_engagement_history(member_id);\nCREATE INDEX idx_member_engagement_history_type_date ON public.member_engagement_history(engagement_type, created_at);\nCREATE INDEX idx_loyalty_points_member_id ON public.loyalty_points(member_id);\nCREATE INDEX idx_loyalty_points_activity_type ON public.loyalty_points(activity_type, created_at);\nCREATE INDEX idx_campaign_executions_member_campaign ON public.campaign_executions(member_id, campaign_id);\nCREATE INDEX idx_member_feedback_status ON public.member_feedback(status, created_at);\nCREATE INDEX idx_member_referrals_referrer ON public.member_referrals(referrer_id, status);\n\n-- Create view for member engagement summary\nCREATE OR REPLACE VIEW member_engagement_summary AS\nSELECT \n  p.id as member_id,\n  p.first_name,\n  p.last_name,\n  p.email,\n  COUNT(meh.id) as total_engagements,\n  COUNT(CASE WHEN meh.engagement_type = 'check_in' THEN 1 END) as check_ins,\n  COUNT(CASE WHEN meh.engagement_type = 'class_booking' THEN 1 END) as class_bookings,\n  COUNT(CASE WHEN meh.created_at >= CURRENT_DATE - INTERVAL '30 days' THEN 1 END) as engagements_last_30_days,\n  MAX(meh.created_at) as last_engagement,\n  COALESCE(SUM(lp.current_balance), 0) as loyalty_points_balance\nFROM profiles p\nLEFT JOIN member_engagement_history meh ON p.id = meh.member_id\nLEFT JOIN loyalty_points lp ON p.id = lp.member_id\nWHERE p.role = 'member'\nGROUP BY p.id, p.first_name, p.last_name, p.email;"}		pearson.performance@gmail.com	\N	\N
20250827093438	{"-- Create analytics tables for comprehensive reporting\n\n-- Create member analytics snapshot table\nCREATE TABLE public.member_analytics_snapshots (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  snapshot_date DATE NOT NULL,\n  total_members INTEGER NOT NULL DEFAULT 0,\n  active_members INTEGER NOT NULL DEFAULT 0,\n  new_members INTEGER NOT NULL DEFAULT 0,\n  churned_members INTEGER NOT NULL DEFAULT 0,\n  average_visits_per_member NUMERIC(5,2) DEFAULT 0,\n  retention_rate NUMERIC(5,2) DEFAULT 0,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  UNIQUE(organization_id, snapshot_date)\n);\n\n-- Create revenue analytics table\nCREATE TABLE public.revenue_analytics (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  period_start DATE NOT NULL,\n  period_end DATE NOT NULL,\n  period_type TEXT NOT NULL CHECK (period_type IN ('daily', 'weekly', 'monthly', 'quarterly', 'yearly')),\n  total_revenue NUMERIC(10,2) NOT NULL DEFAULT 0,\n  membership_revenue NUMERIC(10,2) NOT NULL DEFAULT 0,\n  class_revenue NUMERIC(10,2) NOT NULL DEFAULT 0,\n  other_revenue NUMERIC(10,2) NOT NULL DEFAULT 0,\n  refunds NUMERIC(10,2) NOT NULL DEFAULT 0,\n  net_revenue NUMERIC(10,2) NOT NULL DEFAULT 0,\n  transaction_count INTEGER NOT NULL DEFAULT 0,\n  average_transaction_value NUMERIC(10,2) NOT NULL DEFAULT 0,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  UNIQUE(organization_id, period_start, period_end, period_type)\n);\n\n-- Create class analytics table\nCREATE TABLE public.class_analytics (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  class_id UUID,\n  instructor_id UUID,\n  class_date DATE NOT NULL,\n  class_name TEXT NOT NULL,\n  instructor_name TEXT,\n  capacity INTEGER NOT NULL DEFAULT 0,\n  bookings INTEGER NOT NULL DEFAULT 0,\n  attendance INTEGER NOT NULL DEFAULT 0,\n  no_shows INTEGER NOT NULL DEFAULT 0,\n  cancellations INTEGER NOT NULL DEFAULT 0,\n  utilization_rate NUMERIC(5,2) NOT NULL DEFAULT 0,\n  attendance_rate NUMERIC(5,2) NOT NULL DEFAULT 0,\n  revenue NUMERIC(10,2) DEFAULT 0,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Create marketing analytics table  \nCREATE TABLE public.marketing_analytics (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  campaign_id UUID,\n  campaign_type TEXT NOT NULL,\n  campaign_name TEXT NOT NULL,\n  period_start DATE NOT NULL,\n  period_end DATE NOT NULL,\n  impressions INTEGER DEFAULT 0,\n  clicks INTEGER DEFAULT 0,\n  conversions INTEGER DEFAULT 0,\n  leads_generated INTEGER DEFAULT 0,\n  cost NUMERIC(10,2) DEFAULT 0,\n  revenue NUMERIC(10,2) DEFAULT 0,\n  roi NUMERIC(8,2) DEFAULT 0,\n  click_through_rate NUMERIC(5,2) DEFAULT 0,\n  conversion_rate NUMERIC(5,2) DEFAULT 0,\n  cost_per_lead NUMERIC(10,2) DEFAULT 0,\n  customer_acquisition_cost NUMERIC(10,2) DEFAULT 0,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Create staff performance analytics table\nCREATE TABLE public.staff_performance_analytics (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  staff_id UUID NOT NULL,\n  period_start DATE NOT NULL,\n  period_end DATE NOT NULL,\n  classes_taught INTEGER DEFAULT 0,\n  total_class_revenue NUMERIC(10,2) DEFAULT 0,\n  average_class_utilization NUMERIC(5,2) DEFAULT 0,\n  member_satisfaction_score NUMERIC(3,2) DEFAULT 0,\n  leads_converted INTEGER DEFAULT 0,\n  tours_conducted INTEGER DEFAULT 0,\n  sales_made INTEGER DEFAULT 0,\n  total_sales_revenue NUMERIC(10,2) DEFAULT 0,\n  commission_earned NUMERIC(10,2) DEFAULT 0,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  UNIQUE(organization_id, staff_id, period_start, period_end)\n);\n\n-- Create cohort analysis table for member retention\nCREATE TABLE public.member_cohorts (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  cohort_period TEXT NOT NULL, -- e.g., \\"2024-01\\", \\"2024-Q1\\"\n  cohort_size INTEGER NOT NULL DEFAULT 0,\n  month_1_retained INTEGER DEFAULT 0,\n  month_2_retained INTEGER DEFAULT 0,\n  month_3_retained INTEGER DEFAULT 0,\n  month_6_retained INTEGER DEFAULT 0,\n  month_12_retained INTEGER DEFAULT 0,\n  month_1_rate NUMERIC(5,2) DEFAULT 0,\n  month_2_rate NUMERIC(5,2) DEFAULT 0,\n  month_3_rate NUMERIC(5,2) DEFAULT 0,\n  month_6_rate NUMERIC(5,2) DEFAULT 0,\n  month_12_rate NUMERIC(5,2) DEFAULT 0,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  UNIQUE(organization_id, cohort_period)\n);\n\n-- Create KPI tracking table\nCREATE TABLE public.kpi_metrics (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  metric_name TEXT NOT NULL,\n  metric_category TEXT NOT NULL CHECK (metric_category IN ('financial', 'operational', 'marketing', 'member_engagement', 'staff')),\n  metric_value NUMERIC(15,2) NOT NULL,\n  target_value NUMERIC(15,2),\n  metric_unit TEXT, -- e.g., 'currency', 'percentage', 'count'\n  period_start DATE NOT NULL,\n  period_end DATE NOT NULL,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Enable RLS on all analytics tables\nALTER TABLE public.member_analytics_snapshots ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.revenue_analytics ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.class_analytics ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.marketing_analytics ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.staff_performance_analytics ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.member_cohorts ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.kpi_metrics ENABLE ROW LEVEL SECURITY;\n\n-- RLS Policies for analytics tables (Staff can view analytics for their organization)\nCREATE POLICY \\"Staff can view member analytics\\"\nON public.member_analytics_snapshots\nFOR SELECT\nUSING (\n  organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() \n    AND role IN ('owner', 'manager', 'staff')\n  )\n);\n\nCREATE POLICY \\"Staff can manage member analytics\\"\nON public.member_analytics_snapshots\nFOR ALL\nUSING (\n  organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() \n    AND role IN ('owner', 'manager')\n  )\n);\n\nCREATE POLICY \\"Staff can view revenue analytics\\"\nON public.revenue_analytics\nFOR SELECT\nUSING (\n  organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() \n    AND role IN ('owner', 'manager', 'staff')\n  )\n);\n\nCREATE POLICY \\"Staff can manage revenue analytics\\"\nON public.revenue_analytics\nFOR ALL\nUSING (\n  organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() \n    AND role IN ('owner', 'manager')\n  )\n);\n\nCREATE POLICY \\"Staff can view class analytics\\"\nON public.class_analytics\nFOR SELECT\nUSING (\n  organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() \n    AND role IN ('owner', 'manager', 'staff', 'trainer')\n  )\n);\n\nCREATE POLICY \\"Staff can manage class analytics\\"\nON public.class_analytics\nFOR ALL\nUSING (\n  organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() \n    AND role IN ('owner', 'manager')\n  )\n);\n\nCREATE POLICY \\"Staff can view marketing analytics\\"\nON public.marketing_analytics\nFOR SELECT\nUSING (\n  organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() \n    AND role IN ('owner', 'manager', 'staff')\n  )\n);\n\nCREATE POLICY \\"Staff can manage marketing analytics\\"\nON public.marketing_analytics\nFOR ALL\nUSING (\n  organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() \n    AND role IN ('owner', 'manager')\n  )\n);\n\nCREATE POLICY \\"Staff can view staff performance analytics\\"\nON public.staff_performance_analytics\nFOR SELECT\nUSING (\n  organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() \n    AND role IN ('owner', 'manager', 'staff')\n  ) OR staff_id = auth.uid()\n);\n\nCREATE POLICY \\"Managers can manage staff performance analytics\\"\nON public.staff_performance_analytics\nFOR ALL\nUSING (\n  organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() \n    AND role IN ('owner', 'manager')\n  )\n);\n\nCREATE POLICY \\"Staff can view member cohorts\\"\nON public.member_cohorts\nFOR SELECT\nUSING (\n  organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() \n    AND role IN ('owner', 'manager', 'staff')\n  )\n);\n\nCREATE POLICY \\"Managers can manage member cohorts\\"\nON public.member_cohorts\nFOR ALL\nUSING (\n  organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() \n    AND role IN ('owner', 'manager')\n  )\n);\n\nCREATE POLICY \\"Staff can view KPI metrics\\"\nON public.kpi_metrics\nFOR SELECT\nUSING (\n  organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() \n    AND role IN ('owner', 'manager', 'staff')\n  )\n);\n\nCREATE POLICY \\"Managers can manage KPI metrics\\"\nON public.kpi_metrics\nFOR ALL\nUSING (\n  organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() \n    AND role IN ('owner', 'manager')\n  )\n);\n\n-- Add updated_at triggers\nCREATE TRIGGER update_revenue_analytics_updated_at\nBEFORE UPDATE ON public.revenue_analytics\nFOR EACH ROW\nEXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_marketing_analytics_updated_at\nBEFORE UPDATE ON public.marketing_analytics\nFOR EACH ROW\nEXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_staff_performance_analytics_updated_at\nBEFORE UPDATE ON public.staff_performance_analytics\nFOR EACH ROW\nEXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_member_cohorts_updated_at\nBEFORE UPDATE ON public.member_cohorts\nFOR EACH ROW\nEXECUTE FUNCTION public.update_updated_at_column();\n\n-- Create indexes for better performance\nCREATE INDEX idx_member_analytics_org_date ON public.member_analytics_snapshots(organization_id, snapshot_date);\nCREATE INDEX idx_revenue_analytics_org_period ON public.revenue_analytics(organization_id, period_start, period_end);\nCREATE INDEX idx_class_analytics_org_date ON public.class_analytics(organization_id, class_date);\nCREATE INDEX idx_marketing_analytics_org_period ON public.marketing_analytics(organization_id, period_start);\nCREATE INDEX idx_staff_performance_org_period ON public.staff_performance_analytics(organization_id, period_start);\nCREATE INDEX idx_kpi_metrics_org_category_period ON public.kpi_metrics(organization_id, metric_category, period_start);"}		pearson.performance@gmail.com	\N	\N
20250827094447	{"-- Create class waitlists table\nCREATE TABLE public.class_waitlists (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  class_id UUID NOT NULL,\n  member_id UUID NOT NULL,\n  joined_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  priority_order INTEGER NOT NULL DEFAULT 1,\n  status TEXT NOT NULL DEFAULT 'waiting',\n  notified_at TIMESTAMP WITH TIME ZONE,\n  expires_at TIMESTAMP WITH TIME ZONE,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  UNIQUE(class_id, member_id)\n);\n\n-- Enable RLS for class waitlists\nALTER TABLE public.class_waitlists ENABLE ROW LEVEL SECURITY;\n\n-- Create policies for class waitlists\nCREATE POLICY \\"Members can view their own waitlist entries\\" \nON public.class_waitlists \nFOR SELECT \nUSING (\n  member_id = auth.uid() OR \n  EXISTS (\n    SELECT 1 FROM profiles \n    WHERE profiles.id = auth.uid() \n    AND profiles.role IN ('owner', 'manager', 'staff', 'trainer')\n    AND profiles.organization_id = (\n      SELECT profiles.organization_id \n      FROM profiles \n      WHERE profiles.id = class_waitlists.member_id\n    )\n  )\n);\n\nCREATE POLICY \\"Members can join waitlists\\" \nON public.class_waitlists \nFOR INSERT \nWITH CHECK (\n  member_id = auth.uid() AND\n  EXISTS (\n    SELECT 1 FROM classes \n    WHERE classes.id = class_waitlists.class_id\n    AND classes.organization_id = (\n      SELECT profiles.organization_id \n      FROM profiles \n      WHERE profiles.id = auth.uid()\n    )\n  )\n);\n\nCREATE POLICY \\"Staff can manage waitlists\\" \nON public.class_waitlists \nFOR ALL \nUSING (\n  EXISTS (\n    SELECT 1 FROM profiles \n    WHERE profiles.id = auth.uid() \n    AND profiles.role IN ('owner', 'manager', 'staff', 'trainer')\n    AND profiles.organization_id = (\n      SELECT classes.organization_id \n      FROM classes \n      WHERE classes.id = class_waitlists.class_id\n    )\n  )\n);\n\n-- Create function to automatically update priority order\nCREATE OR REPLACE FUNCTION public.update_waitlist_priority()\nRETURNS TRIGGER AS $$\nBEGIN\n  -- Set priority order based on join time\n  IF TG_OP = 'INSERT' THEN\n    NEW.priority_order := COALESCE(\n      (SELECT MAX(priority_order) + 1 FROM class_waitlists WHERE class_id = NEW.class_id),\n      1\n    );\n    RETURN NEW;\n  END IF;\n  RETURN NULL;\nEND;\n$$ LANGUAGE plpgsql;\n\n-- Create trigger for waitlist priority\nCREATE TRIGGER set_waitlist_priority\n  BEFORE INSERT ON public.class_waitlists\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_waitlist_priority();\n\n-- Create function to promote from waitlist when booking is cancelled\nCREATE OR REPLACE FUNCTION public.promote_from_waitlist()\nRETURNS TRIGGER AS $$\nDECLARE\n  next_member_id UUID;\n  class_capacity INTEGER;\n  current_bookings INTEGER;\nBEGIN\n  -- Only process when a booking is cancelled\n  IF TG_OP = 'UPDATE' AND OLD.status = 'booked' AND NEW.status = 'cancelled' THEN\n    -- Check if there are people on the waitlist for this class\n    SELECT member_id INTO next_member_id\n    FROM class_waitlists \n    WHERE class_id = NEW.class_id \n    AND status = 'waiting'\n    ORDER BY priority_order ASC, joined_at ASC\n    LIMIT 1;\n    \n    IF next_member_id IS NOT NULL THEN\n      -- Get class capacity and current bookings\n      SELECT max_capacity INTO class_capacity\n      FROM classes \n      WHERE id = NEW.class_id;\n      \n      SELECT COUNT(*) INTO current_bookings\n      FROM class_bookings \n      WHERE class_id = NEW.class_id \n      AND status = 'booked';\n      \n      -- If there's space, promote the first person from waitlist\n      IF current_bookings < class_capacity THEN\n        -- Create booking for waitlisted member\n        INSERT INTO class_bookings (class_id, member_id, status, booked_at)\n        VALUES (NEW.class_id, next_member_id, 'booked', now());\n        \n        -- Update waitlist status\n        UPDATE class_waitlists \n        SET status = 'promoted', notified_at = now()\n        WHERE class_id = NEW.class_id \n        AND member_id = next_member_id;\n      END IF;\n    END IF;\n  END IF;\n  \n  RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql;\n\n-- Create trigger for automatic waitlist promotion\nCREATE TRIGGER promote_waitlist_on_cancellation\n  AFTER UPDATE ON public.class_bookings\n  FOR EACH ROW\n  EXECUTE FUNCTION public.promote_from_waitlist();\n\n-- Add updated_at trigger for waitlists\nCREATE TRIGGER update_class_waitlists_updated_at\n  BEFORE UPDATE ON public.class_waitlists\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\n-- Create indexes for performance\nCREATE INDEX idx_class_waitlists_class_id ON public.class_waitlists(class_id);\nCREATE INDEX idx_class_waitlists_member_id ON public.class_waitlists(member_id);\nCREATE INDEX idx_class_waitlists_priority ON public.class_waitlists(class_id, priority_order, joined_at);"}		pearson.performance@gmail.com	\N	\N
20250827104334	{"-- Fix function search path security issues\n\n-- Update waitlist priority function with proper search path\nCREATE OR REPLACE FUNCTION public.update_waitlist_priority()\nRETURNS TRIGGER AS $$\nBEGIN\n  -- Set priority order based on join time\n  IF TG_OP = 'INSERT' THEN\n    NEW.priority_order := COALESCE(\n      (SELECT MAX(priority_order) + 1 FROM class_waitlists WHERE class_id = NEW.class_id),\n      1\n    );\n    RETURN NEW;\n  END IF;\n  RETURN NULL;\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER SET search_path = 'public';\n\n-- Update promote from waitlist function with proper search path\nCREATE OR REPLACE FUNCTION public.promote_from_waitlist()\nRETURNS TRIGGER AS $$\nDECLARE\n  next_member_id UUID;\n  class_capacity INTEGER;\n  current_bookings INTEGER;\nBEGIN\n  -- Only process when a booking is cancelled\n  IF TG_OP = 'UPDATE' AND OLD.status = 'booked' AND NEW.status = 'cancelled' THEN\n    -- Check if there are people on the waitlist for this class\n    SELECT member_id INTO next_member_id\n    FROM class_waitlists \n    WHERE class_id = NEW.class_id \n    AND status = 'waiting'\n    ORDER BY priority_order ASC, joined_at ASC\n    LIMIT 1;\n    \n    IF next_member_id IS NOT NULL THEN\n      -- Get class capacity and current bookings\n      SELECT max_capacity INTO class_capacity\n      FROM classes \n      WHERE id = NEW.class_id;\n      \n      SELECT COUNT(*) INTO current_bookings\n      FROM class_bookings \n      WHERE class_id = NEW.class_id \n      AND status = 'booked';\n      \n      -- If there's space, promote the first person from waitlist\n      IF current_bookings < class_capacity THEN\n        -- Create booking for waitlisted member\n        INSERT INTO class_bookings (class_id, member_id, status, booked_at)\n        VALUES (NEW.class_id, next_member_id, 'booked', now());\n        \n        -- Update waitlist status\n        UPDATE class_waitlists \n        SET status = 'promoted', notified_at = now()\n        WHERE class_id = NEW.class_id \n        AND member_id = next_member_id;\n      END IF;\n    END IF;\n  END IF;\n  \n  RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER SET search_path = 'public';"}		pearson.performance@gmail.com	\N	\N
20250827105958	{"-- Create notifications table\nCREATE TABLE public.notifications (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  member_id UUID NOT NULL,\n  type TEXT NOT NULL DEFAULT 'general',\n  title TEXT NOT NULL,\n  message TEXT NOT NULL,\n  status TEXT NOT NULL DEFAULT 'unread',\n  priority TEXT NOT NULL DEFAULT 'normal',\n  scheduled_for TIMESTAMP WITH TIME ZONE,\n  sent_at TIMESTAMP WITH TIME ZONE,\n  read_at TIMESTAMP WITH TIME ZONE,\n  metadata JSONB DEFAULT '{}',\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Enable RLS\nALTER TABLE public.notifications ENABLE ROW LEVEL SECURITY;\n\n-- Create RLS policies\nCREATE POLICY \\"Members can view their own notifications\\"\nON public.notifications\nFOR SELECT\nUSING (member_id = auth.uid());\n\nCREATE POLICY \\"Staff can manage all notifications in their organization\\"\nON public.notifications\nFOR ALL\nUSING (organization_id IN (\n  SELECT organization_id FROM profiles \n  WHERE id = auth.uid() \n  AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n));\n\n-- Create notification templates table\nCREATE TABLE public.notification_templates (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  name TEXT NOT NULL,\n  template_type TEXT NOT NULL,\n  subject TEXT NOT NULL,\n  content TEXT NOT NULL,\n  variables JSONB DEFAULT '{}',\n  is_active BOOLEAN NOT NULL DEFAULT true,\n  created_by UUID NOT NULL,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Enable RLS for templates\nALTER TABLE public.notification_templates ENABLE ROW LEVEL SECURITY;\n\nCREATE POLICY \\"Staff can manage notification templates\\"\nON public.notification_templates\nFOR ALL\nUSING (organization_id IN (\n  SELECT organization_id FROM profiles \n  WHERE id = auth.uid() \n  AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n));\n\n-- Create notification preferences table\nCREATE TABLE public.notification_preferences (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  member_id UUID NOT NULL UNIQUE,\n  email_enabled BOOLEAN NOT NULL DEFAULT true,\n  sms_enabled BOOLEAN NOT NULL DEFAULT false,\n  push_enabled BOOLEAN NOT NULL DEFAULT true,\n  class_reminders BOOLEAN NOT NULL DEFAULT true,\n  waitlist_updates BOOLEAN NOT NULL DEFAULT true,\n  membership_updates BOOLEAN NOT NULL DEFAULT true,\n  marketing_notifications BOOLEAN NOT NULL DEFAULT false,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Enable RLS for preferences\nALTER TABLE public.notification_preferences ENABLE ROW LEVEL SECURITY;\n\nCREATE POLICY \\"Members can manage their own notification preferences\\"\nON public.notification_preferences\nFOR ALL\nUSING (member_id = auth.uid());\n\n-- Create indexes for better performance\nCREATE INDEX idx_notifications_member_id ON public.notifications(member_id);\nCREATE INDEX idx_notifications_status ON public.notifications(status);\nCREATE INDEX idx_notifications_scheduled_for ON public.notifications(scheduled_for);\nCREATE INDEX idx_notifications_organization_id ON public.notifications(organization_id);\n\n-- Create updated_at trigger for notifications\nCREATE TRIGGER update_notifications_updated_at\n  BEFORE UPDATE ON public.notifications\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\n-- Create updated_at trigger for notification templates\nCREATE TRIGGER update_notification_templates_updated_at\n  BEFORE UPDATE ON public.notification_templates\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\n-- Create updated_at trigger for notification preferences\nCREATE TRIGGER update_notification_preferences_updated_at\n  BEFORE UPDATE ON public.notification_preferences\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\n-- Create function to create default notification preferences\nCREATE OR REPLACE FUNCTION public.create_default_notification_preferences()\nRETURNS TRIGGER\nLANGUAGE plpgsql\nSECURITY DEFINER\nSET search_path = 'public'\nAS $$\nBEGIN\n  -- Only create for members\n  IF NEW.role = 'member' THEN\n    INSERT INTO public.notification_preferences (member_id)\n    VALUES (NEW.id)\n    ON CONFLICT (member_id) DO NOTHING;\n  END IF;\n  \n  RETURN NEW;\nEND;\n$$;\n\n-- Create trigger to automatically create notification preferences for new members\nCREATE TRIGGER on_member_created_notification_preferences\n  AFTER INSERT ON public.profiles\n  FOR EACH ROW\n  EXECUTE FUNCTION public.create_default_notification_preferences();\n\n-- Create function to send class reminder notifications\nCREATE OR REPLACE FUNCTION public.create_class_reminder_notifications()\nRETURNS void\nLANGUAGE plpgsql\nSECURITY DEFINER\nSET search_path = 'public'\nAS $$\nDECLARE\n  class_record RECORD;\n  booking_record RECORD;\nBEGIN\n  -- Find classes starting in 2 hours that need reminders\n  FOR class_record IN \n    SELECT \n      c.id as class_id,\n      c.name as class_name,\n      c.scheduled_at,\n      c.organization_id,\n      l.name as location_name\n    FROM classes c\n    LEFT JOIN locations l ON c.location_id = l.id\n    WHERE c.scheduled_at BETWEEN \n      (now() + INTERVAL '1 hour 45 minutes') AND \n      (now() + INTERVAL '2 hours 15 minutes')\n  LOOP\n    -- Create notifications for all booked members\n    FOR booking_record IN\n      SELECT cb.member_id, p.first_name, p.last_name\n      FROM class_bookings cb\n      JOIN profiles p ON cb.member_id = p.id\n      JOIN notification_preferences np ON p.id = np.member_id\n      WHERE cb.class_id = class_record.class_id\n      AND cb.status = 'booked'\n      AND np.class_reminders = true\n      AND NOT EXISTS (\n        SELECT 1 FROM notifications n \n        WHERE n.member_id = cb.member_id \n        AND n.type = 'class_reminder'\n        AND n.metadata->>'class_id' = class_record.class_id::text\n      )\n    LOOP\n      INSERT INTO notifications (\n        organization_id,\n        member_id,\n        type,\n        title,\n        message,\n        metadata,\n        scheduled_for\n      ) VALUES (\n        class_record.organization_id,\n        booking_record.member_id,\n        'class_reminder',\n        'Class Reminder: ' || class_record.class_name,\n        'Don''t forget! Your class \\"' || class_record.class_name || '\\" starts at ' || \n        to_char(class_record.scheduled_at, 'HH24:MI') || \n        COALESCE(' at ' || class_record.location_name, '') || '. See you there!',\n        jsonb_build_object(\n          'class_id', class_record.class_id,\n          'class_name', class_record.class_name,\n          'scheduled_at', class_record.scheduled_at\n        ),\n        now()\n      );\n    END LOOP;\n  END LOOP;\nEND;\n$$;\n\n-- Create function to send waitlist promotion notifications\nCREATE OR REPLACE FUNCTION public.create_waitlist_promotion_notification()\nRETURNS TRIGGER\nLANGUAGE plpgsql\nSECURITY DEFINER\nSET search_path = 'public'\nAS $$\nDECLARE\n  class_info RECORD;\n  member_info RECORD;\n  org_id UUID;\nBEGIN\n  -- Only process waitlist promotions\n  IF TG_OP = 'UPDATE' AND OLD.status = 'waiting' AND NEW.status = 'promoted' THEN\n    -- Get class and member information\n    SELECT c.name, c.scheduled_at, c.organization_id, l.name as location_name\n    INTO class_info\n    FROM classes c\n    LEFT JOIN locations l ON c.location_id = l.id\n    WHERE c.id = NEW.class_id;\n    \n    SELECT first_name, last_name, organization_id\n    INTO member_info\n    FROM profiles\n    WHERE id = NEW.member_id;\n    \n    -- Create promotion notification\n    INSERT INTO notifications (\n      organization_id,\n      member_id,\n      type,\n      title,\n      message,\n      priority,\n      metadata,\n      scheduled_for\n    ) VALUES (\n      class_info.organization_id,\n      NEW.member_id,\n      'waitlist_promotion',\n      'Great News! You''re Off the Waitlist',\n      'A spot opened up in \\"' || class_info.name || '\\" on ' || \n      to_char(class_info.scheduled_at, 'Mon, DD FMMonth at HH24:MI') ||\n      COALESCE(' at ' || class_info.location_name, '') || \n      '. You''ve been automatically booked!',\n      'high',\n      jsonb_build_object(\n        'class_id', NEW.class_id,\n        'class_name', class_info.name,\n        'scheduled_at', class_info.scheduled_at,\n        'waitlist_id', NEW.id\n      ),\n      now()\n    );\n  END IF;\n  \n  RETURN NEW;\nEND;\n$$;\n\n-- Create trigger for waitlist promotions\nCREATE TRIGGER on_waitlist_promotion_notification\n  AFTER UPDATE ON public.class_waitlists\n  FOR EACH ROW\n  EXECUTE FUNCTION public.create_waitlist_promotion_notification();\n\n-- Insert default notification templates\nINSERT INTO public.notification_templates (\n  organization_id, name, template_type, subject, content, variables, created_by\n) \nSELECT \n  p.organization_id,\n  'Class Reminder',\n  'class_reminder',\n  'Reminder: {{class_name}} starts soon!',\n  'Hi {{member_name}}, your class \\"{{class_name}}\\" starts at {{class_time}} today. Don''t forget to bring your water bottle and towel!',\n  '{\\"class_name\\": \\"Class Name\\", \\"member_name\\": \\"Member Name\\", \\"class_time\\": \\"Class Time\\"}',\n  p.id\nFROM profiles p \nWHERE p.role IN ('owner', 'manager') \nAND p.organization_id IS NOT NULL\nON CONFLICT DO NOTHING;\n\nINSERT INTO public.notification_templates (\n  organization_id, name, template_type, subject, content, variables, created_by\n) \nSELECT \n  p.organization_id,\n  'Waitlist Promotion',\n  'waitlist_promotion',\n  'You''re off the waitlist for {{class_name}}!',\n  'Great news {{member_name}}! A spot opened up in \\"{{class_name}}\\" and you''ve been automatically enrolled. The class is on {{class_date}} at {{class_time}}.',\n  '{\\"class_name\\": \\"Class Name\\", \\"member_name\\": \\"Member Name\\", \\"class_date\\": \\"Class Date\\", \\"class_time\\": \\"Class Time\\"}',\n  p.id\nFROM profiles p \nWHERE p.role IN ('owner', 'manager') \nAND p.organization_id IS NOT NULL\nON CONFLICT DO NOTHING;"}		pearson.performance@gmail.com	\N	\N
20250827110035	{"-- Fix function search path security issues for existing functions\n\n-- Update promote_from_waitlist function \nCREATE OR REPLACE FUNCTION public.promote_from_waitlist()\n RETURNS trigger\n LANGUAGE plpgsql\n SECURITY DEFINER\n SET search_path TO 'public'\nAS $$\nDECLARE\n  next_member_id UUID;\n  class_capacity INTEGER;\n  current_bookings INTEGER;\nBEGIN\n  -- Only process when a booking is cancelled\n  IF TG_OP = 'UPDATE' AND OLD.status = 'booked' AND NEW.status = 'cancelled' THEN\n    -- Check if there are people on the waitlist for this class\n    SELECT member_id INTO next_member_id\n    FROM class_waitlists \n    WHERE class_id = NEW.class_id \n    AND status = 'waiting'\n    ORDER BY priority_order ASC, joined_at ASC\n    LIMIT 1;\n    \n    IF next_member_id IS NOT NULL THEN\n      -- Get class capacity and current bookings\n      SELECT max_capacity INTO class_capacity\n      FROM classes \n      WHERE id = NEW.class_id;\n      \n      SELECT COUNT(*) INTO current_bookings\n      FROM class_bookings \n      WHERE class_id = NEW.class_id \n      AND status = 'booked';\n      \n      -- If there's space, promote the first person from waitlist\n      IF current_bookings < class_capacity THEN\n        -- Create booking for waitlisted member\n        INSERT INTO class_bookings (class_id, member_id, status, booked_at)\n        VALUES (NEW.class_id, next_member_id, 'booked', now());\n        \n        -- Update waitlist status\n        UPDATE class_waitlists \n        SET status = 'promoted', notified_at = now()\n        WHERE class_id = NEW.class_id \n        AND member_id = next_member_id;\n      END IF;\n    END IF;\n  END IF;\n  \n  RETURN NEW;\nEND;\n$$;\n\n-- Update update_waitlist_priority function\nCREATE OR REPLACE FUNCTION public.update_waitlist_priority()\n RETURNS trigger\n LANGUAGE plpgsql\n SECURITY DEFINER\n SET search_path TO 'public'\nAS $$\nBEGIN\n  -- Set priority order based on join time\n  IF TG_OP = 'INSERT' THEN\n    NEW.priority_order := COALESCE(\n      (SELECT MAX(priority_order) + 1 FROM class_waitlists WHERE class_id = NEW.class_id),\n      1\n    );\n    RETURN NEW;\n  END IF;\n  RETURN NULL;\nEND;\n$$;"}		pearson.performance@gmail.com	\N	\N
20250828124438	{"-- Add staff management fields to profiles table\nALTER TABLE public.profiles \nADD COLUMN IF NOT EXISTS hire_date DATE,\nADD COLUMN IF NOT EXISTS hourly_rate DECIMAL(10,2),\nADD COLUMN IF NOT EXISTS status TEXT DEFAULT 'active' CHECK (status IN ('active', 'inactive', 'on_leave')),\nADD COLUMN IF NOT EXISTS certifications TEXT[],\nADD COLUMN IF NOT EXISTS employee_id TEXT UNIQUE,\nADD COLUMN IF NOT EXISTS department TEXT;\n\n-- Create staff schedules table\nCREATE TABLE IF NOT EXISTS public.staff_schedules (\n    id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n    staff_id UUID NOT NULL REFERENCES public.profiles(id) ON DELETE CASCADE,\n    organization_id UUID NOT NULL REFERENCES public.organizations(id) ON DELETE CASCADE,\n    day_of_week INTEGER NOT NULL CHECK (day_of_week >= 0 AND day_of_week <= 6), -- 0 = Sunday, 6 = Saturday\n    start_time TIME NOT NULL,\n    end_time TIME NOT NULL,\n    is_available BOOLEAN DEFAULT true,\n    break_start TIME,\n    break_end TIME,\n    notes TEXT,\n    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n    updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Enable RLS\nALTER TABLE public.staff_schedules ENABLE ROW LEVEL SECURITY;\n\n-- Create RLS policies for staff_schedules\nCREATE POLICY \\"Staff schedules are viewable by organization members\\" \nON public.staff_schedules \nFOR SELECT \nUSING (\n    EXISTS (\n        SELECT 1 FROM public.profiles \n        WHERE profiles.id = auth.uid() \n        AND profiles.organization_id = staff_schedules.organization_id\n    )\n);\n\nCREATE POLICY \\"Staff can manage their own schedules\\" \nON public.staff_schedules \nFOR ALL \nUSING (\n    staff_id = auth.uid() OR\n    EXISTS (\n        SELECT 1 FROM public.profiles \n        WHERE profiles.id = auth.uid() \n        AND profiles.organization_id = staff_schedules.organization_id\n        AND profiles.role IN ('owner', 'manager')\n    )\n);\n\n-- Create time tracking table\nCREATE TABLE IF NOT EXISTS public.time_entries (\n    id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n    staff_id UUID NOT NULL REFERENCES public.profiles(id) ON DELETE CASCADE,\n    organization_id UUID NOT NULL REFERENCES public.organizations(id) ON DELETE CASCADE,\n    clock_in TIMESTAMP WITH TIME ZONE NOT NULL,\n    clock_out TIMESTAMP WITH TIME ZONE,\n    break_start TIMESTAMP WITH TIME ZONE,\n    break_end TIMESTAMP WITH TIME ZONE,\n    hours_worked DECIMAL(5,2),\n    hourly_rate DECIMAL(10,2),\n    total_pay DECIMAL(10,2),\n    notes TEXT,\n    status TEXT DEFAULT 'active' CHECK (status IN ('active', 'completed', 'reviewed')),\n    approved_by UUID REFERENCES public.profiles(id),\n    approved_at TIMESTAMP WITH TIME ZONE,\n    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n    updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Enable RLS\nALTER TABLE public.time_entries ENABLE ROW LEVEL SECURITY;\n\n-- Create RLS policies for time_entries\nCREATE POLICY \\"Time entries are viewable by organization members\\" \nON public.time_entries \nFOR SELECT \nUSING (\n    staff_id = auth.uid() OR\n    EXISTS (\n        SELECT 1 FROM public.profiles \n        WHERE profiles.id = auth.uid() \n        AND profiles.organization_id = time_entries.organization_id\n        AND profiles.role IN ('owner', 'manager')\n    )\n);\n\nCREATE POLICY \\"Staff can create their own time entries\\" \nON public.time_entries \nFOR INSERT \nWITH CHECK (\n    staff_id = auth.uid() AND\n    EXISTS (\n        SELECT 1 FROM public.profiles \n        WHERE profiles.id = auth.uid() \n        AND profiles.organization_id = time_entries.organization_id\n    )\n);\n\nCREATE POLICY \\"Staff can update their own time entries\\" \nON public.time_entries \nFOR UPDATE \nUSING (\n    staff_id = auth.uid() OR\n    EXISTS (\n        SELECT 1 FROM public.profiles \n        WHERE profiles.id = auth.uid() \n        AND profiles.organization_id = time_entries.organization_id\n        AND profiles.role IN ('owner', 'manager')\n    )\n);\n\n-- Create payroll periods table\nCREATE TABLE IF NOT EXISTS public.payroll_periods (\n    id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n    organization_id UUID NOT NULL REFERENCES public.organizations(id) ON DELETE CASCADE,\n    start_date DATE NOT NULL,\n    end_date DATE NOT NULL,\n    status TEXT DEFAULT 'draft' CHECK (status IN ('draft', 'processing', 'completed', 'paid')),\n    total_amount DECIMAL(12,2),\n    notes TEXT,\n    created_by UUID NOT NULL REFERENCES public.profiles(id),\n    processed_at TIMESTAMP WITH TIME ZONE,\n    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n    updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n    UNIQUE(organization_id, start_date, end_date)\n);\n\n-- Enable RLS\nALTER TABLE public.payroll_periods ENABLE ROW LEVEL SECURITY;\n\n-- Create RLS policies for payroll_periods\nCREATE POLICY \\"Payroll periods are viewable by managers\\" \nON public.payroll_periods \nFOR SELECT \nUSING (\n    EXISTS (\n        SELECT 1 FROM public.profiles \n        WHERE profiles.id = auth.uid() \n        AND profiles.organization_id = payroll_periods.organization_id\n        AND profiles.role IN ('owner', 'manager')\n    )\n);\n\nCREATE POLICY \\"Managers can manage payroll periods\\" \nON public.payroll_periods \nFOR ALL \nUSING (\n    EXISTS (\n        SELECT 1 FROM public.profiles \n        WHERE profiles.id = auth.uid() \n        AND profiles.organization_id = payroll_periods.organization_id\n        AND profiles.role IN ('owner', 'manager')\n    )\n);\n\n-- Create function to update timestamps\nCREATE OR REPLACE FUNCTION public.update_updated_at_column()\nRETURNS TRIGGER AS $$\nBEGIN\n    NEW.updated_at = now();\n    RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql;\n\n-- Create triggers for automatic timestamp updates\nCREATE TRIGGER update_staff_schedules_updated_at\n    BEFORE UPDATE ON public.staff_schedules\n    FOR EACH ROW\n    EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_time_entries_updated_at\n    BEFORE UPDATE ON public.time_entries\n    FOR EACH ROW\n    EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_payroll_periods_updated_at\n    BEFORE UPDATE ON public.payroll_periods\n    FOR EACH ROW\n    EXECUTE FUNCTION public.update_updated_at_column();\n\n-- Create indexes for better performance\nCREATE INDEX IF NOT EXISTS idx_staff_schedules_staff_id ON public.staff_schedules(staff_id);\nCREATE INDEX IF NOT EXISTS idx_staff_schedules_organization_id ON public.staff_schedules(organization_id);\nCREATE INDEX IF NOT EXISTS idx_time_entries_staff_id ON public.time_entries(staff_id);\nCREATE INDEX IF NOT EXISTS idx_time_entries_organization_id ON public.time_entries(organization_id);\nCREATE INDEX IF NOT EXISTS idx_time_entries_dates ON public.time_entries(clock_in, clock_out);\nCREATE INDEX IF NOT EXISTS idx_payroll_periods_organization_id ON public.payroll_periods(organization_id);\nCREATE INDEX IF NOT EXISTS idx_payroll_periods_dates ON public.payroll_periods(start_date, end_date);"}		pearson.performance@gmail.com	\N	\N
20250828125232	{"-- Create marketing campaigns table\nCREATE TABLE IF NOT EXISTS public.marketing_campaigns (\n    id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n    organization_id UUID NOT NULL REFERENCES public.organizations(id) ON DELETE CASCADE,\n    name TEXT NOT NULL,\n    campaign_type TEXT NOT NULL CHECK (campaign_type IN ('email', 'sms', 'push', 'in_app')),\n    status TEXT NOT NULL DEFAULT 'draft' CHECK (status IN ('draft', 'scheduled', 'active', 'paused', 'completed', 'cancelled')),\n    subject TEXT,\n    content TEXT NOT NULL,\n    target_segment TEXT NOT NULL DEFAULT 'all_members' CHECK (target_segment IN ('all_members', 'new_members', 'active_members', 'at_risk_members', 'vip_members', 'custom')),\n    custom_recipients UUID[],\n    scheduled_at TIMESTAMP WITH TIME ZONE,\n    sent_at TIMESTAMP WITH TIME ZONE,\n    sent_count INTEGER DEFAULT 0,\n    delivered_count INTEGER DEFAULT 0,\n    opened_count INTEGER DEFAULT 0,\n    clicked_count INTEGER DEFAULT 0,\n    unsubscribed_count INTEGER DEFAULT 0,\n    bounced_count INTEGER DEFAULT 0,\n    created_by UUID NOT NULL REFERENCES public.profiles(id),\n    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n    updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Enable RLS\nALTER TABLE public.marketing_campaigns ENABLE ROW LEVEL SECURITY;\n\n-- Create RLS policies for marketing_campaigns\nCREATE POLICY \\"Staff can manage marketing campaigns\\" \nON public.marketing_campaigns \nFOR ALL \nUSING (\n    organization_id IN (\n        SELECT profiles.organization_id\n        FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN ('owner', 'manager', 'staff')\n    )\n);\n\n-- Create campaign executions table (already exists, but add if missing)\n-- This tracks individual campaign sends to members\n\n-- Create loyalty program rules table\nCREATE TABLE IF NOT EXISTS public.loyalty_program_rules (\n    id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n    organization_id UUID NOT NULL REFERENCES public.organizations(id) ON DELETE CASCADE,\n    activity_type TEXT NOT NULL,\n    points_awarded INTEGER NOT NULL DEFAULT 0,\n    description TEXT,\n    is_active BOOLEAN DEFAULT true,\n    conditions JSONB,\n    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n    updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Enable RLS\nALTER TABLE public.loyalty_program_rules ENABLE ROW LEVEL SECURITY;\n\n-- Create RLS policies for loyalty_program_rules\nCREATE POLICY \\"Staff can manage loyalty rules\\" \nON public.loyalty_program_rules \nFOR ALL \nUSING (\n    organization_id IN (\n        SELECT profiles.organization_id\n        FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN ('owner', 'manager', 'staff')\n    )\n);\n\n-- Create loyalty rewards catalog table\nCREATE TABLE IF NOT EXISTS public.loyalty_rewards (\n    id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n    organization_id UUID NOT NULL REFERENCES public.organizations(id) ON DELETE CASCADE,\n    name TEXT NOT NULL,\n    description TEXT,\n    category TEXT NOT NULL DEFAULT 'general',\n    points_cost INTEGER NOT NULL,\n    is_active BOOLEAN DEFAULT true,\n    stock_quantity INTEGER,\n    redemption_limit INTEGER,\n    expiry_date DATE,\n    terms_conditions TEXT,\n    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n    updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Enable RLS\nALTER TABLE public.loyalty_rewards ENABLE ROW LEVEL SECURITY;\n\n-- Create RLS policies for loyalty_rewards\nCREATE POLICY \\"Staff can manage loyalty rewards\\" \nON public.loyalty_rewards \nFOR ALL \nUSING (\n    organization_id IN (\n        SELECT profiles.organization_id\n        FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN ('owner', 'manager', 'staff')\n    )\n);\n\nCREATE POLICY \\"Members can view available rewards\\" \nON public.loyalty_rewards \nFOR SELECT \nUSING (\n    is_active = true AND\n    organization_id IN (\n        SELECT profiles.organization_id\n        FROM profiles\n        WHERE profiles.id = auth.uid()\n    )\n);\n\n-- Create loyalty redemptions table\nCREATE TABLE IF NOT EXISTS public.loyalty_redemptions (\n    id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n    member_id UUID NOT NULL REFERENCES public.profiles(id) ON DELETE CASCADE,\n    reward_id UUID NOT NULL REFERENCES public.loyalty_rewards(id) ON DELETE CASCADE,\n    points_used INTEGER NOT NULL,\n    status TEXT NOT NULL DEFAULT 'pending' CHECK (status IN ('pending', 'approved', 'completed', 'cancelled')),\n    redeemed_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n    fulfilled_at TIMESTAMP WITH TIME ZONE,\n    fulfilled_by UUID REFERENCES public.profiles(id),\n    notes TEXT,\n    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n    updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Enable RLS\nALTER TABLE public.loyalty_redemptions ENABLE ROW LEVEL SECURITY;\n\n-- Create RLS policies for loyalty_redemptions\nCREATE POLICY \\"Members can view their own redemptions\\" \nON public.loyalty_redemptions \nFOR SELECT \nUSING (\n    member_id = auth.uid() OR\n    EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN ('owner', 'manager', 'staff')\n        AND profiles.organization_id = (\n            SELECT profiles_1.organization_id\n            FROM profiles profiles_1\n            WHERE profiles_1.id = loyalty_redemptions.member_id\n        )\n    )\n);\n\nCREATE POLICY \\"Members can create their own redemptions\\" \nON public.loyalty_redemptions \nFOR INSERT \nWITH CHECK (member_id = auth.uid());\n\nCREATE POLICY \\"Staff can manage redemptions\\" \nON public.loyalty_redemptions \nFOR ALL \nUSING (\n    EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN ('owner', 'manager', 'staff')\n        AND profiles.organization_id = (\n            SELECT profiles_1.organization_id\n            FROM profiles profiles_1\n            WHERE profiles_1.id = loyalty_redemptions.member_id\n        )\n    )\n);\n\n-- Create member segments table for marketing\nCREATE TABLE IF NOT EXISTS public.member_segments (\n    id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n    organization_id UUID NOT NULL REFERENCES public.organizations(id) ON DELETE CASCADE,\n    name TEXT NOT NULL,\n    description TEXT,\n    criteria JSONB NOT NULL,\n    member_count INTEGER DEFAULT 0,\n    last_calculated_at TIMESTAMP WITH TIME ZONE,\n    is_dynamic BOOLEAN DEFAULT true,\n    created_by UUID NOT NULL REFERENCES public.profiles(id),\n    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n    updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Enable RLS\nALTER TABLE public.member_segments ENABLE ROW LEVEL SECURITY;\n\n-- Create RLS policies for member_segments\nCREATE POLICY \\"Staff can manage member segments\\" \nON public.member_segments \nFOR ALL \nUSING (\n    organization_id IN (\n        SELECT profiles.organization_id\n        FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN ('owner', 'manager', 'staff')\n    )\n);\n\n-- Create triggers for automatic timestamp updates\nCREATE TRIGGER update_marketing_campaigns_updated_at\n    BEFORE UPDATE ON public.marketing_campaigns\n    FOR EACH ROW\n    EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_loyalty_program_rules_updated_at\n    BEFORE UPDATE ON public.loyalty_program_rules\n    FOR EACH ROW\n    EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_loyalty_rewards_updated_at\n    BEFORE UPDATE ON public.loyalty_rewards\n    FOR EACH ROW\n    EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_loyalty_redemptions_updated_at\n    BEFORE UPDATE ON public.loyalty_redemptions\n    FOR EACH ROW\n    EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_member_segments_updated_at\n    BEFORE UPDATE ON public.member_segments\n    FOR EACH ROW\n    EXECUTE FUNCTION public.update_updated_at_column();\n\n-- Create indexes for better performance\nCREATE INDEX IF NOT EXISTS idx_marketing_campaigns_organization_id ON public.marketing_campaigns(organization_id);\nCREATE INDEX IF NOT EXISTS idx_marketing_campaigns_status ON public.marketing_campaigns(status);\nCREATE INDEX IF NOT EXISTS idx_marketing_campaigns_scheduled_at ON public.marketing_campaigns(scheduled_at);\n\nCREATE INDEX IF NOT EXISTS idx_loyalty_program_rules_organization_id ON public.loyalty_program_rules(organization_id);\nCREATE INDEX IF NOT EXISTS idx_loyalty_program_rules_activity_type ON public.loyalty_program_rules(activity_type);\n\nCREATE INDEX IF NOT EXISTS idx_loyalty_rewards_organization_id ON public.loyalty_rewards(organization_id);\nCREATE INDEX IF NOT EXISTS idx_loyalty_rewards_category ON public.loyalty_rewards(category);\n\nCREATE INDEX IF NOT EXISTS idx_loyalty_redemptions_member_id ON public.loyalty_redemptions(member_id);\nCREATE INDEX IF NOT EXISTS idx_loyalty_redemptions_reward_id ON public.loyalty_redemptions(reward_id);\nCREATE INDEX IF NOT EXISTS idx_loyalty_redemptions_status ON public.loyalty_redemptions(status);\n\nCREATE INDEX IF NOT EXISTS idx_member_segments_organization_id ON public.member_segments(organization_id);"}		pearson.performance@gmail.com	\N	\N
20250828010140	{"-- Create messages table for internal communication\nCREATE TABLE public.messages (\n    id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n    sender_id UUID NOT NULL,\n    recipient_id UUID NOT NULL, \n    subject TEXT NOT NULL,\n    content TEXT NOT NULL,\n    is_read BOOLEAN NOT NULL DEFAULT false,\n    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n    updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Enable RLS\nALTER TABLE public.messages ENABLE ROW LEVEL SECURITY;\n\n-- Create policies for secure messaging\nCREATE POLICY \\"Users can view their sent messages\\" \nON public.messages \nFOR SELECT \nUSING (sender_id = auth.uid());\n\nCREATE POLICY \\"Users can view their received messages\\" \nON public.messages \nFOR SELECT \nUSING (recipient_id = auth.uid());\n\nCREATE POLICY \\"Users can send messages\\" \nON public.messages \nFOR INSERT \nWITH CHECK (sender_id = auth.uid());\n\nCREATE POLICY \\"Users can update their received messages\\" \nON public.messages \nFOR UPDATE \nUSING (recipient_id = auth.uid());\n\n-- Create trigger for automatic timestamp updates\nCREATE TRIGGER update_messages_updated_at\nBEFORE UPDATE ON public.messages\nFOR EACH ROW\nEXECUTE FUNCTION public.update_updated_at_column();"}		pearson.performance@gmail.com	\N	\N
20250828010909	{"-- Fix the member_engagement_summary view\nDROP VIEW IF EXISTS member_engagement_summary;\n\n-- Create improved member engagement summary view\nCREATE VIEW member_engagement_summary AS\nSELECT \n    p.id as member_id,\n    p.first_name,\n    p.last_name,\n    p.email,\n    p.organization_id,\n    p.join_date,\n    COALESCE(visit_stats.total_visits, 0) as total_visits,\n    COALESCE(visit_stats.visits_last_30_days, 0) as visits_last_30_days,\n    COALESCE(visit_stats.avg_visit_duration, 0) as avg_visit_duration_minutes,\n    COALESCE(class_stats.classes_attended, 0) as classes_attended,\n    COALESCE(class_stats.classes_booked_last_30, 0) as classes_booked_last_30,\n    CASE \n        WHEN visit_stats.last_visit_date >= CURRENT_DATE - INTERVAL '7 days' THEN 'active'\n        WHEN visit_stats.last_visit_date >= CURRENT_DATE - INTERVAL '30 days' THEN 'at_risk'\n        ELSE 'inactive'\n    END as engagement_status,\n    visit_stats.last_visit_date\nFROM profiles p\nLEFT JOIN (\n    SELECT \n        member_id,\n        COUNT(*) as total_visits,\n        COUNT(CASE WHEN checked_in_at >= CURRENT_DATE - INTERVAL '30 days' THEN 1 END) as visits_last_30_days,\n        AVG(EXTRACT(EPOCH FROM (checked_out_at - checked_in_at)) / 60) as avg_visit_duration,\n        MAX(checked_in_at) as last_visit_date\n    FROM check_ins \n    WHERE is_guest = false\n    GROUP BY member_id\n) visit_stats ON p.id = visit_stats.member_id\nLEFT JOIN (\n    SELECT \n        cb.member_id,\n        COUNT(*) as classes_attended,\n        COUNT(CASE WHEN cb.booked_at >= CURRENT_DATE - INTERVAL '30 days' THEN 1 END) as classes_booked_last_30\n    FROM class_bookings cb\n    WHERE cb.status = 'booked'\n    GROUP BY cb.member_id\n) class_stats ON p.id = class_stats.member_id\nWHERE p.role = 'member';\n\n-- Create daily snapshots table for trend analysis\nCREATE TABLE IF NOT EXISTS public.daily_analytics_snapshots (\n    id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n    organization_id UUID NOT NULL,\n    snapshot_date DATE NOT NULL DEFAULT CURRENT_DATE,\n    total_members INTEGER NOT NULL DEFAULT 0,\n    active_members INTEGER NOT NULL DEFAULT 0,\n    new_members_today INTEGER NOT NULL DEFAULT 0,\n    total_check_ins INTEGER NOT NULL DEFAULT 0,\n    total_revenue DECIMAL(10,2) NOT NULL DEFAULT 0,\n    classes_scheduled INTEGER NOT NULL DEFAULT 0,\n    class_bookings INTEGER NOT NULL DEFAULT 0,\n    class_attendance_rate DECIMAL(5,2) NOT NULL DEFAULT 0,\n    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n    UNIQUE(organization_id, snapshot_date)\n);\n\n-- Enable RLS on daily snapshots\nALTER TABLE public.daily_analytics_snapshots ENABLE ROW LEVEL SECURITY;\n\n-- RLS policies for daily snapshots\nCREATE POLICY \\"Organizations can view their analytics snapshots\\" \nON public.daily_analytics_snapshots \nFOR SELECT \nUSING (organization_id IN (\n    SELECT profiles.organization_id \n    FROM profiles \n    WHERE profiles.id = auth.uid()\n));\n\nCREATE POLICY \\"Staff can manage analytics snapshots\\" \nON public.daily_analytics_snapshots \nFOR ALL \nUSING (organization_id IN (\n    SELECT profiles.organization_id \n    FROM profiles \n    WHERE profiles.id = auth.uid() \n    AND profiles.role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n));"}		pearson.performance@gmail.com	\N	\N
20250828013833	{"-- Equipment & Facility Management Module\n-- Create equipment table for tracking gym equipment\nCREATE TABLE public.equipment (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  name TEXT NOT NULL,\n  equipment_type TEXT NOT NULL DEFAULT 'cardio', -- cardio, strength, functional, other\n  brand TEXT,\n  model TEXT,\n  serial_number TEXT,\n  purchase_date DATE,\n  purchase_price NUMERIC,\n  warranty_expiry DATE,\n  location_id UUID,\n  status TEXT NOT NULL DEFAULT 'active', -- active, maintenance, out_of_service, retired\n  last_maintenance_date DATE,\n  next_maintenance_date DATE,\n  maintenance_interval_days INTEGER DEFAULT 90,\n  usage_hours INTEGER DEFAULT 0,\n  notes TEXT,\n  specifications JSONB DEFAULT '{}',\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Create maintenance_schedules table for planned maintenance\nCREATE TABLE public.maintenance_schedules (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  equipment_id UUID NOT NULL,\n  maintenance_type TEXT NOT NULL DEFAULT 'routine', -- routine, preventive, repair, inspection\n  title TEXT NOT NULL,\n  description TEXT,\n  scheduled_date DATE NOT NULL,\n  estimated_duration_minutes INTEGER DEFAULT 60,\n  assigned_to UUID, -- staff member\n  priority TEXT NOT NULL DEFAULT 'medium', -- low, medium, high, urgent\n  status TEXT NOT NULL DEFAULT 'scheduled', -- scheduled, in_progress, completed, cancelled, overdue\n  completion_date TIMESTAMP WITH TIME ZONE,\n  completion_notes TEXT,\n  cost NUMERIC,\n  vendor_id UUID,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Create maintenance_logs table for maintenance history\nCREATE TABLE public.maintenance_logs (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  equipment_id UUID NOT NULL,\n  maintenance_schedule_id UUID,\n  performed_by UUID NOT NULL, -- staff member\n  maintenance_date TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  maintenance_type TEXT NOT NULL,\n  description TEXT NOT NULL,\n  parts_used TEXT[],\n  labor_hours NUMERIC,\n  cost NUMERIC,\n  next_maintenance_date DATE,\n  photos TEXT[], -- array of photo URLs\n  notes TEXT,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Create facility_areas table for different areas of the gym\nCREATE TABLE public.facility_areas (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  location_id UUID NOT NULL,\n  name TEXT NOT NULL,\n  area_type TEXT NOT NULL DEFAULT 'general', -- general, cardio, strength, class_room, locker_room, pool, sauna\n  square_footage INTEGER,\n  max_capacity INTEGER,\n  equipment_count INTEGER DEFAULT 0,\n  cleaning_frequency TEXT DEFAULT 'daily', -- daily, weekly, monthly\n  last_cleaned TIMESTAMP WITH TIME ZONE,\n  temperature_range TEXT, -- e.g., \\"68-72F\\"\n  special_requirements TEXT,\n  safety_notes TEXT,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Create incident_reports table for safety incidents\nCREATE TABLE public.incident_reports (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  location_id UUID,\n  reported_by UUID NOT NULL, -- staff or member\n  incident_date TIMESTAMP WITH TIME ZONE NOT NULL,\n  incident_type TEXT NOT NULL DEFAULT 'injury', -- injury, equipment_malfunction, property_damage, safety_violation, other\n  severity TEXT NOT NULL DEFAULT 'minor', -- minor, moderate, major, critical\n  description TEXT NOT NULL,\n  injured_person_name TEXT,\n  injured_person_type TEXT, -- member, staff, visitor\n  injured_person_id UUID, -- member or staff ID if applicable\n  equipment_involved UUID, -- equipment ID if applicable\n  area_involved UUID, -- facility_area ID if applicable\n  witnesses TEXT[],\n  actions_taken TEXT,\n  medical_attention_required BOOLEAN DEFAULT false,\n  medical_provider TEXT,\n  follow_up_required BOOLEAN DEFAULT false,\n  follow_up_date DATE,\n  insurance_notified BOOLEAN DEFAULT false,\n  insurance_claim_number TEXT,\n  status TEXT NOT NULL DEFAULT 'open', -- open, investigating, resolved, closed\n  resolved_by UUID,\n  resolved_at TIMESTAMP WITH TIME ZONE,\n  resolution_notes TEXT,\n  photos TEXT[], -- array of photo URLs\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Create vendors table for service providers\nCREATE TABLE public.vendors (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  name TEXT NOT NULL,\n  vendor_type TEXT NOT NULL DEFAULT 'maintenance', -- maintenance, cleaning, security, hvac, equipment_supplier, other\n  contact_name TEXT,\n  email TEXT,\n  phone TEXT,\n  address TEXT,\n  website TEXT,\n  license_number TEXT,\n  insurance_expiry DATE,\n  rating INTEGER CHECK (rating >= 1 AND rating <= 5),\n  preferred_vendor BOOLEAN DEFAULT false,\n  notes TEXT,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Create cleaning_schedules table for facility cleaning\nCREATE TABLE public.cleaning_schedules (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  area_id UUID NOT NULL,\n  task_name TEXT NOT NULL,\n  frequency TEXT NOT NULL DEFAULT 'daily', -- daily, weekly, monthly\n  assigned_to UUID, -- staff member\n  estimated_duration_minutes INTEGER DEFAULT 30,\n  last_completed TIMESTAMP WITH TIME ZONE,\n  next_due DATE NOT NULL,\n  status TEXT NOT NULL DEFAULT 'pending', -- pending, in_progress, completed, overdue\n  priority TEXT NOT NULL DEFAULT 'normal', -- low, normal, high\n  supplies_needed TEXT[],\n  instructions TEXT,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Add RLS policies\nALTER TABLE public.equipment ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.maintenance_schedules ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.maintenance_logs ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.facility_areas ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.incident_reports ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.vendors ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.cleaning_schedules ENABLE ROW LEVEL SECURITY;\n\n-- Equipment policies\nCREATE POLICY \\"Staff can manage equipment\\" ON public.equipment\n  FOR ALL USING (\n    organization_id IN (\n      SELECT organization_id FROM profiles \n      WHERE id = auth.uid() \n      AND role IN ('owner', 'manager', 'staff')\n    )\n  );\n\nCREATE POLICY \\"Users can view equipment in their organization\\" ON public.equipment\n  FOR SELECT USING (\n    organization_id IN (\n      SELECT organization_id FROM profiles WHERE id = auth.uid()\n    )\n  );\n\n-- Maintenance schedules policies\nCREATE POLICY \\"Staff can manage maintenance schedules\\" ON public.maintenance_schedules\n  FOR ALL USING (\n    organization_id IN (\n      SELECT organization_id FROM profiles \n      WHERE id = auth.uid() \n      AND role IN ('owner', 'manager', 'staff')\n    )\n  );\n\n-- Maintenance logs policies\nCREATE POLICY \\"Staff can manage maintenance logs\\" ON public.maintenance_logs\n  FOR ALL USING (\n    organization_id IN (\n      SELECT organization_id FROM profiles \n      WHERE id = auth.uid() \n      AND role IN ('owner', 'manager', 'staff')\n    )\n  );\n\n-- Facility areas policies\nCREATE POLICY \\"Staff can manage facility areas\\" ON public.facility_areas\n  FOR ALL USING (\n    organization_id IN (\n      SELECT organization_id FROM profiles \n      WHERE id = auth.uid() \n      AND role IN ('owner', 'manager', 'staff')\n    )\n  );\n\nCREATE POLICY \\"Users can view facility areas\\" ON public.facility_areas\n  FOR SELECT USING (\n    organization_id IN (\n      SELECT organization_id FROM profiles WHERE id = auth.uid()\n    )\n  );\n\n-- Incident reports policies\nCREATE POLICY \\"Staff can manage incident reports\\" ON public.incident_reports\n  FOR ALL USING (\n    organization_id IN (\n      SELECT organization_id FROM profiles \n      WHERE id = auth.uid() \n      AND role IN ('owner', 'manager', 'staff')\n    )\n  );\n\nCREATE POLICY \\"Users can report incidents\\" ON public.incident_reports\n  FOR INSERT WITH CHECK (\n    reported_by = auth.uid() AND\n    organization_id IN (\n      SELECT organization_id FROM profiles WHERE id = auth.uid()\n    )\n  );\n\n-- Vendors policies\nCREATE POLICY \\"Staff can manage vendors\\" ON public.vendors\n  FOR ALL USING (\n    organization_id IN (\n      SELECT organization_id FROM profiles \n      WHERE id = auth.uid() \n      AND role IN ('owner', 'manager', 'staff')\n    )\n  );\n\n-- Cleaning schedules policies\nCREATE POLICY \\"Staff can manage cleaning schedules\\" ON public.cleaning_schedules\n  FOR ALL USING (\n    organization_id IN (\n      SELECT organization_id FROM profiles \n      WHERE id = auth.uid() \n      AND role IN ('owner', 'manager', 'staff')\n    )\n  );\n\n-- Add foreign key relationships\nALTER TABLE public.equipment ADD CONSTRAINT equipment_organization_fk \n  FOREIGN KEY (organization_id) REFERENCES public.organizations(id) ON DELETE CASCADE;\n  \nALTER TABLE public.equipment ADD CONSTRAINT equipment_location_fk \n  FOREIGN KEY (location_id) REFERENCES public.locations(id) ON DELETE SET NULL;\n\nALTER TABLE public.maintenance_schedules ADD CONSTRAINT maintenance_schedules_organization_fk \n  FOREIGN KEY (organization_id) REFERENCES public.organizations(id) ON DELETE CASCADE;\n  \nALTER TABLE public.maintenance_schedules ADD CONSTRAINT maintenance_schedules_equipment_fk \n  FOREIGN KEY (equipment_id) REFERENCES public.equipment(id) ON DELETE CASCADE;\n\nALTER TABLE public.maintenance_logs ADD CONSTRAINT maintenance_logs_organization_fk \n  FOREIGN KEY (organization_id) REFERENCES public.organizations(id) ON DELETE CASCADE;\n  \nALTER TABLE public.maintenance_logs ADD CONSTRAINT maintenance_logs_equipment_fk \n  FOREIGN KEY (equipment_id) REFERENCES public.equipment(id) ON DELETE CASCADE;\n\nALTER TABLE public.facility_areas ADD CONSTRAINT facility_areas_organization_fk \n  FOREIGN KEY (organization_id) REFERENCES public.organizations(id) ON DELETE CASCADE;\n  \nALTER TABLE public.facility_areas ADD CONSTRAINT facility_areas_location_fk \n  FOREIGN KEY (location_id) REFERENCES public.locations(id) ON DELETE CASCADE;\n\nALTER TABLE public.incident_reports ADD CONSTRAINT incident_reports_organization_fk \n  FOREIGN KEY (organization_id) REFERENCES public.organizations(id) ON DELETE CASCADE;\n\nALTER TABLE public.vendors ADD CONSTRAINT vendors_organization_fk \n  FOREIGN KEY (organization_id) REFERENCES public.organizations(id) ON DELETE CASCADE;\n\nALTER TABLE public.cleaning_schedules ADD CONSTRAINT cleaning_schedules_organization_fk \n  FOREIGN KEY (organization_id) REFERENCES public.organizations(id) ON DELETE CASCADE;\n  \nALTER TABLE public.cleaning_schedules ADD CONSTRAINT cleaning_schedules_area_fk \n  FOREIGN KEY (area_id) REFERENCES public.facility_areas(id) ON DELETE CASCADE;\n\n-- Add triggers for updated_at columns\nCREATE TRIGGER update_equipment_updated_at\n  BEFORE UPDATE ON public.equipment\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_maintenance_schedules_updated_at\n  BEFORE UPDATE ON public.maintenance_schedules\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_maintenance_logs_updated_at\n  BEFORE UPDATE ON public.maintenance_logs\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_facility_areas_updated_at\n  BEFORE UPDATE ON public.facility_areas\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_incident_reports_updated_at\n  BEFORE UPDATE ON public.incident_reports\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_vendors_updated_at\n  BEFORE UPDATE ON public.vendors\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_cleaning_schedules_updated_at\n  BEFORE UPDATE ON public.cleaning_schedules\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\n-- Create function to automatically update equipment maintenance dates\nCREATE OR REPLACE FUNCTION public.update_equipment_maintenance_schedule()\nRETURNS TRIGGER AS $$\nBEGIN\n  -- Update equipment's last maintenance date and calculate next maintenance date\n  UPDATE public.equipment \n  SET \n    last_maintenance_date = NEW.maintenance_date::date,\n    next_maintenance_date = (NEW.maintenance_date::date + INTERVAL '1 day' * COALESCE(maintenance_interval_days, 90))\n  WHERE id = NEW.equipment_id;\n  \n  RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER;\n\n-- Create trigger to automatically update equipment maintenance dates\nCREATE TRIGGER update_equipment_maintenance_dates\n  AFTER INSERT ON public.maintenance_logs\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_equipment_maintenance_schedule();\n\n-- Create indexes for better performance\nCREATE INDEX idx_equipment_organization_id ON public.equipment(organization_id);\nCREATE INDEX idx_equipment_status ON public.equipment(status);\nCREATE INDEX idx_equipment_next_maintenance ON public.equipment(next_maintenance_date) WHERE next_maintenance_date IS NOT NULL;\n\nCREATE INDEX idx_maintenance_schedules_organization_id ON public.maintenance_schedules(organization_id);\nCREATE INDEX idx_maintenance_schedules_equipment_id ON public.maintenance_schedules(equipment_id);\nCREATE INDEX idx_maintenance_schedules_scheduled_date ON public.maintenance_schedules(scheduled_date);\n\nCREATE INDEX idx_incident_reports_organization_id ON public.incident_reports(organization_id);\nCREATE INDEX idx_incident_reports_incident_date ON public.incident_reports(incident_date);\nCREATE INDEX idx_incident_reports_severity ON public.incident_reports(severity);\n\nCREATE INDEX idx_cleaning_schedules_organization_id ON public.cleaning_schedules(organization_id);\nCREATE INDEX idx_cleaning_schedules_next_due ON public.cleaning_schedules(next_due);"}		pearson.performance@gmail.com	\N	\N
20250901040925	{"-- Add sample marketing campaigns with correct column names based on actual schema\nINSERT INTO marketing_campaigns (\n    organization_id, \n    name, \n    subject, \n    content,\n    campaign_type, \n    status, \n    sent_count, \n    opened_count, \n    clicked_count,\n    target_segment,\n    created_by,\n    created_at,\n    scheduled_at\n) \nSELECT \n    p.organization_id,\n    'New Member Welcome Series' as name,\n    'Welcome to RepClub! Your fitness journey starts now ' as subject,\n    'Welcome to our fitness community! We''re excited to help you achieve your fitness goals.' as content,\n    'email' as campaign_type,\n    'active' as status,\n    45 as sent_count,\n    38 as opened_count,  -- 38/45 = 0.84 open rate\n    10 as clicked_count, -- 10/45 = 0.22 click rate\n    'new_members' as target_segment,\n    p.id as created_by,\n    NOW() - INTERVAL '5 days' as created_at,\n    NULL as scheduled_at\nFROM profiles p\nWHERE p.role IN ('owner', 'manager') \nAND NOT EXISTS (\n    SELECT 1 FROM marketing_campaigns \n    WHERE organization_id = p.organization_id \n    AND name = 'New Member Welcome Series'\n)\nLIMIT 1;\n\nINSERT INTO marketing_campaigns (\n    organization_id, \n    name, \n    subject, \n    content,\n    campaign_type, \n    status, \n    sent_count, \n    opened_count, \n    clicked_count,\n    target_segment,\n    created_by,\n    created_at,\n    scheduled_at\n) \nSELECT \n    p.organization_id,\n    'Class Reminder Campaign' as name,\n    'Don''t forget your yoga class tomorrow at 10 AM!' as subject,\n    'This is a friendly reminder about your upcoming class. We look forward to seeing you there!' as content,\n    'email' as campaign_type,\n    'scheduled' as status,\n    0 as sent_count,\n    0 as opened_count,\n    0 as clicked_count,\n    'active_members' as target_segment,\n    p.id as created_by,\n    NOW() - INTERVAL '2 days' as created_at,\n    NOW() + INTERVAL '1 day' as scheduled_at\nFROM profiles p\nWHERE p.role IN ('owner', 'manager') \nAND NOT EXISTS (\n    SELECT 1 FROM marketing_campaigns \n    WHERE organization_id = p.organization_id \n    AND name = 'Class Reminder Campaign'\n)\nLIMIT 1;\n\nINSERT INTO marketing_campaigns (\n    organization_id, \n    name, \n    subject, \n    content,\n    campaign_type, \n    status, \n    sent_count, \n    opened_count, \n    clicked_count,\n    target_segment,\n    created_by,\n    created_at,\n    scheduled_at\n) \nSELECT \n    p.organization_id,\n    'Member Retention Offer' as name,\n    ' Special offer just for you - Come back to RepClub' as subject,\n    'We miss you! Here''s a special offer to welcome you back to your fitness journey.' as content,\n    'email' as campaign_type,\n    'completed' as status,\n    23 as sent_count,\n    15 as opened_count,  -- 15/23 = 0.65 open rate\n    3 as clicked_count,  -- 3/23 = 0.13 click rate\n    'at_risk_members' as target_segment,\n    p.id as created_by,\n    NOW() - INTERVAL '10 days' as created_at,\n    NULL as scheduled_at\nFROM profiles p\nWHERE p.role IN ('owner', 'manager') \nAND NOT EXISTS (\n    SELECT 1 FROM marketing_campaigns \n    WHERE organization_id = p.organization_id \n    AND name = 'Member Retention Offer'\n)\nLIMIT 1;"}		pearson.performance@gmail.com	\N	\N
20250901043458	{"-- Create organization and location for authentication testing with proper UUID format\n\n-- Ensure we have an organization to work with\nINSERT INTO public.organizations (id, name, slug, primary_color, secondary_color)\nVALUES \n  ('d290f1ee-6c54-4b01-90e6-d701748f0851', 'FitnessPro Gym', 'fitnesspro', 'hsl(220, 90%, 60%)', 'hsl(280, 90%, 65%)')\nON CONFLICT (slug) DO NOTHING;\n\n-- Add a location for the organization with proper UUID\nINSERT INTO public.locations (id, organization_id, name, address, email, phone)\nVALUES \n  ('a290f1ee-6c54-4b01-90e6-d701748f0851', 'd290f1ee-6c54-4b01-90e6-d701748f0851', 'Main Location', '123 Fitness St, Gym City, GC 12345', 'info@fitnesspro.com', '+1-555-123-4567')\nON CONFLICT (id) DO UPDATE SET\n  name = EXCLUDED.name,\n  address = EXCLUDED.address,\n  email = EXCLUDED.email,\n  phone = EXCLUDED.phone;"}		pearson.performance@gmail.com	\N	\N
20250901044805	{"-- Create instructor_availability table\nCREATE TABLE public.instructor_availability (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  instructor_id UUID NOT NULL,\n  day_of_week INTEGER NOT NULL CHECK (day_of_week >= 0 AND day_of_week <= 6),\n  start_time TIME NOT NULL,\n  end_time TIME NOT NULL,\n  is_available BOOLEAN NOT NULL DEFAULT true,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Create resource_bookings table\nCREATE TABLE public.resource_bookings (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  resource_id UUID NOT NULL,\n  resource_type TEXT NOT NULL CHECK (resource_type IN ('equipment', 'room')),\n  booked_by UUID NOT NULL,\n  start_time TIMESTAMP WITH TIME ZONE NOT NULL,\n  end_time TIMESTAMP WITH TIME ZONE NOT NULL,\n  status TEXT NOT NULL DEFAULT 'confirmed' CHECK (status IN ('confirmed', 'cancelled', 'completed')),\n  purpose TEXT,\n  notes TEXT,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Enable Row Level Security\nALTER TABLE public.instructor_availability ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.resource_bookings ENABLE ROW LEVEL SECURITY;\n\n-- RLS policies for instructor_availability\nCREATE POLICY \\"Instructors can manage their own availability\\" \nON public.instructor_availability \nFOR ALL \nUSING (instructor_id = auth.uid() OR EXISTS (\n  SELECT 1 FROM profiles \n  WHERE id = auth.uid() \n  AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n  AND organization_id = (\n    SELECT organization_id FROM profiles WHERE id = instructor_availability.instructor_id\n  )\n));\n\nCREATE POLICY \\"Users can view instructor availability\\" \nON public.instructor_availability \nFOR SELECT \nUSING (EXISTS (\n  SELECT 1 FROM profiles p1, profiles p2\n  WHERE p1.id = auth.uid() \n  AND p2.id = instructor_availability.instructor_id\n  AND p1.organization_id = p2.organization_id\n));\n\n-- RLS policies for resource_bookings\nCREATE POLICY \\"Users can manage their own resource bookings\\" \nON public.resource_bookings \nFOR ALL \nUSING (booked_by = auth.uid() OR EXISTS (\n  SELECT 1 FROM profiles \n  WHERE id = auth.uid() \n  AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n  AND organization_id = (\n    SELECT organization_id FROM profiles WHERE id = resource_bookings.booked_by\n  )\n));\n\nCREATE POLICY \\"Users can view resource bookings in their organization\\" \nON public.resource_bookings \nFOR SELECT \nUSING (EXISTS (\n  SELECT 1 FROM profiles p1, profiles p2\n  WHERE p1.id = auth.uid() \n  AND p2.id = resource_bookings.booked_by\n  AND p1.organization_id = p2.organization_id\n));\n\n-- Add triggers for updated_at\nCREATE TRIGGER update_instructor_availability_updated_at\n  BEFORE UPDATE ON public.instructor_availability\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_resource_bookings_updated_at\n  BEFORE UPDATE ON public.resource_bookings\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();"}		pearson.performance@gmail.com	\N	\N
20250901053615	{"-- Create SMS/Email provider configuration table\nCREATE TABLE public.communication_providers (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  provider_type TEXT NOT NULL CHECK (provider_type IN ('sms', 'email')),\n  provider_name TEXT NOT NULL,\n  configuration JSONB NOT NULL DEFAULT '{}',\n  is_active BOOLEAN NOT NULL DEFAULT true,\n  is_default BOOLEAN NOT NULL DEFAULT false,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Create communication templates table\nCREATE TABLE public.communication_templates (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  name TEXT NOT NULL,\n  template_type TEXT NOT NULL CHECK (template_type IN ('sms', 'email')),\n  category TEXT NOT NULL DEFAULT 'general',\n  subject TEXT, -- For email templates only\n  content TEXT NOT NULL,\n  variables JSONB DEFAULT '[]', -- Available variables for template\n  is_active BOOLEAN NOT NULL DEFAULT true,\n  created_by UUID NOT NULL,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Create message history table\nCREATE TABLE public.message_history (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  recipient_type TEXT NOT NULL CHECK (recipient_type IN ('member', 'staff', 'lead')),\n  recipient_id UUID NOT NULL,\n  message_type TEXT NOT NULL CHECK (message_type IN ('sms', 'email', 'push')),\n  template_id UUID,\n  subject TEXT,\n  content TEXT NOT NULL,\n  status TEXT NOT NULL DEFAULT 'pending' CHECK (status IN ('pending', 'sent', 'delivered', 'failed')),\n  sent_at TIMESTAMP WITH TIME ZONE,\n  delivered_at TIMESTAMP WITH TIME ZONE,\n  error_message TEXT,\n  metadata JSONB DEFAULT '{}',\n  sent_by UUID NOT NULL,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Create campaign executions enhancements for SMS/Email\nALTER TABLE public.campaign_executions \nADD COLUMN IF NOT EXISTS message_type TEXT DEFAULT 'email' CHECK (message_type IN ('sms', 'email', 'push')),\nADD COLUMN IF NOT EXISTS template_id UUID,\nADD COLUMN IF NOT EXISTS delivery_status TEXT DEFAULT 'pending' CHECK (delivery_status IN ('pending', 'sent', 'delivered', 'failed'));\n\n-- Enable RLS\nALTER TABLE public.communication_providers ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.communication_templates ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.message_history ENABLE ROW LEVEL SECURITY;\n\n-- RLS Policies for communication_providers\nCREATE POLICY \\"Staff can manage communication providers\\" ON public.communication_providers\n  FOR ALL USING (organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n  ));\n\n-- RLS Policies for communication_templates  \nCREATE POLICY \\"Staff can manage communication templates\\" ON public.communication_templates\n  FOR ALL USING (organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n  ));\n\n-- RLS Policies for message_history\nCREATE POLICY \\"Staff can view message history\\" ON public.message_history\n  FOR SELECT USING (organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n  ));\n\nCREATE POLICY \\"Staff can create message history\\" ON public.message_history\n  FOR INSERT WITH CHECK (\n    organization_id IN (\n      SELECT organization_id FROM profiles \n      WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n    )\n    AND sent_by = auth.uid()\n  );\n\n-- Add updated_at triggers\nCREATE TRIGGER update_communication_providers_updated_at\n  BEFORE UPDATE ON public.communication_providers\n  FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_communication_templates_updated_at\n  BEFORE UPDATE ON public.communication_templates\n  FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_message_history_updated_at\n  BEFORE UPDATE ON public.message_history\n  FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();"}		pearson.performance@gmail.com	\N	\N
20250901044000	{"-- Create personal training sessions table\nCREATE TABLE public.personal_training_sessions (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  trainer_id UUID NOT NULL,\n  member_id UUID NOT NULL,\n  session_date DATE NOT NULL,\n  start_time TIME NOT NULL,\n  end_time TIME NOT NULL,\n  duration_minutes INTEGER NOT NULL DEFAULT 60,\n  session_type TEXT NOT NULL DEFAULT 'individual',\n  status TEXT NOT NULL DEFAULT 'scheduled',\n  price NUMERIC(10,2) NOT NULL DEFAULT 0.00,\n  notes TEXT,\n  cancellation_reason TEXT,\n  cancelled_at TIMESTAMP WITH TIME ZONE,\n  cancelled_by UUID,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Create training packages table\nCREATE TABLE public.training_packages (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  name TEXT NOT NULL,\n  description TEXT,\n  session_count INTEGER NOT NULL,\n  session_duration_minutes INTEGER NOT NULL DEFAULT 60,\n  price NUMERIC(10,2) NOT NULL,\n  expiration_days INTEGER NOT NULL DEFAULT 90,\n  is_active BOOLEAN NOT NULL DEFAULT true,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Create member training packages table (purchased packages)\nCREATE TABLE public.member_training_packages (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  member_id UUID NOT NULL,\n  package_id UUID NOT NULL,\n  sessions_remaining INTEGER NOT NULL,\n  purchased_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  expires_at TIMESTAMP WITH TIME ZONE NOT NULL,\n  is_active BOOLEAN NOT NULL DEFAULT true,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Create trainer availability table\nCREATE TABLE public.trainer_availability (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  trainer_id UUID NOT NULL,\n  day_of_week INTEGER NOT NULL CHECK (day_of_week >= 0 AND day_of_week <= 6),\n  start_time TIME NOT NULL,\n  end_time TIME NOT NULL,\n  is_available BOOLEAN NOT NULL DEFAULT true,\n  location_id UUID,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Enable RLS\nALTER TABLE public.personal_training_sessions ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.training_packages ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.member_training_packages ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.trainer_availability ENABLE ROW LEVEL SECURITY;\n\n-- Create RLS policies for personal_training_sessions\nCREATE POLICY \\"Members can view their own training sessions\\"\nON public.personal_training_sessions FOR SELECT\nUSING (\n  (member_id = auth.uid()) OR \n  (trainer_id = auth.uid()) OR\n  (organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n  ))\n);\n\nCREATE POLICY \\"Trainers and staff can manage training sessions\\"\nON public.personal_training_sessions FOR ALL\nUSING (\n  (trainer_id = auth.uid()) OR\n  (organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n  ))\n);\n\nCREATE POLICY \\"Members can book training sessions\\"\nON public.personal_training_sessions FOR INSERT\nWITH CHECK (\n  (member_id = auth.uid()) AND\n  (organization_id IN (\n    SELECT organization_id FROM profiles WHERE id = auth.uid()\n  ))\n);\n\n-- Create RLS policies for training_packages\nCREATE POLICY \\"Users can view training packages in their organization\\"\nON public.training_packages FOR SELECT\nUSING (\n  organization_id IN (\n    SELECT organization_id FROM profiles WHERE id = auth.uid()\n  )\n);\n\nCREATE POLICY \\"Staff can manage training packages\\"\nON public.training_packages FOR ALL\nUSING (\n  organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n  )\n);\n\n-- Create RLS policies for member_training_packages\nCREATE POLICY \\"Members can view their own training packages\\"\nON public.member_training_packages FOR SELECT\nUSING (\n  (member_id = auth.uid()) OR\n  (EXISTS (\n    SELECT 1 FROM profiles \n    WHERE id = auth.uid() \n    AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n    AND organization_id = (\n      SELECT organization_id FROM profiles WHERE id = member_training_packages.member_id\n    )\n  ))\n);\n\nCREATE POLICY \\"Staff can manage member training packages\\"\nON public.member_training_packages FOR ALL\nUSING (\n  EXISTS (\n    SELECT 1 FROM profiles \n    WHERE id = auth.uid() \n    AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n    AND organization_id = (\n      SELECT organization_id FROM profiles WHERE id = member_training_packages.member_id\n    )\n  )\n);\n\n-- Create RLS policies for trainer_availability\nCREATE POLICY \\"Trainers can manage their own availability\\"\nON public.trainer_availability FOR ALL\nUSING (\n  (trainer_id = auth.uid()) OR\n  (EXISTS (\n    SELECT 1 FROM profiles \n    WHERE id = auth.uid() \n    AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n    AND organization_id = (\n      SELECT organization_id FROM profiles WHERE id = trainer_availability.trainer_id\n    )\n  ))\n);\n\nCREATE POLICY \\"Users can view trainer availability in their organization\\"\nON public.trainer_availability FOR SELECT\nUSING (\n  EXISTS (\n    SELECT 1 FROM profiles p1, profiles p2\n    WHERE p1.id = auth.uid() \n    AND p2.id = trainer_availability.trainer_id \n    AND p1.organization_id = p2.organization_id\n  )\n);\n\n-- Create update triggers\nCREATE TRIGGER update_personal_training_sessions_updated_at\nBEFORE UPDATE ON public.personal_training_sessions\nFOR EACH ROW\nEXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_training_packages_updated_at\nBEFORE UPDATE ON public.training_packages\nFOR EACH ROW\nEXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_trainer_availability_updated_at\nBEFORE UPDATE ON public.trainer_availability\nFOR EACH ROW\nEXECUTE FUNCTION public.update_updated_at_column();"}		pearson.performance@gmail.com	\N	\N
20250901051025	{"-- Fix foreign key relationships for personal training sessions\nALTER TABLE personal_training_sessions \nADD CONSTRAINT personal_training_sessions_trainer_id_fkey \nFOREIGN KEY (trainer_id) REFERENCES profiles(id);\n\nALTER TABLE personal_training_sessions \nADD CONSTRAINT personal_training_sessions_member_id_fkey \nFOREIGN KEY (member_id) REFERENCES profiles(id);"}		pearson.performance@gmail.com	\N	\N
20250913035940	{"-- FIX: Re-apply blog schema with correct seeding (no CTE reuse across statements)\n\n-- Function\nCREATE OR REPLACE FUNCTION public.update_updated_at_column()\nRETURNS TRIGGER AS $$\nBEGIN\n  NEW.updated_at = now();\n  RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql SET search_path = public;\n\n-- Tables\nCREATE TABLE IF NOT EXISTS public.blog_categories (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  name TEXT NOT NULL,\n  slug TEXT NOT NULL UNIQUE,\n  description TEXT,\n  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT now()\n);\nCREATE TABLE IF NOT EXISTS public.blog_tags (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  name TEXT NOT NULL,\n  slug TEXT NOT NULL UNIQUE,\n  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT now()\n);\nCREATE TABLE IF NOT EXISTS public.blog_posts (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  slug TEXT NOT NULL UNIQUE,\n  title TEXT NOT NULL,\n  excerpt TEXT,\n  content TEXT NOT NULL,\n  featured_image TEXT,\n  category_id UUID REFERENCES public.blog_categories(id) ON DELETE SET NULL,\n  read_time INTEGER,\n  status TEXT NOT NULL DEFAULT 'draft',\n  published_at TIMESTAMPTZ,\n  created_by UUID,\n  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT now()\n);\nCREATE TABLE IF NOT EXISTS public.blog_post_tags (\n  post_id UUID NOT NULL REFERENCES public.blog_posts(id) ON DELETE CASCADE,\n  tag_id UUID NOT NULL REFERENCES public.blog_tags(id) ON DELETE CASCADE,\n  PRIMARY KEY (post_id, tag_id)\n);\n\n-- Triggers\nDO $$ BEGIN\n  IF NOT EXISTS (\n    SELECT 1 FROM pg_trigger WHERE tgname = 'trg_blog_categories_updated'\n  ) THEN\n    CREATE TRIGGER trg_blog_categories_updated BEFORE UPDATE ON public.blog_categories\n    FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();\n  END IF;\n  IF NOT EXISTS (\n    SELECT 1 FROM pg_trigger WHERE tgname = 'trg_blog_tags_updated'\n  ) THEN\n    CREATE TRIGGER trg_blog_tags_updated BEFORE UPDATE ON public.blog_tags\n    FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();\n  END IF;\n  IF NOT EXISTS (\n    SELECT 1 FROM pg_trigger WHERE tgname = 'trg_blog_posts_updated'\n  ) THEN\n    CREATE TRIGGER trg_blog_posts_updated BEFORE UPDATE ON public.blog_posts\n    FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();\n  END IF;\nEND $$;\n\n-- RLS\nALTER TABLE public.blog_categories ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.blog_tags ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.blog_posts ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.blog_post_tags ENABLE ROW LEVEL SECURITY;\n\n-- Policies\nDO $$ BEGIN\n  IF NOT EXISTS (\n    SELECT 1 FROM pg_policies WHERE tablename = 'blog_posts' AND policyname = 'Public can view published posts'\n  ) THEN\n    CREATE POLICY \\"Public can view published posts\\" ON public.blog_posts\n      FOR SELECT USING (status = 'published' AND published_at IS NOT NULL AND published_at <= now());\n  END IF;\n  IF NOT EXISTS (\n    SELECT 1 FROM pg_policies WHERE tablename = 'blog_posts' AND policyname = 'Staff can manage blog posts'\n  ) THEN\n    CREATE POLICY \\"Staff can manage blog posts\\" ON public.blog_posts FOR ALL\n    USING (EXISTS (SELECT 1 FROM public.profiles p WHERE p.id = auth.uid() AND p.role IN ('owner','manager','staff')))\n    WITH CHECK (EXISTS (SELECT 1 FROM public.profiles p WHERE p.id = auth.uid() AND p.role IN ('owner','manager','staff')));\n  END IF;\n  IF NOT EXISTS (\n    SELECT 1 FROM pg_policies WHERE tablename = 'blog_categories' AND policyname = 'Categories are publicly readable'\n  ) THEN\n    CREATE POLICY \\"Categories are publicly readable\\" ON public.blog_categories FOR SELECT USING (true);\n  END IF;\n  IF NOT EXISTS (\n    SELECT 1 FROM pg_policies WHERE tablename = 'blog_categories' AND policyname = 'Staff can manage categories'\n  ) THEN\n    CREATE POLICY \\"Staff can manage categories\\" ON public.blog_categories FOR ALL\n    USING (EXISTS (SELECT 1 FROM public.profiles p WHERE p.id = auth.uid() AND p.role IN ('owner','manager','staff')))\n    WITH CHECK (EXISTS (SELECT 1 FROM public.profiles p WHERE p.id = auth.uid() AND p.role IN ('owner','manager','staff')));\n  END IF;\n  IF NOT EXISTS (\n    SELECT 1 FROM pg_policies WHERE tablename = 'blog_tags' AND policyname = 'Tags are publicly readable'\n  ) THEN\n    CREATE POLICY \\"Tags are publicly readable\\" ON public.blog_tags FOR SELECT USING (true);\n  END IF;\n  IF NOT EXISTS (\n    SELECT 1 FROM pg_policies WHERE tablename = 'blog_tags' AND policyname = 'Staff can manage tags'\n  ) THEN\n    CREATE POLICY \\"Staff can manage tags\\" ON public.blog_tags FOR ALL\n    USING (EXISTS (SELECT 1 FROM public.profiles p WHERE p.id = auth.uid() AND p.role IN ('owner','manager','staff')))\n    WITH CHECK (EXISTS (SELECT 1 FROM public.profiles p WHERE p.id = auth.uid() AND p.role IN ('owner','manager','staff')));\n  END IF;\n  IF NOT EXISTS (\n    SELECT 1 FROM pg_policies WHERE tablename = 'blog_post_tags' AND policyname = 'Post tags are publicly readable'\n  ) THEN\n    CREATE POLICY \\"Post tags are publicly readable\\" ON public.blog_post_tags FOR SELECT USING (true);\n  END IF;\n  IF NOT EXISTS (\n    SELECT 1 FROM pg_policies WHERE tablename = 'blog_post_tags' AND policyname = 'Staff can manage post tags'\n  ) THEN\n    CREATE POLICY \\"Staff can manage post tags\\" ON public.blog_post_tags FOR ALL\n    USING (EXISTS (SELECT 1 FROM public.profiles p WHERE p.id = auth.uid() AND p.role IN ('owner','manager','staff')))\n    WITH CHECK (EXISTS (SELECT 1 FROM public.profiles p WHERE p.id = auth.uid() AND p.role IN ('owner','manager','staff')));\n  END IF;\nEND $$;\n\n-- Seed minimal categories/tags\nINSERT INTO public.blog_categories (name, slug)\nVALUES ('Equipment Management','equipment-management')\nON CONFLICT (slug) DO NOTHING;\nINSERT INTO public.blog_categories (name, slug)\nVALUES ('Marketing','marketing')\nON CONFLICT (slug) DO NOTHING;\n\nINSERT INTO public.blog_tags (name, slug) VALUES ('equipment','equipment') ON CONFLICT (slug) DO NOTHING;\nINSERT INTO public.blog_tags (name, slug) VALUES ('maintenance','maintenance') ON CONFLICT (slug) DO NOTHING;\nINSERT INTO public.blog_tags (name, slug) VALUES ('marketing','marketing') ON CONFLICT (slug) DO NOTHING;\nINSERT INTO public.blog_tags (name, slug) VALUES ('social media','social-media') ON CONFLICT (slug) DO NOTHING;\n\n-- Seed two posts if missing\nINSERT INTO public.blog_posts (slug, title, excerpt, content, featured_image, category_id, read_time, status, published_at)\nSELECT\n  'equipment-maintenance-guide',\n  'The Ultimate Equipment Maintenance Guide for Gym Owners',\n  'Keep your equipment running smoothly and extend its lifespan with this comprehensive maintenance checklist.',\n  '<p>Proper equipment maintenance is crucial for member safety, satisfaction, and your bottom line...</p>',\n  '/assets/equipment-maintenance.jpg',\n  (SELECT id FROM public.blog_categories WHERE slug = 'equipment-management'),\n  12,\n  'published',\n  now() - interval '120 days'\nWHERE NOT EXISTS (SELECT 1 FROM public.blog_posts WHERE slug = 'equipment-maintenance-guide');\n\nINSERT INTO public.blog_posts (slug, title, excerpt, content, featured_image, category_id, read_time, status, published_at)\nSELECT\n  'gym-marketing-strategies-2024',\n  'Top Gym Marketing Strategies That Actually Work in 2024',\n  'Modern marketing tactics to attract new members and build a strong fitness community.',\n  '<p>The fitness marketing landscape has evolved dramatically...</p>',\n  '/assets/gym-marketing.jpg',\n  (SELECT id FROM public.blog_categories WHERE slug = 'marketing'),\n  10,\n  'published',\n  now() - interval '110 days'\nWHERE NOT EXISTS (SELECT 1 FROM public.blog_posts WHERE slug = 'gym-marketing-strategies-2024');\n\n-- Attach tags (idempotent)\nINSERT INTO public.blog_post_tags (post_id, tag_id)\nSELECT p.id, t.id\nFROM public.blog_posts p, public.blog_tags t\nWHERE p.slug = 'equipment-maintenance-guide' AND t.slug IN ('equipment','maintenance')\nON CONFLICT DO NOTHING;\n\nINSERT INTO public.blog_post_tags (post_id, tag_id)\nSELECT p.id, t.id\nFROM public.blog_posts p, public.blog_tags t\nWHERE p.slug = 'gym-marketing-strategies-2024' AND t.slug IN ('marketing','social-media')\nON CONFLICT DO NOTHING;\n"}		pearson.performance@gmail.com	\N	\N
20250920064930	{"-- Create expense categories table if not exists\nCREATE TABLE IF NOT EXISTS public.expense_categories (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  name TEXT NOT NULL,\n  description TEXT,\n  budget_amount NUMERIC,\n  is_active BOOLEAN DEFAULT true,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Create expense vendors table (different from existing vendors)\nCREATE TABLE IF NOT EXISTS public.expense_vendors (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  name TEXT NOT NULL,\n  contact_person TEXT,\n  email TEXT,\n  phone TEXT,\n  address TEXT,\n  payment_terms TEXT DEFAULT '30',\n  tax_id TEXT,\n  is_active BOOLEAN DEFAULT true,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Create expenses table\nCREATE TABLE IF NOT EXISTS public.expenses (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  vendor_id UUID REFERENCES public.expense_vendors(id),\n  category_id UUID NOT NULL REFERENCES public.expense_categories(id),\n  expense_date DATE NOT NULL,\n  amount NUMERIC NOT NULL,\n  description TEXT NOT NULL,\n  receipt_url TEXT,\n  receipt_filename TEXT,\n  payment_method TEXT DEFAULT 'check',\n  payment_status TEXT DEFAULT 'pending',\n  payment_date DATE,\n  check_number TEXT,\n  reference_number TEXT,\n  approved_by UUID,\n  approved_at TIMESTAMP WITH TIME ZONE,\n  recurring BOOLEAN DEFAULT false,\n  recurring_frequency TEXT,\n  created_by UUID NOT NULL,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Enable RLS on all tables\nALTER TABLE public.expense_categories ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.expense_vendors ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.expenses ENABLE ROW LEVEL SECURITY;\n\n-- Create RLS policies for expense_categories\nCREATE POLICY \\"Staff can manage expense categories\\"\nON public.expense_categories\nFOR ALL\nUSING (organization_id IN (\n  SELECT organization_id FROM profiles \n  WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n));\n\n-- Create RLS policies for expense_vendors\nCREATE POLICY \\"Staff can manage expense vendors\\"\nON public.expense_vendors\nFOR ALL\nUSING (organization_id IN (\n  SELECT organization_id FROM profiles \n  WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n));\n\n-- Create RLS policies for expenses\nCREATE POLICY \\"Staff can manage expenses\\"\nON public.expenses\nFOR ALL\nUSING (organization_id IN (\n  SELECT organization_id FROM profiles \n  WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n));\n\n-- Create triggers for updated_at (only if they don't exist)\nDO $$\nBEGIN\n  IF NOT EXISTS (SELECT 1 FROM pg_trigger WHERE tgname = 'update_expense_categories_updated_at') THEN\n    CREATE TRIGGER update_expense_categories_updated_at\n    BEFORE UPDATE ON public.expense_categories\n    FOR EACH ROW\n    EXECUTE FUNCTION public.update_updated_at_column();\n  END IF;\n  \n  IF NOT EXISTS (SELECT 1 FROM pg_trigger WHERE tgname = 'update_expense_vendors_updated_at') THEN\n    CREATE TRIGGER update_expense_vendors_updated_at\n    BEFORE UPDATE ON public.expense_vendors\n    FOR EACH ROW\n    EXECUTE FUNCTION public.update_updated_at_column();\n  END IF;\n  \n  IF NOT EXISTS (SELECT 1 FROM pg_trigger WHERE tgname = 'update_expenses_updated_at') THEN\n    CREATE TRIGGER update_expenses_updated_at\n    BEFORE UPDATE ON public.expenses\n    FOR EACH ROW\n    EXECUTE FUNCTION public.update_updated_at_column();\n  END IF;\nEND $$;\n\n-- Create indexes for performance\nCREATE INDEX IF NOT EXISTS idx_expenses_organization_date ON public.expenses(organization_id, expense_date);\nCREATE INDEX IF NOT EXISTS idx_expenses_category ON public.expenses(category_id);\nCREATE INDEX IF NOT EXISTS idx_expenses_vendor ON public.expenses(vendor_id);\nCREATE INDEX IF NOT EXISTS idx_expenses_payment_status ON public.expenses(payment_status);"}		pearson.performance@gmail.com	\N	\N
20250920025714	{"-- Create guest pass system tables\n\n-- Guest pass types and pricing\nCREATE TABLE public.guest_pass_types (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  name TEXT NOT NULL,\n  description TEXT,\n  price NUMERIC NOT NULL DEFAULT 0,\n  validity_hours INTEGER NOT NULL DEFAULT 24,\n  includes_amenities TEXT[] DEFAULT '{}',\n  max_uses_per_member INTEGER DEFAULT 1,\n  is_active BOOLEAN DEFAULT true,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Guest pass purchases and tracking\nCREATE TABLE public.guest_passes (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  pass_type_id UUID NOT NULL REFERENCES public.guest_pass_types(id),\n  purchased_by UUID REFERENCES auth.users(id),\n  guest_name TEXT NOT NULL,\n  guest_email TEXT,\n  guest_phone TEXT,\n  purchase_date TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  valid_until TIMESTAMP WITH TIME ZONE NOT NULL,\n  amount_paid NUMERIC NOT NULL,\n  payment_method TEXT DEFAULT 'cash',\n  used_at TIMESTAMP WITH TIME ZONE,\n  status TEXT NOT NULL DEFAULT 'active',\n  notes TEXT,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Daily visitor check-ins (separate from member check-ins)\nCREATE TABLE public.visitor_checkins (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  guest_pass_id UUID REFERENCES public.guest_passes(id),\n  visitor_name TEXT NOT NULL,\n  visitor_email TEXT,\n  check_in_time TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  check_out_time TIMESTAMP WITH TIME ZONE,\n  purpose TEXT DEFAULT 'day_pass',\n  accompanied_by UUID REFERENCES auth.users(id),\n  liability_waiver_signed BOOLEAN DEFAULT false,\n  emergency_contact_name TEXT,\n  emergency_contact_phone TEXT,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Liability waivers\nCREATE TABLE public.liability_waivers (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  visitor_checkin_id UUID REFERENCES public.visitor_checkins(id),\n  signee_name TEXT NOT NULL,\n  signee_email TEXT,\n  signature_data TEXT,\n  waiver_content TEXT NOT NULL,\n  signed_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  witness_staff_id UUID REFERENCES auth.users(id),\n  ip_address TEXT,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Enable RLS\nALTER TABLE public.guest_pass_types ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.guest_passes ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.visitor_checkins ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.liability_waivers ENABLE ROW LEVEL SECURITY;\n\n-- RLS Policies for guest_pass_types\nCREATE POLICY \\"Staff can manage guest pass types\\"\nON public.guest_pass_types\nFOR ALL\nUSING (organization_id IN (\n  SELECT organization_id FROM profiles \n  WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n));\n\nCREATE POLICY \\"Users can view active guest pass types\\"\nON public.guest_pass_types\nFOR SELECT\nUSING (is_active = true AND organization_id IN (\n  SELECT organization_id FROM profiles WHERE id = auth.uid()\n));\n\n-- RLS Policies for guest_passes\nCREATE POLICY \\"Staff can manage guest passes\\"\nON public.guest_passes\nFOR ALL\nUSING (organization_id IN (\n  SELECT organization_id FROM profiles \n  WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n));\n\nCREATE POLICY \\"Members can view passes they purchased\\"\nON public.guest_passes\nFOR SELECT\nUSING (purchased_by = auth.uid() OR organization_id IN (\n  SELECT organization_id FROM profiles \n  WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n));\n\n-- RLS Policies for visitor_checkins\nCREATE POLICY \\"Staff can manage visitor checkins\\"\nON public.visitor_checkins\nFOR ALL\nUSING (organization_id IN (\n  SELECT organization_id FROM profiles \n  WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n));\n\n-- RLS Policies for liability_waivers\nCREATE POLICY \\"Staff can manage liability waivers\\"\nON public.liability_waivers\nFOR ALL\nUSING (organization_id IN (\n  SELECT organization_id FROM profiles \n  WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n));\n\n-- Create indexes for performance\nCREATE INDEX idx_guest_passes_organization ON public.guest_passes(organization_id);\nCREATE INDEX idx_guest_passes_valid_until ON public.guest_passes(valid_until);\nCREATE INDEX idx_visitor_checkins_organization ON public.visitor_checkins(organization_id);\nCREATE INDEX idx_visitor_checkins_date ON public.visitor_checkins(check_in_time);\n\n-- Update triggers\nCREATE TRIGGER update_guest_pass_types_updated_at\n  BEFORE UPDATE ON public.guest_pass_types\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_guest_passes_updated_at\n  BEFORE UPDATE ON public.guest_passes\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();"}		pearson.performance@gmail.com	\N	\N
20250920030408	{"-- Create locker management system tables\n\n-- Locker inventory and specifications\nCREATE TABLE public.lockers (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  location_id UUID REFERENCES public.locations(id),\n  locker_number TEXT NOT NULL,\n  locker_type TEXT NOT NULL DEFAULT 'standard',\n  size_category TEXT NOT NULL DEFAULT 'medium',\n  has_lock BOOLEAN DEFAULT true,\n  lock_type TEXT DEFAULT 'combination',\n  lock_combination TEXT,\n  key_number TEXT,\n  monthly_rate NUMERIC DEFAULT 10.00,\n  daily_rate NUMERIC DEFAULT 2.00,\n  deposit_amount NUMERIC DEFAULT 25.00,\n  is_available BOOLEAN DEFAULT true,\n  is_out_of_order BOOLEAN DEFAULT false,\n  maintenance_notes TEXT,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  UNIQUE(organization_id, locker_number)\n);\n\n-- Locker rental agreements\nCREATE TABLE public.locker_rentals (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  locker_id UUID NOT NULL REFERENCES public.lockers(id),\n  member_id UUID NOT NULL,\n  rental_type TEXT NOT NULL DEFAULT 'monthly',\n  start_date DATE NOT NULL DEFAULT CURRENT_DATE,\n  end_date DATE,\n  monthly_rate NUMERIC NOT NULL,\n  deposit_paid NUMERIC DEFAULT 0,\n  deposit_refunded BOOLEAN DEFAULT false,\n  auto_renew BOOLEAN DEFAULT true,\n  status TEXT NOT NULL DEFAULT 'active',\n  payment_method TEXT DEFAULT 'auto',\n  last_payment_date DATE,\n  next_payment_due DATE,\n  notes TEXT,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Locker maintenance and inspection logs\nCREATE TABLE public.locker_maintenance (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  locker_id UUID NOT NULL REFERENCES public.lockers(id),\n  maintenance_type TEXT NOT NULL DEFAULT 'inspection',\n  performed_by UUID REFERENCES auth.users(id),\n  maintenance_date TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  issue_description TEXT,\n  resolution_notes TEXT,\n  parts_replaced TEXT[],\n  labor_time_minutes INTEGER,\n  cost NUMERIC DEFAULT 0,\n  follow_up_required BOOLEAN DEFAULT false,\n  follow_up_date DATE,\n  status TEXT NOT NULL DEFAULT 'completed',\n  photos TEXT[],\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Locker access history and audit trail  \nCREATE TABLE public.locker_access_log (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  locker_id UUID NOT NULL REFERENCES public.lockers(id),\n  member_id UUID,\n  staff_id UUID REFERENCES auth.users(id),\n  access_type TEXT NOT NULL DEFAULT 'member_access',\n  access_time TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  access_method TEXT DEFAULT 'combination',\n  notes TEXT,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Enable RLS\nALTER TABLE public.lockers ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.locker_rentals ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.locker_maintenance ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.locker_access_log ENABLE ROW LEVEL SECURITY;\n\n-- RLS Policies for lockers\nCREATE POLICY \\"Staff can manage lockers\\"\nON public.lockers\nFOR ALL\nUSING (organization_id IN (\n  SELECT organization_id FROM profiles \n  WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n));\n\nCREATE POLICY \\"Members can view available lockers\\"\nON public.lockers\nFOR SELECT\nUSING ((is_available = true AND is_out_of_order = false) AND organization_id IN (\n  SELECT organization_id FROM profiles WHERE id = auth.uid()\n));\n\n-- RLS Policies for locker_rentals\nCREATE POLICY \\"Staff can manage locker rentals\\"\nON public.locker_rentals\nFOR ALL\nUSING (organization_id IN (\n  SELECT organization_id FROM profiles \n  WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n));\n\nCREATE POLICY \\"Members can view their own rentals\\"\nON public.locker_rentals\nFOR SELECT\nUSING (member_id = auth.uid() OR organization_id IN (\n  SELECT organization_id FROM profiles \n  WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n));\n\n-- RLS Policies for locker_maintenance\nCREATE POLICY \\"Staff can manage locker maintenance\\"\nON public.locker_maintenance\nFOR ALL\nUSING (organization_id IN (\n  SELECT organization_id FROM profiles \n  WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n));\n\n-- RLS Policies for locker_access_log\nCREATE POLICY \\"Staff can manage access logs\\"\nON public.locker_access_log\nFOR ALL\nUSING (organization_id IN (\n  SELECT organization_id FROM profiles \n  WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n));\n\nCREATE POLICY \\"Members can view their own access logs\\"\nON public.locker_access_log\nFOR SELECT\nUSING (member_id = auth.uid() OR organization_id IN (\n  SELECT organization_id FROM profiles \n  WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n));\n\n-- Create indexes for performance\nCREATE INDEX idx_lockers_organization ON public.lockers(organization_id);\nCREATE INDEX idx_lockers_available ON public.lockers(organization_id, is_available, is_out_of_order);\nCREATE INDEX idx_locker_rentals_organization ON public.locker_rentals(organization_id);\nCREATE INDEX idx_locker_rentals_member ON public.locker_rentals(member_id);\nCREATE INDEX idx_locker_rentals_active ON public.locker_rentals(organization_id, status);\nCREATE INDEX idx_locker_maintenance_organization ON public.locker_maintenance(organization_id);\nCREATE INDEX idx_locker_access_log_time ON public.locker_access_log(access_time);\n\n-- Update triggers\nCREATE TRIGGER update_lockers_updated_at\n  BEFORE UPDATE ON public.lockers\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_locker_rentals_updated_at\n  BEFORE UPDATE ON public.locker_rentals\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_locker_maintenance_updated_at\n  BEFORE UPDATE ON public.locker_maintenance\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\n-- Function to automatically set next payment due date\nCREATE OR REPLACE FUNCTION public.calculate_next_payment_due()\nRETURNS TRIGGER\nLANGUAGE plpgsql\nSECURITY DEFINER\nSET search_path = public\nAS $$\nBEGIN\n  IF NEW.rental_type = 'monthly' THEN\n    NEW.next_payment_due := NEW.start_date + INTERVAL '1 month';\n  ELSIF NEW.rental_type = 'quarterly' THEN\n    NEW.next_payment_due := NEW.start_date + INTERVAL '3 months';\n  ELSIF NEW.rental_type = 'annual' THEN\n    NEW.next_payment_due := NEW.start_date + INTERVAL '1 year';\n  END IF;\n  \n  RETURN NEW;\nEND;\n$$;\n\n-- Trigger to calculate payment due dates\nCREATE TRIGGER calculate_payment_due_date\n  BEFORE INSERT ON public.locker_rentals\n  FOR EACH ROW\n  EXECUTE FUNCTION public.calculate_next_payment_due();"}		pearson.performance@gmail.com	\N	\N
20250920031136	{"-- Create the remaining incident management tables (incident_reports already exists)\n\n-- Insurance claims tracking\nCREATE TABLE public.insurance_claims (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  incident_report_id UUID NOT NULL REFERENCES public.incident_reports(id),\n  claim_number TEXT NOT NULL,\n  insurance_company TEXT NOT NULL,\n  policy_number TEXT,\n  claim_type TEXT NOT NULL DEFAULT 'liability',\n  claim_amount NUMERIC,\n  claim_status TEXT NOT NULL DEFAULT 'filed',\n  filed_date DATE NOT NULL DEFAULT CURRENT_DATE,\n  adjuster_name TEXT,\n  adjuster_contact TEXT,\n  settlement_amount NUMERIC,\n  settlement_date DATE,\n  claim_notes TEXT,\n  documents TEXT[],\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Follow-up tasks for incidents\nCREATE TABLE public.incident_follow_ups (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  incident_report_id UUID NOT NULL REFERENCES public.incident_reports(id),\n  task_type TEXT NOT NULL DEFAULT 'follow_up_call',\n  task_description TEXT NOT NULL,\n  assigned_to UUID REFERENCES auth.users(id),\n  due_date DATE NOT NULL,\n  completed_at TIMESTAMP WITH TIME ZONE,\n  completed_by UUID REFERENCES auth.users(id),\n  completion_notes TEXT,\n  priority TEXT NOT NULL DEFAULT 'medium',\n  status TEXT NOT NULL DEFAULT 'pending',\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Incident investigation notes\nCREATE TABLE public.incident_investigations (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  incident_report_id UUID NOT NULL REFERENCES public.incident_reports(id),\n  investigator_id UUID NOT NULL REFERENCES auth.users(id),\n  investigation_date TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  findings TEXT NOT NULL,\n  recommendations TEXT,\n  contributing_factors TEXT[],\n  preventability TEXT DEFAULT 'unknown',\n  investigation_status TEXT NOT NULL DEFAULT 'ongoing',\n  photos TEXT[],\n  documents TEXT[],\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Enable RLS on new tables\nALTER TABLE public.insurance_claims ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.incident_follow_ups ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.incident_investigations ENABLE ROW LEVEL SECURITY;\n\n-- RLS Policies for insurance_claims\nCREATE POLICY \\"Staff can manage insurance claims\\"\nON public.insurance_claims\nFOR ALL\nUSING (organization_id IN (\n  SELECT organization_id FROM profiles \n  WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n));\n\n-- RLS Policies for incident_follow_ups\nCREATE POLICY \\"Staff can manage incident follow-ups\\"\nON public.incident_follow_ups\nFOR ALL\nUSING (organization_id IN (\n  SELECT organization_id FROM profiles \n  WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n));\n\n-- RLS Policies for incident_investigations\nCREATE POLICY \\"Staff can manage incident investigations\\"\nON public.incident_investigations\nFOR ALL\nUSING (organization_id IN (\n  SELECT organization_id FROM profiles \n  WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n));\n\n-- Create indexes for performance\nCREATE INDEX idx_insurance_claims_organization ON public.insurance_claims(organization_id);\nCREATE INDEX idx_incident_follow_ups_due ON public.incident_follow_ups(organization_id, due_date);\nCREATE INDEX idx_incident_investigations_organization ON public.incident_investigations(organization_id);\n\n-- Update triggers\nCREATE TRIGGER update_insurance_claims_updated_at\n  BEFORE UPDATE ON public.insurance_claims\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_incident_follow_ups_updated_at\n  BEFORE UPDATE ON public.incident_follow_ups\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_incident_investigations_updated_at\n  BEFORE UPDATE ON public.incident_investigations\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();"}		pearson.performance@gmail.com	\N	\N
20250920031649	{"-- Create sports courts management tables\nCREATE TABLE public.sports_courts (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  location_id UUID REFERENCES public.locations(id),\n  court_number TEXT NOT NULL,\n  court_type TEXT NOT NULL DEFAULT 'tennis', -- tennis, pickleball, racquetball, basketball, etc\n  surface_type TEXT DEFAULT 'hard', -- hard, clay, grass, indoor, etc\n  is_indoor BOOLEAN DEFAULT false,\n  max_players INTEGER DEFAULT 4,\n  hourly_rate NUMERIC DEFAULT 25.00,\n  lighting_available BOOLEAN DEFAULT true,\n  equipment_included TEXT[] DEFAULT '{}', -- nets, posts, etc\n  maintenance_notes TEXT,\n  is_available BOOLEAN DEFAULT true,\n  is_out_of_order BOOLEAN DEFAULT false,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Create court reservations table\nCREATE TABLE public.court_reservations (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  court_id UUID NOT NULL REFERENCES public.sports_courts(id) ON DELETE CASCADE,\n  member_id UUID NOT NULL,\n  reservation_date DATE NOT NULL,\n  start_time TIME NOT NULL,\n  end_time TIME NOT NULL,\n  duration_minutes INTEGER NOT NULL DEFAULT 60,\n  hourly_rate NUMERIC NOT NULL,\n  total_cost NUMERIC NOT NULL,\n  payment_status TEXT DEFAULT 'pending', -- pending, paid, cancelled, refunded\n  payment_method TEXT,\n  additional_players TEXT[], -- names or member IDs of other players\n  special_requests TEXT,\n  checked_in_at TIMESTAMP WITH TIME ZONE,\n  cancelled_at TIMESTAMP WITH TIME ZONE,\n  cancellation_reason TEXT,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  status TEXT NOT NULL DEFAULT 'confirmed' -- confirmed, cancelled, completed, no_show\n);\n\n-- Create equipment checkout table\nCREATE TABLE public.equipment_checkout (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  equipment_item_id UUID NOT NULL,\n  member_id UUID NOT NULL,\n  checked_out_by UUID, -- staff member who processed checkout\n  checked_out_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  due_back_at TIMESTAMP WITH TIME ZONE NOT NULL,\n  checked_in_at TIMESTAMP WITH TIME ZONE,\n  checked_in_by UUID, -- staff member who processed return\n  rental_fee NUMERIC DEFAULT 0.00,\n  deposit_amount NUMERIC DEFAULT 0.00,\n  damage_fee NUMERIC DEFAULT 0.00,\n  condition_out TEXT DEFAULT 'good', -- excellent, good, fair, poor\n  condition_in TEXT,\n  damage_notes TEXT,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  status TEXT NOT NULL DEFAULT 'checked_out' -- checked_out, returned, overdue, lost, damaged\n);\n\n-- Create equipment inventory table for sports equipment\nCREATE TABLE public.sports_equipment (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  location_id UUID REFERENCES public.locations(id),\n  equipment_type TEXT NOT NULL, -- racket, ball, paddle, net, etc\n  sport TEXT NOT NULL, -- tennis, pickleball, racquetball, etc\n  brand TEXT,\n  model TEXT,\n  size_specification TEXT, -- grip size, ball type, etc\n  purchase_date DATE,\n  purchase_price NUMERIC,\n  rental_rate_hourly NUMERIC DEFAULT 5.00,\n  rental_rate_daily NUMERIC DEFAULT 15.00,\n  deposit_required NUMERIC DEFAULT 25.00,\n  current_condition TEXT DEFAULT 'good', -- excellent, good, fair, poor, out_of_service\n  maintenance_notes TEXT,\n  is_available_for_rental BOOLEAN DEFAULT true,\n  total_rentals INTEGER DEFAULT 0,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  equipment_code TEXT NOT NULL, -- unique identifier/barcode\n  description TEXT,\n  notes TEXT\n);\n\n-- Create tournaments table\nCREATE TABLE public.tournaments (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  tournament_name TEXT NOT NULL,\n  sport TEXT NOT NULL,\n  tournament_type TEXT DEFAULT 'single_elimination', -- single_elimination, double_elimination, round_robin\n  entry_fee NUMERIC DEFAULT 0.00,\n  max_participants INTEGER,\n  registration_deadline DATE,\n  tournament_start_date DATE NOT NULL,\n  tournament_end_date DATE NOT NULL,\n  prize_pool NUMERIC DEFAULT 0.00,\n  winner_id UUID,\n  runner_up_id UUID,\n  created_by UUID NOT NULL,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  status TEXT NOT NULL DEFAULT 'registration_open', -- registration_open, registration_closed, in_progress, completed, cancelled\n  description TEXT,\n  rules TEXT,\n  contact_info TEXT\n);\n\n-- Create tournament participants table\nCREATE TABLE public.tournament_participants (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  tournament_id UUID NOT NULL REFERENCES public.tournaments(id) ON DELETE CASCADE,\n  member_id UUID NOT NULL,\n  partner_id UUID, -- for doubles tournaments\n  registration_date TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  seed_number INTEGER,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  status TEXT NOT NULL DEFAULT 'registered' -- registered, eliminated, advanced, withdrew\n);\n\n-- Enable Row Level Security\nALTER TABLE public.sports_courts ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.court_reservations ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.equipment_checkout ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.sports_equipment ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.tournaments ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.tournament_participants ENABLE ROW LEVEL SECURITY;\n\n-- RLS Policies for sports_courts\nCREATE POLICY \\"Members can view available courts\\" ON public.sports_courts\n  FOR SELECT USING (\n    is_available = true AND \n    is_out_of_order = false AND \n    organization_id IN (\n      SELECT organization_id FROM profiles WHERE id = auth.uid()\n    )\n  );\n\nCREATE POLICY \\"Staff can manage sports courts\\" ON public.sports_courts\n  FOR ALL USING (\n    organization_id IN (\n      SELECT organization_id FROM profiles \n      WHERE id = auth.uid() \n      AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n    )\n  );\n\n-- RLS Policies for court_reservations\nCREATE POLICY \\"Members can view their own reservations\\" ON public.court_reservations\n  FOR SELECT USING (\n    member_id = auth.uid() OR \n    organization_id IN (\n      SELECT organization_id FROM profiles \n      WHERE id = auth.uid() \n      AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n    )\n  );\n\nCREATE POLICY \\"Members can create reservations\\" ON public.court_reservations\n  FOR INSERT WITH CHECK (\n    member_id = auth.uid() AND \n    organization_id IN (\n      SELECT organization_id FROM profiles WHERE id = auth.uid()\n    )\n  );\n\nCREATE POLICY \\"Staff can manage all reservations\\" ON public.court_reservations\n  FOR ALL USING (\n    organization_id IN (\n      SELECT organization_id FROM profiles \n      WHERE id = auth.uid() \n      AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n    )\n  );\n\n-- RLS Policies for equipment_checkout\nCREATE POLICY \\"Members can view their own checkouts\\" ON public.equipment_checkout\n  FOR SELECT USING (\n    member_id = auth.uid() OR \n    organization_id IN (\n      SELECT organization_id FROM profiles \n      WHERE id = auth.uid() \n      AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n    )\n  );\n\nCREATE POLICY \\"Staff can manage equipment checkouts\\" ON public.equipment_checkout\n  FOR ALL USING (\n    organization_id IN (\n      SELECT organization_id FROM profiles \n      WHERE id = auth.uid() \n      AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n    )\n  );\n\n-- RLS Policies for sports_equipment\nCREATE POLICY \\"Members can view available equipment\\" ON public.sports_equipment\n  FOR SELECT USING (\n    is_available_for_rental = true AND \n    current_condition != 'out_of_service' AND \n    organization_id IN (\n      SELECT organization_id FROM profiles WHERE id = auth.uid()\n    )\n  );\n\nCREATE POLICY \\"Staff can manage sports equipment\\" ON public.sports_equipment\n  FOR ALL USING (\n    organization_id IN (\n      SELECT organization_id FROM profiles \n      WHERE id = auth.uid() \n      AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n    )\n  );\n\n-- RLS Policies for tournaments\nCREATE POLICY \\"Members can view tournaments\\" ON public.tournaments\n  FOR SELECT USING (\n    organization_id IN (\n      SELECT organization_id FROM profiles WHERE id = auth.uid()\n    )\n  );\n\nCREATE POLICY \\"Staff can manage tournaments\\" ON public.tournaments\n  FOR ALL USING (\n    organization_id IN (\n      SELECT organization_id FROM profiles \n      WHERE id = auth.uid() \n      AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n    )\n  );\n\n-- RLS Policies for tournament_participants\nCREATE POLICY \\"Members can view tournament participants\\" ON public.tournament_participants\n  FOR SELECT USING (\n    tournament_id IN (\n      SELECT id FROM tournaments \n      WHERE organization_id IN (\n        SELECT organization_id FROM profiles WHERE id = auth.uid()\n      )\n    )\n  );\n\nCREATE POLICY \\"Members can register for tournaments\\" ON public.tournament_participants\n  FOR INSERT WITH CHECK (\n    member_id = auth.uid() AND \n    tournament_id IN (\n      SELECT id FROM tournaments \n      WHERE organization_id IN (\n        SELECT organization_id FROM profiles WHERE id = auth.uid()\n      )\n    )\n  );\n\nCREATE POLICY \\"Staff can manage tournament participants\\" ON public.tournament_participants\n  FOR ALL USING (\n    tournament_id IN (\n      SELECT id FROM tournaments \n      WHERE organization_id IN (\n        SELECT organization_id FROM profiles \n        WHERE id = auth.uid() \n        AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n      )\n    )\n  );\n\n-- Create indexes for performance\nCREATE INDEX idx_sports_courts_organization ON public.sports_courts(organization_id);\nCREATE INDEX idx_sports_courts_type ON public.sports_courts(court_type);\nCREATE INDEX idx_court_reservations_organization ON public.court_reservations(organization_id);\nCREATE INDEX idx_court_reservations_member ON public.court_reservations(member_id);\nCREATE INDEX idx_court_reservations_date ON public.court_reservations(reservation_date, start_time);\nCREATE INDEX idx_equipment_checkout_member ON public.equipment_checkout(member_id);\nCREATE INDEX idx_equipment_checkout_status ON public.equipment_checkout(status);\nCREATE INDEX idx_sports_equipment_organization ON public.sports_equipment(organization_id);\nCREATE INDEX idx_sports_equipment_sport ON public.sports_equipment(sport);\nCREATE INDEX idx_tournaments_organization ON public.tournaments(organization_id);\nCREATE INDEX idx_tournament_participants_tournament ON public.tournament_participants(tournament_id);\n\n-- Add update triggers\nCREATE TRIGGER update_sports_courts_updated_at\n  BEFORE UPDATE ON public.sports_courts\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_court_reservations_updated_at\n  BEFORE UPDATE ON public.court_reservations\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_equipment_checkout_updated_at\n  BEFORE UPDATE ON public.equipment_checkout\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_sports_equipment_updated_at\n  BEFORE UPDATE ON public.sports_equipment\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_tournaments_updated_at\n  BEFORE UPDATE ON public.tournaments\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();"}		pearson.performance@gmail.com	\N	\N
20250920032350	{"-- Create pool/aquatic center management tables\nCREATE TABLE public.pool_facilities (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  location_id UUID REFERENCES public.locations(id),\n  pool_name TEXT NOT NULL,\n  pool_type TEXT NOT NULL DEFAULT 'indoor', -- indoor, outdoor, heated, therapy, lap, recreational\n  length_meters NUMERIC,\n  width_meters NUMERIC,\n  depth_min NUMERIC,\n  depth_max NUMERIC,\n  lane_count INTEGER DEFAULT 6,\n  temperature_target NUMERIC DEFAULT 78.0,\n  is_heated BOOLEAN DEFAULT true,\n  has_diving_board BOOLEAN DEFAULT false,\n  has_slides BOOLEAN DEFAULT false,\n  capacity_max INTEGER DEFAULT 50,\n  is_available BOOLEAN DEFAULT true,\n  is_closed_for_maintenance BOOLEAN DEFAULT false,\n  operating_hours_start TIME DEFAULT '06:00',\n  operating_hours_end TIME DEFAULT '22:00',\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  description TEXT,\n  safety_notes TEXT,\n  amenities TEXT[]\n);\n\n-- Create pool lane reservations table\nCREATE TABLE public.pool_lane_reservations (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  pool_id UUID NOT NULL REFERENCES public.pool_facilities(id) ON DELETE CASCADE,\n  lane_number INTEGER NOT NULL,\n  member_id UUID NOT NULL,\n  reservation_date DATE NOT NULL,\n  start_time TIME NOT NULL,\n  end_time TIME NOT NULL,\n  duration_minutes INTEGER NOT NULL DEFAULT 60,\n  purpose TEXT DEFAULT 'lap_swimming', -- lap_swimming, training, private_lesson, therapy\n  hourly_rate NUMERIC NOT NULL,\n  total_cost NUMERIC NOT NULL,\n  payment_status TEXT DEFAULT 'pending',\n  payment_method TEXT,\n  special_equipment TEXT[],\n  special_requests TEXT,\n  checked_in_at TIMESTAMP WITH TIME ZONE,\n  cancelled_at TIMESTAMP WITH TIME ZONE,\n  cancellation_reason TEXT,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  status TEXT NOT NULL DEFAULT 'confirmed'\n);\n\n-- Create swim lessons table\nCREATE TABLE public.swim_lessons (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  pool_id UUID NOT NULL REFERENCES public.pool_facilities(id),\n  instructor_id UUID NOT NULL,\n  lesson_name TEXT NOT NULL,\n  lesson_type TEXT NOT NULL DEFAULT 'group', -- private, semi_private, group\n  skill_level TEXT NOT NULL DEFAULT 'beginner', -- beginner, intermediate, advanced, competitive\n  max_participants INTEGER DEFAULT 8,\n  age_group TEXT DEFAULT 'adult', -- toddler, child, teen, adult, senior, all_ages\n  lesson_date DATE NOT NULL,\n  start_time TIME NOT NULL,\n  end_time TIME NOT NULL,\n  duration_minutes INTEGER NOT NULL DEFAULT 45,\n  lesson_fee NUMERIC NOT NULL,\n  recurring_schedule TEXT, -- weekly, biweekly, monthly\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  description TEXT,\n  requirements TEXT,\n  equipment_provided TEXT[],\n  status TEXT NOT NULL DEFAULT 'scheduled'\n);\n\n-- Create swim lesson enrollments table\nCREATE TABLE public.swim_lesson_enrollments (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  lesson_id UUID NOT NULL REFERENCES public.swim_lessons(id) ON DELETE CASCADE,\n  member_id UUID NOT NULL,\n  enrolled_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  enrollment_status TEXT DEFAULT 'enrolled', -- enrolled, waitlisted, completed, cancelled\n  payment_status TEXT DEFAULT 'pending',\n  payment_amount NUMERIC NOT NULL,\n  special_needs TEXT,\n  emergency_contact_name TEXT,\n  emergency_contact_phone TEXT,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  notes TEXT\n);\n\n-- Create lifeguard schedules table\nCREATE TABLE public.lifeguard_schedules (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  pool_id UUID NOT NULL REFERENCES public.pool_facilities(id),\n  lifeguard_id UUID NOT NULL,\n  scheduled_date DATE NOT NULL,\n  start_time TIME NOT NULL,\n  end_time TIME NOT NULL,\n  shift_type TEXT DEFAULT 'regular', -- regular, break_coverage, event_coverage, training\n  is_head_lifeguard BOOLEAN DEFAULT false,\n  certification_expires DATE,\n  created_by UUID NOT NULL,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  status TEXT DEFAULT 'scheduled', -- scheduled, confirmed, completed, no_show, cancelled\n  notes TEXT\n);\n\n-- Create water quality logs table\nCREATE TABLE public.water_quality_logs (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  pool_id UUID NOT NULL REFERENCES public.pool_facilities(id),\n  tested_by UUID NOT NULL,\n  test_date DATE NOT NULL DEFAULT CURRENT_DATE,\n  test_time TIME NOT NULL DEFAULT CURRENT_TIME,\n  ph_level NUMERIC,\n  chlorine_ppm NUMERIC,\n  alkalinity_ppm NUMERIC,\n  temperature_fahrenheit NUMERIC,\n  clarity_rating INTEGER CHECK (clarity_rating >= 1 AND clarity_rating <= 5),\n  bacteria_count INTEGER,\n  chemical_balance_ok BOOLEAN DEFAULT true,\n  action_required TEXT,\n  actions_taken TEXT,\n  next_test_due TIMESTAMP WITH TIME ZONE,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  notes TEXT,\n  compliance_status TEXT DEFAULT 'compliant' -- compliant, warning, critical\n);\n\n-- Create pool maintenance logs table\nCREATE TABLE public.pool_maintenance_logs (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  pool_id UUID NOT NULL REFERENCES public.pool_facilities(id),\n  maintenance_type TEXT NOT NULL, -- cleaning, chemical_treatment, equipment_repair, inspection\n  performed_by UUID NOT NULL,\n  maintenance_date DATE NOT NULL DEFAULT CURRENT_DATE,\n  start_time TIME NOT NULL,\n  end_time TIME,\n  scheduled_duration_minutes INTEGER,\n  actual_duration_minutes INTEGER,\n  equipment_used TEXT[],\n  chemicals_used JSONB, -- {chemical_name: amount_used}\n  issues_found TEXT,\n  actions_performed TEXT NOT NULL,\n  followup_required BOOLEAN DEFAULT false,\n  followup_due_date DATE,\n  cost_estimate NUMERIC,\n  actual_cost NUMERIC,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  maintenance_status TEXT DEFAULT 'completed', -- scheduled, in_progress, completed, delayed\n  priority_level TEXT DEFAULT 'medium', -- low, medium, high, emergency\n  notes TEXT\n);\n\n-- Enable Row Level Security\nALTER TABLE public.pool_facilities ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.pool_lane_reservations ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.swim_lessons ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.swim_lesson_enrollments ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.lifeguard_schedules ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.water_quality_logs ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.pool_maintenance_logs ENABLE ROW LEVEL SECURITY;\n\n-- RLS Policies for pool_facilities\nCREATE POLICY \\"Members can view available pools\\" ON public.pool_facilities\n  FOR SELECT USING (\n    is_available = true AND \n    is_closed_for_maintenance = false AND \n    organization_id IN (\n      SELECT organization_id FROM profiles WHERE id = auth.uid()\n    )\n  );\n\nCREATE POLICY \\"Staff can manage pools\\" ON public.pool_facilities\n  FOR ALL USING (\n    organization_id IN (\n      SELECT organization_id FROM profiles \n      WHERE id = auth.uid() \n      AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n    )\n  );\n\n-- RLS Policies for pool_lane_reservations\nCREATE POLICY \\"Members can view their own reservations\\" ON public.pool_lane_reservations\n  FOR SELECT USING (\n    member_id = auth.uid() OR \n    organization_id IN (\n      SELECT organization_id FROM profiles \n      WHERE id = auth.uid() \n      AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n    )\n  );\n\nCREATE POLICY \\"Members can create lane reservations\\" ON public.pool_lane_reservations\n  FOR INSERT WITH CHECK (\n    member_id = auth.uid() AND \n    organization_id IN (\n      SELECT organization_id FROM profiles WHERE id = auth.uid()\n    )\n  );\n\nCREATE POLICY \\"Staff can manage lane reservations\\" ON public.pool_lane_reservations\n  FOR ALL USING (\n    organization_id IN (\n      SELECT organization_id FROM profiles \n      WHERE id = auth.uid() \n      AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n    )\n  );\n\n-- RLS Policies for swim_lessons\nCREATE POLICY \\"Members can view swim lessons\\" ON public.swim_lessons\n  FOR SELECT USING (\n    organization_id IN (\n      SELECT organization_id FROM profiles WHERE id = auth.uid()\n    )\n  );\n\nCREATE POLICY \\"Staff and instructors can manage swim lessons\\" ON public.swim_lessons\n  FOR ALL USING (\n    instructor_id = auth.uid() OR \n    organization_id IN (\n      SELECT organization_id FROM profiles \n      WHERE id = auth.uid() \n      AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n    )\n  );\n\n-- RLS Policies for swim_lesson_enrollments\nCREATE POLICY \\"Members can view their own enrollments\\" ON public.swim_lesson_enrollments\n  FOR SELECT USING (\n    member_id = auth.uid() OR \n    lesson_id IN (\n      SELECT id FROM swim_lessons \n      WHERE organization_id IN (\n        SELECT organization_id FROM profiles \n        WHERE id = auth.uid() \n        AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n      )\n    )\n  );\n\nCREATE POLICY \\"Members can enroll in lessons\\" ON public.swim_lesson_enrollments\n  FOR INSERT WITH CHECK (\n    member_id = auth.uid()\n  );\n\nCREATE POLICY \\"Staff can manage enrollments\\" ON public.swim_lesson_enrollments\n  FOR ALL USING (\n    lesson_id IN (\n      SELECT id FROM swim_lessons \n      WHERE organization_id IN (\n        SELECT organization_id FROM profiles \n        WHERE id = auth.uid() \n        AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n      )\n    )\n  );\n\n-- RLS Policies for lifeguard_schedules\nCREATE POLICY \\"Lifeguards can view their schedules\\" ON public.lifeguard_schedules\n  FOR SELECT USING (\n    lifeguard_id = auth.uid() OR \n    organization_id IN (\n      SELECT organization_id FROM profiles \n      WHERE id = auth.uid() \n      AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n    )\n  );\n\nCREATE POLICY \\"Staff can manage lifeguard schedules\\" ON public.lifeguard_schedules\n  FOR ALL USING (\n    organization_id IN (\n      SELECT organization_id FROM profiles \n      WHERE id = auth.uid() \n      AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n    )\n  );\n\n-- RLS Policies for water_quality_logs\nCREATE POLICY \\"Staff can manage water quality logs\\" ON public.water_quality_logs\n  FOR ALL USING (\n    organization_id IN (\n      SELECT organization_id FROM profiles \n      WHERE id = auth.uid() \n      AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n    )\n  );\n\n-- RLS Policies for pool_maintenance_logs\nCREATE POLICY \\"Staff can manage maintenance logs\\" ON public.pool_maintenance_logs\n  FOR ALL USING (\n    organization_id IN (\n      SELECT organization_id FROM profiles \n      WHERE id = auth.uid() \n      AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n    )\n  );\n\n-- Create indexes for performance\nCREATE INDEX idx_pool_facilities_organization ON public.pool_facilities(organization_id);\nCREATE INDEX idx_pool_lane_reservations_organization ON public.pool_lane_reservations(organization_id);\nCREATE INDEX idx_pool_lane_reservations_member ON public.pool_lane_reservations(member_id);\nCREATE INDEX idx_pool_lane_reservations_date ON public.pool_lane_reservations(reservation_date, start_time);\nCREATE INDEX idx_swim_lessons_organization ON public.swim_lessons(organization_id);\nCREATE INDEX idx_swim_lessons_instructor ON public.swim_lessons(instructor_id);\nCREATE INDEX idx_swim_lesson_enrollments_member ON public.swim_lesson_enrollments(member_id);\nCREATE INDEX idx_lifeguard_schedules_organization ON public.lifeguard_schedules(organization_id);\nCREATE INDEX idx_lifeguard_schedules_lifeguard ON public.lifeguard_schedules(lifeguard_id);\nCREATE INDEX idx_water_quality_logs_pool ON public.water_quality_logs(pool_id, test_date);\nCREATE INDEX idx_pool_maintenance_logs_pool ON public.pool_maintenance_logs(pool_id, maintenance_date);\n\n-- Add update triggers\nCREATE TRIGGER update_pool_facilities_updated_at\n  BEFORE UPDATE ON public.pool_facilities\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_pool_lane_reservations_updated_at\n  BEFORE UPDATE ON public.pool_lane_reservations\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_swim_lessons_updated_at\n  BEFORE UPDATE ON public.swim_lessons\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_swim_lesson_enrollments_updated_at\n  BEFORE UPDATE ON public.swim_lesson_enrollments\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_lifeguard_schedules_updated_at\n  BEFORE UPDATE ON public.lifeguard_schedules\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_water_quality_logs_updated_at\n  BEFORE UPDATE ON public.water_quality_logs\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_pool_maintenance_logs_updated_at\n  BEFORE UPDATE ON public.pool_maintenance_logs\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();"}		pearson.performance@gmail.com	\N	\N
20250920033002	{"-- Create spa services table\nCREATE TABLE public.spa_services (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  service_name TEXT NOT NULL,\n  service_category TEXT NOT NULL DEFAULT 'massage',\n  description TEXT,\n  duration_minutes INTEGER NOT NULL DEFAULT 60,\n  base_price NUMERIC(10,2) NOT NULL,\n  commission_rate NUMERIC(5,2) DEFAULT 0.00,\n  requires_certification TEXT[] DEFAULT '{}',\n  equipment_needed TEXT[] DEFAULT '{}',\n  is_active BOOLEAN DEFAULT true,\n  max_advance_booking_days INTEGER DEFAULT 30,\n  min_advance_booking_hours INTEGER DEFAULT 2,\n  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT now()\n);\n\n-- Create spa appointments table\nCREATE TABLE public.spa_appointments (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  service_id UUID NOT NULL REFERENCES public.spa_services(id) ON DELETE RESTRICT,\n  member_id UUID NOT NULL,\n  therapist_id UUID NOT NULL,\n  appointment_date DATE NOT NULL,\n  start_time TIME NOT NULL,\n  end_time TIME NOT NULL,\n  duration_minutes INTEGER NOT NULL,\n  total_price NUMERIC(10,2) NOT NULL,\n  deposit_paid NUMERIC(10,2) DEFAULT 0.00,\n  payment_status TEXT DEFAULT 'pending',\n  status TEXT DEFAULT 'scheduled',\n  special_requests TEXT,\n  preparation_notes TEXT,\n  post_service_notes TEXT,\n  cancelled_at TIMESTAMPTZ,\n  cancellation_reason TEXT,\n  cancelled_by UUID,\n  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  \n  CONSTRAINT spa_appointments_status_check CHECK (status IN ('scheduled', 'confirmed', 'in_progress', 'completed', 'cancelled', 'no_show')),\n  CONSTRAINT spa_appointments_payment_status_check CHECK (payment_status IN ('pending', 'partial', 'paid', 'refunded'))\n);\n\n-- Create spa inventory table\nCREATE TABLE public.spa_inventory (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  product_name TEXT NOT NULL,\n  product_category TEXT NOT NULL DEFAULT 'oil',\n  brand TEXT,\n  product_code TEXT,\n  description TEXT,\n  unit_of_measurement TEXT DEFAULT 'ml',\n  current_stock INTEGER DEFAULT 0,\n  minimum_stock INTEGER DEFAULT 10,\n  maximum_stock INTEGER DEFAULT 100,\n  cost_per_unit NUMERIC(10,2) DEFAULT 0.00,\n  retail_price NUMERIC(10,2) DEFAULT 0.00,\n  supplier_name TEXT,\n  supplier_contact TEXT,\n  last_restock_date DATE,\n  expiry_date DATE,\n  storage_location TEXT,\n  usage_per_service NUMERIC(10,2) DEFAULT 0,\n  is_active BOOLEAN DEFAULT true,\n  requires_certification BOOLEAN DEFAULT false,\n  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  \n  CONSTRAINT spa_inventory_category_check CHECK (product_category IN ('oil', 'lotion', 'cream', 'towel', 'equipment', 'supplement', 'retail'))\n);\n\n-- Create spa service packages table\nCREATE TABLE public.spa_service_packages (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  package_name TEXT NOT NULL,\n  description TEXT,\n  service_ids UUID[] NOT NULL,\n  total_duration_minutes INTEGER NOT NULL,\n  individual_price NUMERIC(10,2) NOT NULL,\n  package_price NUMERIC(10,2) NOT NULL,\n  savings_amount NUMERIC(10,2) GENERATED ALWAYS AS (individual_price - package_price) STORED,\n  max_validity_days INTEGER DEFAULT 90,\n  is_active BOOLEAN DEFAULT true,\n  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT now()\n);\n\n-- Create therapist availability table\nCREATE TABLE public.therapist_availability (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  therapist_id UUID NOT NULL,\n  day_of_week INTEGER NOT NULL CHECK (day_of_week BETWEEN 0 AND 6),\n  start_time TIME NOT NULL,\n  end_time TIME NOT NULL,\n  break_start TIME,\n  break_end TIME,\n  is_available BOOLEAN DEFAULT true,\n  specializations TEXT[] DEFAULT '{}',\n  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  \n  UNIQUE (therapist_id, day_of_week, start_time)\n);\n\n-- Enable RLS\nALTER TABLE public.spa_services ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.spa_appointments ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.spa_inventory ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.spa_service_packages ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.therapist_availability ENABLE ROW LEVEL SECURITY;\n\n-- RLS Policies for spa_services\nCREATE POLICY \\"Members can view active spa services\\" \nON public.spa_services \nFOR SELECT \nUSING (\n  is_active = true \n  AND organization_id IN (\n    SELECT organization_id FROM profiles WHERE id = auth.uid()\n  )\n);\n\nCREATE POLICY \\"Staff can manage spa services\\" \nON public.spa_services \nFOR ALL \nUSING (\n  organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() \n    AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n  )\n);\n\n-- RLS Policies for spa_appointments\nCREATE POLICY \\"Members can view their own spa appointments\\" \nON public.spa_appointments \nFOR SELECT \nUSING (\n  member_id = auth.uid() \n  OR therapist_id = auth.uid()\n  OR organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() \n    AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n  )\n);\n\nCREATE POLICY \\"Members can book spa appointments\\" \nON public.spa_appointments \nFOR INSERT \nWITH CHECK (\n  member_id = auth.uid() \n  AND organization_id IN (\n    SELECT organization_id FROM profiles WHERE id = auth.uid()\n  )\n);\n\nCREATE POLICY \\"Therapists and staff can manage spa appointments\\" \nON public.spa_appointments \nFOR ALL \nUSING (\n  therapist_id = auth.uid()\n  OR organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() \n    AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n  )\n);\n\n-- RLS Policies for spa_inventory\nCREATE POLICY \\"Staff can manage spa inventory\\" \nON public.spa_inventory \nFOR ALL \nUSING (\n  organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() \n    AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n  )\n);\n\n-- RLS Policies for spa_service_packages\nCREATE POLICY \\"Members can view active spa packages\\" \nON public.spa_service_packages \nFOR SELECT \nUSING (\n  is_active = true \n  AND organization_id IN (\n    SELECT organization_id FROM profiles WHERE id = auth.uid()\n  )\n);\n\nCREATE POLICY \\"Staff can manage spa packages\\" \nON public.spa_service_packages \nFOR ALL \nUSING (\n  organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() \n    AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n  )\n);\n\n-- RLS Policies for therapist_availability\nCREATE POLICY \\"Members can view therapist availability\\" \nON public.therapist_availability \nFOR SELECT \nUSING (\n  is_available = true \n  AND organization_id IN (\n    SELECT organization_id FROM profiles WHERE id = auth.uid()\n  )\n);\n\nCREATE POLICY \\"Therapists can manage their own availability\\" \nON public.therapist_availability \nFOR ALL \nUSING (\n  therapist_id = auth.uid()\n  OR organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() \n    AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n  )\n);\n\n-- Create indexes for performance\nCREATE INDEX idx_spa_services_organization_active ON public.spa_services(organization_id, is_active);\nCREATE INDEX idx_spa_appointments_organization_date ON public.spa_appointments(organization_id, appointment_date);\nCREATE INDEX idx_spa_appointments_therapist_date ON public.spa_appointments(therapist_id, appointment_date);\nCREATE INDEX idx_spa_appointments_member ON public.spa_appointments(member_id);\nCREATE INDEX idx_spa_inventory_organization_active ON public.spa_inventory(organization_id, is_active);\nCREATE INDEX idx_spa_inventory_stock_level ON public.spa_inventory(organization_id, current_stock, minimum_stock);\nCREATE INDEX idx_therapist_availability_therapist_day ON public.therapist_availability(therapist_id, day_of_week);\n\n-- Create triggers for updated_at\nCREATE TRIGGER update_spa_services_updated_at \nBEFORE UPDATE ON public.spa_services \nFOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_spa_appointments_updated_at \nBEFORE UPDATE ON public.spa_appointments \nFOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_spa_inventory_updated_at \nBEFORE UPDATE ON public.spa_inventory \nFOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_spa_service_packages_updated_at \nBEFORE UPDATE ON public.spa_service_packages \nFOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_therapist_availability_updated_at \nBEFORE UPDATE ON public.therapist_availability \nFOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();"}		pearson.performance@gmail.com	\N	\N
20250920033915	{"-- Create child profiles table\nCREATE TABLE public.child_profiles (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  parent_member_id UUID NOT NULL,\n  child_first_name TEXT NOT NULL,\n  child_last_name TEXT NOT NULL,\n  date_of_birth DATE NOT NULL,\n  gender TEXT,\n  emergency_contact_name TEXT,\n  emergency_contact_phone TEXT,\n  medical_conditions TEXT,\n  allergies TEXT,\n  dietary_restrictions TEXT,\n  special_instructions TEXT,\n  authorized_pickup_contacts JSONB DEFAULT '[]'::jsonb,\n  photo_url TEXT,\n  is_active BOOLEAN DEFAULT true,\n  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  \n  CONSTRAINT child_profiles_gender_check CHECK (gender IN ('male', 'female', 'other', 'prefer_not_to_say'))\n);\n\n-- Create childcare activities table\nCREATE TABLE public.childcare_activities (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  activity_name TEXT NOT NULL,\n  description TEXT,\n  age_group_min_months INTEGER NOT NULL DEFAULT 0,\n  age_group_max_months INTEGER NOT NULL DEFAULT 144, -- 12 years\n  max_participants INTEGER DEFAULT 15,\n  staff_ratio_requirement INTEGER DEFAULT 8, -- 1 staff per X children\n  activity_date DATE NOT NULL,\n  start_time TIME NOT NULL,\n  end_time TIME NOT NULL,\n  duration_minutes INTEGER NOT NULL,\n  location_room TEXT,\n  equipment_needed TEXT[] DEFAULT '{}',\n  activity_fee NUMERIC(10,2) DEFAULT 0.00,\n  requires_registration BOOLEAN DEFAULT true,\n  registration_deadline TIMESTAMPTZ,\n  activity_type TEXT DEFAULT 'play',\n  is_recurring BOOLEAN DEFAULT false,\n  recurring_pattern TEXT,\n  assigned_staff UUID[] DEFAULT '{}',\n  status TEXT DEFAULT 'scheduled',\n  created_by UUID NOT NULL,\n  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  \n  CONSTRAINT childcare_activities_type_check CHECK (activity_type IN ('play', 'education', 'arts_crafts', 'story_time', 'outdoor', 'free_play')),\n  CONSTRAINT childcare_activities_status_check CHECK (status IN ('scheduled', 'in_progress', 'completed', 'cancelled'))\n);\n\n-- Create childcare check-ins table\nCREATE TABLE public.childcare_checkins (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  child_id UUID NOT NULL REFERENCES public.child_profiles(id) ON DELETE CASCADE,\n  activity_id UUID REFERENCES public.childcare_activities(id) ON DELETE SET NULL,\n  parent_member_id UUID NOT NULL,\n  check_in_time TIMESTAMPTZ NOT NULL DEFAULT now(),\n  check_out_time TIMESTAMPTZ,\n  checked_in_by UUID NOT NULL,\n  checked_out_by UUID,\n  drop_off_notes TEXT,\n  pick_up_notes TEXT,\n  child_condition_checkin TEXT DEFAULT 'good',\n  child_condition_checkout TEXT,\n  authorized_pickup_person TEXT,\n  pickup_person_id TEXT,\n  incident_occurred BOOLEAN DEFAULT false,\n  incident_description TEXT,\n  diaper_changes INTEGER DEFAULT 0,\n  meals_eaten TEXT[],\n  nap_start_time TIMESTAMPTZ,\n  nap_end_time TIMESTAMPTZ,\n  mood_rating INTEGER CHECK (mood_rating BETWEEN 1 AND 5),\n  activities_participated TEXT[],\n  status TEXT DEFAULT 'checked_in',\n  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  \n  CONSTRAINT childcare_checkins_status_check CHECK (status IN ('checked_in', 'checked_out', 'emergency_pickup')),\n  CONSTRAINT childcare_checkins_condition_check CHECK (\n    child_condition_checkin IN ('excellent', 'good', 'fair', 'sick', 'upset') AND\n    (child_condition_checkout IS NULL OR child_condition_checkout IN ('excellent', 'good', 'fair', 'sick', 'upset'))\n  )\n);\n\n-- Create childcare activity registrations table\nCREATE TABLE public.childcare_activity_registrations (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  activity_id UUID NOT NULL REFERENCES public.childcare_activities(id) ON DELETE CASCADE,\n  child_id UUID NOT NULL REFERENCES public.child_profiles(id) ON DELETE CASCADE,\n  parent_member_id UUID NOT NULL,\n  registration_date TIMESTAMPTZ NOT NULL DEFAULT now(),\n  attended BOOLEAN DEFAULT false,\n  payment_status TEXT DEFAULT 'pending',\n  special_requests TEXT,\n  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  \n  UNIQUE (activity_id, child_id),\n  CONSTRAINT childcare_registrations_payment_check CHECK (payment_status IN ('pending', 'paid', 'waived', 'refunded'))\n);\n\n-- Create childcare staff schedules table\nCREATE TABLE public.childcare_staff_schedules (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  staff_id UUID NOT NULL,\n  schedule_date DATE NOT NULL,\n  start_time TIME NOT NULL,\n  end_time TIME NOT NULL,\n  break_start TIME,\n  break_end TIME,\n  max_children_capacity INTEGER DEFAULT 8,\n  current_children_count INTEGER DEFAULT 0,\n  room_assignment TEXT,\n  age_group_specialization TEXT[] DEFAULT '{}',\n  certifications TEXT[] DEFAULT '{}',\n  is_available BOOLEAN DEFAULT true,\n  notes TEXT,\n  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  \n  UNIQUE (staff_id, schedule_date, start_time)\n);\n\n-- Create childcare daily reports table\nCREATE TABLE public.childcare_daily_reports (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  child_id UUID NOT NULL REFERENCES public.child_profiles(id) ON DELETE CASCADE,\n  report_date DATE NOT NULL DEFAULT CURRENT_DATE,\n  arrival_time TIMESTAMPTZ,\n  departure_time TIMESTAMPTZ,\n  meals JSON DEFAULT '[]'::json,\n  naps JSON DEFAULT '[]'::json,\n  diaper_changes JSON DEFAULT '[]'::json,\n  activities JSON DEFAULT '[]'::json,\n  mood_observations TEXT,\n  learning_milestones TEXT,\n  social_interactions TEXT,\n  parent_communication TEXT,\n  photos_taken INTEGER DEFAULT 0,\n  incidents JSON DEFAULT '[]'::json,\n  overall_rating INTEGER CHECK (overall_rating BETWEEN 1 AND 5),\n  staff_notes TEXT,\n  parent_signature_required BOOLEAN DEFAULT false,\n  parent_signed_at TIMESTAMPTZ,\n  created_by UUID NOT NULL,\n  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  \n  UNIQUE (child_id, report_date)\n);\n\n-- Enable RLS\nALTER TABLE public.child_profiles ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.childcare_activities ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.childcare_checkins ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.childcare_activity_registrations ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.childcare_staff_schedules ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.childcare_daily_reports ENABLE ROW LEVEL SECURITY;\n\n-- RLS Policies for child_profiles\nCREATE POLICY \\"Parents can view their own children profiles\\" \nON public.child_profiles \nFOR SELECT \nUSING (\n  parent_member_id = auth.uid() \n  OR organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() \n    AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n  )\n);\n\nCREATE POLICY \\"Parents can create child profiles\\" \nON public.child_profiles \nFOR INSERT \nWITH CHECK (\n  parent_member_id = auth.uid() \n  AND organization_id IN (\n    SELECT organization_id FROM profiles WHERE id = auth.uid()\n  )\n);\n\nCREATE POLICY \\"Parents and staff can update child profiles\\" \nON public.child_profiles \nFOR UPDATE \nUSING (\n  parent_member_id = auth.uid() \n  OR organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() \n    AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n  )\n);\n\nCREATE POLICY \\"Staff can manage child profiles\\" \nON public.child_profiles \nFOR DELETE \nUSING (\n  organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() \n    AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role])\n  )\n);\n\n-- RLS Policies for childcare_activities\nCREATE POLICY \\"Members can view childcare activities\\" \nON public.childcare_activities \nFOR SELECT \nUSING (\n  organization_id IN (\n    SELECT organization_id FROM profiles WHERE id = auth.uid()\n  )\n);\n\nCREATE POLICY \\"Staff can manage childcare activities\\" \nON public.childcare_activities \nFOR ALL \nUSING (\n  organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() \n    AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n  )\n);\n\n-- RLS Policies for childcare_checkins\nCREATE POLICY \\"Parents can view their children check-ins\\" \nON public.childcare_checkins \nFOR SELECT \nUSING (\n  parent_member_id = auth.uid() \n  OR organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() \n    AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n  )\n);\n\nCREATE POLICY \\"Staff can manage all check-ins\\" \nON public.childcare_checkins \nFOR ALL \nUSING (\n  organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() \n    AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n  )\n);\n\n-- RLS Policies for childcare_activity_registrations\nCREATE POLICY \\"Parents can register their children\\" \nON public.childcare_activity_registrations \nFOR ALL \nUSING (\n  parent_member_id = auth.uid() \n  OR organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() \n    AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n  )\n);\n\n-- RLS Policies for childcare_staff_schedules\nCREATE POLICY \\"Staff can view schedules\\" \nON public.childcare_staff_schedules \nFOR SELECT \nUSING (\n  staff_id = auth.uid() \n  OR organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() \n    AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n  )\n);\n\nCREATE POLICY \\"Staff can manage their own schedules\\" \nON public.childcare_staff_schedules \nFOR ALL \nUSING (\n  staff_id = auth.uid() \n  OR organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() \n    AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role])\n  )\n);\n\n-- RLS Policies for childcare_daily_reports\nCREATE POLICY \\"Parents can view their children reports\\" \nON public.childcare_daily_reports \nFOR SELECT \nUSING (\n  child_id IN (\n    SELECT id FROM child_profiles WHERE parent_member_id = auth.uid()\n  )\n  OR organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() \n    AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n  )\n);\n\nCREATE POLICY \\"Staff can manage daily reports\\" \nON public.childcare_daily_reports \nFOR ALL \nUSING (\n  organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() \n    AND role = ANY(ARRAY['owner'::user_role, 'manager'::user_role, 'staff'::user_role])\n  )\n);\n\n-- Create indexes for performance\nCREATE INDEX idx_child_profiles_organization_parent ON public.child_profiles(organization_id, parent_member_id);\nCREATE INDEX idx_child_profiles_date_of_birth ON public.child_profiles(date_of_birth);\nCREATE INDEX idx_childcare_activities_organization_date ON public.childcare_activities(organization_id, activity_date);\nCREATE INDEX idx_childcare_activities_age_group ON public.childcare_activities(age_group_min_months, age_group_max_months);\nCREATE INDEX idx_childcare_checkins_organization ON public.childcare_checkins(organization_id);\nCREATE INDEX idx_childcare_checkins_child ON public.childcare_checkins(child_id);\nCREATE INDEX idx_childcare_checkins_status ON public.childcare_checkins(status, check_out_time);\nCREATE INDEX idx_childcare_staff_schedules_date_staff ON public.childcare_staff_schedules(schedule_date, staff_id);\nCREATE INDEX idx_childcare_daily_reports_child_date ON public.childcare_daily_reports(child_id, report_date);\n\n-- Create triggers for updated_at\nCREATE TRIGGER update_child_profiles_updated_at \nBEFORE UPDATE ON public.child_profiles \nFOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_childcare_activities_updated_at \nBEFORE UPDATE ON public.childcare_activities \nFOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_childcare_checkins_updated_at \nBEFORE UPDATE ON public.childcare_checkins \nFOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_childcare_activity_registrations_updated_at \nBEFORE UPDATE ON public.childcare_activity_registrations \nFOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_childcare_staff_schedules_updated_at \nBEFORE UPDATE ON public.childcare_staff_schedules \nFOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_childcare_daily_reports_updated_at \nBEFORE UPDATE ON public.childcare_daily_reports \nFOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();\n\n-- Utility function to calculate child age in months\nCREATE OR REPLACE FUNCTION public.calculate_child_age_months(birth_date DATE)\nRETURNS INTEGER AS $$\nBEGIN\n  RETURN EXTRACT(YEAR FROM age(CURRENT_DATE, birth_date)) * 12 + \n         EXTRACT(MONTH FROM age(CURRENT_DATE, birth_date));\nEND;\n$$ LANGUAGE plpgsql STABLE SET search_path = public;"}		pearson.performance@gmail.com	\N	\N
20250920034508	{"-- Create retail products table\nCREATE TABLE public.retail_products (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  sku TEXT NOT NULL,\n  name TEXT NOT NULL,\n  description TEXT,\n  category TEXT NOT NULL DEFAULT 'general',\n  brand TEXT,\n  supplier TEXT,\n  cost_price NUMERIC(10,2),\n  sale_price NUMERIC(10,2) NOT NULL,\n  tax_rate NUMERIC(5,2) DEFAULT 0.00,\n  is_active BOOLEAN DEFAULT true,\n  requires_age_verification BOOLEAN DEFAULT false,\n  weight_grams INTEGER,\n  dimensions TEXT,\n  image_url TEXT,\n  barcode TEXT,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  UNIQUE(organization_id, sku)\n);\n\n-- Create inventory items table for stock tracking\nCREATE TABLE public.inventory_items (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  product_id UUID NOT NULL REFERENCES public.retail_products(id) ON DELETE CASCADE,\n  location_id UUID REFERENCES public.locations(id),\n  current_stock INTEGER NOT NULL DEFAULT 0,\n  min_stock_level INTEGER DEFAULT 0,\n  max_stock_level INTEGER,\n  reorder_point INTEGER DEFAULT 0,\n  last_restocked_at TIMESTAMP WITH TIME ZONE,\n  last_count_date DATE,\n  cost_per_unit NUMERIC(10,2),\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  UNIQUE(product_id, location_id)\n);\n\n-- Create retail transactions table\nCREATE TABLE public.retail_transactions (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  transaction_number TEXT NOT NULL,\n  member_id UUID,\n  cashier_id UUID NOT NULL,\n  location_id UUID REFERENCES public.locations(id),\n  subtotal NUMERIC(10,2) NOT NULL DEFAULT 0,\n  tax_amount NUMERIC(10,2) NOT NULL DEFAULT 0,\n  discount_amount NUMERIC(10,2) DEFAULT 0,\n  total_amount NUMERIC(10,2) NOT NULL,\n  amount_tendered NUMERIC(10,2),\n  change_given NUMERIC(10,2) DEFAULT 0,\n  payment_method TEXT NOT NULL DEFAULT 'cash',\n  payment_reference TEXT,\n  transaction_date TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  void_reason TEXT,\n  voided_by UUID,\n  voided_at TIMESTAMP WITH TIME ZONE,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  status TEXT NOT NULL DEFAULT 'completed',\n  notes TEXT,\n  UNIQUE(organization_id, transaction_number)\n);\n\n-- Create retail transaction items table\nCREATE TABLE public.retail_transaction_items (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  transaction_id UUID NOT NULL REFERENCES public.retail_transactions(id) ON DELETE CASCADE,\n  product_id UUID NOT NULL REFERENCES public.retail_products(id),\n  quantity INTEGER NOT NULL DEFAULT 1,\n  unit_price NUMERIC(10,2) NOT NULL,\n  discount_amount NUMERIC(10,2) DEFAULT 0,\n  tax_rate NUMERIC(5,2) DEFAULT 0,\n  line_total NUMERIC(10,2) NOT NULL,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Create stock movements table for inventory tracking\nCREATE TABLE public.stock_movements (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  inventory_item_id UUID NOT NULL REFERENCES public.inventory_items(id) ON DELETE CASCADE,\n  transaction_id UUID REFERENCES public.retail_transactions(id),\n  movement_type TEXT NOT NULL, -- 'sale', 'restock', 'adjustment', 'return', 'waste'\n  quantity_change INTEGER NOT NULL,\n  reference_number TEXT,\n  reason TEXT,\n  performed_by UUID NOT NULL,\n  movement_date TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  notes TEXT\n);\n\n-- Enable RLS on all tables\nALTER TABLE public.retail_products ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.inventory_items ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.retail_transactions ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.retail_transaction_items ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.stock_movements ENABLE ROW LEVEL SECURITY;\n\n-- RLS Policies for retail_products\nCREATE POLICY \\"Staff can manage retail products\\" ON public.retail_products\nFOR ALL USING (\n  organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() \n    AND role IN ('owner', 'manager', 'staff')\n  )\n);\n\nCREATE POLICY \\"Members can view active products\\" ON public.retail_products\nFOR SELECT USING (\n  is_active = true AND \n  organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid()\n  )\n);\n\n-- RLS Policies for inventory_items\nCREATE POLICY \\"Staff can manage inventory\\" ON public.inventory_items\nFOR ALL USING (\n  organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() \n    AND role IN ('owner', 'manager', 'staff')\n  )\n);\n\n-- RLS Policies for retail_transactions\nCREATE POLICY \\"Staff can manage transactions\\" ON public.retail_transactions\nFOR ALL USING (\n  organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() \n    AND role IN ('owner', 'manager', 'staff')\n  )\n);\n\nCREATE POLICY \\"Members can view their own transactions\\" ON public.retail_transactions\nFOR SELECT USING (\n  member_id = auth.uid() OR \n  organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() \n    AND role IN ('owner', 'manager', 'staff')\n  )\n);\n\n-- RLS Policies for retail_transaction_items\nCREATE POLICY \\"Staff can manage transaction items\\" ON public.retail_transaction_items\nFOR ALL USING (\n  transaction_id IN (\n    SELECT id FROM retail_transactions \n    WHERE organization_id IN (\n      SELECT organization_id FROM profiles \n      WHERE id = auth.uid() \n      AND role IN ('owner', 'manager', 'staff')\n    )\n  )\n);\n\n-- RLS Policies for stock_movements\nCREATE POLICY \\"Staff can manage stock movements\\" ON public.stock_movements\nFOR ALL USING (\n  organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() \n    AND role IN ('owner', 'manager', 'staff')\n  )\n);\n\n-- Create indexes for better performance\nCREATE INDEX idx_retail_products_org_active ON public.retail_products(organization_id, is_active);\nCREATE INDEX idx_retail_products_sku ON public.retail_products(organization_id, sku);\nCREATE INDEX idx_retail_products_category ON public.retail_products(organization_id, category);\nCREATE INDEX idx_inventory_items_org_product ON public.inventory_items(organization_id, product_id);\nCREATE INDEX idx_inventory_items_stock_level ON public.inventory_items(organization_id, current_stock, min_stock_level);\nCREATE INDEX idx_retail_transactions_org_date ON public.retail_transactions(organization_id, transaction_date);\nCREATE INDEX idx_retail_transactions_member ON public.retail_transactions(member_id);\nCREATE INDEX idx_retail_transactions_cashier ON public.retail_transactions(cashier_id);\nCREATE INDEX idx_stock_movements_org_date ON public.stock_movements(organization_id, movement_date);\nCREATE INDEX idx_stock_movements_inventory ON public.stock_movements(inventory_item_id);\n\n-- Create triggers for updated_at columns\nCREATE TRIGGER update_retail_products_updated_at\n  BEFORE UPDATE ON public.retail_products\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_inventory_items_updated_at\n  BEFORE UPDATE ON public.inventory_items\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_retail_transactions_updated_at\n  BEFORE UPDATE ON public.retail_transactions\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\n-- Create function to automatically update stock levels\nCREATE OR REPLACE FUNCTION public.update_inventory_on_transaction()\nRETURNS TRIGGER AS $$\nBEGIN\n  -- Update stock when transaction item is inserted (sale)\n  IF TG_OP = 'INSERT' THEN\n    UPDATE public.inventory_items \n    SET current_stock = current_stock - NEW.quantity\n    WHERE product_id = NEW.product_id;\n    \n    -- Create stock movement record\n    INSERT INTO public.stock_movements (\n      organization_id,\n      inventory_item_id,\n      transaction_id,\n      movement_type,\n      quantity_change,\n      performed_by\n    )\n    SELECT \n      rt.organization_id,\n      ii.id,\n      NEW.transaction_id,\n      'sale',\n      -NEW.quantity,\n      rt.cashier_id\n    FROM retail_transactions rt\n    JOIN inventory_items ii ON ii.product_id = NEW.product_id\n    WHERE rt.id = NEW.transaction_id;\n    \n    RETURN NEW;\n  END IF;\n  \n  RETURN NULL;\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER SET search_path = public;\n\n-- Create trigger to update inventory on sales\nCREATE TRIGGER update_inventory_on_sale\n  AFTER INSERT ON public.retail_transaction_items\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_inventory_on_transaction();\n\n-- Create function to generate transaction numbers\nCREATE OR REPLACE FUNCTION public.generate_transaction_number()\nRETURNS TEXT AS $$\nDECLARE\n  new_number TEXT;\n  number_exists BOOLEAN;\nBEGIN\n  LOOP\n    -- Generate transaction number: current date + 6 random digits\n    new_number := to_char(CURRENT_DATE, 'YYYYMMDD') || LPAD(FLOOR(RANDOM() * 1000000)::TEXT, 6, '0');\n    \n    -- Check if number already exists\n    SELECT EXISTS(SELECT 1 FROM public.retail_transactions WHERE transaction_number = new_number) INTO number_exists;\n    \n    IF NOT number_exists THEN\n      EXIT;\n    END IF;\n  END LOOP;\n  \n  RETURN new_number;\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER SET search_path = public;\n\n-- Create trigger to auto-generate transaction numbers\nCREATE OR REPLACE FUNCTION public.set_transaction_number()\nRETURNS TRIGGER AS $$\nBEGIN\n  IF NEW.transaction_number IS NULL OR NEW.transaction_number = '' THEN\n    NEW.transaction_number := public.generate_transaction_number();\n  END IF;\n  RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql SET search_path = public;\n\nCREATE TRIGGER set_transaction_number_trigger\n  BEFORE INSERT ON public.retail_transactions\n  FOR EACH ROW\n  EXECUTE FUNCTION public.set_transaction_number();"}		pearson.performance@gmail.com	\N	\N
20250920040333	{"-- Equipment Safety Inspections System\n-- Critical for safety compliance and liability protection\n\n-- Create inspection checklists table (reusable templates)\nCREATE TABLE public.inspection_checklists (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  checklist_name TEXT NOT NULL,\n  equipment_type TEXT NOT NULL, -- matches equipment.equipment_type\n  description TEXT,\n  frequency_days INTEGER NOT NULL DEFAULT 30, -- inspection frequency\n  is_active BOOLEAN DEFAULT true,\n  requires_certification BOOLEAN DEFAULT false,\n  created_by UUID NOT NULL,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Create inspection checklist items\nCREATE TABLE public.inspection_checklist_items (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  checklist_id UUID NOT NULL,\n  item_number INTEGER NOT NULL,\n  item_description TEXT NOT NULL,\n  is_critical BOOLEAN DEFAULT false, -- critical safety item\n  expected_condition TEXT, -- what should pass\n  inspection_method TEXT, -- visual, functional, measurement, etc.\n  pass_criteria TEXT,\n  fail_criteria TEXT,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Create safety inspections table\nCREATE TABLE public.safety_inspections (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  equipment_id UUID NOT NULL,\n  checklist_id UUID NOT NULL,\n  inspector_id UUID NOT NULL, -- staff member conducting inspection\n  scheduled_date DATE NOT NULL,\n  completed_at TIMESTAMP WITH TIME ZONE,\n  overall_status TEXT NOT NULL DEFAULT 'pending' CHECK (overall_status IN ('pending', 'passed', 'failed', 'needs_attention')),\n  total_items INTEGER DEFAULT 0,\n  passed_items INTEGER DEFAULT 0,\n  failed_items INTEGER DEFAULT 0,\n  critical_failures INTEGER DEFAULT 0,\n  next_inspection_date DATE,\n  estimated_duration_minutes INTEGER DEFAULT 30,\n  actual_duration_minutes INTEGER,\n  inspection_notes TEXT,\n  recommendations TEXT,\n  requires_immediate_attention BOOLEAN DEFAULT false,\n  equipment_taken_offline BOOLEAN DEFAULT false,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Create inspection results for each checklist item\nCREATE TABLE public.inspection_results (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  inspection_id UUID NOT NULL,\n  checklist_item_id UUID NOT NULL,\n  result_status TEXT NOT NULL CHECK (result_status IN ('pass', 'fail', 'not_applicable', 'needs_repair')),\n  inspector_notes TEXT,\n  photo_urls TEXT[], -- array of photo URLs for documentation\n  measurements JSONB, -- store any measurements taken\n  action_required TEXT,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Create violations table for tracking safety issues\nCREATE TABLE public.safety_violations (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  inspection_id UUID NOT NULL,\n  equipment_id UUID NOT NULL,\n  violation_type TEXT NOT NULL,\n  severity_level TEXT NOT NULL CHECK (severity_level IN ('low', 'medium', 'high', 'critical')),\n  description TEXT NOT NULL,\n  photo_documentation TEXT[], -- photo evidence\n  immediate_action_taken TEXT,\n  corrective_action_required TEXT,\n  assigned_to UUID, -- staff member responsible for fix\n  target_resolution_date DATE,\n  resolved_at TIMESTAMP WITH TIME ZONE,\n  resolution_notes TEXT,\n  follow_up_required BOOLEAN DEFAULT false,\n  follow_up_date DATE,\n  compliance_impact TEXT,\n  created_by UUID NOT NULL,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  status TEXT NOT NULL DEFAULT 'open' CHECK (status IN ('open', 'in_progress', 'resolved', 'closed'))\n);\n\n-- Enable RLS\nALTER TABLE public.inspection_checklists ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.inspection_checklist_items ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.safety_inspections ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.inspection_results ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.safety_violations ENABLE ROW LEVEL SECURITY;\n\n-- RLS Policies for inspection_checklists\nCREATE POLICY \\"Staff can view checklists in their organization\\"\n  ON public.inspection_checklists FOR SELECT\n  USING (organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n  ));\n\nCREATE POLICY \\"Staff can manage checklists in their organization\\"\n  ON public.inspection_checklists FOR ALL\n  USING (organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n  ));\n\n-- RLS Policies for inspection_checklist_items\nCREATE POLICY \\"Staff can view checklist items\\"\n  ON public.inspection_checklist_items FOR SELECT\n  USING (checklist_id IN (\n    SELECT id FROM inspection_checklists \n    WHERE organization_id IN (\n      SELECT organization_id FROM profiles \n      WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n    )\n  ));\n\nCREATE POLICY \\"Staff can manage checklist items\\"\n  ON public.inspection_checklist_items FOR ALL\n  USING (checklist_id IN (\n    SELECT id FROM inspection_checklists \n    WHERE organization_id IN (\n      SELECT organization_id FROM profiles \n      WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n    )\n  ));\n\n-- RLS Policies for safety_inspections\nCREATE POLICY \\"Staff can view inspections in their organization\\"\n  ON public.safety_inspections FOR SELECT\n  USING (organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n  ));\n\nCREATE POLICY \\"Staff can manage inspections in their organization\\"\n  ON public.safety_inspections FOR ALL\n  USING (organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n  ));\n\n-- RLS Policies for inspection_results\nCREATE POLICY \\"Staff can view inspection results\\"\n  ON public.inspection_results FOR SELECT\n  USING (inspection_id IN (\n    SELECT id FROM safety_inspections \n    WHERE organization_id IN (\n      SELECT organization_id FROM profiles \n      WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n    )\n  ));\n\nCREATE POLICY \\"Staff can manage inspection results\\"\n  ON public.inspection_results FOR ALL\n  USING (inspection_id IN (\n    SELECT id FROM safety_inspections \n    WHERE organization_id IN (\n      SELECT organization_id FROM profiles \n      WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n    )\n  ));\n\n-- RLS Policies for safety_violations\nCREATE POLICY \\"Staff can view violations in their organization\\"\n  ON public.safety_violations FOR SELECT\n  USING (organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n  ));\n\nCREATE POLICY \\"Staff can manage violations in their organization\\"\n  ON public.safety_violations FOR ALL\n  USING (organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n  ));\n\n-- Add indexes for performance\nCREATE INDEX idx_inspection_checklists_org_id ON public.inspection_checklists(organization_id);\nCREATE INDEX idx_inspection_checklists_equipment_type ON public.inspection_checklists(equipment_type);\nCREATE INDEX idx_checklist_items_checklist_id ON public.inspection_checklist_items(checklist_id);\nCREATE INDEX idx_safety_inspections_org_id ON public.safety_inspections(organization_id);\nCREATE INDEX idx_safety_inspections_equipment_id ON public.safety_inspections(equipment_id);\nCREATE INDEX idx_safety_inspections_scheduled_date ON public.safety_inspections(scheduled_date);\nCREATE INDEX idx_inspection_results_inspection_id ON public.inspection_results(inspection_id);\nCREATE INDEX idx_safety_violations_org_id ON public.safety_violations(organization_id);\nCREATE INDEX idx_safety_violations_equipment_id ON public.safety_violations(equipment_id);\nCREATE INDEX idx_safety_violations_status ON public.safety_violations(status);\n\n-- Add triggers for updated_at\nCREATE TRIGGER update_inspection_checklists_updated_at \n  BEFORE UPDATE ON public.inspection_checklists\n  FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_inspection_checklist_items_updated_at \n  BEFORE UPDATE ON public.inspection_checklist_items\n  FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_safety_inspections_updated_at \n  BEFORE UPDATE ON public.safety_inspections\n  FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_inspection_results_updated_at \n  BEFORE UPDATE ON public.inspection_results\n  FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_safety_violations_updated_at \n  BEFORE UPDATE ON public.safety_violations\n  FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();\n\n-- Function to calculate inspection statistics\nCREATE OR REPLACE FUNCTION public.update_inspection_statistics()\nRETURNS TRIGGER AS $$\nBEGIN\n  -- Update inspection totals based on results\n  UPDATE public.safety_inspections \n  SET \n    total_items = (\n      SELECT COUNT(*) FROM inspection_results \n      WHERE inspection_id = NEW.inspection_id\n    ),\n    passed_items = (\n      SELECT COUNT(*) FROM inspection_results \n      WHERE inspection_id = NEW.inspection_id AND result_status = 'pass'\n    ),\n    failed_items = (\n      SELECT COUNT(*) FROM inspection_results \n      WHERE inspection_id = NEW.inspection_id AND result_status IN ('fail', 'needs_repair')\n    ),\n    critical_failures = (\n      SELECT COUNT(*) FROM inspection_results ir\n      JOIN inspection_checklist_items ici ON ir.checklist_item_id = ici.id\n      WHERE ir.inspection_id = NEW.inspection_id \n      AND ir.result_status IN ('fail', 'needs_repair')\n      AND ici.is_critical = true\n    )\n  WHERE id = NEW.inspection_id;\n  \n  -- Update overall status\n  UPDATE public.safety_inspections \n  SET overall_status = CASE\n    WHEN critical_failures > 0 THEN 'failed'\n    WHEN failed_items > 0 THEN 'needs_attention'\n    WHEN total_items > 0 AND passed_items = total_items THEN 'passed'\n    ELSE 'pending'\n  END\n  WHERE id = NEW.inspection_id;\n  \n  RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER SET search_path = public;\n\n-- Trigger to update inspection statistics\nCREATE TRIGGER update_inspection_stats_on_result_change\n  AFTER INSERT OR UPDATE OR DELETE ON public.inspection_results\n  FOR EACH ROW EXECUTE FUNCTION public.update_inspection_statistics();\n\n-- Function to schedule next inspection\nCREATE OR REPLACE FUNCTION public.schedule_next_inspection()\nRETURNS TRIGGER AS $$\nDECLARE\n  checklist_frequency INTEGER;\nBEGIN\n  -- Only schedule when inspection is completed\n  IF NEW.completed_at IS NOT NULL AND (OLD.completed_at IS NULL OR OLD.completed_at != NEW.completed_at) THEN\n    -- Get checklist frequency\n    SELECT frequency_days INTO checklist_frequency\n    FROM inspection_checklists \n    WHERE id = NEW.checklist_id;\n    \n    -- Calculate and set next inspection date\n    NEW.next_inspection_date := NEW.completed_at::date + (checklist_frequency || ' days')::interval;\n    \n    -- Update equipment's next inspection date\n    UPDATE equipment \n    SET next_maintenance_date = NEW.next_inspection_date\n    WHERE id = NEW.equipment_id;\n  END IF;\n  \n  RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER SET search_path = public;"}		pearson.performance@gmail.com	\N	\N
20250920040408	{"-- Fix security definer functions that don't have proper search_path\n-- These are likely existing functions that need to be updated\n\n-- Update existing functions to have proper search_path setting\nCREATE OR REPLACE FUNCTION public.recalculate_lead_scores(org_id uuid)\n RETURNS void\n LANGUAGE plpgsql\n SECURITY DEFINER\n SET search_path = public  -- Add this line\nAS $$\nBEGIN\n  -- Reset all lead scores for the organization\n  UPDATE public.leads \n  SET lead_score = 0, qualification_status = 'unqualified'\n  WHERE organization_id = org_id;\n  \n  -- This is a placeholder for the actual scoring logic\n  -- In a real implementation, you would loop through scoring rules\n  -- and apply them to calculate scores for each lead\n  \n  -- Update qualification status based on score ranges\n  UPDATE public.leads \n  SET qualification_status = CASE \n    WHEN lead_score >= 80 THEN 'qualified'\n    WHEN lead_score >= 60 THEN 'hot'\n    WHEN lead_score >= 40 THEN 'warm'\n    WHEN lead_score >= 20 THEN 'cold'\n    ELSE 'unqualified'\n  END\n  WHERE organization_id = org_id;\nEND;\n$$;\n\n-- Update other functions that might have search_path issues\nCREATE OR REPLACE FUNCTION public.update_inventory_on_transaction()\n RETURNS trigger\n LANGUAGE plpgsql\n SECURITY DEFINER\n SET search_path = public  -- Add this line\nAS $$\nBEGIN\n  -- Update stock when transaction item is inserted (sale)\n  IF TG_OP = 'INSERT' THEN\n    UPDATE public.inventory_items \n    SET current_stock = current_stock - NEW.quantity\n    WHERE product_id = NEW.product_id;\n    \n    -- Create stock movement record\n    INSERT INTO public.stock_movements (\n      organization_id,\n      inventory_item_id,\n      transaction_id,\n      movement_type,\n      quantity_change,\n      performed_by\n    )\n    SELECT \n      rt.organization_id,\n      ii.id,\n      NEW.transaction_id,\n      'sale',\n      -NEW.quantity,\n      rt.cashier_id\n    FROM retail_transactions rt\n    JOIN inventory_items ii ON ii.product_id = NEW.product_id\n    WHERE rt.id = NEW.transaction_id;\n    \n    RETURN NEW;\n  END IF;\n  \n  RETURN NULL;\nEND;\n$$;\n\nCREATE OR REPLACE FUNCTION public.generate_transaction_number()\n RETURNS text\n LANGUAGE plpgsql\n SECURITY DEFINER\n SET search_path = public  -- Add this line\nAS $$\nDECLARE\n  new_number TEXT;\n  number_exists BOOLEAN;\nBEGIN\n  LOOP\n    -- Generate transaction number: current date + 6 random digits\n    new_number := to_char(CURRENT_DATE, 'YYYYMMDD') || LPAD(FLOOR(RANDOM() * 1000000)::TEXT, 6, '0');\n    \n    -- Check if number already exists\n    SELECT EXISTS(SELECT 1 FROM public.retail_transactions WHERE transaction_number = new_number) INTO number_exists;\n    \n    IF NOT number_exists THEN\n      EXIT;\n    END IF;\n  END LOOP;\n  \n  RETURN new_number;\nEND;\n$$;\n\nCREATE OR REPLACE FUNCTION public.update_waitlist_priority()\n RETURNS trigger\n LANGUAGE plpgsql\n SECURITY DEFINER\n SET search_path = public  -- Add this line\nAS $$\nBEGIN\n  -- Set priority order based on join time\n  IF TG_OP = 'INSERT' THEN\n    NEW.priority_order := COALESCE(\n      (SELECT MAX(priority_order) + 1 FROM class_waitlists WHERE class_id = NEW.class_id),\n      1\n    );\n    RETURN NEW;\n  END IF;\n  RETURN NULL;\nEND;\n$$;\n\nCREATE OR REPLACE FUNCTION public.create_default_notification_preferences()\n RETURNS trigger\n LANGUAGE plpgsql\n SECURITY DEFINER\n SET search_path = public  -- Add this line\nAS $$\nBEGIN\n  -- Only create for members\n  IF NEW.role = 'member' THEN\n    INSERT INTO public.notification_preferences (member_id)\n    VALUES (NEW.id)\n    ON CONFLICT (member_id) DO NOTHING;\n  END IF;\n  \n  RETURN NEW;\nEND;\n$$;"}		pearson.performance@gmail.com	\N	\N
20250920040438	{"-- Fix remaining security issues\n\n-- Fix remaining functions that might not have search_path\nCREATE OR REPLACE FUNCTION public.setup_default_lead_stages(org_id uuid)\n RETURNS void\n LANGUAGE plpgsql\n SECURITY DEFINER\n SET search_path = public  -- Add this line\nAS $$\nBEGIN\n  -- Only create stages if none exist for the organization\n  IF NOT EXISTS (SELECT 1 FROM lead_stages WHERE organization_id = org_id) THEN\n    INSERT INTO lead_stages (name, organization_id, order_index, color, description, is_closed) VALUES\n      ('New Lead', org_id, 1, '#3b82f6', 'Initial contact made', false),\n      ('Qualified', org_id, 2, '#8b5cf6', 'Lead shows genuine interest', false),\n      ('Tour Scheduled', org_id, 3, '#f59e0b', 'Facility tour booked', false),\n      ('Tour Completed', org_id, 4, '#10b981', 'Completed facility tour', false),\n      ('Proposal Sent', org_id, 5, '#f97316', 'Membership proposal provided', false),\n      ('Negotiating', org_id, 6, '#ef4444', 'Discussing terms and pricing', false),\n      ('Closed Won', org_id, 7, '#22c55e', 'Converted to member', true),\n      ('Closed Lost', org_id, 8, '#6b7280', 'Lead did not convert', true);\n  END IF;\nEND;\n$$;\n\nCREATE OR REPLACE FUNCTION public.trigger_setup_lead_stages()\n RETURNS trigger\n LANGUAGE plpgsql\n SECURITY DEFINER\n SET search_path = public  -- Add this line\nAS $$\nBEGIN\n  -- Set up default lead stages for the user's organization\n  IF NEW.organization_id IS NOT NULL THEN\n    PERFORM setup_default_lead_stages(NEW.organization_id);\n  END IF;\n  RETURN NEW;\nEND;\n$$;\n\nCREATE OR REPLACE FUNCTION public.update_equipment_maintenance_schedule()\n RETURNS trigger\n LANGUAGE plpgsql\n SECURITY DEFINER\n SET search_path = public  -- Add this line\nAS $$\nBEGIN\n  -- Update equipment's last maintenance date and calculate next maintenance date\n  UPDATE public.equipment \n  SET \n    last_maintenance_date = NEW.maintenance_date::date,\n    next_maintenance_date = (NEW.maintenance_date::date + INTERVAL '1 day' * COALESCE(maintenance_interval_days, 90))\n  WHERE id = NEW.equipment_id;\n  \n  RETURN NEW;\nEND;\n$$;\n\nCREATE OR REPLACE FUNCTION public.handle_member_barcode_generation()\n RETURNS trigger\n LANGUAGE plpgsql\n SECURITY DEFINER\n SET search_path = public  -- Add this line\nAS $$\nBEGIN\n    -- Only generate barcode for members without one\n    IF NEW.role = 'member' AND (NEW.barcode IS NULL OR NEW.barcode = '') THEN\n        NEW.barcode := public.generate_member_barcode();\n        NEW.barcode_generated_at := now();\n    END IF;\n    \n    RETURN NEW;\nEND;\n$$;\n\n-- Check for views with security definer - these might be the issue\n-- If there are any SECURITY DEFINER views, they would need to be recreated without that property\n-- For now, let's see if this resolves the function issues"}		pearson.performance@gmail.com	\N	\N
20250920065656	{"-- Create department revenues table\nCREATE TABLE IF NOT EXISTS public.department_revenues (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  department_name TEXT NOT NULL,\n  revenue_source TEXT NOT NULL,\n  period_start DATE NOT NULL,\n  period_end DATE NOT NULL,\n  revenue_amount NUMERIC NOT NULL DEFAULT 0,\n  transaction_count INTEGER DEFAULT 0,\n  average_transaction_value NUMERIC DEFAULT 0,\n  created_by UUID NOT NULL,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Create cost allocations table\nCREATE TABLE IF NOT EXISTS public.cost_allocations (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  department_name TEXT NOT NULL,\n  cost_category TEXT NOT NULL,\n  period_start DATE NOT NULL,\n  period_end DATE NOT NULL,\n  allocated_amount NUMERIC NOT NULL DEFAULT 0,\n  allocation_basis TEXT NOT NULL,\n  allocation_percentage NUMERIC DEFAULT 0,\n  notes TEXT,\n  created_by UUID NOT NULL,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Create department budgets table\nCREATE TABLE IF NOT EXISTS public.department_budgets (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  department_name TEXT NOT NULL,\n  budget_year INTEGER NOT NULL,\n  budget_month INTEGER,\n  revenue_budget NUMERIC DEFAULT 0,\n  expense_budget NUMERIC DEFAULT 0,\n  profit_target NUMERIC DEFAULT 0,\n  created_by UUID NOT NULL,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  UNIQUE(organization_id, department_name, budget_year, budget_month)\n);\n\n-- Enable RLS on all tables\nALTER TABLE public.department_revenues ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.cost_allocations ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.department_budgets ENABLE ROW LEVEL SECURITY;\n\n-- Create RLS policies\nCREATE POLICY \\"Staff can manage department revenues\\"\nON public.department_revenues\nFOR ALL\nUSING (organization_id IN (\n  SELECT organization_id FROM profiles \n  WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n));\n\nCREATE POLICY \\"Staff can manage cost allocations\\"\nON public.cost_allocations\nFOR ALL\nUSING (organization_id IN (\n  SELECT organization_id FROM profiles \n  WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n));\n\nCREATE POLICY \\"Staff can manage department budgets\\"\nON public.department_budgets\nFOR ALL\nUSING (organization_id IN (\n  SELECT organization_id FROM profiles \n  WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n));\n\n-- Create triggers for updated_at\nDO $$\nBEGIN\n  IF NOT EXISTS (SELECT 1 FROM pg_trigger WHERE tgname = 'update_department_revenues_updated_at') THEN\n    CREATE TRIGGER update_department_revenues_updated_at\n    BEFORE UPDATE ON public.department_revenues\n    FOR EACH ROW\n    EXECUTE FUNCTION public.update_updated_at_column();\n  END IF;\n  \n  IF NOT EXISTS (SELECT 1 FROM pg_trigger WHERE tgname = 'update_cost_allocations_updated_at') THEN\n    CREATE TRIGGER update_cost_allocations_updated_at\n    BEFORE UPDATE ON public.cost_allocations\n    FOR EACH ROW\n    EXECUTE FUNCTION public.update_updated_at_column();\n  END IF;\n  \n  IF NOT EXISTS (SELECT 1 FROM pg_trigger WHERE tgname = 'update_department_budgets_updated_at') THEN\n    CREATE TRIGGER update_department_budgets_updated_at\n    BEFORE UPDATE ON public.department_budgets\n    FOR EACH ROW\n    EXECUTE FUNCTION public.update_updated_at_column();\n  END IF;\nEND $$;\n\n-- Create indexes for performance\nCREATE INDEX IF NOT EXISTS idx_department_revenues_org_period ON public.department_revenues(organization_id, period_start, period_end);\nCREATE INDEX IF NOT EXISTS idx_department_revenues_department ON public.department_revenues(department_name);\nCREATE INDEX IF NOT EXISTS idx_cost_allocations_org_period ON public.cost_allocations(organization_id, period_start, period_end);\nCREATE INDEX IF NOT EXISTS idx_cost_allocations_department ON public.cost_allocations(department_name);\nCREATE INDEX IF NOT EXISTS idx_department_budgets_org_year ON public.department_budgets(organization_id, budget_year);"}		pearson.performance@gmail.com	\N	\N
20250920072823	{"-- Create certification requirements table\nCREATE TABLE public.certification_requirements (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  certification_name TEXT NOT NULL,\n  description TEXT,\n  validity_period_months INTEGER NOT NULL DEFAULT 12,\n  is_required BOOLEAN DEFAULT true,\n  required_for_roles TEXT[] DEFAULT ARRAY['staff'::TEXT],\n  renewal_notice_days INTEGER DEFAULT 30,\n  training_provider TEXT,\n  cost_estimate DECIMAL(10,2),\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Create staff certifications table  \nCREATE TABLE public.staff_certifications (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  staff_id UUID NOT NULL,\n  requirement_id UUID NOT NULL,\n  certification_number TEXT,\n  issued_date DATE NOT NULL,\n  expiry_date DATE NOT NULL,\n  issuing_authority TEXT,\n  verification_status TEXT NOT NULL DEFAULT 'pending',\n  file_url TEXT,\n  renewal_cost DECIMAL(10,2),\n  renewal_completed_at TIMESTAMP WITH TIME ZONE,\n  notes TEXT,\n  created_by UUID NOT NULL,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Enable RLS\nALTER TABLE public.certification_requirements ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.staff_certifications ENABLE ROW LEVEL SECURITY;\n\n-- RLS Policies for certification_requirements\nCREATE POLICY \\"Staff can view certification requirements\\"\nON public.certification_requirements\nFOR SELECT\nUSING (\n  organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid()\n  )\n);\n\nCREATE POLICY \\"Managers can manage certification requirements\\"\nON public.certification_requirements\nFOR ALL\nUSING (\n  organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() \n    AND role IN ('owner', 'manager')\n  )\n);\n\n-- RLS Policies for staff_certifications\nCREATE POLICY \\"Staff can view their own certifications\\"\nON public.staff_certifications\nFOR SELECT\nUSING (\n  staff_id = auth.uid() OR\n  organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() \n    AND role IN ('owner', 'manager', 'staff')\n  )\n);\n\nCREATE POLICY \\"Staff can manage staff certifications\\"\nON public.staff_certifications\nFOR ALL\nUSING (\n  organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() \n    AND role IN ('owner', 'manager', 'staff')\n  )\n);\n\n-- Create indexes for performance\nCREATE INDEX idx_certification_requirements_org ON public.certification_requirements(organization_id);\nCREATE INDEX idx_staff_certifications_org ON public.staff_certifications(organization_id);\nCREATE INDEX idx_staff_certifications_staff ON public.staff_certifications(staff_id);\nCREATE INDEX idx_staff_certifications_expiry ON public.staff_certifications(expiry_date);\n\n-- Create trigger for updated_at\nCREATE TRIGGER update_certification_requirements_updated_at\n  BEFORE UPDATE ON public.certification_requirements\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_staff_certifications_updated_at\n  BEFORE UPDATE ON public.staff_certifications\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();"}		pearson.performance@gmail.com	\N	\N
20250920085843	{"-- Create towel inventory management system\n\n-- Towel inventory table for tracking towel stock\nCREATE TABLE public.towel_inventory (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  towel_type TEXT NOT NULL DEFAULT 'standard', -- standard, premium, workout, pool\n  size TEXT NOT NULL DEFAULT 'medium', -- small, medium, large\n  color TEXT NOT NULL DEFAULT 'white',\n  total_quantity INTEGER NOT NULL DEFAULT 0,\n  available_quantity INTEGER NOT NULL DEFAULT 0,\n  rented_quantity INTEGER NOT NULL DEFAULT 0,\n  in_cleaning INTEGER NOT NULL DEFAULT 0,\n  damaged_quantity INTEGER NOT NULL DEFAULT 0,\n  cost_per_towel DECIMAL(10,2) DEFAULT 0.00,\n  rental_price DECIMAL(10,2) NOT NULL DEFAULT 5.00,\n  replacement_cost DECIMAL(10,2) DEFAULT 0.00,\n  min_stock_level INTEGER DEFAULT 10,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Towel rentals table for tracking individual rentals\nCREATE TABLE public.towel_rentals (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  member_id UUID NOT NULL,\n  towel_inventory_id UUID NOT NULL,\n  rental_date DATE NOT NULL DEFAULT CURRENT_DATE,\n  rental_time TIME NOT NULL DEFAULT CURRENT_TIME,\n  return_date DATE,\n  return_time TIME,\n  rental_fee DECIMAL(10,2) NOT NULL DEFAULT 0.00,\n  late_fee DECIMAL(10,2) DEFAULT 0.00,\n  damage_fee DECIMAL(10,2) DEFAULT 0.00,\n  payment_method TEXT DEFAULT 'member_account', -- cash, card, member_account\n  payment_status TEXT NOT NULL DEFAULT 'pending', -- pending, paid, overdue, waived\n  towel_condition_out TEXT DEFAULT 'good', -- excellent, good, fair, damaged\n  towel_condition_in TEXT,\n  staff_out UUID NOT NULL, -- staff member who issued towel\n  staff_in UUID, -- staff member who received towel back\n  notes TEXT,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  status TEXT NOT NULL DEFAULT 'active' -- active, returned, lost, damaged\n);\n\n-- Towel cleaning logs for tracking cleaning schedules and cycles\nCREATE TABLE public.towel_cleaning_logs (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  towel_inventory_id UUID NOT NULL,\n  cleaning_date DATE NOT NULL DEFAULT CURRENT_DATE,\n  quantity_cleaned INTEGER NOT NULL DEFAULT 0,\n  cleaning_method TEXT NOT NULL DEFAULT 'machine_wash', -- machine_wash, hand_wash, dry_clean, sanitize\n  detergent_used TEXT,\n  temperature_celsius INTEGER DEFAULT 60,\n  cycle_duration_minutes INTEGER DEFAULT 45,\n  staff_assigned UUID NOT NULL,\n  quality_check_passed BOOLEAN DEFAULT true,\n  quality_check_notes TEXT,\n  cost DECIMAL(10,2) DEFAULT 0.00,\n  next_cleaning_due DATE,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  batch_number TEXT, -- for tracking cleaning batches\n  cleaning_status TEXT NOT NULL DEFAULT 'completed' -- scheduled, in_progress, completed, failed\n);\n\n-- Enable RLS on all tables\nALTER TABLE public.towel_inventory ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.towel_rentals ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.towel_cleaning_logs ENABLE ROW LEVEL SECURITY;\n\n-- RLS Policies for towel_inventory\nCREATE POLICY \\"Staff can manage towel inventory\\"\n  ON public.towel_inventory\n  FOR ALL\n  USING (\n    organization_id IN (\n      SELECT organization_id FROM public.profiles \n      WHERE id = auth.uid() \n      AND role IN ('owner', 'manager', 'staff')\n    )\n  );\n\nCREATE POLICY \\"Members can view towel inventory\\"\n  ON public.towel_inventory\n  FOR SELECT\n  USING (\n    organization_id IN (\n      SELECT organization_id FROM public.profiles \n      WHERE id = auth.uid()\n    )\n  );\n\n-- RLS Policies for towel_rentals\nCREATE POLICY \\"Staff can manage towel rentals\\"\n  ON public.towel_rentals\n  FOR ALL\n  USING (\n    organization_id IN (\n      SELECT organization_id FROM public.profiles \n      WHERE id = auth.uid() \n      AND role IN ('owner', 'manager', 'staff')\n    )\n  );\n\nCREATE POLICY \\"Members can view their own towel rentals\\"\n  ON public.towel_rentals\n  FOR SELECT\n  USING (\n    member_id = auth.uid() OR\n    organization_id IN (\n      SELECT organization_id FROM public.profiles \n      WHERE id = auth.uid() \n      AND role IN ('owner', 'manager', 'staff')\n    )\n  );\n\n-- RLS Policies for towel_cleaning_logs\nCREATE POLICY \\"Staff can manage cleaning logs\\"\n  ON public.towel_cleaning_logs\n  FOR ALL\n  USING (\n    organization_id IN (\n      SELECT organization_id FROM public.profiles \n      WHERE id = auth.uid() \n      AND role IN ('owner', 'manager', 'staff')\n    )\n  );\n\n-- Create function to update towel inventory quantities\nCREATE OR REPLACE FUNCTION public.update_towel_inventory_quantities()\nRETURNS TRIGGER AS $$\nBEGIN\n  -- Update inventory quantities based on rental status changes\n  IF TG_OP = 'INSERT' THEN\n    -- New rental: decrease available, increase rented\n    UPDATE public.towel_inventory \n    SET \n      available_quantity = available_quantity - 1,\n      rented_quantity = rented_quantity + 1,\n      updated_at = now()\n    WHERE id = NEW.towel_inventory_id;\n    \n  ELSIF TG_OP = 'UPDATE' THEN\n    -- Status changed from active to returned\n    IF OLD.status = 'active' AND NEW.status = 'returned' THEN\n      -- Check if towel needs cleaning or is ready for rent\n      IF NEW.towel_condition_in IN ('excellent', 'good') THEN\n        UPDATE public.towel_inventory \n        SET \n          available_quantity = available_quantity + 1,\n          rented_quantity = rented_quantity - 1,\n          updated_at = now()\n        WHERE id = NEW.towel_inventory_id;\n      ELSE\n        -- Towel needs cleaning or is damaged\n        UPDATE public.towel_inventory \n        SET \n          rented_quantity = rented_quantity - 1,\n          in_cleaning = in_cleaning + 1,\n          updated_at = now()\n        WHERE id = NEW.towel_inventory_id;\n      END IF;\n    \n    -- Status changed to lost or damaged\n    ELSIF OLD.status = 'active' AND NEW.status IN ('lost', 'damaged') THEN\n      UPDATE public.towel_inventory \n      SET \n        rented_quantity = rented_quantity - 1,\n        damaged_quantity = damaged_quantity + 1,\n        updated_at = now()\n      WHERE id = NEW.towel_inventory_id;\n    END IF;\n  END IF;\n  \n  RETURN COALESCE(NEW, OLD);\nEND;\n$$ LANGUAGE plpgsql SET search_path = public;\n\n-- Create trigger for updating inventory quantities\nCREATE TRIGGER update_towel_inventory_quantities_trigger\n  AFTER INSERT OR UPDATE ON public.towel_rentals\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_towel_inventory_quantities();\n\n-- Create function to handle cleaning completion\nCREATE OR REPLACE FUNCTION public.handle_cleaning_completion()\nRETURNS TRIGGER AS $$\nBEGIN\n  -- When cleaning is completed, move towels from cleaning back to available\n  IF TG_OP = 'UPDATE' AND OLD.cleaning_status != 'completed' AND NEW.cleaning_status = 'completed' AND NEW.quality_check_passed = true THEN\n    UPDATE public.towel_inventory \n    SET \n      in_cleaning = GREATEST(in_cleaning - NEW.quantity_cleaned, 0),\n      available_quantity = available_quantity + NEW.quantity_cleaned,\n      updated_at = now()\n    WHERE id = NEW.towel_inventory_id;\n  END IF;\n  \n  RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql SET search_path = public;\n\n-- Create trigger for cleaning completion\nCREATE TRIGGER handle_cleaning_completion_trigger\n  AFTER UPDATE ON public.towel_cleaning_logs\n  FOR EACH ROW\n  EXECUTE FUNCTION public.handle_cleaning_completion();\n\n-- Create updated_at triggers for all tables\nCREATE TRIGGER update_towel_inventory_updated_at\n  BEFORE UPDATE ON public.towel_inventory\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_towel_rentals_updated_at\n  BEFORE UPDATE ON public.towel_rentals\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_towel_cleaning_logs_updated_at\n  BEFORE UPDATE ON public.towel_cleaning_logs\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\n-- Create indexes for better performance\nCREATE INDEX idx_towel_inventory_organization_id ON public.towel_inventory(organization_id);\nCREATE INDEX idx_towel_inventory_type_size ON public.towel_inventory(towel_type, size);\nCREATE INDEX idx_towel_rentals_organization_id ON public.towel_rentals(organization_id);\nCREATE INDEX idx_towel_rentals_member_id ON public.towel_rentals(member_id);\nCREATE INDEX idx_towel_rentals_status ON public.towel_rentals(status);\nCREATE INDEX idx_towel_rentals_rental_date ON public.towel_rentals(rental_date);\nCREATE INDEX idx_towel_cleaning_logs_organization_id ON public.towel_cleaning_logs(organization_id);\nCREATE INDEX idx_towel_cleaning_logs_cleaning_date ON public.towel_cleaning_logs(cleaning_date);"}		pearson.performance@gmail.com	\N	\N
20250921120254	{"-- Multi-Location Management System\n-- Enable comprehensive multi-location gym chain management\n\n-- Create location hierarchy table for organizational structure\nCREATE TABLE public.location_hierarchies (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  parent_location_id UUID REFERENCES public.locations(id),\n  child_location_id UUID NOT NULL REFERENCES public.locations(id),\n  hierarchy_type TEXT NOT NULL DEFAULT 'branch', -- 'branch', 'franchise', 'corporate'\n  relationship_start_date DATE NOT NULL DEFAULT CURRENT_DATE,\n  relationship_end_date DATE,\n  is_active BOOLEAN DEFAULT true,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  UNIQUE(child_location_id, parent_location_id)\n);\n\n-- Create cross-location staff assignments\nCREATE TABLE public.cross_location_assignments (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  staff_id UUID NOT NULL,\n  location_id UUID NOT NULL REFERENCES public.locations(id),\n  assignment_type TEXT NOT NULL DEFAULT 'primary', -- 'primary', 'secondary', 'floating'\n  start_date DATE NOT NULL DEFAULT CURRENT_DATE,\n  end_date DATE,\n  permissions JSONB DEFAULT '{}',\n  hourly_rate DECIMAL(10,2),\n  is_active BOOLEAN DEFAULT true,\n  created_by UUID NOT NULL,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Create member location access table\nCREATE TABLE public.member_location_access (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  member_id UUID NOT NULL,\n  location_id UUID NOT NULL REFERENCES public.locations(id),\n  access_type TEXT NOT NULL DEFAULT 'full', -- 'full', 'limited', 'guest'\n  access_start_date DATE NOT NULL DEFAULT CURRENT_DATE,\n  access_end_date DATE,\n  visit_limit INTEGER, -- for limited access\n  visits_used INTEGER DEFAULT 0,\n  additional_fee DECIMAL(10,2) DEFAULT 0.00,\n  is_active BOOLEAN DEFAULT true,\n  granted_by UUID NOT NULL,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Create cross-location transfers table\nCREATE TABLE public.cross_location_transfers (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  transfer_type TEXT NOT NULL, -- 'member', 'staff', 'equipment', 'inventory'\n  entity_id UUID NOT NULL, -- ID of the member/staff/equipment being transferred\n  from_location_id UUID NOT NULL REFERENCES public.locations(id),\n  to_location_id UUID NOT NULL REFERENCES public.locations(id),\n  transfer_date DATE NOT NULL DEFAULT CURRENT_DATE,\n  effective_date DATE NOT NULL DEFAULT CURRENT_DATE,\n  reason TEXT,\n  transfer_fee DECIMAL(10,2) DEFAULT 0.00,\n  approval_required BOOLEAN DEFAULT true,\n  approved_by UUID,\n  approved_at TIMESTAMP WITH TIME ZONE,\n  initiated_by UUID NOT NULL,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  status TEXT NOT NULL DEFAULT 'pending' -- 'pending', 'approved', 'rejected', 'completed'\n);\n\n-- Create location analytics summary table\nCREATE TABLE public.location_analytics (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  location_id UUID NOT NULL REFERENCES public.locations(id),\n  analytics_date DATE NOT NULL DEFAULT CURRENT_DATE,\n  total_members INTEGER DEFAULT 0,\n  active_members INTEGER DEFAULT 0,\n  new_members INTEGER DEFAULT 0,\n  cancelled_members INTEGER DEFAULT 0,\n  daily_checkins INTEGER DEFAULT 0,\n  peak_hour_checkins INTEGER DEFAULT 0,\n  revenue_total DECIMAL(12,2) DEFAULT 0.00,\n  revenue_memberships DECIMAL(12,2) DEFAULT 0.00,\n  revenue_classes DECIMAL(12,2) DEFAULT 0.00,\n  revenue_personal_training DECIMAL(12,2) DEFAULT 0.00,\n  revenue_retail DECIMAL(12,2) DEFAULT 0.00,\n  classes_held INTEGER DEFAULT 0,\n  equipment_maintenance_requests INTEGER DEFAULT 0,\n  staff_hours_worked DECIMAL(8,2) DEFAULT 0.00,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  UNIQUE(location_id, analytics_date)\n);\n\n-- Add multi-location support to existing locations table\nALTER TABLE public.locations \nADD COLUMN IF NOT EXISTS is_headquarters BOOLEAN DEFAULT false,\nADD COLUMN IF NOT EXISTS location_code TEXT UNIQUE,\nADD COLUMN IF NOT EXISTS region TEXT,\nADD COLUMN IF NOT EXISTS district TEXT,\nADD COLUMN IF NOT EXISTS manager_id UUID,\nADD COLUMN IF NOT EXISTS operating_hours JSONB DEFAULT '{}',\nADD COLUMN IF NOT EXISTS max_capacity INTEGER,\nADD COLUMN IF NOT EXISTS square_footage INTEGER,\nADD COLUMN IF NOT EXISTS parking_spaces INTEGER,\nADD COLUMN IF NOT EXISTS amenities JSONB DEFAULT '[]',\nADD COLUMN IF NOT EXISTS status TEXT DEFAULT 'active'; -- 'active', 'under_construction', 'closed', 'maintenance'\n\n-- Enable RLS on all new tables\nALTER TABLE public.location_hierarchies ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.cross_location_assignments ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.member_location_access ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.cross_location_transfers ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.location_analytics ENABLE ROW LEVEL SECURITY;\n\n-- Create RLS policies for location hierarchies\nCREATE POLICY \\"Staff can view location hierarchies in their organization\\" \nON public.location_hierarchies FOR SELECT \nUSING (organization_id IN (\n  SELECT organization_id FROM profiles \n  WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n));\n\nCREATE POLICY \\"Managers can manage location hierarchies\\" \nON public.location_hierarchies FOR ALL \nUSING (organization_id IN (\n  SELECT organization_id FROM profiles \n  WHERE id = auth.uid() AND role IN ('owner', 'manager')\n));\n\n-- Create RLS policies for cross-location staff assignments\nCREATE POLICY \\"Staff can view their assignments\\" \nON public.cross_location_assignments FOR SELECT \nUSING (\n  staff_id = auth.uid() OR \n  organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n  )\n);\n\nCREATE POLICY \\"Managers can manage staff assignments\\" \nON public.cross_location_assignments FOR ALL \nUSING (organization_id IN (\n  SELECT organization_id FROM profiles \n  WHERE id = auth.uid() AND role IN ('owner', 'manager')\n));\n\n-- Create RLS policies for member location access\nCREATE POLICY \\"Members can view their location access\\" \nON public.member_location_access FOR SELECT \nUSING (\n  member_id = auth.uid() OR \n  organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n  )\n);\n\nCREATE POLICY \\"Staff can manage member location access\\" \nON public.member_location_access FOR ALL \nUSING (organization_id IN (\n  SELECT organization_id FROM profiles \n  WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n));\n\n-- Create RLS policies for cross-location transfers\nCREATE POLICY \\"Staff can view transfers in their organization\\" \nON public.cross_location_transfers FOR SELECT \nUSING (organization_id IN (\n  SELECT organization_id FROM profiles \n  WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n));\n\nCREATE POLICY \\"Staff can create transfer requests\\" \nON public.cross_location_transfers FOR INSERT \nWITH CHECK (\n  organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n  ) AND initiated_by = auth.uid()\n);\n\nCREATE POLICY \\"Managers can manage transfers\\" \nON public.cross_location_transfers FOR ALL \nUSING (organization_id IN (\n  SELECT organization_id FROM profiles \n  WHERE id = auth.uid() AND role IN ('owner', 'manager')\n));\n\n-- Create RLS policies for location analytics\nCREATE POLICY \\"Staff can view location analytics in their organization\\" \nON public.location_analytics FOR SELECT \nUSING (organization_id IN (\n  SELECT organization_id FROM profiles \n  WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n));\n\nCREATE POLICY \\"Managers can manage location analytics\\" \nON public.location_analytics FOR ALL \nUSING (organization_id IN (\n  SELECT organization_id FROM profiles \n  WHERE id = auth.uid() AND role IN ('owner', 'manager')\n));\n\n-- Create indexes for performance\nCREATE INDEX idx_location_hierarchies_org_id ON public.location_hierarchies(organization_id);\nCREATE INDEX idx_location_hierarchies_parent ON public.location_hierarchies(parent_location_id);\nCREATE INDEX idx_location_hierarchies_child ON public.location_hierarchies(child_location_id);\n\nCREATE INDEX idx_cross_location_assignments_org ON public.cross_location_assignments(organization_id);\nCREATE INDEX idx_cross_location_assignments_staff ON public.cross_location_assignments(staff_id);\nCREATE INDEX idx_cross_location_assignments_location ON public.cross_location_assignments(location_id);\n\nCREATE INDEX idx_member_location_access_org ON public.member_location_access(organization_id);\nCREATE INDEX idx_member_location_access_member ON public.member_location_access(member_id);\nCREATE INDEX idx_member_location_access_location ON public.member_location_access(location_id);\n\nCREATE INDEX idx_cross_location_transfers_org ON public.cross_location_transfers(organization_id);\nCREATE INDEX idx_cross_location_transfers_from ON public.cross_location_transfers(from_location_id);\nCREATE INDEX idx_cross_location_transfers_to ON public.cross_location_transfers(to_location_id);\n\nCREATE INDEX idx_location_analytics_org ON public.location_analytics(organization_id);\nCREATE INDEX idx_location_analytics_location ON public.location_analytics(location_id);\nCREATE INDEX idx_location_analytics_date ON public.location_analytics(analytics_date);\n\n-- Create trigger for updating timestamps\nCREATE TRIGGER update_location_hierarchies_updated_at\n  BEFORE UPDATE ON public.location_hierarchies\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_cross_location_assignments_updated_at\n  BEFORE UPDATE ON public.cross_location_assignments\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_member_location_access_updated_at\n  BEFORE UPDATE ON public.member_location_access\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_cross_location_transfers_updated_at\n  BEFORE UPDATE ON public.cross_location_transfers\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_location_analytics_updated_at\n  BEFORE UPDATE ON public.location_analytics\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();"}		pearson.performance@gmail.com	\N	\N
20250921015658	{"-- Corporate Membership Management System\n\n-- Corporate accounts table\nCREATE TABLE public.corporate_accounts (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  company_name TEXT NOT NULL,\n  contact_person TEXT NOT NULL,\n  contact_email TEXT NOT NULL,\n  contact_phone TEXT,\n  billing_address TEXT,\n  tax_id TEXT,\n  contract_start_date DATE NOT NULL,\n  contract_end_date DATE,\n  total_member_allocation INTEGER NOT NULL DEFAULT 0,\n  used_member_allocation INTEGER NOT NULL DEFAULT 0,\n  monthly_rate_per_member DECIMAL(10,2) NOT NULL,\n  setup_fee DECIMAL(10,2) DEFAULT 0,\n  discount_percentage DECIMAL(5,2) DEFAULT 0,\n  billing_cycle TEXT NOT NULL DEFAULT 'monthly' CHECK (billing_cycle IN ('monthly', 'quarterly', 'annual')),\n  auto_billing BOOLEAN DEFAULT true,\n  status TEXT NOT NULL DEFAULT 'active' CHECK (status IN ('active', 'suspended', 'cancelled', 'pending')),\n  account_manager_id UUID,\n  payment_terms TEXT DEFAULT '30 days',\n  special_terms TEXT,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Corporate membership plans (special corporate rates)\nCREATE TABLE public.corporate_membership_plans (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  corporate_account_id UUID NOT NULL,\n  plan_name TEXT NOT NULL,\n  description TEXT,\n  monthly_rate DECIMAL(10,2) NOT NULL,\n  access_level TEXT NOT NULL DEFAULT 'standard' CHECK (access_level IN ('basic', 'standard', 'premium', 'executive')),\n  included_services JSONB DEFAULT '[]'::jsonb,\n  excluded_services JSONB DEFAULT '[]'::jsonb,\n  guest_privileges INTEGER DEFAULT 0,\n  class_booking_priority BOOLEAN DEFAULT false,\n  personal_training_discount DECIMAL(5,2) DEFAULT 0,\n  retail_discount DECIMAL(5,2) DEFAULT 0,\n  parking_included BOOLEAN DEFAULT false,\n  locker_included BOOLEAN DEFAULT false,\n  is_active BOOLEAN DEFAULT true,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Link individual members to corporate accounts\nCREATE TABLE public.corporate_members (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  corporate_account_id UUID NOT NULL,\n  member_id UUID NOT NULL,\n  corporate_plan_id UUID,\n  employee_id TEXT,\n  department TEXT,\n  job_title TEXT,\n  manager_member_id UUID, -- For hierarchical relationships\n  start_date DATE NOT NULL DEFAULT CURRENT_DATE,\n  end_date DATE,\n  is_active BOOLEAN DEFAULT true,\n  billing_responsibility TEXT DEFAULT 'corporate' CHECK (billing_responsibility IN ('corporate', 'employee', 'shared')),\n  employee_contribution DECIMAL(10,2) DEFAULT 0,\n  notes TEXT,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  UNIQUE(corporate_account_id, member_id)\n);\n\n-- Corporate invoicing and billing\nCREATE TABLE public.corporate_invoices (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  corporate_account_id UUID NOT NULL,\n  invoice_number TEXT NOT NULL,\n  billing_period_start DATE NOT NULL,\n  billing_period_end DATE NOT NULL,\n  member_count INTEGER NOT NULL DEFAULT 0,\n  base_amount DECIMAL(10,2) NOT NULL DEFAULT 0,\n  discount_amount DECIMAL(10,2) DEFAULT 0,\n  tax_amount DECIMAL(10,2) DEFAULT 0,\n  additional_charges DECIMAL(10,2) DEFAULT 0,\n  total_amount DECIMAL(10,2) NOT NULL DEFAULT 0,\n  payment_due_date DATE,\n  payment_received_date DATE,\n  payment_method TEXT,\n  payment_reference TEXT,\n  late_fee DECIMAL(10,2) DEFAULT 0,\n  status TEXT NOT NULL DEFAULT 'draft' CHECK (status IN ('draft', 'sent', 'paid', 'overdue', 'cancelled')),\n  sent_at TIMESTAMP WITH TIME ZONE,\n  created_by UUID NOT NULL,\n  notes TEXT,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Corporate invoice line items (for detailed billing)\nCREATE TABLE public.corporate_invoice_items (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  invoice_id UUID NOT NULL,\n  member_id UUID,\n  item_type TEXT NOT NULL CHECK (item_type IN ('membership', 'personal_training', 'classes', 'retail', 'fee', 'other')),\n  description TEXT NOT NULL,\n  quantity INTEGER DEFAULT 1,\n  unit_price DECIMAL(10,2) NOT NULL,\n  total_price DECIMAL(10,2) NOT NULL,\n  billing_period_start DATE,\n  billing_period_end DATE,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Bulk member operations tracking\nCREATE TABLE public.bulk_member_operations (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  corporate_account_id UUID,\n  operation_type TEXT NOT NULL CHECK (operation_type IN ('bulk_add', 'bulk_update', 'bulk_suspend', 'bulk_terminate', 'bulk_transfer')),\n  initiated_by UUID NOT NULL,\n  total_members INTEGER DEFAULT 0,\n  processed_members INTEGER DEFAULT 0,\n  failed_members INTEGER DEFAULT 0,\n  operation_data JSONB DEFAULT '{}'::jsonb,\n  error_log JSONB DEFAULT '[]'::jsonb,\n  status TEXT NOT NULL DEFAULT 'pending' CHECK (status IN ('pending', 'processing', 'completed', 'failed', 'cancelled')),\n  started_at TIMESTAMP WITH TIME ZONE,\n  completed_at TIMESTAMP WITH TIME ZONE,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Enable Row Level Security\nALTER TABLE public.corporate_accounts ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.corporate_membership_plans ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.corporate_members ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.corporate_invoices ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.corporate_invoice_items ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.bulk_member_operations ENABLE ROW LEVEL SECURITY;\n\n-- RLS Policies for corporate_accounts\nCREATE POLICY \\"Staff can manage corporate accounts\\" \nON public.corporate_accounts \nFOR ALL \nUSING (organization_id IN (\n  SELECT organization_id FROM profiles \n  WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n));\n\n-- RLS Policies for corporate_membership_plans\nCREATE POLICY \\"Staff can manage corporate plans\\" \nON public.corporate_membership_plans \nFOR ALL \nUSING (organization_id IN (\n  SELECT organization_id FROM profiles \n  WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n));\n\n-- RLS Policies for corporate_members\nCREATE POLICY \\"Staff can manage corporate members\\" \nON public.corporate_members \nFOR ALL \nUSING (corporate_account_id IN (\n  SELECT id FROM corporate_accounts \n  WHERE organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n  )\n));\n\nCREATE POLICY \\"Members can view their corporate info\\" \nON public.corporate_members \nFOR SELECT \nUSING (member_id = auth.uid());\n\n-- RLS Policies for corporate_invoices\nCREATE POLICY \\"Staff can manage corporate invoices\\" \nON public.corporate_invoices \nFOR ALL \nUSING (organization_id IN (\n  SELECT organization_id FROM profiles \n  WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n));\n\n-- RLS Policies for corporate_invoice_items\nCREATE POLICY \\"Staff can manage invoice items\\" \nON public.corporate_invoice_items \nFOR ALL \nUSING (invoice_id IN (\n  SELECT id FROM corporate_invoices \n  WHERE organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n  )\n));\n\n-- RLS Policies for bulk_member_operations\nCREATE POLICY \\"Staff can manage bulk operations\\" \nON public.bulk_member_operations \nFOR ALL \nUSING (organization_id IN (\n  SELECT organization_id FROM profiles \n  WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n));\n\n-- Indexes for performance\nCREATE INDEX idx_corporate_accounts_org_id ON public.corporate_accounts(organization_id);\nCREATE INDEX idx_corporate_accounts_status ON public.corporate_accounts(status);\nCREATE INDEX idx_corporate_members_account_id ON public.corporate_members(corporate_account_id);\nCREATE INDEX idx_corporate_members_member_id ON public.corporate_members(member_id);\nCREATE INDEX idx_corporate_members_manager ON public.corporate_members(manager_member_id);\nCREATE INDEX idx_corporate_invoices_account_id ON public.corporate_invoices(corporate_account_id);\nCREATE INDEX idx_corporate_invoices_status ON public.corporate_invoices(status);\nCREATE INDEX idx_corporate_invoices_due_date ON public.corporate_invoices(payment_due_date);\nCREATE INDEX idx_invoice_items_invoice_id ON public.corporate_invoice_items(invoice_id);\n\n-- Triggers for updated_at\nCREATE TRIGGER update_corporate_accounts_updated_at\n  BEFORE UPDATE ON public.corporate_accounts\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_corporate_membership_plans_updated_at\n  BEFORE UPDATE ON public.corporate_membership_plans\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_corporate_members_updated_at\n  BEFORE UPDATE ON public.corporate_members\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_corporate_invoices_updated_at\n  BEFORE UPDATE ON public.corporate_invoices\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\n-- Function to update member allocation counts\nCREATE OR REPLACE FUNCTION public.update_corporate_member_allocation()\nRETURNS trigger AS $$\nBEGIN\n  -- Update used allocation count when members are added/removed/changed\n  IF TG_OP = 'INSERT' AND NEW.is_active = true THEN\n    UPDATE public.corporate_accounts \n    SET used_member_allocation = used_member_allocation + 1\n    WHERE id = NEW.corporate_account_id;\n  ELSIF TG_OP = 'UPDATE' THEN\n    -- Member became active\n    IF OLD.is_active = false AND NEW.is_active = true THEN\n      UPDATE public.corporate_accounts \n      SET used_member_allocation = used_member_allocation + 1\n      WHERE id = NEW.corporate_account_id;\n    -- Member became inactive\n    ELSIF OLD.is_active = true AND NEW.is_active = false THEN\n      UPDATE public.corporate_accounts \n      SET used_member_allocation = GREATEST(used_member_allocation - 1, 0)\n      WHERE id = NEW.corporate_account_id;\n    END IF;\n  ELSIF TG_OP = 'DELETE' AND OLD.is_active = true THEN\n    UPDATE public.corporate_accounts \n    SET used_member_allocation = GREATEST(used_member_allocation - 1, 0)\n    WHERE id = OLD.corporate_account_id;\n  END IF;\n  \n  RETURN COALESCE(NEW, OLD);\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER SET search_path = public;\n\n-- Trigger for allocation tracking\nCREATE TRIGGER update_member_allocation_trigger\n  AFTER INSERT OR UPDATE OR DELETE ON public.corporate_members\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_corporate_member_allocation();\n\n-- Function to generate invoice numbers\nCREATE OR REPLACE FUNCTION public.generate_corporate_invoice_number()\nRETURNS TEXT AS $$\nDECLARE\n  new_number TEXT;\n  number_exists BOOLEAN;\nBEGIN\n  LOOP\n    -- Generate invoice number: CORP + YYYYMM + 6 random digits\n    new_number := 'CORP' || to_char(CURRENT_DATE, 'YYYYMM') || LPAD(FLOOR(RANDOM() * 1000000)::TEXT, 6, '0');\n    \n    -- Check if number already exists\n    SELECT EXISTS(SELECT 1 FROM public.corporate_invoices WHERE invoice_number = new_number) INTO number_exists;\n    \n    IF NOT number_exists THEN\n      EXIT;\n    END IF;\n  END LOOP;\n  \n  RETURN new_number;\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER SET search_path = public;\n\n-- Trigger to set invoice number\nCREATE OR REPLACE FUNCTION public.set_corporate_invoice_number()\nRETURNS trigger AS $$\nBEGIN\n  IF NEW.invoice_number IS NULL OR NEW.invoice_number = '' THEN\n    NEW.invoice_number := public.generate_corporate_invoice_number();\n  END IF;\n  RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql SET search_path = public;\n\nCREATE TRIGGER set_invoice_number_trigger\n  BEFORE INSERT ON public.corporate_invoices\n  FOR EACH ROW\n  EXECUTE FUNCTION public.set_corporate_invoice_number();"}		pearson.performance@gmail.com	\N	\N
20250922024552	{"-- Create SMS campaigns table\nCREATE TABLE public.sms_campaigns (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  campaign_name TEXT NOT NULL,\n  message_content TEXT NOT NULL,\n  recipient_type TEXT NOT NULL CHECK (recipient_type IN ('all_members', 'active_members', 'leads', 'staff', 'custom')),\n  recipient_count INTEGER DEFAULT 0,\n  scheduled_at TIMESTAMP WITH TIME ZONE,\n  sent_at TIMESTAMP WITH TIME ZONE,\n  delivery_count INTEGER DEFAULT 0,\n  failure_count INTEGER DEFAULT 0,\n  status TEXT NOT NULL DEFAULT 'draft' CHECK (status IN ('draft', 'scheduled', 'sending', 'sent', 'failed')),\n  created_by UUID NOT NULL,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Enable RLS\nALTER TABLE public.sms_campaigns ENABLE ROW LEVEL SECURITY;\n\n-- Create policies\nCREATE POLICY \\"Staff can manage SMS campaigns\\" \nON public.sms_campaigns \nFOR ALL \nUSING (organization_id IN (\n  SELECT organization_id FROM profiles \n  WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n));\n\n-- Create SMS campaign recipients table\nCREATE TABLE public.sms_campaign_recipients (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  campaign_id UUID NOT NULL REFERENCES sms_campaigns(id) ON DELETE CASCADE,\n  recipient_id UUID NOT NULL,\n  recipient_phone TEXT NOT NULL,\n  recipient_name TEXT,\n  sent_at TIMESTAMP WITH TIME ZONE,\n  delivered_at TIMESTAMP WITH TIME ZONE,\n  status TEXT NOT NULL DEFAULT 'pending' CHECK (status IN ('pending', 'sent', 'delivered', 'failed')),\n  error_message TEXT,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Enable RLS\nALTER TABLE public.sms_campaign_recipients ENABLE ROW LEVEL SECURITY;\n\n-- Create policies\nCREATE POLICY \\"Staff can view campaign recipients\\" \nON public.sms_campaign_recipients \nFOR SELECT \nUSING (campaign_id IN (\n  SELECT id FROM sms_campaigns \n  WHERE organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n  )\n));\n\n-- Create trigger\nCREATE TRIGGER update_sms_campaigns_updated_at\n  BEFORE UPDATE ON public.sms_campaigns\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();"}		pearson.performance@gmail.com	\N	\N
20250922025309	{"-- Create POS products table\nCREATE TABLE public.pos_products (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  name TEXT NOT NULL,\n  description TEXT,\n  price NUMERIC(10,2) NOT NULL,\n  cost NUMERIC(10,2),\n  barcode TEXT,\n  category TEXT NOT NULL DEFAULT 'general',\n  stock_quantity INTEGER DEFAULT 0,\n  low_stock_threshold INTEGER DEFAULT 5,\n  is_active BOOLEAN DEFAULT true,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Create POS sales table\nCREATE TABLE public.pos_sales (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  sale_number TEXT NOT NULL UNIQUE,\n  cashier_id UUID NOT NULL,\n  customer_id UUID,\n  subtotal NUMERIC(10,2) NOT NULL DEFAULT 0,\n  tax_amount NUMERIC(10,2) NOT NULL DEFAULT 0,\n  discount_amount NUMERIC(10,2) DEFAULT 0,\n  total_amount NUMERIC(10,2) NOT NULL,\n  payment_method TEXT NOT NULL DEFAULT 'cash',\n  payment_status TEXT NOT NULL DEFAULT 'completed',\n  location_id UUID,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Create POS sale items table\nCREATE TABLE public.pos_sale_items (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  sale_id UUID NOT NULL REFERENCES pos_sales(id) ON DELETE CASCADE,\n  product_id UUID NOT NULL REFERENCES pos_products(id),\n  quantity INTEGER NOT NULL DEFAULT 1,\n  unit_price NUMERIC(10,2) NOT NULL,\n  total_price NUMERIC(10,2) NOT NULL,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Enable RLS\nALTER TABLE public.pos_products ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.pos_sales ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.pos_sale_items ENABLE ROW LEVEL SECURITY;\n\n-- Create policies for products\nCREATE POLICY \\"Staff can manage POS products\\" \nON public.pos_products \nFOR ALL \nUSING (organization_id IN (\n  SELECT organization_id FROM profiles \n  WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n));\n\n-- Create policies for sales\nCREATE POLICY \\"Staff can manage POS sales\\" \nON public.pos_sales \nFOR ALL \nUSING (organization_id IN (\n  SELECT organization_id FROM profiles \n  WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n));\n\n-- Create policies for sale items\nCREATE POLICY \\"Staff can view POS sale items\\" \nON public.pos_sale_items \nFOR SELECT \nUSING (sale_id IN (\n  SELECT id FROM pos_sales \n  WHERE organization_id IN (\n    SELECT organization_id FROM profiles \n    WHERE id = auth.uid() AND role IN ('owner', 'manager', 'staff')\n  )\n));\n\n-- Create function to generate sale number\nCREATE OR REPLACE FUNCTION public.generate_pos_sale_number()\nRETURNS text\nLANGUAGE plpgsql\nSECURITY DEFINER\nSET search_path = public\nAS $$\nDECLARE\n  new_number TEXT;\n  number_exists BOOLEAN;\nBEGIN\n  LOOP\n    -- Generate sale number: POS + current date + 4 random digits\n    new_number := 'POS' || to_char(CURRENT_DATE, 'YYYYMMDD') || LPAD(FLOOR(RANDOM() * 10000)::TEXT, 4, '0');\n    \n    -- Check if number already exists\n    SELECT EXISTS(SELECT 1 FROM public.pos_sales WHERE sale_number = new_number) INTO number_exists;\n    \n    IF NOT number_exists THEN\n      EXIT;\n    END IF;\n  END LOOP;\n  \n  RETURN new_number;\nEND;\n$$;\n\n-- Create trigger for sale number\nCREATE OR REPLACE FUNCTION public.set_pos_sale_number()\nRETURNS trigger\nLANGUAGE plpgsql\nSET search_path = public\nAS $$\nBEGIN\n  IF NEW.sale_number IS NULL OR NEW.sale_number = '' THEN\n    NEW.sale_number := public.generate_pos_sale_number();\n  END IF;\n  RETURN NEW;\nEND;\n$$;\n\nCREATE TRIGGER set_pos_sale_number_trigger\n  BEFORE INSERT ON public.pos_sales\n  FOR EACH ROW\n  EXECUTE FUNCTION public.set_pos_sale_number();\n\n-- Create triggers for updated_at\nCREATE TRIGGER update_pos_products_updated_at\n  BEFORE UPDATE ON public.pos_products\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();"}		pearson.performance@gmail.com	\N	\N
20250922105502	{"-- Create missing pool maintenance scheduling tables (only if not exists)\nCREATE TABLE IF NOT EXISTS public.pool_maintenance_schedules (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  pool_id UUID NOT NULL,\n  maintenance_type TEXT NOT NULL,\n  title TEXT NOT NULL,\n  description TEXT,\n  frequency_days INTEGER NOT NULL DEFAULT 7,\n  estimated_duration_minutes INTEGER DEFAULT 60,\n  priority TEXT NOT NULL DEFAULT 'medium',\n  assigned_to UUID,\n  next_due_date DATE NOT NULL,\n  last_completed_date DATE,\n  is_active BOOLEAN DEFAULT true,\n  requires_pool_closure BOOLEAN DEFAULT false,\n  equipment_needed JSONB DEFAULT '[]',\n  safety_requirements JSONB DEFAULT '[]',\n  created_by UUID NOT NULL,\n  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT now()\n);\n\nCREATE TABLE IF NOT EXISTS public.pool_maintenance_logs (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  pool_id UUID NOT NULL,\n  schedule_id UUID,\n  maintenance_type TEXT NOT NULL,\n  title TEXT NOT NULL,\n  description TEXT,\n  performed_by UUID NOT NULL,\n  performed_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  duration_minutes INTEGER,\n  cost NUMERIC,\n  vendor_id UUID,\n  water_chemistry_before JSONB DEFAULT '{}',\n  water_chemistry_after JSONB DEFAULT '{}',\n  issues_found TEXT,\n  actions_taken TEXT,\n  next_maintenance_date DATE,\n  photos_taken INTEGER DEFAULT 0,\n  certification_required BOOLEAN DEFAULT false,\n  certified_by UUID,\n  certified_at TIMESTAMPTZ,\n  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT now()\n);\n\n-- Tournament management tables (only if not exists)\nCREATE TABLE IF NOT EXISTS public.tournament_matches (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  tournament_id UUID NOT NULL,\n  round_number INTEGER NOT NULL,\n  match_number INTEGER NOT NULL,\n  player1_id UUID,\n  player2_id UUID,\n  winner_id UUID,\n  court_id UUID,\n  scheduled_at TIMESTAMPTZ,\n  started_at TIMESTAMPTZ,\n  completed_at TIMESTAMPTZ,\n  score TEXT,\n  status TEXT NOT NULL DEFAULT 'pending',\n  notes TEXT,\n  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT now()\n);\n\n-- Enable RLS (with IF NOT EXISTS equivalent check)\nDO $$ BEGIN\n  IF NOT EXISTS (\n    SELECT 1 FROM pg_policies WHERE tablename = 'pool_maintenance_schedules' AND policyname = 'Staff can manage pool maintenance schedules'\n  ) THEN\n    ALTER TABLE public.pool_maintenance_schedules ENABLE ROW LEVEL SECURITY;\n    \n    CREATE POLICY \\"Staff can manage pool maintenance schedules\\" ON public.pool_maintenance_schedules\n    FOR ALL USING (\n      organization_id IN (\n        SELECT organization_id FROM profiles \n        WHERE id = auth.uid() \n        AND role IN ('owner', 'manager', 'staff')\n      )\n    );\n  END IF;\nEND $$;\n\nDO $$ BEGIN\n  IF NOT EXISTS (\n    SELECT 1 FROM pg_policies WHERE tablename = 'pool_maintenance_logs' AND policyname = 'Staff can manage pool maintenance logs'\n  ) THEN\n    ALTER TABLE public.pool_maintenance_logs ENABLE ROW LEVEL SECURITY;\n    \n    CREATE POLICY \\"Staff can manage pool maintenance logs\\" ON public.pool_maintenance_logs\n    FOR ALL USING (\n      organization_id IN (\n        SELECT organization_id FROM profiles \n        WHERE id = auth.uid() \n        AND role IN ('owner', 'manager', 'staff')\n      )\n    );\n  END IF;\nEND $$;\n\nDO $$ BEGIN\n  IF NOT EXISTS (\n    SELECT 1 FROM pg_policies WHERE tablename = 'tournament_matches' AND policyname = 'Members can view tournament matches'\n  ) THEN\n    ALTER TABLE public.tournament_matches ENABLE ROW LEVEL SECURITY;\n    \n    CREATE POLICY \\"Members can view tournament matches\\" ON public.tournament_matches\n    FOR SELECT USING (\n      tournament_id IN (\n        SELECT id FROM tournaments \n        WHERE organization_id IN (\n          SELECT organization_id FROM profiles WHERE id = auth.uid()\n        )\n      )\n    );\n    \n    CREATE POLICY \\"Staff can manage tournament matches\\" ON public.tournament_matches\n    FOR ALL USING (\n      tournament_id IN (\n        SELECT id FROM tournaments \n        WHERE organization_id IN (\n          SELECT organization_id FROM profiles \n          WHERE id = auth.uid() \n          AND role IN ('owner', 'manager', 'staff')\n        )\n      )\n    );\n  END IF;\nEND $$;"}		pearson.performance@gmail.com	\N	\N
20250927023335	{"-- First, check if blog_posts table exists and add missing SEO columns if needed\nDO $$\nBEGIN\n  -- Add meta_title column if it doesn't exist\n  IF NOT EXISTS (\n    SELECT 1 FROM information_schema.columns \n    WHERE table_name = 'blog_posts' AND column_name = 'meta_title'\n  ) THEN\n    ALTER TABLE blog_posts ADD COLUMN meta_title text;\n  END IF;\n\n  -- Add meta_description column if it doesn't exist\n  IF NOT EXISTS (\n    SELECT 1 FROM information_schema.columns \n    WHERE table_name = 'blog_posts' AND column_name = 'meta_description'\n  ) THEN\n    ALTER TABLE blog_posts ADD COLUMN meta_description text;\n  END IF;\n\n  -- Add meta_keywords column if it doesn't exist\n  IF NOT EXISTS (\n    SELECT 1 FROM information_schema.columns \n    WHERE table_name = 'blog_posts' AND column_name = 'meta_keywords'\n  ) THEN\n    ALTER TABLE blog_posts ADD COLUMN meta_keywords text;\n  END IF;\nEND $$;\n\n-- Now insert SEO-rich blog articles for Rep Club\n\n-- First, let's ensure we have blog categories\nINSERT INTO blog_categories (name, slug, description) VALUES\n  ('Gym Management', 'gym-management', 'Best practices for running a successful fitness facility'),\n  ('Member Retention', 'member-retention', 'Strategies to keep members engaged and reduce churn'),\n  ('Equipment & Maintenance', 'equipment-maintenance', 'Equipment care, safety, and facility management'),\n  ('Staff Training', 'staff-training', 'Training and development for gym staff'),\n  ('Marketing & Growth', 'marketing-growth', 'Marketing strategies and business growth tips'),\n  ('Technology & Innovation', 'technology-innovation', 'Latest tech trends in fitness industry')\nON CONFLICT (slug) DO NOTHING;\n\n-- Insert high-quality, SEO-optimized blog posts\nINSERT INTO blog_posts (\n  title, \n  slug, \n  excerpt, \n  content, \n  featured_image,\n  status, \n  published_at, \n  read_time,\n  meta_title,\n  meta_description,\n  meta_keywords,\n  category_id\n) VALUES \n(\n  'The Complete Guide to Gym Management Software in 2024',\n  'complete-guide-gym-management-software-2024',\n  'Discover how modern gym management software can revolutionize your fitness business operations, boost member satisfaction, and increase revenue by up to 30%.',\n  '<h2>Why Gym Management Software is Essential for Modern Fitness Businesses</h2>\n<p>Running a successful gym in 2024 requires more than just great equipment and trainers. With competition fierce and member expectations higher than ever, gym management software has become the backbone of profitable fitness businesses.</p>\n\n<h2>Key Features Every Gym Management System Should Have</h2>\n<h3>Member Management & CRM</h3>\n<p>A robust member management system tracks member information, visit history, and engagement patterns. This data helps you identify at-risk members and create targeted retention campaigns.</p>\n\n<h3>Billing & Payment Processing</h3>\n<p>Automated billing reduces administrative overhead and ensures consistent cash flow. Look for systems that support multiple payment methods and handle failed payments gracefully.</p>\n\n<h3>Class Scheduling & Booking</h3>\n<p>Online class booking increases member satisfaction and reduces front desk workload. Members can book classes 24/7, and you can track capacity and popularity.</p>\n\n<h3>Staff Management</h3>\n<p>Track staff schedules, certifications, and performance metrics. Good staff management features help reduce turnover and ensure proper coverage.</p>\n\n<h2>ROI: How Management Software Pays for Itself</h2>\n<p>Studies show that gyms using comprehensive management software see:</p>\n<ul>\n<li>25-30% reduction in member churn</li>\n<li>40% decrease in administrative tasks</li>\n<li>20% increase in personal training sales</li>\n<li>15% improvement in overall member satisfaction</li>\n</ul>\n\n<h2>Implementation Best Practices</h2>\n<p>Successfully implementing gym management software requires careful planning. Start with staff training, migrate data gradually, and maintain clear communication with members throughout the transition.</p>\n\n<h2>Choosing the Right Platform</h2>\n<p>Consider factors like scalability, integration capabilities, customer support, and pricing structure. The best system grows with your business and adapts to changing needs.</p>',\n  'https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=800&h=400&fit=crop',\n  'published',\n  '2024-01-15 10:00:00'::timestamp,\n  8,\n  'Complete Guide to Gym Management Software 2024 | Rep Club',\n  'Discover how gym management software revolutionizes fitness businesses. Boost member satisfaction, reduce churn by 30%, and streamline operations. Free guide.',\n  'gym management software, fitness business software, gym CRM, member management, gym billing, class scheduling, fitness center technology',\n  (SELECT id FROM blog_categories WHERE slug = 'gym-management')\n),\n(\n  '10 Proven Strategies to Reduce Gym Member Churn in 2024',\n  '10-proven-strategies-reduce-gym-member-churn-2024',\n  'Learn the top 10 evidence-based strategies that successful gyms use to reduce member churn rates by up to 40% and build long-term member loyalty.',\n  '<h2>The Hidden Cost of Member Churn</h2>\n<p>Member churn is the silent profit killer in the fitness industry. With average churn rates between 30-40% annually, retaining existing members is 5x more cost-effective than acquiring new ones.</p>\n\n<h2>Strategy 1: Implement a Comprehensive Onboarding Program</h2>\n<p>New members who complete a structured onboarding program are 80% more likely to stay beyond their first year. Your onboarding should include:</p>\n<ul>\n<li>Fitness assessment and goal setting</li>\n<li>Equipment orientation and safety training</li>\n<li>Introduction to staff and trainers</li>\n<li>Customized workout plan creation</li>\n</ul>\n\n<h2>Strategy 2: Use Predictive Analytics to Identify At-Risk Members</h2>\n<p>Track key indicators like visit frequency, class attendance, and engagement metrics. Members who show declining activity patterns are prime candidates for retention interventions.</p>\n\n<h2>Strategy 3: Create a Strong Community Culture</h2>\n<p>Members who feel connected to your gym community are 60% less likely to cancel. Foster community through:</p>\n<ul>\n<li>Group challenges and competitions</li>\n<li>Social events and member appreciation days</li>\n<li>Member Facebook groups or forums</li>\n<li>Partner workout programs</li>\n</ul>\n\n<h2>Strategy 4: Personalize the Member Experience</h2>\n<p>Use member data to create personalized experiences. Send customized workout suggestions, celebrate fitness milestones, and offer relevant services based on member preferences.</p>\n\n<h2>Strategy 5: Optimize Your Cancellation Process</h2>\n<p>Don''t make cancellation difficult, but do make it productive. Use exit interviews to understand reasons for leaving and offer alternatives like membership freezes or plan downgrades.</p>\n\n<h2>Strategy 6: Implement Regular Check-ins</h2>\n<p>Proactive communication prevents problems from escalating. Schedule regular check-ins with members, especially during their first 90 days.</p>\n\n<h2>Strategy 7: Offer Flexible Membership Options</h2>\n<p>Life circumstances change. Offer membership pause options, flexible contracts, and seasonal memberships to accommodate member needs.</p>\n\n<h2>Strategy 8: Maintain Exceptional Facility Standards</h2>\n<p>Clean, well-maintained facilities with modern equipment create positive experiences that keep members coming back.</p>\n\n<h2>Strategy 9: Invest in Staff Training</h2>\n<p>Friendly, knowledgeable staff significantly impact member satisfaction. Invest in customer service training and create a culture of member-first thinking.</p>\n\n<h2>Strategy 10: Track and Act on Member Feedback</h2>\n<p>Regular surveys and feedback collection help you address issues before they lead to cancellations. Act quickly on legitimate concerns and communicate changes to members.</p>\n\n<h2>Measuring Success</h2>\n<p>Track key metrics like monthly churn rate, lifetime value, and Net Promoter Score to measure the effectiveness of your retention strategies.</p>',\n  'https://images.unsplash.com/photo-1549476464-37392f717541?w=800&h=400&fit=crop',\n  'published',\n  '2024-01-20 09:00:00'::timestamp,\n  12,\n  '10 Proven Strategies to Reduce Gym Member Churn | Rep Club',\n  'Reduce gym member churn by 40% with these proven strategies. Expert tips for member retention, onboarding, and building gym community. Free guide.',\n  'gym member retention, reduce gym churn, member loyalty, fitness member retention, gym business strategies, member satisfaction',\n  (SELECT id FROM blog_categories WHERE slug = 'member-retention')\n);\n\n-- Insert blog tags if table exists\nDO $$\nBEGIN\n  IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_name = 'blog_tags') THEN\n    INSERT INTO blog_tags (name, slug) VALUES\n      ('Gym Management', 'gym-management'),\n      ('Member Retention', 'member-retention'),\n      ('Equipment Maintenance', 'equipment-maintenance'),\n      ('Staff Training', 'staff-training'),\n      ('Digital Marketing', 'digital-marketing'),\n      ('Fitness Technology', 'fitness-technology'),\n      ('Business Growth', 'business-growth'),\n      ('Customer Service', 'customer-service'),\n      ('Safety Protocols', 'safety-protocols'),\n      ('ROI Optimization', 'roi-optimization')\n    ON CONFLICT (slug) DO NOTHING;\n  END IF;\nEND $$;"}		pearson.performance@gmail.com	\N	\N
20250927074756	{"-- Create integrations table for third-party service connections\nCREATE TABLE public.integrations (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  name TEXT NOT NULL,\n  integration_type TEXT NOT NULL,\n  status TEXT NOT NULL DEFAULT 'inactive' CHECK (status IN ('active', 'inactive', 'error')),\n  config JSONB DEFAULT '{}',\n  last_sync_at TIMESTAMP WITH TIME ZONE,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Create webhook endpoints table\nCREATE TABLE public.webhook_endpoints (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  name TEXT NOT NULL,\n  url TEXT NOT NULL,\n  events TEXT[] NOT NULL DEFAULT '{}',\n  status TEXT NOT NULL DEFAULT 'active' CHECK (status IN ('active', 'inactive')),\n  secret_key TEXT,\n  retry_count INTEGER NOT NULL DEFAULT 3,\n  timeout_seconds INTEGER NOT NULL DEFAULT 30,\n  last_triggered_at TIMESTAMP WITH TIME ZONE,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Create webhook logs table for delivery tracking\nCREATE TABLE public.webhook_logs (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  webhook_endpoint_id UUID NOT NULL,\n  event_type TEXT NOT NULL,\n  status TEXT NOT NULL CHECK (status IN ('success', 'failed', 'retry')),\n  response_code INTEGER,\n  response_body TEXT,\n  attempt_count INTEGER NOT NULL DEFAULT 1,\n  payload JSONB,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Create API keys table\nCREATE TABLE public.api_keys (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  name TEXT NOT NULL,\n  key_hash TEXT NOT NULL, -- Store hashed version\n  key_preview TEXT NOT NULL, -- First/last few characters for display\n  permissions TEXT[] NOT NULL DEFAULT '{}',\n  last_used_at TIMESTAMP WITH TIME ZONE,\n  expires_at TIMESTAMP WITH TIME ZONE,\n  status TEXT NOT NULL DEFAULT 'active' CHECK (status IN ('active', 'inactive', 'revoked')),\n  created_by UUID NOT NULL,\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Create integration activity logs for audit trail\nCREATE TABLE public.integration_logs (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  organization_id UUID NOT NULL,\n  integration_id UUID,\n  api_key_id UUID,\n  event_type TEXT NOT NULL,\n  details JSONB DEFAULT '{}',\n  status TEXT NOT NULL CHECK (status IN ('success', 'error', 'warning')),\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Enable Row Level Security\nALTER TABLE public.integrations ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.webhook_endpoints ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.webhook_logs ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.api_keys ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.integration_logs ENABLE ROW LEVEL SECURITY;\n\n-- RLS Policies for integrations\nCREATE POLICY \\"Staff can manage integrations in their organization\\"\nON public.integrations\nFOR ALL\nUSING (organization_id IN (\n  SELECT organization_id FROM profiles \n  WHERE id = auth.uid() \n  AND role IN ('owner', 'manager', 'staff')\n));\n\n-- RLS Policies for webhook endpoints\nCREATE POLICY \\"Staff can manage webhook endpoints in their organization\\"\nON public.webhook_endpoints\nFOR ALL\nUSING (organization_id IN (\n  SELECT organization_id FROM profiles \n  WHERE id = auth.uid() \n  AND role IN ('owner', 'manager', 'staff')\n));\n\n-- RLS Policies for webhook logs\nCREATE POLICY \\"Staff can view webhook logs in their organization\\"\nON public.webhook_logs\nFOR SELECT\nUSING (organization_id IN (\n  SELECT organization_id FROM profiles \n  WHERE id = auth.uid() \n  AND role IN ('owner', 'manager', 'staff')\n));\n\nCREATE POLICY \\"System can insert webhook logs\\"\nON public.webhook_logs\nFOR INSERT\nWITH CHECK (true); -- Allow system to insert logs\n\n-- RLS Policies for API keys\nCREATE POLICY \\"Staff can manage API keys in their organization\\"\nON public.api_keys\nFOR ALL\nUSING (organization_id IN (\n  SELECT organization_id FROM profiles \n  WHERE id = auth.uid() \n  AND role IN ('owner', 'manager', 'staff')\n));\n\n-- RLS Policies for integration logs\nCREATE POLICY \\"Staff can view integration logs in their organization\\"\nON public.integration_logs\nFOR SELECT\nUSING (organization_id IN (\n  SELECT organization_id FROM profiles \n  WHERE id = auth.uid() \n  AND role IN ('owner', 'manager', 'staff')\n));\n\nCREATE POLICY \\"System can insert integration logs\\"\nON public.integration_logs\nFOR INSERT\nWITH CHECK (true); -- Allow system to insert logs\n\n-- Create foreign key relationships\nALTER TABLE public.webhook_logs \nADD CONSTRAINT fk_webhook_logs_endpoint \nFOREIGN KEY (webhook_endpoint_id) \nREFERENCES public.webhook_endpoints(id) \nON DELETE CASCADE;\n\nALTER TABLE public.integration_logs \nADD CONSTRAINT fk_integration_logs_integration \nFOREIGN KEY (integration_id) \nREFERENCES public.integrations(id) \nON DELETE CASCADE;\n\nALTER TABLE public.integration_logs \nADD CONSTRAINT fk_integration_logs_api_key \nFOREIGN KEY (api_key_id) \nREFERENCES public.api_keys(id) \nON DELETE CASCADE;\n\n-- Create function to update updated_at timestamps\nCREATE OR REPLACE FUNCTION public.update_integration_updated_at()\nRETURNS TRIGGER AS $$\nBEGIN\n  NEW.updated_at = now();\n  RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql SET search_path = public;\n\n-- Create triggers for updated_at\nCREATE TRIGGER update_integrations_updated_at\n  BEFORE UPDATE ON public.integrations\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_integration_updated_at();\n\nCREATE TRIGGER update_webhook_endpoints_updated_at\n  BEFORE UPDATE ON public.webhook_endpoints\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_integration_updated_at();\n\nCREATE TRIGGER update_api_keys_updated_at\n  BEFORE UPDATE ON public.api_keys\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_integration_updated_at();\n\n-- Create indexes for better performance\nCREATE INDEX idx_integrations_organization_id ON public.integrations(organization_id);\nCREATE INDEX idx_integrations_status ON public.integrations(status);\nCREATE INDEX idx_webhook_endpoints_organization_id ON public.webhook_endpoints(organization_id);\nCREATE INDEX idx_webhook_endpoints_status ON public.webhook_endpoints(status);\nCREATE INDEX idx_webhook_logs_organization_id ON public.webhook_logs(organization_id);\nCREATE INDEX idx_webhook_logs_endpoint_id ON public.webhook_logs(webhook_endpoint_id);\nCREATE INDEX idx_webhook_logs_created_at ON public.webhook_logs(created_at DESC);\nCREATE INDEX idx_api_keys_organization_id ON public.api_keys(organization_id);\nCREATE INDEX idx_api_keys_status ON public.api_keys(status);\nCREATE INDEX idx_integration_logs_organization_id ON public.integration_logs(organization_id);\nCREATE INDEX idx_integration_logs_created_at ON public.integration_logs(created_at DESC);"}		pearson.performance@gmail.com	\N	\N
20250929051346	{"-- Create early access requests table\nCREATE TABLE public.early_access_requests (\n  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,\n  name TEXT NOT NULL,\n  email TEXT NOT NULL UNIQUE,\n  company TEXT,\n  phone TEXT,\n  business_type TEXT NOT NULL,\n  current_members TEXT NOT NULL,\n  message TEXT,\n  status TEXT NOT NULL DEFAULT 'pending' CHECK (status IN ('pending', 'approved', 'contacted', 'converted')),\n  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),\n  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()\n);\n\n-- Enable Row Level Security\nALTER TABLE public.early_access_requests ENABLE ROW LEVEL SECURITY;\n\n-- Create policy for inserting early access requests (anyone can submit)\nCREATE POLICY \\"Anyone can submit early access requests\\"\nON public.early_access_requests\nFOR INSERT\nWITH CHECK (true);\n\n-- Create policy for staff to view and manage requests\nCREATE POLICY \\"Staff can manage early access requests\\"\nON public.early_access_requests\nFOR ALL\nUSING (EXISTS (\n  SELECT 1 FROM profiles \n  WHERE id = auth.uid() \n  AND role IN ('owner', 'manager', 'staff')\n));\n\n-- Create index for better performance\nCREATE INDEX idx_early_access_email ON public.early_access_requests(email);\nCREATE INDEX idx_early_access_status ON public.early_access_requests(status);\nCREATE INDEX idx_early_access_created_at ON public.early_access_requests(created_at DESC);\n\n-- Create trigger for updated_at\nCREATE TRIGGER update_early_access_updated_at\n  BEFORE UPDATE ON public.early_access_requests\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_integration_updated_at();"}		pearson.performance@gmail.com	\N	\N
20250930110840	{"-- Fix Security Definer View issues by recreating views with SECURITY INVOKER\n-- This makes views use the privileges of the querying user, not the view creator\n-- RLS policies on underlying tables (profiles, check_ins, class_bookings) will apply\n\n-- Drop and recreate member_attendance_summary with SECURITY INVOKER\nDROP VIEW IF EXISTS public.member_attendance_summary;\n\nCREATE VIEW public.member_attendance_summary\nWITH (security_invoker = true)\nAS\nSELECT \n  p.id AS member_id,\n  p.first_name,\n  p.last_name,\n  p.email,\n  count(c.id) AS total_visits,\n  count(CASE WHEN c.checked_in_at >= (CURRENT_DATE - '30 days'::interval) THEN 1 ELSE NULL END) AS visits_last_30_days,\n  count(CASE WHEN c.checked_in_at >= (CURRENT_DATE - '7 days'::interval) THEN 1 ELSE NULL END) AS visits_last_7_days,\n  max(c.checked_in_at) AS last_visit,\n  avg(EXTRACT(epoch FROM (c.checked_out_at - c.checked_in_at)) / 60) AS avg_duration_minutes\nFROM profiles p\nLEFT JOIN check_ins c ON p.id = c.member_id AND c.is_guest = false\nWHERE p.role = 'member'\nGROUP BY p.id, p.first_name, p.last_name, p.email;\n\n-- Drop and recreate member_engagement_summary with SECURITY INVOKER\nDROP VIEW IF EXISTS public.member_engagement_summary;\n\nCREATE VIEW public.member_engagement_summary\nWITH (security_invoker = true)\nAS\nSELECT \n  p.id AS member_id,\n  p.first_name,\n  p.last_name,\n  p.email,\n  p.organization_id,\n  p.join_date,\n  COALESCE(visit_stats.total_visits, 0) AS total_visits,\n  COALESCE(visit_stats.visits_last_30_days, 0) AS visits_last_30_days,\n  COALESCE(visit_stats.avg_visit_duration, 0) AS avg_visit_duration_minutes,\n  COALESCE(class_stats.classes_attended, 0) AS classes_attended,\n  COALESCE(class_stats.classes_booked_last_30, 0) AS classes_booked_last_30,\n  CASE\n    WHEN visit_stats.last_visit_date >= (CURRENT_DATE - '7 days'::interval) THEN 'active'\n    WHEN visit_stats.last_visit_date >= (CURRENT_DATE - '30 days'::interval) THEN 'at_risk'\n    ELSE 'inactive'\n  END AS engagement_status,\n  visit_stats.last_visit_date\nFROM profiles p\nLEFT JOIN (\n  SELECT \n    member_id,\n    count(*) AS total_visits,\n    count(CASE WHEN checked_in_at >= (CURRENT_DATE - '30 days'::interval) THEN 1 ELSE NULL END) AS visits_last_30_days,\n    avg(EXTRACT(epoch FROM (checked_out_at - checked_in_at)) / 60) AS avg_visit_duration,\n    max(checked_in_at) AS last_visit_date\n  FROM check_ins\n  WHERE is_guest = false\n  GROUP BY member_id\n) visit_stats ON p.id = visit_stats.member_id\nLEFT JOIN (\n  SELECT \n    member_id,\n    count(*) AS classes_attended,\n    count(CASE WHEN booked_at >= (CURRENT_DATE - '30 days'::interval) THEN 1 ELSE NULL END) AS classes_booked_last_30\n  FROM class_bookings\n  WHERE status = 'booked'\n  GROUP BY member_id\n) class_stats ON p.id = class_stats.member_id\nWHERE p.role = 'member';"}		pearson.performance@gmail.com	\N	\N
20251119034641	{"-- Create email threads table (one per domain)\nCREATE TABLE public.email_threads (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  organization_id UUID NOT NULL REFERENCES public.organizations(id) ON DELETE CASCADE,\n  domain TEXT NOT NULL,\n  display_name TEXT NOT NULL,\n  is_active BOOLEAN DEFAULT true,\n  created_at TIMESTAMPTZ DEFAULT now(),\n  updated_at TIMESTAMPTZ DEFAULT now(),\n  UNIQUE(organization_id, domain)\n);\n\n-- Create SMTP settings table (per thread)\nCREATE TABLE public.smtp_settings (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  thread_id UUID NOT NULL REFERENCES public.email_threads(id) ON DELETE CASCADE,\n  smtp_host TEXT NOT NULL,\n  smtp_port INTEGER NOT NULL DEFAULT 587,\n  smtp_username TEXT NOT NULL,\n  smtp_password TEXT NOT NULL,\n  from_email TEXT NOT NULL,\n  from_name TEXT,\n  use_tls BOOLEAN DEFAULT true,\n  created_at TIMESTAMPTZ DEFAULT now(),\n  updated_at TIMESTAMPTZ DEFAULT now(),\n  UNIQUE(thread_id)\n);\n\n-- Create email messages table\nCREATE TABLE public.email_messages (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  thread_id UUID NOT NULL REFERENCES public.email_threads(id) ON DELETE CASCADE,\n  external_id TEXT NOT NULL,\n  to_email TEXT NOT NULL,\n  from_name TEXT,\n  from_email TEXT NOT NULL,\n  subject TEXT,\n  body TEXT,\n  received_date TIMESTAMPTZ NOT NULL,\n  status TEXT DEFAULT 'open' CHECK (status IN ('open', 'closed', 'disregarded')),\n  assigned_to UUID REFERENCES public.profiles(id) ON DELETE SET NULL,\n  created_at TIMESTAMPTZ DEFAULT now(),\n  updated_at TIMESTAMPTZ DEFAULT now(),\n  UNIQUE(external_id)\n);\n\n-- Create email responses table (for tracking sent replies)\nCREATE TABLE public.email_responses (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  message_id UUID NOT NULL REFERENCES public.email_messages(id) ON DELETE CASCADE,\n  sent_by UUID NOT NULL REFERENCES public.profiles(id) ON DELETE CASCADE,\n  response_body TEXT NOT NULL,\n  sent_at TIMESTAMPTZ DEFAULT now(),\n  created_at TIMESTAMPTZ DEFAULT now()\n);\n\n-- Enable RLS\nALTER TABLE public.email_threads ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.smtp_settings ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.email_messages ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.email_responses ENABLE ROW LEVEL SECURITY;\n\n-- RLS Policies for email_threads\nCREATE POLICY \\"Users can view their org's email threads\\"\n  ON public.email_threads FOR SELECT\n  USING (organization_id = (SELECT organization_id FROM public.profiles WHERE id = auth.uid()));\n\nCREATE POLICY \\"Owners can manage email threads\\"\n  ON public.email_threads FOR ALL\n  USING (\n    organization_id = (SELECT organization_id FROM public.profiles WHERE id = auth.uid())\n    AND (SELECT role FROM public.profiles WHERE id = auth.uid()) = 'owner'\n  );\n\n-- RLS Policies for smtp_settings\nCREATE POLICY \\"Owners can view SMTP settings\\"\n  ON public.smtp_settings FOR SELECT\n  USING (\n    thread_id IN (\n      SELECT id FROM public.email_threads \n      WHERE organization_id = (SELECT organization_id FROM public.profiles WHERE id = auth.uid())\n    )\n    AND (SELECT role FROM public.profiles WHERE id = auth.uid()) = 'owner'\n  );\n\nCREATE POLICY \\"Owners can manage SMTP settings\\"\n  ON public.smtp_settings FOR ALL\n  USING (\n    thread_id IN (\n      SELECT id FROM public.email_threads \n      WHERE organization_id = (SELECT organization_id FROM public.profiles WHERE id = auth.uid())\n    )\n    AND (SELECT role FROM public.profiles WHERE id = auth.uid()) = 'owner'\n  );\n\n-- RLS Policies for email_messages\nCREATE POLICY \\"Users can view their org's email messages\\"\n  ON public.email_messages FOR SELECT\n  USING (\n    thread_id IN (\n      SELECT id FROM public.email_threads \n      WHERE organization_id = (SELECT organization_id FROM public.profiles WHERE id = auth.uid())\n    )\n  );\n\nCREATE POLICY \\"Staff can manage email messages\\"\n  ON public.email_messages FOR ALL\n  USING (\n    thread_id IN (\n      SELECT id FROM public.email_threads \n      WHERE organization_id = (SELECT organization_id FROM public.profiles WHERE id = auth.uid())\n    )\n    AND (SELECT role FROM public.profiles WHERE id = auth.uid()) IN ('owner', 'staff')\n  );\n\n-- RLS Policies for email_responses\nCREATE POLICY \\"Users can view email responses\\"\n  ON public.email_responses FOR SELECT\n  USING (\n    message_id IN (\n      SELECT em.id FROM public.email_messages em\n      JOIN public.email_threads et ON em.thread_id = et.id\n      WHERE et.organization_id = (SELECT organization_id FROM public.profiles WHERE id = auth.uid())\n    )\n  );\n\nCREATE POLICY \\"Staff can create email responses\\"\n  ON public.email_responses FOR INSERT\n  WITH CHECK (\n    message_id IN (\n      SELECT em.id FROM public.email_messages em\n      JOIN public.email_threads et ON em.thread_id = et.id\n      WHERE et.organization_id = (SELECT organization_id FROM public.profiles WHERE id = auth.uid())\n    )\n    AND (SELECT role FROM public.profiles WHERE id = auth.uid()) IN ('owner', 'staff')\n  );\n\n-- Create indexes\nCREATE INDEX idx_email_threads_org ON public.email_threads(organization_id);\nCREATE INDEX idx_email_messages_thread ON public.email_messages(thread_id);\nCREATE INDEX idx_email_messages_status ON public.email_messages(status);\nCREATE INDEX idx_email_messages_external_id ON public.email_messages(external_id);\nCREATE INDEX idx_email_responses_message ON public.email_responses(message_id);\n\n-- Create trigger for updated_at\nCREATE TRIGGER update_email_threads_updated_at\n  BEFORE UPDATE ON public.email_threads\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_smtp_settings_updated_at\n  BEFORE UPDATE ON public.smtp_settings\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\nCREATE TRIGGER update_email_messages_updated_at\n  BEFORE UPDATE ON public.email_messages\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();"}		pearson.performance@gmail.com	\N	\N
20251119042644	{"-- Drop smtp_settings table as it's no longer needed (using global Amazon SES instead)\nDROP TABLE IF EXISTS smtp_settings CASCADE;"}		pearson.performance@gmail.com	\N	\N
20251121052435	{"-- Add custom domain columns to organizations table\nALTER TABLE organizations \nADD COLUMN IF NOT EXISTS custom_domain TEXT UNIQUE,\nADD COLUMN IF NOT EXISTS custom_domain_verified BOOLEAN DEFAULT false;"}		pearson.performance@gmail.com	\N	\N
20251202041840	{"-- Add missing columns to profiles table for onboarding and dashboard preferences\nALTER TABLE public.profiles \nADD COLUMN IF NOT EXISTS onboarding_state JSONB DEFAULT NULL,\nADD COLUMN IF NOT EXISTS dashboard_preferences JSONB DEFAULT NULL;\n\n-- Add comments for documentation\nCOMMENT ON COLUMN public.profiles.onboarding_state IS 'Stores user onboarding tour progress and state';\nCOMMENT ON COLUMN public.profiles.dashboard_preferences IS 'Stores user dashboard widget preferences and layout';"}		pearson.performance@gmail.com	\N	\N
20251202043211	{"-- =============================================\n-- Blog & Social Media AI Automation System\n-- Database Schema Migration\n-- =============================================\n\n-- Table 1: AI Model Configuration (Centralized)\nCREATE TABLE IF NOT EXISTS public.ai_model_settings (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  organization_id UUID NOT NULL REFERENCES public.organizations(id) ON DELETE CASCADE,\n  \n  -- Primary AI Provider Configuration\n  primary_provider TEXT DEFAULT 'claude', -- 'claude', 'openai', 'gemini', 'lovable'\n  primary_model TEXT DEFAULT 'claude-sonnet-4-5',\n  fallback_provider TEXT DEFAULT 'claude',\n  fallback_model TEXT DEFAULT 'claude-opus-4-1-20250805',\n  \n  -- Model Parameters\n  temperature DECIMAL(3,2) DEFAULT 0.7,\n  max_tokens INTEGER DEFAULT 4096,\n  \n  -- Provider-Specific Settings\n  claude_version TEXT DEFAULT '2023-06-01',\n  openai_organization_id TEXT,\n  \n  -- Usage Tracking\n  last_used_at TIMESTAMPTZ,\n  total_requests INTEGER DEFAULT 0,\n  total_tokens_used BIGINT DEFAULT 0,\n  \n  created_at TIMESTAMPTZ DEFAULT now(),\n  updated_at TIMESTAMPTZ DEFAULT now(),\n  created_by UUID REFERENCES auth.users(id),\n  \n  UNIQUE(organization_id)\n);\n\n-- Table 2: Blog Auto-Generation Settings\nCREATE TABLE IF NOT EXISTS public.blog_auto_generation_settings (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  organization_id UUID NOT NULL REFERENCES public.organizations(id) ON DELETE CASCADE,\n  \n  -- Generation Schedule\n  is_enabled BOOLEAN DEFAULT false,\n  generation_frequency TEXT DEFAULT 'weekly', -- 'daily', 'weekly', 'biweekly', 'monthly'\n  generation_time TIME DEFAULT '09:00:00',\n  generation_timezone TEXT DEFAULT 'America/New_York',\n  last_generation_at TIMESTAMPTZ,\n  next_generation_at TIMESTAMPTZ,\n  \n  -- Content Settings\n  target_word_count INTEGER DEFAULT 1200,\n  content_style TEXT DEFAULT 'professional', -- 'professional', 'conversational', 'technical', 'casual'\n  industry_focus TEXT[] DEFAULT '{\\"fitness\\", \\"health\\", \\"wellness\\"}',\n  target_keywords TEXT[] DEFAULT '{}',\n  \n  -- SEO & GEO Settings\n  optimize_for_geographic BOOLEAN DEFAULT false,\n  target_locations TEXT[] DEFAULT '{}',\n  seo_focus TEXT DEFAULT 'balanced', -- 'aggressive', 'balanced', 'minimal'\n  geo_optimization BOOLEAN DEFAULT true, -- Generative Engine Optimization\n  perplexity_optimization BOOLEAN DEFAULT true,\n  ai_search_optimization BOOLEAN DEFAULT true,\n  \n  -- Content Diversity\n  topic_diversity_enabled BOOLEAN DEFAULT true,\n  minimum_topic_gap_days INTEGER DEFAULT 30,\n  content_analysis_depth TEXT DEFAULT 'excerpt', -- 'title', 'excerpt', 'full'\n  \n  -- Publishing Settings\n  auto_publish BOOLEAN DEFAULT false,\n  publish_as_draft BOOLEAN DEFAULT true,\n  require_review BOOLEAN DEFAULT true,\n  notify_on_generation BOOLEAN DEFAULT true,\n  notification_emails TEXT[] DEFAULT '{}',\n  \n  -- Customization\n  content_template TEXT,\n  custom_instructions TEXT,\n  brand_voice_guidelines TEXT,\n  \n  created_at TIMESTAMPTZ DEFAULT now(),\n  updated_at TIMESTAMPTZ DEFAULT now(),\n  created_by UUID REFERENCES auth.users(id),\n  \n  UNIQUE(organization_id)\n);\n\n-- Table 3: Blog Generation Queue\nCREATE TABLE IF NOT EXISTS public.blog_generation_queue (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  organization_id UUID NOT NULL REFERENCES public.organizations(id) ON DELETE CASCADE,\n  \n  scheduled_for TIMESTAMPTZ NOT NULL,\n  status TEXT DEFAULT 'pending', -- 'pending', 'processing', 'completed', 'failed', 'cancelled'\n  priority INTEGER DEFAULT 5, -- 1-10 (10 is highest)\n  \n  suggested_topic TEXT,\n  target_keywords TEXT[] DEFAULT '{}',\n  custom_parameters JSONB DEFAULT '{}',\n  \n  processing_started_at TIMESTAMPTZ,\n  processing_completed_at TIMESTAMPTZ,\n  error_message TEXT,\n  retry_count INTEGER DEFAULT 0,\n  max_retries INTEGER DEFAULT 3,\n  \n  blog_post_id UUID REFERENCES public.blog_posts(id) ON DELETE SET NULL,\n  generation_metadata JSONB DEFAULT '{}',\n  \n  created_at TIMESTAMPTZ DEFAULT now(),\n  updated_at TIMESTAMPTZ DEFAULT now()\n);\n\n-- Table 4: Blog Topic History (for diversity tracking)\nCREATE TABLE IF NOT EXISTS public.blog_topic_history (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  organization_id UUID NOT NULL REFERENCES public.organizations(id) ON DELETE CASCADE,\n  blog_post_id UUID REFERENCES public.blog_posts(id) ON DELETE CASCADE,\n  \n  primary_topic TEXT NOT NULL,\n  secondary_topics TEXT[] DEFAULT '{}',\n  keywords_used TEXT[] DEFAULT '{}',\n  topic_category TEXT,\n  content_type TEXT DEFAULT 'article',\n  \n  target_keywords TEXT[] DEFAULT '{}',\n  geo_targets TEXT[] DEFAULT '{}',\n  seo_score DECIMAL(5,2),\n  readability_score DECIMAL(5,2),\n  \n  generation_model TEXT,\n  generation_time_seconds INTEGER,\n  ai_confidence_score DECIMAL(5,2),\n  \n  created_at TIMESTAMPTZ DEFAULT now()\n);\n\n-- Table 5: Social Media Automation Settings\nCREATE TABLE IF NOT EXISTS public.social_media_automation_settings (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  organization_id UUID NOT NULL REFERENCES public.organizations(id) ON DELETE CASCADE,\n  \n  is_active BOOLEAN DEFAULT true,\n  auto_post_on_publish BOOLEAN DEFAULT false,\n  \n  -- Webhook Configuration\n  webhook_url TEXT,\n  webhook_secret TEXT,\n  webhook_enabled BOOLEAN DEFAULT false,\n  \n  -- AI Content Generation\n  ai_content_generation BOOLEAN DEFAULT true,\n  platforms_enabled JSONB DEFAULT '[\\"linkedin\\", \\"twitter\\", \\"facebook\\", \\"instagram\\"]'::jsonb,\n  \n  -- Scheduling & Templates\n  posting_schedule JSONB DEFAULT '{}'::jsonb,\n  content_templates JSONB DEFAULT '{}'::jsonb,\n  \n  -- Platform-Specific Settings\n  twitter_character_limit INTEGER DEFAULT 280,\n  linkedin_character_limit INTEGER DEFAULT 3000,\n  facebook_character_limit INTEGER DEFAULT 63206,\n  instagram_character_limit INTEGER DEFAULT 2200,\n  \n  created_at TIMESTAMPTZ DEFAULT now(),\n  updated_at TIMESTAMPTZ DEFAULT now(),\n  created_by UUID REFERENCES auth.users(id),\n  \n  UNIQUE(organization_id)\n);\n\n-- Table 6: Social Media Automation Logs\nCREATE TABLE IF NOT EXISTS public.social_media_automation_logs (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  organization_id UUID NOT NULL REFERENCES public.organizations(id) ON DELETE CASCADE,\n  blog_post_id UUID REFERENCES public.blog_posts(id) ON DELETE CASCADE,\n  \n  trigger_type TEXT NOT NULL, -- 'manual', 'auto_publish', 'scheduled', 'webhook'\n  platforms_processed JSONB DEFAULT '[]'::jsonb,\n  posts_created INTEGER DEFAULT 0,\n  \n  -- Webhook Tracking\n  webhook_sent BOOLEAN DEFAULT false,\n  webhook_url TEXT,\n  webhook_response JSONB DEFAULT '{}'::jsonb,\n  webhook_response_status INTEGER,\n  \n  -- Generated Content\n  generated_content JSONB DEFAULT '{}'::jsonb,\n  \n  status TEXT DEFAULT 'pending', -- 'pending', 'processing', 'completed', 'failed'\n  error_message TEXT,\n  \n  created_at TIMESTAMPTZ DEFAULT now(),\n  updated_at TIMESTAMPTZ DEFAULT now()\n);\n\n-- Indexes for Performance\nCREATE INDEX IF NOT EXISTS idx_blog_queue_status_scheduled ON public.blog_generation_queue(status, scheduled_for);\nCREATE INDEX IF NOT EXISTS idx_blog_queue_org_status ON public.blog_generation_queue(organization_id, status);\nCREATE INDEX IF NOT EXISTS idx_blog_topic_history_org_created ON public.blog_topic_history(organization_id, created_at DESC);\nCREATE INDEX IF NOT EXISTS idx_social_logs_blog_post ON public.social_media_automation_logs(blog_post_id);\nCREATE INDEX IF NOT EXISTS idx_social_logs_org_created ON public.social_media_automation_logs(organization_id, created_at DESC);\n\n-- Enable RLS on all tables\nALTER TABLE public.ai_model_settings ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.blog_auto_generation_settings ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.blog_generation_queue ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.blog_topic_history ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.social_media_automation_settings ENABLE ROW LEVEL SECURITY;\nALTER TABLE public.social_media_automation_logs ENABLE ROW LEVEL SECURITY;\n\n-- RLS Policies for ai_model_settings\nCREATE POLICY \\"Organizations can view their AI settings\\"\n  ON public.ai_model_settings FOR SELECT\n  USING (organization_id = get_user_organization_id(auth.uid()));\n\nCREATE POLICY \\"Organization owners can manage AI settings\\"\n  ON public.ai_model_settings FOR ALL\n  USING (\n    organization_id = get_user_organization_id(auth.uid())\n    AND EXISTS (\n      SELECT 1 FROM public.profiles\n      WHERE id = auth.uid()\n      AND role = 'owner'\n    )\n  );\n\n-- RLS Policies for blog_auto_generation_settings\nCREATE POLICY \\"Organizations can view their blog settings\\"\n  ON public.blog_auto_generation_settings FOR SELECT\n  USING (organization_id = get_user_organization_id(auth.uid()));\n\nCREATE POLICY \\"Organization owners can manage blog settings\\"\n  ON public.blog_auto_generation_settings FOR ALL\n  USING (\n    organization_id = get_user_organization_id(auth.uid())\n    AND EXISTS (\n      SELECT 1 FROM public.profiles\n      WHERE id = auth.uid()\n      AND role = 'owner'\n    )\n  );\n\n-- RLS Policies for blog_generation_queue\nCREATE POLICY \\"Organizations can view their blog queue\\"\n  ON public.blog_generation_queue FOR SELECT\n  USING (organization_id = get_user_organization_id(auth.uid()));\n\nCREATE POLICY \\"Organization owners can manage blog queue\\"\n  ON public.blog_generation_queue FOR ALL\n  USING (\n    organization_id = get_user_organization_id(auth.uid())\n    AND EXISTS (\n      SELECT 1 FROM public.profiles\n      WHERE id = auth.uid()\n      AND role = 'owner'\n    )\n  );\n\n-- RLS Policies for blog_topic_history\nCREATE POLICY \\"Organizations can view their topic history\\"\n  ON public.blog_topic_history FOR SELECT\n  USING (organization_id = get_user_organization_id(auth.uid()));\n\nCREATE POLICY \\"System can insert topic history\\"\n  ON public.blog_topic_history FOR INSERT\n  WITH CHECK (true); -- Edge functions will insert\n\n-- RLS Policies for social_media_automation_settings\nCREATE POLICY \\"Organizations can view their social settings\\"\n  ON public.social_media_automation_settings FOR SELECT\n  USING (organization_id = get_user_organization_id(auth.uid()));\n\nCREATE POLICY \\"Organization owners can manage social settings\\"\n  ON public.social_media_automation_settings FOR ALL\n  USING (\n    organization_id = get_user_organization_id(auth.uid())\n    AND EXISTS (\n      SELECT 1 FROM public.profiles\n      WHERE id = auth.uid()\n      AND role = 'owner'\n    )\n  );\n\n-- RLS Policies for social_media_automation_logs\nCREATE POLICY \\"Organizations can view their social logs\\"\n  ON public.social_media_automation_logs FOR SELECT\n  USING (organization_id = get_user_organization_id(auth.uid()));\n\nCREATE POLICY \\"System can insert social logs\\"\n  ON public.social_media_automation_logs FOR INSERT\n  WITH CHECK (true); -- Edge functions will insert\n\n-- Trigger to update updated_at timestamps\nCREATE OR REPLACE FUNCTION public.update_ai_automation_updated_at()\nRETURNS TRIGGER\nLANGUAGE plpgsql\nSET search_path = public\nAS $$\nBEGIN\n  NEW.updated_at = now();\n  RETURN NEW;\nEND;\n$$;\n\n-- Apply update triggers\nCREATE TRIGGER update_ai_model_settings_updated_at\n  BEFORE UPDATE ON public.ai_model_settings\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_ai_automation_updated_at();\n\nCREATE TRIGGER update_blog_auto_generation_settings_updated_at\n  BEFORE UPDATE ON public.blog_auto_generation_settings\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_ai_automation_updated_at();\n\nCREATE TRIGGER update_blog_generation_queue_updated_at\n  BEFORE UPDATE ON public.blog_generation_queue\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_ai_automation_updated_at();\n\nCREATE TRIGGER update_social_media_automation_settings_updated_at\n  BEFORE UPDATE ON public.social_media_automation_settings\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_ai_automation_updated_at();\n\nCREATE TRIGGER update_social_media_automation_logs_updated_at\n  BEFORE UPDATE ON public.social_media_automation_logs\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_ai_automation_updated_at();\n\n-- Comments for documentation\nCOMMENT ON TABLE public.ai_model_settings IS 'Centralized AI model configuration for all content generation - single source of truth';\nCOMMENT ON TABLE public.blog_auto_generation_settings IS 'Configuration for automated blog content generation with AI';\nCOMMENT ON TABLE public.blog_generation_queue IS 'Queue for scheduled blog generation jobs with retry logic';\nCOMMENT ON TABLE public.blog_topic_history IS 'Tracks generated topics to prevent repetitive content';\nCOMMENT ON TABLE public.social_media_automation_settings IS 'Social media automation configuration and webhook settings';\nCOMMENT ON TABLE public.social_media_automation_logs IS 'Execution logs for social media automation and debugging';"}		pearson.performance@gmail.com	\N	\N
\.


--
-- Data for Name: seed_files; Type: TABLE DATA; Schema: supabase_migrations; Owner: postgres
--

COPY supabase_migrations.seed_files (path, hash) FROM stdin;
\.


--
-- Data for Name: secrets; Type: TABLE DATA; Schema: vault; Owner: supabase_admin
--

COPY vault.secrets (id, name, description, secret, key_id, nonce, created_at, updated_at) FROM stdin;
\.


--
-- Name: refresh_tokens_id_seq; Type: SEQUENCE SET; Schema: auth; Owner: supabase_auth_admin
--

SELECT pg_catalog.setval('auth.refresh_tokens_id_seq', 34, true);


--
-- Name: subscription_id_seq; Type: SEQUENCE SET; Schema: realtime; Owner: supabase_admin
--

SELECT pg_catalog.setval('realtime.subscription_id_seq', 1, false);


--
-- Name: mfa_amr_claims amr_id_pk; Type: CONSTRAINT; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE ONLY auth.mfa_amr_claims
    ADD CONSTRAINT amr_id_pk PRIMARY KEY (id);


--
-- Name: audit_log_entries audit_log_entries_pkey; Type: CONSTRAINT; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE ONLY auth.audit_log_entries
    ADD CONSTRAINT audit_log_entries_pkey PRIMARY KEY (id);


--
-- Name: flow_state flow_state_pkey; Type: CONSTRAINT; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE ONLY auth.flow_state
    ADD CONSTRAINT flow_state_pkey PRIMARY KEY (id);


--
-- Name: identities identities_pkey; Type: CONSTRAINT; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE ONLY auth.identities
    ADD CONSTRAINT identities_pkey PRIMARY KEY (id);


--
-- Name: identities identities_provider_id_provider_unique; Type: CONSTRAINT; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE ONLY auth.identities
    ADD CONSTRAINT identities_provider_id_provider_unique UNIQUE (provider_id, provider);


--
-- Name: instances instances_pkey; Type: CONSTRAINT; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE ONLY auth.instances
    ADD CONSTRAINT instances_pkey PRIMARY KEY (id);


--
-- Name: mfa_amr_claims mfa_amr_claims_session_id_authentication_method_pkey; Type: CONSTRAINT; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE ONLY auth.mfa_amr_claims
    ADD CONSTRAINT mfa_amr_claims_session_id_authentication_method_pkey UNIQUE (session_id, authentication_method);


--
-- Name: mfa_challenges mfa_challenges_pkey; Type: CONSTRAINT; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE ONLY auth.mfa_challenges
    ADD CONSTRAINT mfa_challenges_pkey PRIMARY KEY (id);


--
-- Name: mfa_factors mfa_factors_last_challenged_at_key; Type: CONSTRAINT; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE ONLY auth.mfa_factors
    ADD CONSTRAINT mfa_factors_last_challenged_at_key UNIQUE (last_challenged_at);


--
-- Name: mfa_factors mfa_factors_pkey; Type: CONSTRAINT; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE ONLY auth.mfa_factors
    ADD CONSTRAINT mfa_factors_pkey PRIMARY KEY (id);


--
-- Name: oauth_authorizations oauth_authorizations_authorization_code_key; Type: CONSTRAINT; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE ONLY auth.oauth_authorizations
    ADD CONSTRAINT oauth_authorizations_authorization_code_key UNIQUE (authorization_code);


--
-- Name: oauth_authorizations oauth_authorizations_authorization_id_key; Type: CONSTRAINT; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE ONLY auth.oauth_authorizations
    ADD CONSTRAINT oauth_authorizations_authorization_id_key UNIQUE (authorization_id);


--
-- Name: oauth_authorizations oauth_authorizations_pkey; Type: CONSTRAINT; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE ONLY auth.oauth_authorizations
    ADD CONSTRAINT oauth_authorizations_pkey PRIMARY KEY (id);


--
-- Name: oauth_client_states oauth_client_states_pkey; Type: CONSTRAINT; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE ONLY auth.oauth_client_states
    ADD CONSTRAINT oauth_client_states_pkey PRIMARY KEY (id);


--
-- Name: oauth_clients oauth_clients_pkey; Type: CONSTRAINT; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE ONLY auth.oauth_clients
    ADD CONSTRAINT oauth_clients_pkey PRIMARY KEY (id);


--
-- Name: oauth_consents oauth_consents_pkey; Type: CONSTRAINT; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE ONLY auth.oauth_consents
    ADD CONSTRAINT oauth_consents_pkey PRIMARY KEY (id);


--
-- Name: oauth_consents oauth_consents_user_client_unique; Type: CONSTRAINT; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE ONLY auth.oauth_consents
    ADD CONSTRAINT oauth_consents_user_client_unique UNIQUE (user_id, client_id);


--
-- Name: one_time_tokens one_time_tokens_pkey; Type: CONSTRAINT; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE ONLY auth.one_time_tokens
    ADD CONSTRAINT one_time_tokens_pkey PRIMARY KEY (id);


--
-- Name: refresh_tokens refresh_tokens_pkey; Type: CONSTRAINT; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE ONLY auth.refresh_tokens
    ADD CONSTRAINT refresh_tokens_pkey PRIMARY KEY (id);


--
-- Name: refresh_tokens refresh_tokens_token_unique; Type: CONSTRAINT; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE ONLY auth.refresh_tokens
    ADD CONSTRAINT refresh_tokens_token_unique UNIQUE (token);


--
-- Name: saml_providers saml_providers_entity_id_key; Type: CONSTRAINT; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE ONLY auth.saml_providers
    ADD CONSTRAINT saml_providers_entity_id_key UNIQUE (entity_id);


--
-- Name: saml_providers saml_providers_pkey; Type: CONSTRAINT; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE ONLY auth.saml_providers
    ADD CONSTRAINT saml_providers_pkey PRIMARY KEY (id);


--
-- Name: saml_relay_states saml_relay_states_pkey; Type: CONSTRAINT; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE ONLY auth.saml_relay_states
    ADD CONSTRAINT saml_relay_states_pkey PRIMARY KEY (id);


--
-- Name: schema_migrations schema_migrations_pkey; Type: CONSTRAINT; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE ONLY auth.schema_migrations
    ADD CONSTRAINT schema_migrations_pkey PRIMARY KEY (version);


--
-- Name: sessions sessions_pkey; Type: CONSTRAINT; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE ONLY auth.sessions
    ADD CONSTRAINT sessions_pkey PRIMARY KEY (id);


--
-- Name: sso_domains sso_domains_pkey; Type: CONSTRAINT; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE ONLY auth.sso_domains
    ADD CONSTRAINT sso_domains_pkey PRIMARY KEY (id);


--
-- Name: sso_providers sso_providers_pkey; Type: CONSTRAINT; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE ONLY auth.sso_providers
    ADD CONSTRAINT sso_providers_pkey PRIMARY KEY (id);


--
-- Name: users users_phone_key; Type: CONSTRAINT; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE ONLY auth.users
    ADD CONSTRAINT users_phone_key UNIQUE (phone);


--
-- Name: users users_pkey; Type: CONSTRAINT; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE ONLY auth.users
    ADD CONSTRAINT users_pkey PRIMARY KEY (id);


--
-- Name: ai_model_settings ai_model_settings_organization_id_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.ai_model_settings
    ADD CONSTRAINT ai_model_settings_organization_id_key UNIQUE (organization_id);


--
-- Name: ai_model_settings ai_model_settings_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.ai_model_settings
    ADD CONSTRAINT ai_model_settings_pkey PRIMARY KEY (id);


--
-- Name: announcements announcements_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.announcements
    ADD CONSTRAINT announcements_pkey PRIMARY KEY (id);


--
-- Name: api_keys api_keys_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.api_keys
    ADD CONSTRAINT api_keys_pkey PRIMARY KEY (id);


--
-- Name: blog_auto_generation_settings blog_auto_generation_settings_organization_id_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.blog_auto_generation_settings
    ADD CONSTRAINT blog_auto_generation_settings_organization_id_key UNIQUE (organization_id);


--
-- Name: blog_auto_generation_settings blog_auto_generation_settings_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.blog_auto_generation_settings
    ADD CONSTRAINT blog_auto_generation_settings_pkey PRIMARY KEY (id);


--
-- Name: blog_categories blog_categories_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.blog_categories
    ADD CONSTRAINT blog_categories_pkey PRIMARY KEY (id);


--
-- Name: blog_categories blog_categories_slug_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.blog_categories
    ADD CONSTRAINT blog_categories_slug_key UNIQUE (slug);


--
-- Name: blog_generation_queue blog_generation_queue_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.blog_generation_queue
    ADD CONSTRAINT blog_generation_queue_pkey PRIMARY KEY (id);


--
-- Name: blog_post_tags blog_post_tags_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.blog_post_tags
    ADD CONSTRAINT blog_post_tags_pkey PRIMARY KEY (post_id, tag_id);


--
-- Name: blog_posts blog_posts_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.blog_posts
    ADD CONSTRAINT blog_posts_pkey PRIMARY KEY (id);


--
-- Name: blog_posts blog_posts_slug_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.blog_posts
    ADD CONSTRAINT blog_posts_slug_key UNIQUE (slug);


--
-- Name: blog_tags blog_tags_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.blog_tags
    ADD CONSTRAINT blog_tags_pkey PRIMARY KEY (id);


--
-- Name: blog_tags blog_tags_slug_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.blog_tags
    ADD CONSTRAINT blog_tags_slug_key UNIQUE (slug);


--
-- Name: blog_topic_history blog_topic_history_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.blog_topic_history
    ADD CONSTRAINT blog_topic_history_pkey PRIMARY KEY (id);


--
-- Name: bulk_member_operations bulk_member_operations_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.bulk_member_operations
    ADD CONSTRAINT bulk_member_operations_pkey PRIMARY KEY (id);


--
-- Name: campaign_executions campaign_executions_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.campaign_executions
    ADD CONSTRAINT campaign_executions_pkey PRIMARY KEY (id);


--
-- Name: certification_requirements certification_requirements_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.certification_requirements
    ADD CONSTRAINT certification_requirements_pkey PRIMARY KEY (id);


--
-- Name: check_ins check_ins_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.check_ins
    ADD CONSTRAINT check_ins_pkey PRIMARY KEY (id);


--
-- Name: child_profiles child_profiles_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.child_profiles
    ADD CONSTRAINT child_profiles_pkey PRIMARY KEY (id);


--
-- Name: childcare_activities childcare_activities_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.childcare_activities
    ADD CONSTRAINT childcare_activities_pkey PRIMARY KEY (id);


--
-- Name: childcare_activity_registrations childcare_activity_registrations_activity_id_child_id_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.childcare_activity_registrations
    ADD CONSTRAINT childcare_activity_registrations_activity_id_child_id_key UNIQUE (activity_id, child_id);


--
-- Name: childcare_activity_registrations childcare_activity_registrations_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.childcare_activity_registrations
    ADD CONSTRAINT childcare_activity_registrations_pkey PRIMARY KEY (id);


--
-- Name: childcare_checkins childcare_checkins_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.childcare_checkins
    ADD CONSTRAINT childcare_checkins_pkey PRIMARY KEY (id);


--
-- Name: childcare_daily_reports childcare_daily_reports_child_id_report_date_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.childcare_daily_reports
    ADD CONSTRAINT childcare_daily_reports_child_id_report_date_key UNIQUE (child_id, report_date);


--
-- Name: childcare_daily_reports childcare_daily_reports_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.childcare_daily_reports
    ADD CONSTRAINT childcare_daily_reports_pkey PRIMARY KEY (id);


--
-- Name: childcare_staff_schedules childcare_staff_schedules_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.childcare_staff_schedules
    ADD CONSTRAINT childcare_staff_schedules_pkey PRIMARY KEY (id);


--
-- Name: childcare_staff_schedules childcare_staff_schedules_staff_id_schedule_date_start_time_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.childcare_staff_schedules
    ADD CONSTRAINT childcare_staff_schedules_staff_id_schedule_date_start_time_key UNIQUE (staff_id, schedule_date, start_time);


--
-- Name: class_analytics class_analytics_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.class_analytics
    ADD CONSTRAINT class_analytics_pkey PRIMARY KEY (id);


--
-- Name: class_bookings class_bookings_class_id_member_id_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.class_bookings
    ADD CONSTRAINT class_bookings_class_id_member_id_key UNIQUE (class_id, member_id);


--
-- Name: class_bookings class_bookings_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.class_bookings
    ADD CONSTRAINT class_bookings_pkey PRIMARY KEY (id);


--
-- Name: class_categories class_categories_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.class_categories
    ADD CONSTRAINT class_categories_pkey PRIMARY KEY (id);


--
-- Name: class_waitlists class_waitlists_class_id_member_id_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.class_waitlists
    ADD CONSTRAINT class_waitlists_class_id_member_id_key UNIQUE (class_id, member_id);


--
-- Name: class_waitlists class_waitlists_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.class_waitlists
    ADD CONSTRAINT class_waitlists_pkey PRIMARY KEY (id);


--
-- Name: classes classes_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.classes
    ADD CONSTRAINT classes_pkey PRIMARY KEY (id);


--
-- Name: cleaning_schedules cleaning_schedules_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.cleaning_schedules
    ADD CONSTRAINT cleaning_schedules_pkey PRIMARY KEY (id);


--
-- Name: commission_calculations commission_calculations_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.commission_calculations
    ADD CONSTRAINT commission_calculations_pkey PRIMARY KEY (id);


--
-- Name: communication_providers communication_providers_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.communication_providers
    ADD CONSTRAINT communication_providers_pkey PRIMARY KEY (id);


--
-- Name: communication_templates communication_templates_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.communication_templates
    ADD CONSTRAINT communication_templates_pkey PRIMARY KEY (id);


--
-- Name: corporate_accounts corporate_accounts_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.corporate_accounts
    ADD CONSTRAINT corporate_accounts_pkey PRIMARY KEY (id);


--
-- Name: corporate_invoice_items corporate_invoice_items_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.corporate_invoice_items
    ADD CONSTRAINT corporate_invoice_items_pkey PRIMARY KEY (id);


--
-- Name: corporate_invoices corporate_invoices_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.corporate_invoices
    ADD CONSTRAINT corporate_invoices_pkey PRIMARY KEY (id);


--
-- Name: corporate_members corporate_members_corporate_account_id_member_id_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.corporate_members
    ADD CONSTRAINT corporate_members_corporate_account_id_member_id_key UNIQUE (corporate_account_id, member_id);


--
-- Name: corporate_members corporate_members_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.corporate_members
    ADD CONSTRAINT corporate_members_pkey PRIMARY KEY (id);


--
-- Name: corporate_membership_plans corporate_membership_plans_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.corporate_membership_plans
    ADD CONSTRAINT corporate_membership_plans_pkey PRIMARY KEY (id);


--
-- Name: cost_allocations cost_allocations_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.cost_allocations
    ADD CONSTRAINT cost_allocations_pkey PRIMARY KEY (id);


--
-- Name: court_reservations court_reservations_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.court_reservations
    ADD CONSTRAINT court_reservations_pkey PRIMARY KEY (id);


--
-- Name: cross_location_assignments cross_location_assignments_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.cross_location_assignments
    ADD CONSTRAINT cross_location_assignments_pkey PRIMARY KEY (id);


--
-- Name: cross_location_transfers cross_location_transfers_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.cross_location_transfers
    ADD CONSTRAINT cross_location_transfers_pkey PRIMARY KEY (id);


--
-- Name: daily_analytics_snapshots daily_analytics_snapshots_organization_id_snapshot_date_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.daily_analytics_snapshots
    ADD CONSTRAINT daily_analytics_snapshots_organization_id_snapshot_date_key UNIQUE (organization_id, snapshot_date);


--
-- Name: daily_analytics_snapshots daily_analytics_snapshots_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.daily_analytics_snapshots
    ADD CONSTRAINT daily_analytics_snapshots_pkey PRIMARY KEY (id);


--
-- Name: department_budgets department_budgets_organization_id_department_name_budget_y_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.department_budgets
    ADD CONSTRAINT department_budgets_organization_id_department_name_budget_y_key UNIQUE (organization_id, department_name, budget_year, budget_month);


--
-- Name: department_budgets department_budgets_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.department_budgets
    ADD CONSTRAINT department_budgets_pkey PRIMARY KEY (id);


--
-- Name: department_revenues department_revenues_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.department_revenues
    ADD CONSTRAINT department_revenues_pkey PRIMARY KEY (id);


--
-- Name: early_access_requests early_access_requests_email_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.early_access_requests
    ADD CONSTRAINT early_access_requests_email_key UNIQUE (email);


--
-- Name: early_access_requests early_access_requests_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.early_access_requests
    ADD CONSTRAINT early_access_requests_pkey PRIMARY KEY (id);


--
-- Name: email_messages email_messages_external_id_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.email_messages
    ADD CONSTRAINT email_messages_external_id_key UNIQUE (external_id);


--
-- Name: email_messages email_messages_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.email_messages
    ADD CONSTRAINT email_messages_pkey PRIMARY KEY (id);


--
-- Name: email_responses email_responses_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.email_responses
    ADD CONSTRAINT email_responses_pkey PRIMARY KEY (id);


--
-- Name: email_templates email_templates_name_org_unique; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.email_templates
    ADD CONSTRAINT email_templates_name_org_unique UNIQUE (organization_id, name);


--
-- Name: email_templates email_templates_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.email_templates
    ADD CONSTRAINT email_templates_pkey PRIMARY KEY (id);


--
-- Name: email_threads email_threads_organization_id_domain_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.email_threads
    ADD CONSTRAINT email_threads_organization_id_domain_key UNIQUE (organization_id, domain);


--
-- Name: email_threads email_threads_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.email_threads
    ADD CONSTRAINT email_threads_pkey PRIMARY KEY (id);


--
-- Name: equipment_checkout equipment_checkout_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.equipment_checkout
    ADD CONSTRAINT equipment_checkout_pkey PRIMARY KEY (id);


--
-- Name: equipment equipment_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.equipment
    ADD CONSTRAINT equipment_pkey PRIMARY KEY (id);


--
-- Name: expense_categories expense_categories_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.expense_categories
    ADD CONSTRAINT expense_categories_pkey PRIMARY KEY (id);


--
-- Name: expense_vendors expense_vendors_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.expense_vendors
    ADD CONSTRAINT expense_vendors_pkey PRIMARY KEY (id);


--
-- Name: expenses expenses_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.expenses
    ADD CONSTRAINT expenses_pkey PRIMARY KEY (id);


--
-- Name: facility_areas facility_areas_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.facility_areas
    ADD CONSTRAINT facility_areas_pkey PRIMARY KEY (id);


--
-- Name: facility_tours facility_tours_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.facility_tours
    ADD CONSTRAINT facility_tours_pkey PRIMARY KEY (id);


--
-- Name: fitness_assessments fitness_assessments_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.fitness_assessments
    ADD CONSTRAINT fitness_assessments_pkey PRIMARY KEY (id);


--
-- Name: guest_pass_types guest_pass_types_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.guest_pass_types
    ADD CONSTRAINT guest_pass_types_pkey PRIMARY KEY (id);


--
-- Name: guest_passes guest_passes_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.guest_passes
    ADD CONSTRAINT guest_passes_pkey PRIMARY KEY (id);


--
-- Name: incident_follow_ups incident_follow_ups_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.incident_follow_ups
    ADD CONSTRAINT incident_follow_ups_pkey PRIMARY KEY (id);


--
-- Name: incident_investigations incident_investigations_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.incident_investigations
    ADD CONSTRAINT incident_investigations_pkey PRIMARY KEY (id);


--
-- Name: incident_reports incident_reports_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.incident_reports
    ADD CONSTRAINT incident_reports_pkey PRIMARY KEY (id);


--
-- Name: inspection_checklist_items inspection_checklist_items_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.inspection_checklist_items
    ADD CONSTRAINT inspection_checklist_items_pkey PRIMARY KEY (id);


--
-- Name: inspection_checklists inspection_checklists_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.inspection_checklists
    ADD CONSTRAINT inspection_checklists_pkey PRIMARY KEY (id);


--
-- Name: inspection_results inspection_results_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.inspection_results
    ADD CONSTRAINT inspection_results_pkey PRIMARY KEY (id);


--
-- Name: instructor_availability instructor_availability_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.instructor_availability
    ADD CONSTRAINT instructor_availability_pkey PRIMARY KEY (id);


--
-- Name: insurance_claims insurance_claims_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.insurance_claims
    ADD CONSTRAINT insurance_claims_pkey PRIMARY KEY (id);


--
-- Name: integration_logs integration_logs_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.integration_logs
    ADD CONSTRAINT integration_logs_pkey PRIMARY KEY (id);


--
-- Name: integrations integrations_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.integrations
    ADD CONSTRAINT integrations_pkey PRIMARY KEY (id);


--
-- Name: inventory_items inventory_items_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.inventory_items
    ADD CONSTRAINT inventory_items_pkey PRIMARY KEY (id);


--
-- Name: inventory_items inventory_items_product_id_location_id_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.inventory_items
    ADD CONSTRAINT inventory_items_product_id_location_id_key UNIQUE (product_id, location_id);


--
-- Name: kpi_metrics kpi_metrics_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.kpi_metrics
    ADD CONSTRAINT kpi_metrics_pkey PRIMARY KEY (id);


--
-- Name: lead_activities lead_activities_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.lead_activities
    ADD CONSTRAINT lead_activities_pkey PRIMARY KEY (id);


--
-- Name: lead_attribution_disputes lead_attribution_disputes_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.lead_attribution_disputes
    ADD CONSTRAINT lead_attribution_disputes_pkey PRIMARY KEY (id);


--
-- Name: lead_scoring_rules lead_scoring_rules_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.lead_scoring_rules
    ADD CONSTRAINT lead_scoring_rules_pkey PRIMARY KEY (id);


--
-- Name: lead_sources lead_sources_name_org_unique; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.lead_sources
    ADD CONSTRAINT lead_sources_name_org_unique UNIQUE (organization_id, name);


--
-- Name: lead_sources lead_sources_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.lead_sources
    ADD CONSTRAINT lead_sources_pkey PRIMARY KEY (id);


--
-- Name: lead_split_commissions lead_split_commissions_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.lead_split_commissions
    ADD CONSTRAINT lead_split_commissions_pkey PRIMARY KEY (id);


--
-- Name: lead_stages lead_stages_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.lead_stages
    ADD CONSTRAINT lead_stages_pkey PRIMARY KEY (id);


--
-- Name: leads leads_organization_id_email_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.leads
    ADD CONSTRAINT leads_organization_id_email_key UNIQUE (organization_id, email);


--
-- Name: leads leads_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.leads
    ADD CONSTRAINT leads_pkey PRIMARY KEY (id);


--
-- Name: liability_waivers liability_waivers_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.liability_waivers
    ADD CONSTRAINT liability_waivers_pkey PRIMARY KEY (id);


--
-- Name: lifeguard_schedules lifeguard_schedules_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.lifeguard_schedules
    ADD CONSTRAINT lifeguard_schedules_pkey PRIMARY KEY (id);


--
-- Name: location_analytics location_analytics_location_id_analytics_date_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.location_analytics
    ADD CONSTRAINT location_analytics_location_id_analytics_date_key UNIQUE (location_id, analytics_date);


--
-- Name: location_analytics location_analytics_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.location_analytics
    ADD CONSTRAINT location_analytics_pkey PRIMARY KEY (id);


--
-- Name: location_hierarchies location_hierarchies_child_location_id_parent_location_id_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.location_hierarchies
    ADD CONSTRAINT location_hierarchies_child_location_id_parent_location_id_key UNIQUE (child_location_id, parent_location_id);


--
-- Name: location_hierarchies location_hierarchies_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.location_hierarchies
    ADD CONSTRAINT location_hierarchies_pkey PRIMARY KEY (id);


--
-- Name: locations locations_location_code_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.locations
    ADD CONSTRAINT locations_location_code_key UNIQUE (location_code);


--
-- Name: locations locations_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.locations
    ADD CONSTRAINT locations_pkey PRIMARY KEY (id);


--
-- Name: locker_access_log locker_access_log_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.locker_access_log
    ADD CONSTRAINT locker_access_log_pkey PRIMARY KEY (id);


--
-- Name: locker_maintenance locker_maintenance_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.locker_maintenance
    ADD CONSTRAINT locker_maintenance_pkey PRIMARY KEY (id);


--
-- Name: locker_rentals locker_rentals_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.locker_rentals
    ADD CONSTRAINT locker_rentals_pkey PRIMARY KEY (id);


--
-- Name: lockers lockers_organization_id_locker_number_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.lockers
    ADD CONSTRAINT lockers_organization_id_locker_number_key UNIQUE (organization_id, locker_number);


--
-- Name: lockers lockers_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.lockers
    ADD CONSTRAINT lockers_pkey PRIMARY KEY (id);


--
-- Name: loyalty_points loyalty_points_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.loyalty_points
    ADD CONSTRAINT loyalty_points_pkey PRIMARY KEY (id);


--
-- Name: loyalty_program_rules loyalty_program_rules_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.loyalty_program_rules
    ADD CONSTRAINT loyalty_program_rules_pkey PRIMARY KEY (id);


--
-- Name: loyalty_redemptions loyalty_redemptions_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.loyalty_redemptions
    ADD CONSTRAINT loyalty_redemptions_pkey PRIMARY KEY (id);


--
-- Name: loyalty_rewards loyalty_rewards_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.loyalty_rewards
    ADD CONSTRAINT loyalty_rewards_pkey PRIMARY KEY (id);


--
-- Name: maintenance_logs maintenance_logs_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.maintenance_logs
    ADD CONSTRAINT maintenance_logs_pkey PRIMARY KEY (id);


--
-- Name: maintenance_schedules maintenance_schedules_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.maintenance_schedules
    ADD CONSTRAINT maintenance_schedules_pkey PRIMARY KEY (id);


--
-- Name: marketing_analytics marketing_analytics_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.marketing_analytics
    ADD CONSTRAINT marketing_analytics_pkey PRIMARY KEY (id);


--
-- Name: marketing_campaigns marketing_campaigns_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.marketing_campaigns
    ADD CONSTRAINT marketing_campaigns_pkey PRIMARY KEY (id);


--
-- Name: member_analytics_snapshots member_analytics_snapshots_organization_id_snapshot_date_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.member_analytics_snapshots
    ADD CONSTRAINT member_analytics_snapshots_organization_id_snapshot_date_key UNIQUE (organization_id, snapshot_date);


--
-- Name: member_analytics_snapshots member_analytics_snapshots_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.member_analytics_snapshots
    ADD CONSTRAINT member_analytics_snapshots_pkey PRIMARY KEY (id);


--
-- Name: member_cards member_cards_barcode_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.member_cards
    ADD CONSTRAINT member_cards_barcode_key UNIQUE (barcode);


--
-- Name: member_cards member_cards_card_number_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.member_cards
    ADD CONSTRAINT member_cards_card_number_key UNIQUE (card_number);


--
-- Name: member_cards member_cards_nfc_uid_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.member_cards
    ADD CONSTRAINT member_cards_nfc_uid_key UNIQUE (nfc_uid);


--
-- Name: member_cards member_cards_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.member_cards
    ADD CONSTRAINT member_cards_pkey PRIMARY KEY (id);


--
-- Name: member_cards member_cards_qr_code_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.member_cards
    ADD CONSTRAINT member_cards_qr_code_key UNIQUE (qr_code);


--
-- Name: member_cohorts member_cohorts_organization_id_cohort_period_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.member_cohorts
    ADD CONSTRAINT member_cohorts_organization_id_cohort_period_key UNIQUE (organization_id, cohort_period);


--
-- Name: member_cohorts member_cohorts_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.member_cohorts
    ADD CONSTRAINT member_cohorts_pkey PRIMARY KEY (id);


--
-- Name: member_documents member_documents_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.member_documents
    ADD CONSTRAINT member_documents_pkey PRIMARY KEY (id);


--
-- Name: member_engagement_history member_engagement_history_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.member_engagement_history
    ADD CONSTRAINT member_engagement_history_pkey PRIMARY KEY (id);


--
-- Name: member_feedback member_feedback_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.member_feedback
    ADD CONSTRAINT member_feedback_pkey PRIMARY KEY (id);


--
-- Name: member_location_access member_location_access_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.member_location_access
    ADD CONSTRAINT member_location_access_pkey PRIMARY KEY (id);


--
-- Name: member_messages member_messages_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.member_messages
    ADD CONSTRAINT member_messages_pkey PRIMARY KEY (id);


--
-- Name: member_milestones member_milestones_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.member_milestones
    ADD CONSTRAINT member_milestones_pkey PRIMARY KEY (id);


--
-- Name: member_orientations member_orientations_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.member_orientations
    ADD CONSTRAINT member_orientations_pkey PRIMARY KEY (id);


--
-- Name: member_referrals member_referrals_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.member_referrals
    ADD CONSTRAINT member_referrals_pkey PRIMARY KEY (id);


--
-- Name: member_segments member_segments_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.member_segments
    ADD CONSTRAINT member_segments_pkey PRIMARY KEY (id);


--
-- Name: member_training_packages member_training_packages_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.member_training_packages
    ADD CONSTRAINT member_training_packages_pkey PRIMARY KEY (id);


--
-- Name: membership_agreement_templates membership_agreement_templates_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.membership_agreement_templates
    ADD CONSTRAINT membership_agreement_templates_pkey PRIMARY KEY (id);


--
-- Name: membership_agreements membership_agreements_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.membership_agreements
    ADD CONSTRAINT membership_agreements_pkey PRIMARY KEY (id);


--
-- Name: membership_plans membership_plans_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.membership_plans
    ADD CONSTRAINT membership_plans_pkey PRIMARY KEY (id);


--
-- Name: memberships memberships_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.memberships
    ADD CONSTRAINT memberships_pkey PRIMARY KEY (id);


--
-- Name: message_history message_history_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.message_history
    ADD CONSTRAINT message_history_pkey PRIMARY KEY (id);


--
-- Name: messages messages_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.messages
    ADD CONSTRAINT messages_pkey PRIMARY KEY (id);


--
-- Name: notification_preferences notification_preferences_member_id_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.notification_preferences
    ADD CONSTRAINT notification_preferences_member_id_key UNIQUE (member_id);


--
-- Name: notification_preferences notification_preferences_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.notification_preferences
    ADD CONSTRAINT notification_preferences_pkey PRIMARY KEY (id);


--
-- Name: notification_templates notification_templates_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.notification_templates
    ADD CONSTRAINT notification_templates_pkey PRIMARY KEY (id);


--
-- Name: notifications notifications_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.notifications
    ADD CONSTRAINT notifications_pkey PRIMARY KEY (id);


--
-- Name: organization_commission_settings organization_commission_settings_organization_id_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.organization_commission_settings
    ADD CONSTRAINT organization_commission_settings_organization_id_key UNIQUE (organization_id);


--
-- Name: organization_commission_settings organization_commission_settings_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.organization_commission_settings
    ADD CONSTRAINT organization_commission_settings_pkey PRIMARY KEY (id);


--
-- Name: organizations organizations_custom_domain_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.organizations
    ADD CONSTRAINT organizations_custom_domain_key UNIQUE (custom_domain);


--
-- Name: organizations organizations_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.organizations
    ADD CONSTRAINT organizations_pkey PRIMARY KEY (id);


--
-- Name: organizations organizations_slug_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.organizations
    ADD CONSTRAINT organizations_slug_key UNIQUE (slug);


--
-- Name: payment_transactions payment_transactions_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.payment_transactions
    ADD CONSTRAINT payment_transactions_pkey PRIMARY KEY (id);


--
-- Name: payroll_periods payroll_periods_organization_id_start_date_end_date_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.payroll_periods
    ADD CONSTRAINT payroll_periods_organization_id_start_date_end_date_key UNIQUE (organization_id, start_date, end_date);


--
-- Name: payroll_periods payroll_periods_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.payroll_periods
    ADD CONSTRAINT payroll_periods_pkey PRIMARY KEY (id);


--
-- Name: personal_training_sessions personal_training_sessions_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.personal_training_sessions
    ADD CONSTRAINT personal_training_sessions_pkey PRIMARY KEY (id);


--
-- Name: pool_facilities pool_facilities_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.pool_facilities
    ADD CONSTRAINT pool_facilities_pkey PRIMARY KEY (id);


--
-- Name: pool_lane_reservations pool_lane_reservations_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.pool_lane_reservations
    ADD CONSTRAINT pool_lane_reservations_pkey PRIMARY KEY (id);


--
-- Name: pool_maintenance_logs pool_maintenance_logs_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.pool_maintenance_logs
    ADD CONSTRAINT pool_maintenance_logs_pkey PRIMARY KEY (id);


--
-- Name: pool_maintenance_schedules pool_maintenance_schedules_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.pool_maintenance_schedules
    ADD CONSTRAINT pool_maintenance_schedules_pkey PRIMARY KEY (id);


--
-- Name: pos_products pos_products_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.pos_products
    ADD CONSTRAINT pos_products_pkey PRIMARY KEY (id);


--
-- Name: pos_sale_items pos_sale_items_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.pos_sale_items
    ADD CONSTRAINT pos_sale_items_pkey PRIMARY KEY (id);


--
-- Name: pos_sales pos_sales_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.pos_sales
    ADD CONSTRAINT pos_sales_pkey PRIMARY KEY (id);


--
-- Name: pos_sales pos_sales_sale_number_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.pos_sales
    ADD CONSTRAINT pos_sales_sale_number_key UNIQUE (sale_number);


--
-- Name: profiles profiles_barcode_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.profiles
    ADD CONSTRAINT profiles_barcode_key UNIQUE (barcode);


--
-- Name: profiles profiles_email_organization_id_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.profiles
    ADD CONSTRAINT profiles_email_organization_id_key UNIQUE (email, organization_id);


--
-- Name: profiles profiles_employee_id_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.profiles
    ADD CONSTRAINT profiles_employee_id_key UNIQUE (employee_id);


--
-- Name: profiles profiles_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.profiles
    ADD CONSTRAINT profiles_pkey PRIMARY KEY (id);


--
-- Name: promotions promotions_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.promotions
    ADD CONSTRAINT promotions_pkey PRIMARY KEY (id);


--
-- Name: quote_line_items quote_line_items_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.quote_line_items
    ADD CONSTRAINT quote_line_items_pkey PRIMARY KEY (id);


--
-- Name: referral_programs referral_programs_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.referral_programs
    ADD CONSTRAINT referral_programs_pkey PRIMARY KEY (id);


--
-- Name: resource_bookings resource_bookings_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.resource_bookings
    ADD CONSTRAINT resource_bookings_pkey PRIMARY KEY (id);


--
-- Name: retail_products retail_products_organization_id_sku_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.retail_products
    ADD CONSTRAINT retail_products_organization_id_sku_key UNIQUE (organization_id, sku);


--
-- Name: retail_products retail_products_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.retail_products
    ADD CONSTRAINT retail_products_pkey PRIMARY KEY (id);


--
-- Name: retail_transaction_items retail_transaction_items_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.retail_transaction_items
    ADD CONSTRAINT retail_transaction_items_pkey PRIMARY KEY (id);


--
-- Name: retail_transactions retail_transactions_organization_id_transaction_number_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.retail_transactions
    ADD CONSTRAINT retail_transactions_organization_id_transaction_number_key UNIQUE (organization_id, transaction_number);


--
-- Name: retail_transactions retail_transactions_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.retail_transactions
    ADD CONSTRAINT retail_transactions_pkey PRIMARY KEY (id);


--
-- Name: retention_campaigns retention_campaigns_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.retention_campaigns
    ADD CONSTRAINT retention_campaigns_pkey PRIMARY KEY (id);


--
-- Name: revenue_analytics revenue_analytics_organization_id_period_start_period_end_p_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.revenue_analytics
    ADD CONSTRAINT revenue_analytics_organization_id_period_start_period_end_p_key UNIQUE (organization_id, period_start, period_end, period_type);


--
-- Name: revenue_analytics revenue_analytics_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.revenue_analytics
    ADD CONSTRAINT revenue_analytics_pkey PRIMARY KEY (id);


--
-- Name: safety_inspections safety_inspections_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.safety_inspections
    ADD CONSTRAINT safety_inspections_pkey PRIMARY KEY (id);


--
-- Name: safety_violations safety_violations_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.safety_violations
    ADD CONSTRAINT safety_violations_pkey PRIMARY KEY (id);


--
-- Name: sales_quotes sales_quotes_number_unique; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.sales_quotes
    ADD CONSTRAINT sales_quotes_number_unique UNIQUE (quote_number);


--
-- Name: sales_quotes sales_quotes_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.sales_quotes
    ADD CONSTRAINT sales_quotes_pkey PRIMARY KEY (id);


--
-- Name: salesperson_commissions salesperson_commissions_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.salesperson_commissions
    ADD CONSTRAINT salesperson_commissions_pkey PRIMARY KEY (id);


--
-- Name: salesperson_referral_links salesperson_referral_links_organization_id_salesperson_id_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.salesperson_referral_links
    ADD CONSTRAINT salesperson_referral_links_organization_id_salesperson_id_key UNIQUE (organization_id, salesperson_id);


--
-- Name: salesperson_referral_links salesperson_referral_links_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.salesperson_referral_links
    ADD CONSTRAINT salesperson_referral_links_pkey PRIMARY KEY (id);


--
-- Name: salesperson_referral_links salesperson_referral_links_referral_code_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.salesperson_referral_links
    ADD CONSTRAINT salesperson_referral_links_referral_code_key UNIQUE (referral_code);


--
-- Name: sms_campaign_recipients sms_campaign_recipients_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.sms_campaign_recipients
    ADD CONSTRAINT sms_campaign_recipients_pkey PRIMARY KEY (id);


--
-- Name: sms_campaigns sms_campaigns_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.sms_campaigns
    ADD CONSTRAINT sms_campaigns_pkey PRIMARY KEY (id);


--
-- Name: social_media_automation_logs social_media_automation_logs_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.social_media_automation_logs
    ADD CONSTRAINT social_media_automation_logs_pkey PRIMARY KEY (id);


--
-- Name: social_media_automation_settings social_media_automation_settings_organization_id_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.social_media_automation_settings
    ADD CONSTRAINT social_media_automation_settings_organization_id_key UNIQUE (organization_id);


--
-- Name: social_media_automation_settings social_media_automation_settings_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.social_media_automation_settings
    ADD CONSTRAINT social_media_automation_settings_pkey PRIMARY KEY (id);


--
-- Name: spa_appointments spa_appointments_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.spa_appointments
    ADD CONSTRAINT spa_appointments_pkey PRIMARY KEY (id);


--
-- Name: spa_inventory spa_inventory_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.spa_inventory
    ADD CONSTRAINT spa_inventory_pkey PRIMARY KEY (id);


--
-- Name: spa_service_packages spa_service_packages_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.spa_service_packages
    ADD CONSTRAINT spa_service_packages_pkey PRIMARY KEY (id);


--
-- Name: spa_services spa_services_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.spa_services
    ADD CONSTRAINT spa_services_pkey PRIMARY KEY (id);


--
-- Name: sports_courts sports_courts_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.sports_courts
    ADD CONSTRAINT sports_courts_pkey PRIMARY KEY (id);


--
-- Name: sports_equipment sports_equipment_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.sports_equipment
    ADD CONSTRAINT sports_equipment_pkey PRIMARY KEY (id);


--
-- Name: staff_certifications staff_certifications_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.staff_certifications
    ADD CONSTRAINT staff_certifications_pkey PRIMARY KEY (id);


--
-- Name: staff_performance_analytics staff_performance_analytics_organization_id_staff_id_period_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.staff_performance_analytics
    ADD CONSTRAINT staff_performance_analytics_organization_id_staff_id_period_key UNIQUE (organization_id, staff_id, period_start, period_end);


--
-- Name: staff_performance_analytics staff_performance_analytics_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.staff_performance_analytics
    ADD CONSTRAINT staff_performance_analytics_pkey PRIMARY KEY (id);


--
-- Name: staff_schedules staff_schedules_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.staff_schedules
    ADD CONSTRAINT staff_schedules_pkey PRIMARY KEY (id);


--
-- Name: stock_movements stock_movements_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.stock_movements
    ADD CONSTRAINT stock_movements_pkey PRIMARY KEY (id);


--
-- Name: subscribers subscribers_email_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.subscribers
    ADD CONSTRAINT subscribers_email_key UNIQUE (email);


--
-- Name: subscribers subscribers_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.subscribers
    ADD CONSTRAINT subscribers_pkey PRIMARY KEY (id);


--
-- Name: support_tickets support_tickets_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.support_tickets
    ADD CONSTRAINT support_tickets_pkey PRIMARY KEY (id);


--
-- Name: swim_lesson_enrollments swim_lesson_enrollments_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.swim_lesson_enrollments
    ADD CONSTRAINT swim_lesson_enrollments_pkey PRIMARY KEY (id);


--
-- Name: swim_lessons swim_lessons_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.swim_lessons
    ADD CONSTRAINT swim_lessons_pkey PRIMARY KEY (id);


--
-- Name: therapist_availability therapist_availability_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.therapist_availability
    ADD CONSTRAINT therapist_availability_pkey PRIMARY KEY (id);


--
-- Name: therapist_availability therapist_availability_therapist_id_day_of_week_start_time_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.therapist_availability
    ADD CONSTRAINT therapist_availability_therapist_id_day_of_week_start_time_key UNIQUE (therapist_id, day_of_week, start_time);


--
-- Name: time_entries time_entries_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.time_entries
    ADD CONSTRAINT time_entries_pkey PRIMARY KEY (id);


--
-- Name: tournament_matches tournament_matches_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.tournament_matches
    ADD CONSTRAINT tournament_matches_pkey PRIMARY KEY (id);


--
-- Name: tournament_participants tournament_participants_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.tournament_participants
    ADD CONSTRAINT tournament_participants_pkey PRIMARY KEY (id);


--
-- Name: tournaments tournaments_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.tournaments
    ADD CONSTRAINT tournaments_pkey PRIMARY KEY (id);


--
-- Name: towel_cleaning_logs towel_cleaning_logs_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.towel_cleaning_logs
    ADD CONSTRAINT towel_cleaning_logs_pkey PRIMARY KEY (id);


--
-- Name: towel_inventory towel_inventory_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.towel_inventory
    ADD CONSTRAINT towel_inventory_pkey PRIMARY KEY (id);


--
-- Name: towel_rentals towel_rentals_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.towel_rentals
    ADD CONSTRAINT towel_rentals_pkey PRIMARY KEY (id);


--
-- Name: trainer_availability trainer_availability_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.trainer_availability
    ADD CONSTRAINT trainer_availability_pkey PRIMARY KEY (id);


--
-- Name: training_packages training_packages_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.training_packages
    ADD CONSTRAINT training_packages_pkey PRIMARY KEY (id);


--
-- Name: vendors vendors_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.vendors
    ADD CONSTRAINT vendors_pkey PRIMARY KEY (id);


--
-- Name: visitor_checkins visitor_checkins_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.visitor_checkins
    ADD CONSTRAINT visitor_checkins_pkey PRIMARY KEY (id);


--
-- Name: water_quality_logs water_quality_logs_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.water_quality_logs
    ADD CONSTRAINT water_quality_logs_pkey PRIMARY KEY (id);


--
-- Name: webhook_endpoints webhook_endpoints_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.webhook_endpoints
    ADD CONSTRAINT webhook_endpoints_pkey PRIMARY KEY (id);


--
-- Name: webhook_logs webhook_logs_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.webhook_logs
    ADD CONSTRAINT webhook_logs_pkey PRIMARY KEY (id);


--
-- Name: messages messages_pkey; Type: CONSTRAINT; Schema: realtime; Owner: supabase_realtime_admin
--

ALTER TABLE ONLY realtime.messages
    ADD CONSTRAINT messages_pkey PRIMARY KEY (id, inserted_at);


--
-- Name: subscription pk_subscription; Type: CONSTRAINT; Schema: realtime; Owner: supabase_admin
--

ALTER TABLE ONLY realtime.subscription
    ADD CONSTRAINT pk_subscription PRIMARY KEY (id);


--
-- Name: schema_migrations schema_migrations_pkey; Type: CONSTRAINT; Schema: realtime; Owner: supabase_admin
--

ALTER TABLE ONLY realtime.schema_migrations
    ADD CONSTRAINT schema_migrations_pkey PRIMARY KEY (version);


--
-- Name: buckets_analytics buckets_analytics_pkey; Type: CONSTRAINT; Schema: storage; Owner: supabase_storage_admin
--

ALTER TABLE ONLY storage.buckets_analytics
    ADD CONSTRAINT buckets_analytics_pkey PRIMARY KEY (id);


--
-- Name: buckets buckets_pkey; Type: CONSTRAINT; Schema: storage; Owner: supabase_storage_admin
--

ALTER TABLE ONLY storage.buckets
    ADD CONSTRAINT buckets_pkey PRIMARY KEY (id);


--
-- Name: buckets_vectors buckets_vectors_pkey; Type: CONSTRAINT; Schema: storage; Owner: supabase_storage_admin
--

ALTER TABLE ONLY storage.buckets_vectors
    ADD CONSTRAINT buckets_vectors_pkey PRIMARY KEY (id);


--
-- Name: migrations migrations_name_key; Type: CONSTRAINT; Schema: storage; Owner: supabase_storage_admin
--

ALTER TABLE ONLY storage.migrations
    ADD CONSTRAINT migrations_name_key UNIQUE (name);


--
-- Name: migrations migrations_pkey; Type: CONSTRAINT; Schema: storage; Owner: supabase_storage_admin
--

ALTER TABLE ONLY storage.migrations
    ADD CONSTRAINT migrations_pkey PRIMARY KEY (id);


--
-- Name: objects objects_pkey; Type: CONSTRAINT; Schema: storage; Owner: supabase_storage_admin
--

ALTER TABLE ONLY storage.objects
    ADD CONSTRAINT objects_pkey PRIMARY KEY (id);


--
-- Name: prefixes prefixes_pkey; Type: CONSTRAINT; Schema: storage; Owner: supabase_storage_admin
--

ALTER TABLE ONLY storage.prefixes
    ADD CONSTRAINT prefixes_pkey PRIMARY KEY (bucket_id, level, name);


--
-- Name: s3_multipart_uploads_parts s3_multipart_uploads_parts_pkey; Type: CONSTRAINT; Schema: storage; Owner: supabase_storage_admin
--

ALTER TABLE ONLY storage.s3_multipart_uploads_parts
    ADD CONSTRAINT s3_multipart_uploads_parts_pkey PRIMARY KEY (id);


--
-- Name: s3_multipart_uploads s3_multipart_uploads_pkey; Type: CONSTRAINT; Schema: storage; Owner: supabase_storage_admin
--

ALTER TABLE ONLY storage.s3_multipart_uploads
    ADD CONSTRAINT s3_multipart_uploads_pkey PRIMARY KEY (id);


--
-- Name: vector_indexes vector_indexes_pkey; Type: CONSTRAINT; Schema: storage; Owner: supabase_storage_admin
--

ALTER TABLE ONLY storage.vector_indexes
    ADD CONSTRAINT vector_indexes_pkey PRIMARY KEY (id);


--
-- Name: schema_migrations schema_migrations_idempotency_key_key; Type: CONSTRAINT; Schema: supabase_migrations; Owner: postgres
--

ALTER TABLE ONLY supabase_migrations.schema_migrations
    ADD CONSTRAINT schema_migrations_idempotency_key_key UNIQUE (idempotency_key);


--
-- Name: schema_migrations schema_migrations_pkey; Type: CONSTRAINT; Schema: supabase_migrations; Owner: postgres
--

ALTER TABLE ONLY supabase_migrations.schema_migrations
    ADD CONSTRAINT schema_migrations_pkey PRIMARY KEY (version);


--
-- Name: seed_files seed_files_pkey; Type: CONSTRAINT; Schema: supabase_migrations; Owner: postgres
--

ALTER TABLE ONLY supabase_migrations.seed_files
    ADD CONSTRAINT seed_files_pkey PRIMARY KEY (path);


--
-- Name: audit_logs_instance_id_idx; Type: INDEX; Schema: auth; Owner: supabase_auth_admin
--

CREATE INDEX audit_logs_instance_id_idx ON auth.audit_log_entries USING btree (instance_id);


--
-- Name: confirmation_token_idx; Type: INDEX; Schema: auth; Owner: supabase_auth_admin
--

CREATE UNIQUE INDEX confirmation_token_idx ON auth.users USING btree (confirmation_token) WHERE ((confirmation_token)::text !~ '^[0-9 ]*$'::text);


--
-- Name: email_change_token_current_idx; Type: INDEX; Schema: auth; Owner: supabase_auth_admin
--

CREATE UNIQUE INDEX email_change_token_current_idx ON auth.users USING btree (email_change_token_current) WHERE ((email_change_token_current)::text !~ '^[0-9 ]*$'::text);


--
-- Name: email_change_token_new_idx; Type: INDEX; Schema: auth; Owner: supabase_auth_admin
--

CREATE UNIQUE INDEX email_change_token_new_idx ON auth.users USING btree (email_change_token_new) WHERE ((email_change_token_new)::text !~ '^[0-9 ]*$'::text);


--
-- Name: factor_id_created_at_idx; Type: INDEX; Schema: auth; Owner: supabase_auth_admin
--

CREATE INDEX factor_id_created_at_idx ON auth.mfa_factors USING btree (user_id, created_at);


--
-- Name: flow_state_created_at_idx; Type: INDEX; Schema: auth; Owner: supabase_auth_admin
--

CREATE INDEX flow_state_created_at_idx ON auth.flow_state USING btree (created_at DESC);


--
-- Name: identities_email_idx; Type: INDEX; Schema: auth; Owner: supabase_auth_admin
--

CREATE INDEX identities_email_idx ON auth.identities USING btree (email text_pattern_ops);


--
-- Name: INDEX identities_email_idx; Type: COMMENT; Schema: auth; Owner: supabase_auth_admin
--

COMMENT ON INDEX auth.identities_email_idx IS 'Auth: Ensures indexed queries on the email column';


--
-- Name: identities_user_id_idx; Type: INDEX; Schema: auth; Owner: supabase_auth_admin
--

CREATE INDEX identities_user_id_idx ON auth.identities USING btree (user_id);


--
-- Name: idx_auth_code; Type: INDEX; Schema: auth; Owner: supabase_auth_admin
--

CREATE INDEX idx_auth_code ON auth.flow_state USING btree (auth_code);


--
-- Name: idx_oauth_client_states_created_at; Type: INDEX; Schema: auth; Owner: supabase_auth_admin
--

CREATE INDEX idx_oauth_client_states_created_at ON auth.oauth_client_states USING btree (created_at);


--
-- Name: idx_user_id_auth_method; Type: INDEX; Schema: auth; Owner: supabase_auth_admin
--

CREATE INDEX idx_user_id_auth_method ON auth.flow_state USING btree (user_id, authentication_method);


--
-- Name: mfa_challenge_created_at_idx; Type: INDEX; Schema: auth; Owner: supabase_auth_admin
--

CREATE INDEX mfa_challenge_created_at_idx ON auth.mfa_challenges USING btree (created_at DESC);


--
-- Name: mfa_factors_user_friendly_name_unique; Type: INDEX; Schema: auth; Owner: supabase_auth_admin
--

CREATE UNIQUE INDEX mfa_factors_user_friendly_name_unique ON auth.mfa_factors USING btree (friendly_name, user_id) WHERE (TRIM(BOTH FROM friendly_name) <> ''::text);


--
-- Name: mfa_factors_user_id_idx; Type: INDEX; Schema: auth; Owner: supabase_auth_admin
--

CREATE INDEX mfa_factors_user_id_idx ON auth.mfa_factors USING btree (user_id);


--
-- Name: oauth_auth_pending_exp_idx; Type: INDEX; Schema: auth; Owner: supabase_auth_admin
--

CREATE INDEX oauth_auth_pending_exp_idx ON auth.oauth_authorizations USING btree (expires_at) WHERE (status = 'pending'::auth.oauth_authorization_status);


--
-- Name: oauth_clients_deleted_at_idx; Type: INDEX; Schema: auth; Owner: supabase_auth_admin
--

CREATE INDEX oauth_clients_deleted_at_idx ON auth.oauth_clients USING btree (deleted_at);


--
-- Name: oauth_consents_active_client_idx; Type: INDEX; Schema: auth; Owner: supabase_auth_admin
--

CREATE INDEX oauth_consents_active_client_idx ON auth.oauth_consents USING btree (client_id) WHERE (revoked_at IS NULL);


--
-- Name: oauth_consents_active_user_client_idx; Type: INDEX; Schema: auth; Owner: supabase_auth_admin
--

CREATE INDEX oauth_consents_active_user_client_idx ON auth.oauth_consents USING btree (user_id, client_id) WHERE (revoked_at IS NULL);


--
-- Name: oauth_consents_user_order_idx; Type: INDEX; Schema: auth; Owner: supabase_auth_admin
--

CREATE INDEX oauth_consents_user_order_idx ON auth.oauth_consents USING btree (user_id, granted_at DESC);


--
-- Name: one_time_tokens_relates_to_hash_idx; Type: INDEX; Schema: auth; Owner: supabase_auth_admin
--

CREATE INDEX one_time_tokens_relates_to_hash_idx ON auth.one_time_tokens USING hash (relates_to);


--
-- Name: one_time_tokens_token_hash_hash_idx; Type: INDEX; Schema: auth; Owner: supabase_auth_admin
--

CREATE INDEX one_time_tokens_token_hash_hash_idx ON auth.one_time_tokens USING hash (token_hash);


--
-- Name: one_time_tokens_user_id_token_type_key; Type: INDEX; Schema: auth; Owner: supabase_auth_admin
--

CREATE UNIQUE INDEX one_time_tokens_user_id_token_type_key ON auth.one_time_tokens USING btree (user_id, token_type);


--
-- Name: reauthentication_token_idx; Type: INDEX; Schema: auth; Owner: supabase_auth_admin
--

CREATE UNIQUE INDEX reauthentication_token_idx ON auth.users USING btree (reauthentication_token) WHERE ((reauthentication_token)::text !~ '^[0-9 ]*$'::text);


--
-- Name: recovery_token_idx; Type: INDEX; Schema: auth; Owner: supabase_auth_admin
--

CREATE UNIQUE INDEX recovery_token_idx ON auth.users USING btree (recovery_token) WHERE ((recovery_token)::text !~ '^[0-9 ]*$'::text);


--
-- Name: refresh_tokens_instance_id_idx; Type: INDEX; Schema: auth; Owner: supabase_auth_admin
--

CREATE INDEX refresh_tokens_instance_id_idx ON auth.refresh_tokens USING btree (instance_id);


--
-- Name: refresh_tokens_instance_id_user_id_idx; Type: INDEX; Schema: auth; Owner: supabase_auth_admin
--

CREATE INDEX refresh_tokens_instance_id_user_id_idx ON auth.refresh_tokens USING btree (instance_id, user_id);


--
-- Name: refresh_tokens_parent_idx; Type: INDEX; Schema: auth; Owner: supabase_auth_admin
--

CREATE INDEX refresh_tokens_parent_idx ON auth.refresh_tokens USING btree (parent);


--
-- Name: refresh_tokens_session_id_revoked_idx; Type: INDEX; Schema: auth; Owner: supabase_auth_admin
--

CREATE INDEX refresh_tokens_session_id_revoked_idx ON auth.refresh_tokens USING btree (session_id, revoked);


--
-- Name: refresh_tokens_updated_at_idx; Type: INDEX; Schema: auth; Owner: supabase_auth_admin
--

CREATE INDEX refresh_tokens_updated_at_idx ON auth.refresh_tokens USING btree (updated_at DESC);


--
-- Name: saml_providers_sso_provider_id_idx; Type: INDEX; Schema: auth; Owner: supabase_auth_admin
--

CREATE INDEX saml_providers_sso_provider_id_idx ON auth.saml_providers USING btree (sso_provider_id);


--
-- Name: saml_relay_states_created_at_idx; Type: INDEX; Schema: auth; Owner: supabase_auth_admin
--

CREATE INDEX saml_relay_states_created_at_idx ON auth.saml_relay_states USING btree (created_at DESC);


--
-- Name: saml_relay_states_for_email_idx; Type: INDEX; Schema: auth; Owner: supabase_auth_admin
--

CREATE INDEX saml_relay_states_for_email_idx ON auth.saml_relay_states USING btree (for_email);


--
-- Name: saml_relay_states_sso_provider_id_idx; Type: INDEX; Schema: auth; Owner: supabase_auth_admin
--

CREATE INDEX saml_relay_states_sso_provider_id_idx ON auth.saml_relay_states USING btree (sso_provider_id);


--
-- Name: sessions_not_after_idx; Type: INDEX; Schema: auth; Owner: supabase_auth_admin
--

CREATE INDEX sessions_not_after_idx ON auth.sessions USING btree (not_after DESC);


--
-- Name: sessions_oauth_client_id_idx; Type: INDEX; Schema: auth; Owner: supabase_auth_admin
--

CREATE INDEX sessions_oauth_client_id_idx ON auth.sessions USING btree (oauth_client_id);


--
-- Name: sessions_user_id_idx; Type: INDEX; Schema: auth; Owner: supabase_auth_admin
--

CREATE INDEX sessions_user_id_idx ON auth.sessions USING btree (user_id);


--
-- Name: sso_domains_domain_idx; Type: INDEX; Schema: auth; Owner: supabase_auth_admin
--

CREATE UNIQUE INDEX sso_domains_domain_idx ON auth.sso_domains USING btree (lower(domain));


--
-- Name: sso_domains_sso_provider_id_idx; Type: INDEX; Schema: auth; Owner: supabase_auth_admin
--

CREATE INDEX sso_domains_sso_provider_id_idx ON auth.sso_domains USING btree (sso_provider_id);


--
-- Name: sso_providers_resource_id_idx; Type: INDEX; Schema: auth; Owner: supabase_auth_admin
--

CREATE UNIQUE INDEX sso_providers_resource_id_idx ON auth.sso_providers USING btree (lower(resource_id));


--
-- Name: sso_providers_resource_id_pattern_idx; Type: INDEX; Schema: auth; Owner: supabase_auth_admin
--

CREATE INDEX sso_providers_resource_id_pattern_idx ON auth.sso_providers USING btree (resource_id text_pattern_ops);


--
-- Name: unique_phone_factor_per_user; Type: INDEX; Schema: auth; Owner: supabase_auth_admin
--

CREATE UNIQUE INDEX unique_phone_factor_per_user ON auth.mfa_factors USING btree (user_id, phone);


--
-- Name: user_id_created_at_idx; Type: INDEX; Schema: auth; Owner: supabase_auth_admin
--

CREATE INDEX user_id_created_at_idx ON auth.sessions USING btree (user_id, created_at);


--
-- Name: users_email_partial_key; Type: INDEX; Schema: auth; Owner: supabase_auth_admin
--

CREATE UNIQUE INDEX users_email_partial_key ON auth.users USING btree (email) WHERE (is_sso_user = false);


--
-- Name: INDEX users_email_partial_key; Type: COMMENT; Schema: auth; Owner: supabase_auth_admin
--

COMMENT ON INDEX auth.users_email_partial_key IS 'Auth: A partial unique index that applies only when is_sso_user is false';


--
-- Name: users_instance_id_email_idx; Type: INDEX; Schema: auth; Owner: supabase_auth_admin
--

CREATE INDEX users_instance_id_email_idx ON auth.users USING btree (instance_id, lower((email)::text));


--
-- Name: users_instance_id_idx; Type: INDEX; Schema: auth; Owner: supabase_auth_admin
--

CREATE INDEX users_instance_id_idx ON auth.users USING btree (instance_id);


--
-- Name: users_is_anonymous_idx; Type: INDEX; Schema: auth; Owner: supabase_auth_admin
--

CREATE INDEX users_is_anonymous_idx ON auth.users USING btree (is_anonymous);


--
-- Name: idx_api_keys_organization_id; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_api_keys_organization_id ON public.api_keys USING btree (organization_id);


--
-- Name: idx_api_keys_status; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_api_keys_status ON public.api_keys USING btree (status);


--
-- Name: idx_blog_queue_org_status; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_blog_queue_org_status ON public.blog_generation_queue USING btree (organization_id, status);


--
-- Name: idx_blog_queue_status_scheduled; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_blog_queue_status_scheduled ON public.blog_generation_queue USING btree (status, scheduled_for);


--
-- Name: idx_blog_topic_history_org_created; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_blog_topic_history_org_created ON public.blog_topic_history USING btree (organization_id, created_at DESC);


--
-- Name: idx_campaign_executions_member_campaign; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_campaign_executions_member_campaign ON public.campaign_executions USING btree (member_id, campaign_id);


--
-- Name: idx_certification_requirements_org; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_certification_requirements_org ON public.certification_requirements USING btree (organization_id);


--
-- Name: idx_checklist_items_checklist_id; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_checklist_items_checklist_id ON public.inspection_checklist_items USING btree (checklist_id);


--
-- Name: idx_child_profiles_date_of_birth; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_child_profiles_date_of_birth ON public.child_profiles USING btree (date_of_birth);


--
-- Name: idx_child_profiles_organization_parent; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_child_profiles_organization_parent ON public.child_profiles USING btree (organization_id, parent_member_id);


--
-- Name: idx_childcare_activities_age_group; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_childcare_activities_age_group ON public.childcare_activities USING btree (age_group_min_months, age_group_max_months);


--
-- Name: idx_childcare_activities_organization_date; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_childcare_activities_organization_date ON public.childcare_activities USING btree (organization_id, activity_date);


--
-- Name: idx_childcare_checkins_child; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_childcare_checkins_child ON public.childcare_checkins USING btree (child_id);


--
-- Name: idx_childcare_checkins_organization; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_childcare_checkins_organization ON public.childcare_checkins USING btree (organization_id);


--
-- Name: idx_childcare_checkins_status; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_childcare_checkins_status ON public.childcare_checkins USING btree (status, check_out_time);


--
-- Name: idx_childcare_daily_reports_child_date; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_childcare_daily_reports_child_date ON public.childcare_daily_reports USING btree (child_id, report_date);


--
-- Name: idx_childcare_staff_schedules_date_staff; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_childcare_staff_schedules_date_staff ON public.childcare_staff_schedules USING btree (schedule_date, staff_id);


--
-- Name: idx_class_analytics_org_date; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_class_analytics_org_date ON public.class_analytics USING btree (organization_id, class_date);


--
-- Name: idx_class_waitlists_class_id; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_class_waitlists_class_id ON public.class_waitlists USING btree (class_id);


--
-- Name: idx_class_waitlists_member_id; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_class_waitlists_member_id ON public.class_waitlists USING btree (member_id);


--
-- Name: idx_class_waitlists_priority; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_class_waitlists_priority ON public.class_waitlists USING btree (class_id, priority_order, joined_at);


--
-- Name: idx_cleaning_schedules_next_due; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_cleaning_schedules_next_due ON public.cleaning_schedules USING btree (next_due);


--
-- Name: idx_cleaning_schedules_organization_id; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_cleaning_schedules_organization_id ON public.cleaning_schedules USING btree (organization_id);


--
-- Name: idx_corporate_accounts_org_id; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_corporate_accounts_org_id ON public.corporate_accounts USING btree (organization_id);


--
-- Name: idx_corporate_accounts_status; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_corporate_accounts_status ON public.corporate_accounts USING btree (status);


--
-- Name: idx_corporate_invoices_account_id; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_corporate_invoices_account_id ON public.corporate_invoices USING btree (corporate_account_id);


--
-- Name: idx_corporate_invoices_due_date; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_corporate_invoices_due_date ON public.corporate_invoices USING btree (payment_due_date);


--
-- Name: idx_corporate_invoices_status; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_corporate_invoices_status ON public.corporate_invoices USING btree (status);


--
-- Name: idx_corporate_members_account_id; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_corporate_members_account_id ON public.corporate_members USING btree (corporate_account_id);


--
-- Name: idx_corporate_members_manager; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_corporate_members_manager ON public.corporate_members USING btree (manager_member_id);


--
-- Name: idx_corporate_members_member_id; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_corporate_members_member_id ON public.corporate_members USING btree (member_id);


--
-- Name: idx_cost_allocations_department; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_cost_allocations_department ON public.cost_allocations USING btree (department_name);


--
-- Name: idx_cost_allocations_org_period; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_cost_allocations_org_period ON public.cost_allocations USING btree (organization_id, period_start, period_end);


--
-- Name: idx_court_reservations_date; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_court_reservations_date ON public.court_reservations USING btree (reservation_date, start_time);


--
-- Name: idx_court_reservations_member; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_court_reservations_member ON public.court_reservations USING btree (member_id);


--
-- Name: idx_court_reservations_organization; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_court_reservations_organization ON public.court_reservations USING btree (organization_id);


--
-- Name: idx_cross_location_assignments_location; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_cross_location_assignments_location ON public.cross_location_assignments USING btree (location_id);


--
-- Name: idx_cross_location_assignments_org; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_cross_location_assignments_org ON public.cross_location_assignments USING btree (organization_id);


--
-- Name: idx_cross_location_assignments_staff; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_cross_location_assignments_staff ON public.cross_location_assignments USING btree (staff_id);


--
-- Name: idx_cross_location_transfers_from; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_cross_location_transfers_from ON public.cross_location_transfers USING btree (from_location_id);


--
-- Name: idx_cross_location_transfers_org; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_cross_location_transfers_org ON public.cross_location_transfers USING btree (organization_id);


--
-- Name: idx_cross_location_transfers_to; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_cross_location_transfers_to ON public.cross_location_transfers USING btree (to_location_id);


--
-- Name: idx_department_budgets_org_year; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_department_budgets_org_year ON public.department_budgets USING btree (organization_id, budget_year);


--
-- Name: idx_department_revenues_department; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_department_revenues_department ON public.department_revenues USING btree (department_name);


--
-- Name: idx_department_revenues_org_period; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_department_revenues_org_period ON public.department_revenues USING btree (organization_id, period_start, period_end);


--
-- Name: idx_early_access_created_at; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_early_access_created_at ON public.early_access_requests USING btree (created_at DESC);


--
-- Name: idx_early_access_email; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_early_access_email ON public.early_access_requests USING btree (email);


--
-- Name: idx_early_access_status; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_early_access_status ON public.early_access_requests USING btree (status);


--
-- Name: idx_email_messages_external_id; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_email_messages_external_id ON public.email_messages USING btree (external_id);


--
-- Name: idx_email_messages_status; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_email_messages_status ON public.email_messages USING btree (status);


--
-- Name: idx_email_messages_thread; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_email_messages_thread ON public.email_messages USING btree (thread_id);


--
-- Name: idx_email_responses_message; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_email_responses_message ON public.email_responses USING btree (message_id);


--
-- Name: idx_email_threads_org; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_email_threads_org ON public.email_threads USING btree (organization_id);


--
-- Name: idx_equipment_checkout_member; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_equipment_checkout_member ON public.equipment_checkout USING btree (member_id);


--
-- Name: idx_equipment_checkout_status; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_equipment_checkout_status ON public.equipment_checkout USING btree (status);


--
-- Name: idx_equipment_next_maintenance; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_equipment_next_maintenance ON public.equipment USING btree (next_maintenance_date) WHERE (next_maintenance_date IS NOT NULL);


--
-- Name: idx_equipment_organization_id; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_equipment_organization_id ON public.equipment USING btree (organization_id);


--
-- Name: idx_equipment_status; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_equipment_status ON public.equipment USING btree (status);


--
-- Name: idx_expenses_category; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_expenses_category ON public.expenses USING btree (category_id);


--
-- Name: idx_expenses_organization_date; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_expenses_organization_date ON public.expenses USING btree (organization_id, expense_date);


--
-- Name: idx_expenses_payment_status; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_expenses_payment_status ON public.expenses USING btree (payment_status);


--
-- Name: idx_expenses_vendor; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_expenses_vendor ON public.expenses USING btree (vendor_id);


--
-- Name: idx_guest_passes_organization; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_guest_passes_organization ON public.guest_passes USING btree (organization_id);


--
-- Name: idx_guest_passes_valid_until; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_guest_passes_valid_until ON public.guest_passes USING btree (valid_until);


--
-- Name: idx_incident_follow_ups_due; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_incident_follow_ups_due ON public.incident_follow_ups USING btree (organization_id, due_date);


--
-- Name: idx_incident_investigations_organization; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_incident_investigations_organization ON public.incident_investigations USING btree (organization_id);


--
-- Name: idx_incident_reports_incident_date; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_incident_reports_incident_date ON public.incident_reports USING btree (incident_date);


--
-- Name: idx_incident_reports_organization_id; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_incident_reports_organization_id ON public.incident_reports USING btree (organization_id);


--
-- Name: idx_incident_reports_severity; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_incident_reports_severity ON public.incident_reports USING btree (severity);


--
-- Name: idx_inspection_checklists_equipment_type; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_inspection_checklists_equipment_type ON public.inspection_checklists USING btree (equipment_type);


--
-- Name: idx_inspection_checklists_org_id; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_inspection_checklists_org_id ON public.inspection_checklists USING btree (organization_id);


--
-- Name: idx_inspection_results_inspection_id; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_inspection_results_inspection_id ON public.inspection_results USING btree (inspection_id);


--
-- Name: idx_insurance_claims_organization; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_insurance_claims_organization ON public.insurance_claims USING btree (organization_id);


--
-- Name: idx_integration_logs_created_at; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_integration_logs_created_at ON public.integration_logs USING btree (created_at DESC);


--
-- Name: idx_integration_logs_organization_id; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_integration_logs_organization_id ON public.integration_logs USING btree (organization_id);


--
-- Name: idx_integrations_organization_id; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_integrations_organization_id ON public.integrations USING btree (organization_id);


--
-- Name: idx_integrations_status; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_integrations_status ON public.integrations USING btree (status);


--
-- Name: idx_inventory_items_org_product; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_inventory_items_org_product ON public.inventory_items USING btree (organization_id, product_id);


--
-- Name: idx_inventory_items_stock_level; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_inventory_items_stock_level ON public.inventory_items USING btree (organization_id, current_stock, min_stock_level);


--
-- Name: idx_invoice_items_invoice_id; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_invoice_items_invoice_id ON public.corporate_invoice_items USING btree (invoice_id);


--
-- Name: idx_kpi_metrics_org_category_period; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_kpi_metrics_org_category_period ON public.kpi_metrics USING btree (organization_id, metric_category, period_start);


--
-- Name: idx_lifeguard_schedules_lifeguard; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_lifeguard_schedules_lifeguard ON public.lifeguard_schedules USING btree (lifeguard_id);


--
-- Name: idx_lifeguard_schedules_organization; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_lifeguard_schedules_organization ON public.lifeguard_schedules USING btree (organization_id);


--
-- Name: idx_location_analytics_date; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_location_analytics_date ON public.location_analytics USING btree (analytics_date);


--
-- Name: idx_location_analytics_location; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_location_analytics_location ON public.location_analytics USING btree (location_id);


--
-- Name: idx_location_analytics_org; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_location_analytics_org ON public.location_analytics USING btree (organization_id);


--
-- Name: idx_location_hierarchies_child; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_location_hierarchies_child ON public.location_hierarchies USING btree (child_location_id);


--
-- Name: idx_location_hierarchies_org_id; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_location_hierarchies_org_id ON public.location_hierarchies USING btree (organization_id);


--
-- Name: idx_location_hierarchies_parent; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_location_hierarchies_parent ON public.location_hierarchies USING btree (parent_location_id);


--
-- Name: idx_locker_access_log_time; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_locker_access_log_time ON public.locker_access_log USING btree (access_time);


--
-- Name: idx_locker_maintenance_organization; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_locker_maintenance_organization ON public.locker_maintenance USING btree (organization_id);


--
-- Name: idx_locker_rentals_active; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_locker_rentals_active ON public.locker_rentals USING btree (organization_id, status);


--
-- Name: idx_locker_rentals_member; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_locker_rentals_member ON public.locker_rentals USING btree (member_id);


--
-- Name: idx_locker_rentals_organization; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_locker_rentals_organization ON public.locker_rentals USING btree (organization_id);


--
-- Name: idx_lockers_available; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_lockers_available ON public.lockers USING btree (organization_id, is_available, is_out_of_order);


--
-- Name: idx_lockers_organization; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_lockers_organization ON public.lockers USING btree (organization_id);


--
-- Name: idx_loyalty_points_activity_type; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_loyalty_points_activity_type ON public.loyalty_points USING btree (activity_type, created_at);


--
-- Name: idx_loyalty_points_member_id; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_loyalty_points_member_id ON public.loyalty_points USING btree (member_id);


--
-- Name: idx_loyalty_program_rules_activity_type; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_loyalty_program_rules_activity_type ON public.loyalty_program_rules USING btree (activity_type);


--
-- Name: idx_loyalty_program_rules_organization_id; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_loyalty_program_rules_organization_id ON public.loyalty_program_rules USING btree (organization_id);


--
-- Name: idx_loyalty_redemptions_member_id; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_loyalty_redemptions_member_id ON public.loyalty_redemptions USING btree (member_id);


--
-- Name: idx_loyalty_redemptions_reward_id; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_loyalty_redemptions_reward_id ON public.loyalty_redemptions USING btree (reward_id);


--
-- Name: idx_loyalty_redemptions_status; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_loyalty_redemptions_status ON public.loyalty_redemptions USING btree (status);


--
-- Name: idx_loyalty_rewards_category; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_loyalty_rewards_category ON public.loyalty_rewards USING btree (category);


--
-- Name: idx_loyalty_rewards_organization_id; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_loyalty_rewards_organization_id ON public.loyalty_rewards USING btree (organization_id);


--
-- Name: idx_maintenance_schedules_equipment_id; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_maintenance_schedules_equipment_id ON public.maintenance_schedules USING btree (equipment_id);


--
-- Name: idx_maintenance_schedules_organization_id; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_maintenance_schedules_organization_id ON public.maintenance_schedules USING btree (organization_id);


--
-- Name: idx_maintenance_schedules_scheduled_date; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_maintenance_schedules_scheduled_date ON public.maintenance_schedules USING btree (scheduled_date);


--
-- Name: idx_marketing_analytics_org_period; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_marketing_analytics_org_period ON public.marketing_analytics USING btree (organization_id, period_start);


--
-- Name: idx_marketing_campaigns_organization_id; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_marketing_campaigns_organization_id ON public.marketing_campaigns USING btree (organization_id);


--
-- Name: idx_marketing_campaigns_scheduled_at; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_marketing_campaigns_scheduled_at ON public.marketing_campaigns USING btree (scheduled_at);


--
-- Name: idx_marketing_campaigns_status; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_marketing_campaigns_status ON public.marketing_campaigns USING btree (status);


--
-- Name: idx_member_analytics_org_date; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_member_analytics_org_date ON public.member_analytics_snapshots USING btree (organization_id, snapshot_date);


--
-- Name: idx_member_engagement_history_member_id; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_member_engagement_history_member_id ON public.member_engagement_history USING btree (member_id);


--
-- Name: idx_member_engagement_history_type_date; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_member_engagement_history_type_date ON public.member_engagement_history USING btree (engagement_type, created_at);


--
-- Name: idx_member_feedback_status; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_member_feedback_status ON public.member_feedback USING btree (status, created_at);


--
-- Name: idx_member_location_access_location; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_member_location_access_location ON public.member_location_access USING btree (location_id);


--
-- Name: idx_member_location_access_member; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_member_location_access_member ON public.member_location_access USING btree (member_id);


--
-- Name: idx_member_location_access_org; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_member_location_access_org ON public.member_location_access USING btree (organization_id);


--
-- Name: idx_member_referrals_referrer; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_member_referrals_referrer ON public.member_referrals USING btree (referrer_id, status);


--
-- Name: idx_member_segments_organization_id; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_member_segments_organization_id ON public.member_segments USING btree (organization_id);


--
-- Name: idx_notifications_member_id; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_notifications_member_id ON public.notifications USING btree (member_id);


--
-- Name: idx_notifications_organization_id; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_notifications_organization_id ON public.notifications USING btree (organization_id);


--
-- Name: idx_notifications_scheduled_for; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_notifications_scheduled_for ON public.notifications USING btree (scheduled_for);


--
-- Name: idx_notifications_status; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_notifications_status ON public.notifications USING btree (status);


--
-- Name: idx_payroll_periods_dates; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_payroll_periods_dates ON public.payroll_periods USING btree (start_date, end_date);


--
-- Name: idx_payroll_periods_organization_id; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_payroll_periods_organization_id ON public.payroll_periods USING btree (organization_id);


--
-- Name: idx_pool_facilities_organization; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_pool_facilities_organization ON public.pool_facilities USING btree (organization_id);


--
-- Name: idx_pool_lane_reservations_date; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_pool_lane_reservations_date ON public.pool_lane_reservations USING btree (reservation_date, start_time);


--
-- Name: idx_pool_lane_reservations_member; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_pool_lane_reservations_member ON public.pool_lane_reservations USING btree (member_id);


--
-- Name: idx_pool_lane_reservations_organization; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_pool_lane_reservations_organization ON public.pool_lane_reservations USING btree (organization_id);


--
-- Name: idx_pool_maintenance_logs_pool; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_pool_maintenance_logs_pool ON public.pool_maintenance_logs USING btree (pool_id, maintenance_date);


--
-- Name: idx_retail_products_category; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_retail_products_category ON public.retail_products USING btree (organization_id, category);


--
-- Name: idx_retail_products_org_active; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_retail_products_org_active ON public.retail_products USING btree (organization_id, is_active);


--
-- Name: idx_retail_products_sku; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_retail_products_sku ON public.retail_products USING btree (organization_id, sku);


--
-- Name: idx_retail_transactions_cashier; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_retail_transactions_cashier ON public.retail_transactions USING btree (cashier_id);


--
-- Name: idx_retail_transactions_member; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_retail_transactions_member ON public.retail_transactions USING btree (member_id);


--
-- Name: idx_retail_transactions_org_date; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_retail_transactions_org_date ON public.retail_transactions USING btree (organization_id, transaction_date);


--
-- Name: idx_revenue_analytics_org_period; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_revenue_analytics_org_period ON public.revenue_analytics USING btree (organization_id, period_start, period_end);


--
-- Name: idx_safety_inspections_equipment_id; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_safety_inspections_equipment_id ON public.safety_inspections USING btree (equipment_id);


--
-- Name: idx_safety_inspections_org_id; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_safety_inspections_org_id ON public.safety_inspections USING btree (organization_id);


--
-- Name: idx_safety_inspections_scheduled_date; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_safety_inspections_scheduled_date ON public.safety_inspections USING btree (scheduled_date);


--
-- Name: idx_safety_violations_equipment_id; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_safety_violations_equipment_id ON public.safety_violations USING btree (equipment_id);


--
-- Name: idx_safety_violations_org_id; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_safety_violations_org_id ON public.safety_violations USING btree (organization_id);


--
-- Name: idx_safety_violations_status; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_safety_violations_status ON public.safety_violations USING btree (status);


--
-- Name: idx_social_logs_blog_post; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_social_logs_blog_post ON public.social_media_automation_logs USING btree (blog_post_id);


--
-- Name: idx_social_logs_org_created; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_social_logs_org_created ON public.social_media_automation_logs USING btree (organization_id, created_at DESC);


--
-- Name: idx_spa_appointments_member; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_spa_appointments_member ON public.spa_appointments USING btree (member_id);


--
-- Name: idx_spa_appointments_organization_date; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_spa_appointments_organization_date ON public.spa_appointments USING btree (organization_id, appointment_date);


--
-- Name: idx_spa_appointments_therapist_date; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_spa_appointments_therapist_date ON public.spa_appointments USING btree (therapist_id, appointment_date);


--
-- Name: idx_spa_inventory_organization_active; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_spa_inventory_organization_active ON public.spa_inventory USING btree (organization_id, is_active);


--
-- Name: idx_spa_inventory_stock_level; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_spa_inventory_stock_level ON public.spa_inventory USING btree (organization_id, current_stock, minimum_stock);


--
-- Name: idx_spa_services_organization_active; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_spa_services_organization_active ON public.spa_services USING btree (organization_id, is_active);


--
-- Name: idx_sports_courts_organization; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_sports_courts_organization ON public.sports_courts USING btree (organization_id);


--
-- Name: idx_sports_courts_type; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_sports_courts_type ON public.sports_courts USING btree (court_type);


--
-- Name: idx_sports_equipment_organization; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_sports_equipment_organization ON public.sports_equipment USING btree (organization_id);


--
-- Name: idx_sports_equipment_sport; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_sports_equipment_sport ON public.sports_equipment USING btree (sport);


--
-- Name: idx_staff_certifications_expiry; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_staff_certifications_expiry ON public.staff_certifications USING btree (expiry_date);


--
-- Name: idx_staff_certifications_org; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_staff_certifications_org ON public.staff_certifications USING btree (organization_id);


--
-- Name: idx_staff_certifications_staff; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_staff_certifications_staff ON public.staff_certifications USING btree (staff_id);


--
-- Name: idx_staff_performance_org_period; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_staff_performance_org_period ON public.staff_performance_analytics USING btree (organization_id, period_start);


--
-- Name: idx_staff_schedules_organization_id; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_staff_schedules_organization_id ON public.staff_schedules USING btree (organization_id);


--
-- Name: idx_staff_schedules_staff_id; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_staff_schedules_staff_id ON public.staff_schedules USING btree (staff_id);


--
-- Name: idx_stock_movements_inventory; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_stock_movements_inventory ON public.stock_movements USING btree (inventory_item_id);


--
-- Name: idx_stock_movements_org_date; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_stock_movements_org_date ON public.stock_movements USING btree (organization_id, movement_date);


--
-- Name: idx_swim_lesson_enrollments_member; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_swim_lesson_enrollments_member ON public.swim_lesson_enrollments USING btree (member_id);


--
-- Name: idx_swim_lessons_instructor; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_swim_lessons_instructor ON public.swim_lessons USING btree (instructor_id);


--
-- Name: idx_swim_lessons_organization; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_swim_lessons_organization ON public.swim_lessons USING btree (organization_id);


--
-- Name: idx_therapist_availability_therapist_day; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_therapist_availability_therapist_day ON public.therapist_availability USING btree (therapist_id, day_of_week);


--
-- Name: idx_time_entries_dates; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_time_entries_dates ON public.time_entries USING btree (clock_in, clock_out);


--
-- Name: idx_time_entries_organization_id; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_time_entries_organization_id ON public.time_entries USING btree (organization_id);


--
-- Name: idx_time_entries_staff_id; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_time_entries_staff_id ON public.time_entries USING btree (staff_id);


--
-- Name: idx_tournament_participants_tournament; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_tournament_participants_tournament ON public.tournament_participants USING btree (tournament_id);


--
-- Name: idx_tournaments_organization; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_tournaments_organization ON public.tournaments USING btree (organization_id);


--
-- Name: idx_towel_cleaning_logs_cleaning_date; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_towel_cleaning_logs_cleaning_date ON public.towel_cleaning_logs USING btree (cleaning_date);


--
-- Name: idx_towel_cleaning_logs_organization_id; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_towel_cleaning_logs_organization_id ON public.towel_cleaning_logs USING btree (organization_id);


--
-- Name: idx_towel_inventory_organization_id; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_towel_inventory_organization_id ON public.towel_inventory USING btree (organization_id);


--
-- Name: idx_towel_inventory_type_size; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_towel_inventory_type_size ON public.towel_inventory USING btree (towel_type, size);


--
-- Name: idx_towel_rentals_member_id; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_towel_rentals_member_id ON public.towel_rentals USING btree (member_id);


--
-- Name: idx_towel_rentals_organization_id; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_towel_rentals_organization_id ON public.towel_rentals USING btree (organization_id);


--
-- Name: idx_towel_rentals_rental_date; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_towel_rentals_rental_date ON public.towel_rentals USING btree (rental_date);


--
-- Name: idx_towel_rentals_status; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_towel_rentals_status ON public.towel_rentals USING btree (status);


--
-- Name: idx_visitor_checkins_date; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_visitor_checkins_date ON public.visitor_checkins USING btree (check_in_time);


--
-- Name: idx_visitor_checkins_organization; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_visitor_checkins_organization ON public.visitor_checkins USING btree (organization_id);


--
-- Name: idx_water_quality_logs_pool; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_water_quality_logs_pool ON public.water_quality_logs USING btree (pool_id, test_date);


--
-- Name: idx_webhook_endpoints_organization_id; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_webhook_endpoints_organization_id ON public.webhook_endpoints USING btree (organization_id);


--
-- Name: idx_webhook_endpoints_status; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_webhook_endpoints_status ON public.webhook_endpoints USING btree (status);


--
-- Name: idx_webhook_logs_created_at; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_webhook_logs_created_at ON public.webhook_logs USING btree (created_at DESC);


--
-- Name: idx_webhook_logs_endpoint_id; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_webhook_logs_endpoint_id ON public.webhook_logs USING btree (webhook_endpoint_id);


--
-- Name: idx_webhook_logs_organization_id; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX idx_webhook_logs_organization_id ON public.webhook_logs USING btree (organization_id);


--
-- Name: ix_realtime_subscription_entity; Type: INDEX; Schema: realtime; Owner: supabase_admin
--

CREATE INDEX ix_realtime_subscription_entity ON realtime.subscription USING btree (entity);


--
-- Name: messages_inserted_at_topic_index; Type: INDEX; Schema: realtime; Owner: supabase_realtime_admin
--

CREATE INDEX messages_inserted_at_topic_index ON ONLY realtime.messages USING btree (inserted_at DESC, topic) WHERE ((extension = 'broadcast'::text) AND (private IS TRUE));


--
-- Name: subscription_subscription_id_entity_filters_key; Type: INDEX; Schema: realtime; Owner: supabase_admin
--

CREATE UNIQUE INDEX subscription_subscription_id_entity_filters_key ON realtime.subscription USING btree (subscription_id, entity, filters);


--
-- Name: bname; Type: INDEX; Schema: storage; Owner: supabase_storage_admin
--

CREATE UNIQUE INDEX bname ON storage.buckets USING btree (name);


--
-- Name: bucketid_objname; Type: INDEX; Schema: storage; Owner: supabase_storage_admin
--

CREATE UNIQUE INDEX bucketid_objname ON storage.objects USING btree (bucket_id, name);


--
-- Name: buckets_analytics_unique_name_idx; Type: INDEX; Schema: storage; Owner: supabase_storage_admin
--

CREATE UNIQUE INDEX buckets_analytics_unique_name_idx ON storage.buckets_analytics USING btree (name) WHERE (deleted_at IS NULL);


--
-- Name: idx_multipart_uploads_list; Type: INDEX; Schema: storage; Owner: supabase_storage_admin
--

CREATE INDEX idx_multipart_uploads_list ON storage.s3_multipart_uploads USING btree (bucket_id, key, created_at);


--
-- Name: idx_name_bucket_level_unique; Type: INDEX; Schema: storage; Owner: supabase_storage_admin
--

CREATE UNIQUE INDEX idx_name_bucket_level_unique ON storage.objects USING btree (name COLLATE "C", bucket_id, level);


--
-- Name: idx_objects_bucket_id_name; Type: INDEX; Schema: storage; Owner: supabase_storage_admin
--

CREATE INDEX idx_objects_bucket_id_name ON storage.objects USING btree (bucket_id, name COLLATE "C");


--
-- Name: idx_objects_lower_name; Type: INDEX; Schema: storage; Owner: supabase_storage_admin
--

CREATE INDEX idx_objects_lower_name ON storage.objects USING btree ((path_tokens[level]), lower(name) text_pattern_ops, bucket_id, level);


--
-- Name: idx_prefixes_lower_name; Type: INDEX; Schema: storage; Owner: supabase_storage_admin
--

CREATE INDEX idx_prefixes_lower_name ON storage.prefixes USING btree (bucket_id, level, ((string_to_array(name, '/'::text))[level]), lower(name) text_pattern_ops);


--
-- Name: name_prefix_search; Type: INDEX; Schema: storage; Owner: supabase_storage_admin
--

CREATE INDEX name_prefix_search ON storage.objects USING btree (name text_pattern_ops);


--
-- Name: objects_bucket_id_level_idx; Type: INDEX; Schema: storage; Owner: supabase_storage_admin
--

CREATE UNIQUE INDEX objects_bucket_id_level_idx ON storage.objects USING btree (bucket_id, level, name COLLATE "C");


--
-- Name: vector_indexes_name_bucket_id_idx; Type: INDEX; Schema: storage; Owner: supabase_storage_admin
--

CREATE UNIQUE INDEX vector_indexes_name_bucket_id_idx ON storage.vector_indexes USING btree (name, bucket_id);


--
-- Name: users on_auth_user_created; Type: TRIGGER; Schema: auth; Owner: supabase_auth_admin
--

CREATE TRIGGER on_auth_user_created AFTER INSERT ON auth.users FOR EACH ROW EXECUTE FUNCTION public.handle_new_user();


--
-- Name: locker_rentals calculate_payment_due_date; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER calculate_payment_due_date BEFORE INSERT ON public.locker_rentals FOR EACH ROW EXECUTE FUNCTION public.calculate_next_payment_due();


--
-- Name: towel_cleaning_logs handle_cleaning_completion_trigger; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER handle_cleaning_completion_trigger AFTER UPDATE ON public.towel_cleaning_logs FOR EACH ROW EXECUTE FUNCTION public.handle_cleaning_completion();


--
-- Name: profiles on_member_created_notification_preferences; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER on_member_created_notification_preferences AFTER INSERT ON public.profiles FOR EACH ROW EXECUTE FUNCTION public.create_default_notification_preferences();


--
-- Name: class_waitlists on_waitlist_promotion_notification; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER on_waitlist_promotion_notification AFTER UPDATE ON public.class_waitlists FOR EACH ROW EXECUTE FUNCTION public.create_waitlist_promotion_notification();


--
-- Name: class_bookings promote_waitlist_on_cancellation; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER promote_waitlist_on_cancellation AFTER UPDATE ON public.class_bookings FOR EACH ROW EXECUTE FUNCTION public.promote_from_waitlist();


--
-- Name: corporate_invoices set_invoice_number_trigger; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER set_invoice_number_trigger BEFORE INSERT ON public.corporate_invoices FOR EACH ROW EXECUTE FUNCTION public.set_corporate_invoice_number();


--
-- Name: pos_sales set_pos_sale_number_trigger; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER set_pos_sale_number_trigger BEFORE INSERT ON public.pos_sales FOR EACH ROW EXECUTE FUNCTION public.set_pos_sale_number();


--
-- Name: retail_transactions set_transaction_number_trigger; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER set_transaction_number_trigger BEFORE INSERT ON public.retail_transactions FOR EACH ROW EXECUTE FUNCTION public.set_transaction_number();


--
-- Name: class_waitlists set_waitlist_priority; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER set_waitlist_priority BEFORE INSERT ON public.class_waitlists FOR EACH ROW EXECUTE FUNCTION public.update_waitlist_priority();


--
-- Name: profiles setup_lead_stages_on_profile; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER setup_lead_stages_on_profile AFTER INSERT ON public.profiles FOR EACH ROW EXECUTE FUNCTION public.trigger_setup_lead_stages();


--
-- Name: blog_categories trg_blog_categories_updated; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER trg_blog_categories_updated BEFORE UPDATE ON public.blog_categories FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: blog_posts trg_blog_posts_updated; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER trg_blog_posts_updated BEFORE UPDATE ON public.blog_posts FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: blog_tags trg_blog_tags_updated; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER trg_blog_tags_updated BEFORE UPDATE ON public.blog_tags FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: profiles trigger_generate_member_barcode; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER trigger_generate_member_barcode BEFORE INSERT OR UPDATE ON public.profiles FOR EACH ROW EXECUTE FUNCTION public.handle_member_barcode_generation();


--
-- Name: ai_model_settings update_ai_model_settings_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_ai_model_settings_updated_at BEFORE UPDATE ON public.ai_model_settings FOR EACH ROW EXECUTE FUNCTION public.update_ai_automation_updated_at();


--
-- Name: announcements update_announcements_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_announcements_updated_at BEFORE UPDATE ON public.announcements FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: api_keys update_api_keys_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_api_keys_updated_at BEFORE UPDATE ON public.api_keys FOR EACH ROW EXECUTE FUNCTION public.update_integration_updated_at();


--
-- Name: blog_auto_generation_settings update_blog_auto_generation_settings_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_blog_auto_generation_settings_updated_at BEFORE UPDATE ON public.blog_auto_generation_settings FOR EACH ROW EXECUTE FUNCTION public.update_ai_automation_updated_at();


--
-- Name: blog_generation_queue update_blog_generation_queue_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_blog_generation_queue_updated_at BEFORE UPDATE ON public.blog_generation_queue FOR EACH ROW EXECUTE FUNCTION public.update_ai_automation_updated_at();


--
-- Name: certification_requirements update_certification_requirements_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_certification_requirements_updated_at BEFORE UPDATE ON public.certification_requirements FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: child_profiles update_child_profiles_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_child_profiles_updated_at BEFORE UPDATE ON public.child_profiles FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: childcare_activities update_childcare_activities_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_childcare_activities_updated_at BEFORE UPDATE ON public.childcare_activities FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: childcare_activity_registrations update_childcare_activity_registrations_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_childcare_activity_registrations_updated_at BEFORE UPDATE ON public.childcare_activity_registrations FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: childcare_checkins update_childcare_checkins_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_childcare_checkins_updated_at BEFORE UPDATE ON public.childcare_checkins FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: childcare_daily_reports update_childcare_daily_reports_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_childcare_daily_reports_updated_at BEFORE UPDATE ON public.childcare_daily_reports FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: childcare_staff_schedules update_childcare_staff_schedules_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_childcare_staff_schedules_updated_at BEFORE UPDATE ON public.childcare_staff_schedules FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: class_waitlists update_class_waitlists_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_class_waitlists_updated_at BEFORE UPDATE ON public.class_waitlists FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: classes update_classes_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_classes_updated_at BEFORE UPDATE ON public.classes FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: cleaning_schedules update_cleaning_schedules_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_cleaning_schedules_updated_at BEFORE UPDATE ON public.cleaning_schedules FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: commission_calculations update_commission_calculations_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_commission_calculations_updated_at BEFORE UPDATE ON public.commission_calculations FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: communication_providers update_communication_providers_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_communication_providers_updated_at BEFORE UPDATE ON public.communication_providers FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: communication_templates update_communication_templates_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_communication_templates_updated_at BEFORE UPDATE ON public.communication_templates FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: corporate_accounts update_corporate_accounts_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_corporate_accounts_updated_at BEFORE UPDATE ON public.corporate_accounts FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: corporate_invoices update_corporate_invoices_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_corporate_invoices_updated_at BEFORE UPDATE ON public.corporate_invoices FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: corporate_members update_corporate_members_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_corporate_members_updated_at BEFORE UPDATE ON public.corporate_members FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: corporate_membership_plans update_corporate_membership_plans_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_corporate_membership_plans_updated_at BEFORE UPDATE ON public.corporate_membership_plans FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: cost_allocations update_cost_allocations_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_cost_allocations_updated_at BEFORE UPDATE ON public.cost_allocations FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: court_reservations update_court_reservations_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_court_reservations_updated_at BEFORE UPDATE ON public.court_reservations FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: cross_location_assignments update_cross_location_assignments_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_cross_location_assignments_updated_at BEFORE UPDATE ON public.cross_location_assignments FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: cross_location_transfers update_cross_location_transfers_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_cross_location_transfers_updated_at BEFORE UPDATE ON public.cross_location_transfers FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: department_budgets update_department_budgets_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_department_budgets_updated_at BEFORE UPDATE ON public.department_budgets FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: department_revenues update_department_revenues_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_department_revenues_updated_at BEFORE UPDATE ON public.department_revenues FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: early_access_requests update_early_access_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_early_access_updated_at BEFORE UPDATE ON public.early_access_requests FOR EACH ROW EXECUTE FUNCTION public.update_integration_updated_at();


--
-- Name: email_messages update_email_messages_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_email_messages_updated_at BEFORE UPDATE ON public.email_messages FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: email_templates update_email_templates_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_email_templates_updated_at BEFORE UPDATE ON public.email_templates FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: email_threads update_email_threads_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_email_threads_updated_at BEFORE UPDATE ON public.email_threads FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: equipment_checkout update_equipment_checkout_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_equipment_checkout_updated_at BEFORE UPDATE ON public.equipment_checkout FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: maintenance_logs update_equipment_maintenance_dates; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_equipment_maintenance_dates AFTER INSERT ON public.maintenance_logs FOR EACH ROW EXECUTE FUNCTION public.update_equipment_maintenance_schedule();


--
-- Name: equipment update_equipment_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_equipment_updated_at BEFORE UPDATE ON public.equipment FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: expense_categories update_expense_categories_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_expense_categories_updated_at BEFORE UPDATE ON public.expense_categories FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: expense_vendors update_expense_vendors_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_expense_vendors_updated_at BEFORE UPDATE ON public.expense_vendors FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: expenses update_expenses_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_expenses_updated_at BEFORE UPDATE ON public.expenses FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: facility_areas update_facility_areas_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_facility_areas_updated_at BEFORE UPDATE ON public.facility_areas FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: facility_tours update_facility_tours_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_facility_tours_updated_at BEFORE UPDATE ON public.facility_tours FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: fitness_assessments update_fitness_assessments_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_fitness_assessments_updated_at BEFORE UPDATE ON public.fitness_assessments FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: guest_pass_types update_guest_pass_types_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_guest_pass_types_updated_at BEFORE UPDATE ON public.guest_pass_types FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: guest_passes update_guest_passes_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_guest_passes_updated_at BEFORE UPDATE ON public.guest_passes FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: incident_follow_ups update_incident_follow_ups_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_incident_follow_ups_updated_at BEFORE UPDATE ON public.incident_follow_ups FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: incident_investigations update_incident_investigations_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_incident_investigations_updated_at BEFORE UPDATE ON public.incident_investigations FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: incident_reports update_incident_reports_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_incident_reports_updated_at BEFORE UPDATE ON public.incident_reports FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: inspection_checklist_items update_inspection_checklist_items_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_inspection_checklist_items_updated_at BEFORE UPDATE ON public.inspection_checklist_items FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: inspection_checklists update_inspection_checklists_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_inspection_checklists_updated_at BEFORE UPDATE ON public.inspection_checklists FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: inspection_results update_inspection_results_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_inspection_results_updated_at BEFORE UPDATE ON public.inspection_results FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: inspection_results update_inspection_stats_on_result_change; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_inspection_stats_on_result_change AFTER INSERT OR DELETE OR UPDATE ON public.inspection_results FOR EACH ROW EXECUTE FUNCTION public.update_inspection_statistics();


--
-- Name: instructor_availability update_instructor_availability_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_instructor_availability_updated_at BEFORE UPDATE ON public.instructor_availability FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: insurance_claims update_insurance_claims_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_insurance_claims_updated_at BEFORE UPDATE ON public.insurance_claims FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: integrations update_integrations_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_integrations_updated_at BEFORE UPDATE ON public.integrations FOR EACH ROW EXECUTE FUNCTION public.update_integration_updated_at();


--
-- Name: inventory_items update_inventory_items_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_inventory_items_updated_at BEFORE UPDATE ON public.inventory_items FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: retail_transaction_items update_inventory_on_sale; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_inventory_on_sale AFTER INSERT ON public.retail_transaction_items FOR EACH ROW EXECUTE FUNCTION public.update_inventory_on_transaction();


--
-- Name: lead_activities update_lead_activities_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_lead_activities_updated_at BEFORE UPDATE ON public.lead_activities FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: lead_attribution_disputes update_lead_attribution_disputes_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_lead_attribution_disputes_updated_at BEFORE UPDATE ON public.lead_attribution_disputes FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: lead_scoring_rules update_lead_scoring_rules_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_lead_scoring_rules_updated_at BEFORE UPDATE ON public.lead_scoring_rules FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: lead_sources update_lead_sources_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_lead_sources_updated_at BEFORE UPDATE ON public.lead_sources FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: lead_stages update_lead_stages_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_lead_stages_updated_at BEFORE UPDATE ON public.lead_stages FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: leads update_leads_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_leads_updated_at BEFORE UPDATE ON public.leads FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: lifeguard_schedules update_lifeguard_schedules_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_lifeguard_schedules_updated_at BEFORE UPDATE ON public.lifeguard_schedules FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: location_analytics update_location_analytics_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_location_analytics_updated_at BEFORE UPDATE ON public.location_analytics FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: location_hierarchies update_location_hierarchies_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_location_hierarchies_updated_at BEFORE UPDATE ON public.location_hierarchies FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: locations update_locations_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_locations_updated_at BEFORE UPDATE ON public.locations FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: locker_maintenance update_locker_maintenance_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_locker_maintenance_updated_at BEFORE UPDATE ON public.locker_maintenance FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: locker_rentals update_locker_rentals_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_locker_rentals_updated_at BEFORE UPDATE ON public.locker_rentals FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: lockers update_lockers_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_lockers_updated_at BEFORE UPDATE ON public.lockers FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: loyalty_points update_loyalty_points_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_loyalty_points_updated_at BEFORE UPDATE ON public.loyalty_points FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: loyalty_program_rules update_loyalty_program_rules_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_loyalty_program_rules_updated_at BEFORE UPDATE ON public.loyalty_program_rules FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: loyalty_redemptions update_loyalty_redemptions_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_loyalty_redemptions_updated_at BEFORE UPDATE ON public.loyalty_redemptions FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: loyalty_rewards update_loyalty_rewards_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_loyalty_rewards_updated_at BEFORE UPDATE ON public.loyalty_rewards FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: maintenance_logs update_maintenance_logs_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_maintenance_logs_updated_at BEFORE UPDATE ON public.maintenance_logs FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: maintenance_schedules update_maintenance_schedules_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_maintenance_schedules_updated_at BEFORE UPDATE ON public.maintenance_schedules FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: marketing_analytics update_marketing_analytics_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_marketing_analytics_updated_at BEFORE UPDATE ON public.marketing_analytics FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: marketing_campaigns update_marketing_campaigns_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_marketing_campaigns_updated_at BEFORE UPDATE ON public.marketing_campaigns FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: corporate_members update_member_allocation_trigger; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_member_allocation_trigger AFTER INSERT OR DELETE OR UPDATE ON public.corporate_members FOR EACH ROW EXECUTE FUNCTION public.update_corporate_member_allocation();


--
-- Name: member_cards update_member_cards_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_member_cards_updated_at BEFORE UPDATE ON public.member_cards FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: member_cohorts update_member_cohorts_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_member_cohorts_updated_at BEFORE UPDATE ON public.member_cohorts FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: member_documents update_member_documents_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_member_documents_updated_at BEFORE UPDATE ON public.member_documents FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: member_feedback update_member_feedback_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_member_feedback_updated_at BEFORE UPDATE ON public.member_feedback FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: member_location_access update_member_location_access_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_member_location_access_updated_at BEFORE UPDATE ON public.member_location_access FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: member_messages update_member_messages_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_member_messages_updated_at BEFORE UPDATE ON public.member_messages FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: member_orientations update_member_orientations_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_member_orientations_updated_at BEFORE UPDATE ON public.member_orientations FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: member_referrals update_member_referrals_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_member_referrals_updated_at BEFORE UPDATE ON public.member_referrals FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: member_segments update_member_segments_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_member_segments_updated_at BEFORE UPDATE ON public.member_segments FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: membership_agreement_templates update_membership_agreement_templates_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_membership_agreement_templates_updated_at BEFORE UPDATE ON public.membership_agreement_templates FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: membership_plans update_membership_plans_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_membership_plans_updated_at BEFORE UPDATE ON public.membership_plans FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: memberships update_memberships_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_memberships_updated_at BEFORE UPDATE ON public.memberships FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: message_history update_message_history_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_message_history_updated_at BEFORE UPDATE ON public.message_history FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: messages update_messages_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_messages_updated_at BEFORE UPDATE ON public.messages FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: notification_preferences update_notification_preferences_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_notification_preferences_updated_at BEFORE UPDATE ON public.notification_preferences FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: notification_templates update_notification_templates_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_notification_templates_updated_at BEFORE UPDATE ON public.notification_templates FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: notifications update_notifications_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_notifications_updated_at BEFORE UPDATE ON public.notifications FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: organization_commission_settings update_organization_commission_settings_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_organization_commission_settings_updated_at BEFORE UPDATE ON public.organization_commission_settings FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: organizations update_organizations_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_organizations_updated_at BEFORE UPDATE ON public.organizations FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: payment_transactions update_payment_transactions_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_payment_transactions_updated_at BEFORE UPDATE ON public.payment_transactions FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: payroll_periods update_payroll_periods_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_payroll_periods_updated_at BEFORE UPDATE ON public.payroll_periods FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: personal_training_sessions update_personal_training_sessions_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_personal_training_sessions_updated_at BEFORE UPDATE ON public.personal_training_sessions FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: pool_facilities update_pool_facilities_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_pool_facilities_updated_at BEFORE UPDATE ON public.pool_facilities FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: pool_lane_reservations update_pool_lane_reservations_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_pool_lane_reservations_updated_at BEFORE UPDATE ON public.pool_lane_reservations FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: pool_maintenance_logs update_pool_maintenance_logs_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_pool_maintenance_logs_updated_at BEFORE UPDATE ON public.pool_maintenance_logs FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: pos_products update_pos_products_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_pos_products_updated_at BEFORE UPDATE ON public.pos_products FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: profiles update_profiles_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_profiles_updated_at BEFORE UPDATE ON public.profiles FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: promotions update_promotions_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_promotions_updated_at BEFORE UPDATE ON public.promotions FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: referral_programs update_referral_programs_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_referral_programs_updated_at BEFORE UPDATE ON public.referral_programs FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: resource_bookings update_resource_bookings_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_resource_bookings_updated_at BEFORE UPDATE ON public.resource_bookings FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: retail_products update_retail_products_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_retail_products_updated_at BEFORE UPDATE ON public.retail_products FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: retail_transactions update_retail_transactions_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_retail_transactions_updated_at BEFORE UPDATE ON public.retail_transactions FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: retention_campaigns update_retention_campaigns_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_retention_campaigns_updated_at BEFORE UPDATE ON public.retention_campaigns FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: revenue_analytics update_revenue_analytics_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_revenue_analytics_updated_at BEFORE UPDATE ON public.revenue_analytics FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: safety_inspections update_safety_inspections_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_safety_inspections_updated_at BEFORE UPDATE ON public.safety_inspections FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: safety_violations update_safety_violations_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_safety_violations_updated_at BEFORE UPDATE ON public.safety_violations FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: sales_quotes update_sales_quotes_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_sales_quotes_updated_at BEFORE UPDATE ON public.sales_quotes FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: salesperson_commissions update_salesperson_commissions_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_salesperson_commissions_updated_at BEFORE UPDATE ON public.salesperson_commissions FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: salesperson_referral_links update_salesperson_referral_links_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_salesperson_referral_links_updated_at BEFORE UPDATE ON public.salesperson_referral_links FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: sms_campaigns update_sms_campaigns_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_sms_campaigns_updated_at BEFORE UPDATE ON public.sms_campaigns FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: social_media_automation_logs update_social_media_automation_logs_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_social_media_automation_logs_updated_at BEFORE UPDATE ON public.social_media_automation_logs FOR EACH ROW EXECUTE FUNCTION public.update_ai_automation_updated_at();


--
-- Name: social_media_automation_settings update_social_media_automation_settings_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_social_media_automation_settings_updated_at BEFORE UPDATE ON public.social_media_automation_settings FOR EACH ROW EXECUTE FUNCTION public.update_ai_automation_updated_at();


--
-- Name: spa_appointments update_spa_appointments_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_spa_appointments_updated_at BEFORE UPDATE ON public.spa_appointments FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: spa_inventory update_spa_inventory_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_spa_inventory_updated_at BEFORE UPDATE ON public.spa_inventory FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: spa_service_packages update_spa_service_packages_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_spa_service_packages_updated_at BEFORE UPDATE ON public.spa_service_packages FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: spa_services update_spa_services_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_spa_services_updated_at BEFORE UPDATE ON public.spa_services FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: sports_courts update_sports_courts_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_sports_courts_updated_at BEFORE UPDATE ON public.sports_courts FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: sports_equipment update_sports_equipment_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_sports_equipment_updated_at BEFORE UPDATE ON public.sports_equipment FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: staff_certifications update_staff_certifications_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_staff_certifications_updated_at BEFORE UPDATE ON public.staff_certifications FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: staff_performance_analytics update_staff_performance_analytics_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_staff_performance_analytics_updated_at BEFORE UPDATE ON public.staff_performance_analytics FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: staff_schedules update_staff_schedules_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_staff_schedules_updated_at BEFORE UPDATE ON public.staff_schedules FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: subscribers update_subscribers_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_subscribers_updated_at BEFORE UPDATE ON public.subscribers FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: support_tickets update_support_tickets_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_support_tickets_updated_at BEFORE UPDATE ON public.support_tickets FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: swim_lesson_enrollments update_swim_lesson_enrollments_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_swim_lesson_enrollments_updated_at BEFORE UPDATE ON public.swim_lesson_enrollments FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: swim_lessons update_swim_lessons_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_swim_lessons_updated_at BEFORE UPDATE ON public.swim_lessons FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: therapist_availability update_therapist_availability_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_therapist_availability_updated_at BEFORE UPDATE ON public.therapist_availability FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: time_entries update_time_entries_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_time_entries_updated_at BEFORE UPDATE ON public.time_entries FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: tournaments update_tournaments_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_tournaments_updated_at BEFORE UPDATE ON public.tournaments FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: towel_cleaning_logs update_towel_cleaning_logs_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_towel_cleaning_logs_updated_at BEFORE UPDATE ON public.towel_cleaning_logs FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: towel_rentals update_towel_inventory_quantities_trigger; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_towel_inventory_quantities_trigger AFTER INSERT OR UPDATE ON public.towel_rentals FOR EACH ROW EXECUTE FUNCTION public.update_towel_inventory_quantities();


--
-- Name: towel_inventory update_towel_inventory_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_towel_inventory_updated_at BEFORE UPDATE ON public.towel_inventory FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: towel_rentals update_towel_rentals_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_towel_rentals_updated_at BEFORE UPDATE ON public.towel_rentals FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: trainer_availability update_trainer_availability_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_trainer_availability_updated_at BEFORE UPDATE ON public.trainer_availability FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: training_packages update_training_packages_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_training_packages_updated_at BEFORE UPDATE ON public.training_packages FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: vendors update_vendors_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_vendors_updated_at BEFORE UPDATE ON public.vendors FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: water_quality_logs update_water_quality_logs_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_water_quality_logs_updated_at BEFORE UPDATE ON public.water_quality_logs FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: webhook_endpoints update_webhook_endpoints_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER update_webhook_endpoints_updated_at BEFORE UPDATE ON public.webhook_endpoints FOR EACH ROW EXECUTE FUNCTION public.update_integration_updated_at();


--
-- Name: subscription tr_check_filters; Type: TRIGGER; Schema: realtime; Owner: supabase_admin
--

CREATE TRIGGER tr_check_filters BEFORE INSERT OR UPDATE ON realtime.subscription FOR EACH ROW EXECUTE FUNCTION realtime.subscription_check_filters();


--
-- Name: buckets enforce_bucket_name_length_trigger; Type: TRIGGER; Schema: storage; Owner: supabase_storage_admin
--

CREATE TRIGGER enforce_bucket_name_length_trigger BEFORE INSERT OR UPDATE OF name ON storage.buckets FOR EACH ROW EXECUTE FUNCTION storage.enforce_bucket_name_length();


--
-- Name: objects objects_delete_delete_prefix; Type: TRIGGER; Schema: storage; Owner: supabase_storage_admin
--

CREATE TRIGGER objects_delete_delete_prefix AFTER DELETE ON storage.objects FOR EACH ROW EXECUTE FUNCTION storage.delete_prefix_hierarchy_trigger();


--
-- Name: objects objects_insert_create_prefix; Type: TRIGGER; Schema: storage; Owner: supabase_storage_admin
--

CREATE TRIGGER objects_insert_create_prefix BEFORE INSERT ON storage.objects FOR EACH ROW EXECUTE FUNCTION storage.objects_insert_prefix_trigger();


--
-- Name: objects objects_update_create_prefix; Type: TRIGGER; Schema: storage; Owner: supabase_storage_admin
--

CREATE TRIGGER objects_update_create_prefix BEFORE UPDATE ON storage.objects FOR EACH ROW WHEN (((new.name <> old.name) OR (new.bucket_id <> old.bucket_id))) EXECUTE FUNCTION storage.objects_update_prefix_trigger();


--
-- Name: prefixes prefixes_create_hierarchy; Type: TRIGGER; Schema: storage; Owner: supabase_storage_admin
--

CREATE TRIGGER prefixes_create_hierarchy BEFORE INSERT ON storage.prefixes FOR EACH ROW WHEN ((pg_trigger_depth() < 1)) EXECUTE FUNCTION storage.prefixes_insert_trigger();


--
-- Name: prefixes prefixes_delete_hierarchy; Type: TRIGGER; Schema: storage; Owner: supabase_storage_admin
--

CREATE TRIGGER prefixes_delete_hierarchy AFTER DELETE ON storage.prefixes FOR EACH ROW EXECUTE FUNCTION storage.delete_prefix_hierarchy_trigger();


--
-- Name: objects update_objects_updated_at; Type: TRIGGER; Schema: storage; Owner: supabase_storage_admin
--

CREATE TRIGGER update_objects_updated_at BEFORE UPDATE ON storage.objects FOR EACH ROW EXECUTE FUNCTION storage.update_updated_at_column();


--
-- Name: identities identities_user_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE ONLY auth.identities
    ADD CONSTRAINT identities_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id) ON DELETE CASCADE;


--
-- Name: mfa_amr_claims mfa_amr_claims_session_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE ONLY auth.mfa_amr_claims
    ADD CONSTRAINT mfa_amr_claims_session_id_fkey FOREIGN KEY (session_id) REFERENCES auth.sessions(id) ON DELETE CASCADE;


--
-- Name: mfa_challenges mfa_challenges_auth_factor_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE ONLY auth.mfa_challenges
    ADD CONSTRAINT mfa_challenges_auth_factor_id_fkey FOREIGN KEY (factor_id) REFERENCES auth.mfa_factors(id) ON DELETE CASCADE;


--
-- Name: mfa_factors mfa_factors_user_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE ONLY auth.mfa_factors
    ADD CONSTRAINT mfa_factors_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id) ON DELETE CASCADE;


--
-- Name: oauth_authorizations oauth_authorizations_client_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE ONLY auth.oauth_authorizations
    ADD CONSTRAINT oauth_authorizations_client_id_fkey FOREIGN KEY (client_id) REFERENCES auth.oauth_clients(id) ON DELETE CASCADE;


--
-- Name: oauth_authorizations oauth_authorizations_user_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE ONLY auth.oauth_authorizations
    ADD CONSTRAINT oauth_authorizations_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id) ON DELETE CASCADE;


--
-- Name: oauth_consents oauth_consents_client_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE ONLY auth.oauth_consents
    ADD CONSTRAINT oauth_consents_client_id_fkey FOREIGN KEY (client_id) REFERENCES auth.oauth_clients(id) ON DELETE CASCADE;


--
-- Name: oauth_consents oauth_consents_user_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE ONLY auth.oauth_consents
    ADD CONSTRAINT oauth_consents_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id) ON DELETE CASCADE;


--
-- Name: one_time_tokens one_time_tokens_user_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE ONLY auth.one_time_tokens
    ADD CONSTRAINT one_time_tokens_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id) ON DELETE CASCADE;


--
-- Name: refresh_tokens refresh_tokens_session_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE ONLY auth.refresh_tokens
    ADD CONSTRAINT refresh_tokens_session_id_fkey FOREIGN KEY (session_id) REFERENCES auth.sessions(id) ON DELETE CASCADE;


--
-- Name: saml_providers saml_providers_sso_provider_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE ONLY auth.saml_providers
    ADD CONSTRAINT saml_providers_sso_provider_id_fkey FOREIGN KEY (sso_provider_id) REFERENCES auth.sso_providers(id) ON DELETE CASCADE;


--
-- Name: saml_relay_states saml_relay_states_flow_state_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE ONLY auth.saml_relay_states
    ADD CONSTRAINT saml_relay_states_flow_state_id_fkey FOREIGN KEY (flow_state_id) REFERENCES auth.flow_state(id) ON DELETE CASCADE;


--
-- Name: saml_relay_states saml_relay_states_sso_provider_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE ONLY auth.saml_relay_states
    ADD CONSTRAINT saml_relay_states_sso_provider_id_fkey FOREIGN KEY (sso_provider_id) REFERENCES auth.sso_providers(id) ON DELETE CASCADE;


--
-- Name: sessions sessions_oauth_client_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE ONLY auth.sessions
    ADD CONSTRAINT sessions_oauth_client_id_fkey FOREIGN KEY (oauth_client_id) REFERENCES auth.oauth_clients(id) ON DELETE CASCADE;


--
-- Name: sessions sessions_user_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE ONLY auth.sessions
    ADD CONSTRAINT sessions_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id) ON DELETE CASCADE;


--
-- Name: sso_domains sso_domains_sso_provider_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE ONLY auth.sso_domains
    ADD CONSTRAINT sso_domains_sso_provider_id_fkey FOREIGN KEY (sso_provider_id) REFERENCES auth.sso_providers(id) ON DELETE CASCADE;


--
-- Name: ai_model_settings ai_model_settings_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.ai_model_settings
    ADD CONSTRAINT ai_model_settings_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id);


--
-- Name: ai_model_settings ai_model_settings_organization_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.ai_model_settings
    ADD CONSTRAINT ai_model_settings_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id) ON DELETE CASCADE;


--
-- Name: announcements announcements_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.announcements
    ADD CONSTRAINT announcements_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.profiles(id);


--
-- Name: announcements announcements_organization_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.announcements
    ADD CONSTRAINT announcements_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id) ON DELETE CASCADE;


--
-- Name: blog_auto_generation_settings blog_auto_generation_settings_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.blog_auto_generation_settings
    ADD CONSTRAINT blog_auto_generation_settings_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id);


--
-- Name: blog_auto_generation_settings blog_auto_generation_settings_organization_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.blog_auto_generation_settings
    ADD CONSTRAINT blog_auto_generation_settings_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id) ON DELETE CASCADE;


--
-- Name: blog_generation_queue blog_generation_queue_blog_post_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.blog_generation_queue
    ADD CONSTRAINT blog_generation_queue_blog_post_id_fkey FOREIGN KEY (blog_post_id) REFERENCES public.blog_posts(id) ON DELETE SET NULL;


--
-- Name: blog_generation_queue blog_generation_queue_organization_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.blog_generation_queue
    ADD CONSTRAINT blog_generation_queue_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id) ON DELETE CASCADE;


--
-- Name: blog_post_tags blog_post_tags_post_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.blog_post_tags
    ADD CONSTRAINT blog_post_tags_post_id_fkey FOREIGN KEY (post_id) REFERENCES public.blog_posts(id) ON DELETE CASCADE;


--
-- Name: blog_post_tags blog_post_tags_tag_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.blog_post_tags
    ADD CONSTRAINT blog_post_tags_tag_id_fkey FOREIGN KEY (tag_id) REFERENCES public.blog_tags(id) ON DELETE CASCADE;


--
-- Name: blog_posts blog_posts_category_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.blog_posts
    ADD CONSTRAINT blog_posts_category_id_fkey FOREIGN KEY (category_id) REFERENCES public.blog_categories(id) ON DELETE SET NULL;


--
-- Name: blog_topic_history blog_topic_history_blog_post_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.blog_topic_history
    ADD CONSTRAINT blog_topic_history_blog_post_id_fkey FOREIGN KEY (blog_post_id) REFERENCES public.blog_posts(id) ON DELETE CASCADE;


--
-- Name: blog_topic_history blog_topic_history_organization_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.blog_topic_history
    ADD CONSTRAINT blog_topic_history_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id) ON DELETE CASCADE;


--
-- Name: check_ins check_ins_lead_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.check_ins
    ADD CONSTRAINT check_ins_lead_id_fkey FOREIGN KEY (lead_id) REFERENCES public.leads(id);


--
-- Name: check_ins check_ins_location_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.check_ins
    ADD CONSTRAINT check_ins_location_id_fkey FOREIGN KEY (location_id) REFERENCES public.locations(id) ON DELETE CASCADE;


--
-- Name: check_ins check_ins_member_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.check_ins
    ADD CONSTRAINT check_ins_member_id_fkey FOREIGN KEY (member_id) REFERENCES public.profiles(id) ON DELETE CASCADE;


--
-- Name: childcare_activity_registrations childcare_activity_registrations_activity_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.childcare_activity_registrations
    ADD CONSTRAINT childcare_activity_registrations_activity_id_fkey FOREIGN KEY (activity_id) REFERENCES public.childcare_activities(id) ON DELETE CASCADE;


--
-- Name: childcare_activity_registrations childcare_activity_registrations_child_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.childcare_activity_registrations
    ADD CONSTRAINT childcare_activity_registrations_child_id_fkey FOREIGN KEY (child_id) REFERENCES public.child_profiles(id) ON DELETE CASCADE;


--
-- Name: childcare_checkins childcare_checkins_activity_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.childcare_checkins
    ADD CONSTRAINT childcare_checkins_activity_id_fkey FOREIGN KEY (activity_id) REFERENCES public.childcare_activities(id) ON DELETE SET NULL;


--
-- Name: childcare_checkins childcare_checkins_child_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.childcare_checkins
    ADD CONSTRAINT childcare_checkins_child_id_fkey FOREIGN KEY (child_id) REFERENCES public.child_profiles(id) ON DELETE CASCADE;


--
-- Name: childcare_daily_reports childcare_daily_reports_child_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.childcare_daily_reports
    ADD CONSTRAINT childcare_daily_reports_child_id_fkey FOREIGN KEY (child_id) REFERENCES public.child_profiles(id) ON DELETE CASCADE;


--
-- Name: class_bookings class_bookings_class_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.class_bookings
    ADD CONSTRAINT class_bookings_class_id_fkey FOREIGN KEY (class_id) REFERENCES public.classes(id) ON DELETE CASCADE;


--
-- Name: class_bookings class_bookings_member_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.class_bookings
    ADD CONSTRAINT class_bookings_member_id_fkey FOREIGN KEY (member_id) REFERENCES public.profiles(id) ON DELETE CASCADE;


--
-- Name: class_categories class_categories_organization_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.class_categories
    ADD CONSTRAINT class_categories_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id) ON DELETE CASCADE;


--
-- Name: classes classes_category_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.classes
    ADD CONSTRAINT classes_category_id_fkey FOREIGN KEY (category_id) REFERENCES public.class_categories(id) ON DELETE SET NULL;


--
-- Name: classes classes_instructor_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.classes
    ADD CONSTRAINT classes_instructor_id_fkey FOREIGN KEY (instructor_id) REFERENCES public.profiles(id) ON DELETE SET NULL;


--
-- Name: classes classes_location_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.classes
    ADD CONSTRAINT classes_location_id_fkey FOREIGN KEY (location_id) REFERENCES public.locations(id) ON DELETE CASCADE;


--
-- Name: classes classes_organization_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.classes
    ADD CONSTRAINT classes_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id) ON DELETE CASCADE;


--
-- Name: cleaning_schedules cleaning_schedules_area_fk; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.cleaning_schedules
    ADD CONSTRAINT cleaning_schedules_area_fk FOREIGN KEY (area_id) REFERENCES public.facility_areas(id) ON DELETE CASCADE;


--
-- Name: cleaning_schedules cleaning_schedules_organization_fk; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.cleaning_schedules
    ADD CONSTRAINT cleaning_schedules_organization_fk FOREIGN KEY (organization_id) REFERENCES public.organizations(id) ON DELETE CASCADE;


--
-- Name: commission_calculations commission_calculations_lead_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.commission_calculations
    ADD CONSTRAINT commission_calculations_lead_id_fkey FOREIGN KEY (lead_id) REFERENCES public.leads(id);


--
-- Name: commission_calculations commission_calculations_membership_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.commission_calculations
    ADD CONSTRAINT commission_calculations_membership_id_fkey FOREIGN KEY (membership_id) REFERENCES public.memberships(id);


--
-- Name: commission_calculations commission_calculations_salesperson_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.commission_calculations
    ADD CONSTRAINT commission_calculations_salesperson_id_fkey FOREIGN KEY (salesperson_id) REFERENCES public.profiles(id);


--
-- Name: court_reservations court_reservations_court_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.court_reservations
    ADD CONSTRAINT court_reservations_court_id_fkey FOREIGN KEY (court_id) REFERENCES public.sports_courts(id) ON DELETE CASCADE;


--
-- Name: cross_location_assignments cross_location_assignments_location_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.cross_location_assignments
    ADD CONSTRAINT cross_location_assignments_location_id_fkey FOREIGN KEY (location_id) REFERENCES public.locations(id);


--
-- Name: cross_location_transfers cross_location_transfers_from_location_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.cross_location_transfers
    ADD CONSTRAINT cross_location_transfers_from_location_id_fkey FOREIGN KEY (from_location_id) REFERENCES public.locations(id);


--
-- Name: cross_location_transfers cross_location_transfers_to_location_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.cross_location_transfers
    ADD CONSTRAINT cross_location_transfers_to_location_id_fkey FOREIGN KEY (to_location_id) REFERENCES public.locations(id);


--
-- Name: email_messages email_messages_assigned_to_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.email_messages
    ADD CONSTRAINT email_messages_assigned_to_fkey FOREIGN KEY (assigned_to) REFERENCES public.profiles(id) ON DELETE SET NULL;


--
-- Name: email_messages email_messages_thread_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.email_messages
    ADD CONSTRAINT email_messages_thread_id_fkey FOREIGN KEY (thread_id) REFERENCES public.email_threads(id) ON DELETE CASCADE;


--
-- Name: email_responses email_responses_message_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.email_responses
    ADD CONSTRAINT email_responses_message_id_fkey FOREIGN KEY (message_id) REFERENCES public.email_messages(id) ON DELETE CASCADE;


--
-- Name: email_responses email_responses_sent_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.email_responses
    ADD CONSTRAINT email_responses_sent_by_fkey FOREIGN KEY (sent_by) REFERENCES public.profiles(id) ON DELETE CASCADE;


--
-- Name: email_threads email_threads_organization_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.email_threads
    ADD CONSTRAINT email_threads_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id) ON DELETE CASCADE;


--
-- Name: equipment equipment_location_fk; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.equipment
    ADD CONSTRAINT equipment_location_fk FOREIGN KEY (location_id) REFERENCES public.locations(id) ON DELETE SET NULL;


--
-- Name: equipment equipment_organization_fk; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.equipment
    ADD CONSTRAINT equipment_organization_fk FOREIGN KEY (organization_id) REFERENCES public.organizations(id) ON DELETE CASCADE;


--
-- Name: expenses expenses_category_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.expenses
    ADD CONSTRAINT expenses_category_id_fkey FOREIGN KEY (category_id) REFERENCES public.expense_categories(id);


--
-- Name: expenses expenses_vendor_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.expenses
    ADD CONSTRAINT expenses_vendor_id_fkey FOREIGN KEY (vendor_id) REFERENCES public.expense_vendors(id);


--
-- Name: facility_areas facility_areas_location_fk; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.facility_areas
    ADD CONSTRAINT facility_areas_location_fk FOREIGN KEY (location_id) REFERENCES public.locations(id) ON DELETE CASCADE;


--
-- Name: facility_areas facility_areas_organization_fk; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.facility_areas
    ADD CONSTRAINT facility_areas_organization_fk FOREIGN KEY (organization_id) REFERENCES public.organizations(id) ON DELETE CASCADE;


--
-- Name: fitness_assessments fitness_assessments_member_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.fitness_assessments
    ADD CONSTRAINT fitness_assessments_member_id_fkey FOREIGN KEY (member_id) REFERENCES public.profiles(id) ON DELETE CASCADE;


--
-- Name: integration_logs fk_integration_logs_api_key; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.integration_logs
    ADD CONSTRAINT fk_integration_logs_api_key FOREIGN KEY (api_key_id) REFERENCES public.api_keys(id) ON DELETE CASCADE;


--
-- Name: integration_logs fk_integration_logs_integration; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.integration_logs
    ADD CONSTRAINT fk_integration_logs_integration FOREIGN KEY (integration_id) REFERENCES public.integrations(id) ON DELETE CASCADE;


--
-- Name: webhook_logs fk_webhook_logs_endpoint; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.webhook_logs
    ADD CONSTRAINT fk_webhook_logs_endpoint FOREIGN KEY (webhook_endpoint_id) REFERENCES public.webhook_endpoints(id) ON DELETE CASCADE;


--
-- Name: guest_passes guest_passes_pass_type_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.guest_passes
    ADD CONSTRAINT guest_passes_pass_type_id_fkey FOREIGN KEY (pass_type_id) REFERENCES public.guest_pass_types(id);


--
-- Name: guest_passes guest_passes_purchased_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.guest_passes
    ADD CONSTRAINT guest_passes_purchased_by_fkey FOREIGN KEY (purchased_by) REFERENCES auth.users(id);


--
-- Name: incident_follow_ups incident_follow_ups_assigned_to_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.incident_follow_ups
    ADD CONSTRAINT incident_follow_ups_assigned_to_fkey FOREIGN KEY (assigned_to) REFERENCES auth.users(id);


--
-- Name: incident_follow_ups incident_follow_ups_completed_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.incident_follow_ups
    ADD CONSTRAINT incident_follow_ups_completed_by_fkey FOREIGN KEY (completed_by) REFERENCES auth.users(id);


--
-- Name: incident_follow_ups incident_follow_ups_incident_report_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.incident_follow_ups
    ADD CONSTRAINT incident_follow_ups_incident_report_id_fkey FOREIGN KEY (incident_report_id) REFERENCES public.incident_reports(id);


--
-- Name: incident_investigations incident_investigations_incident_report_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.incident_investigations
    ADD CONSTRAINT incident_investigations_incident_report_id_fkey FOREIGN KEY (incident_report_id) REFERENCES public.incident_reports(id);


--
-- Name: incident_investigations incident_investigations_investigator_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.incident_investigations
    ADD CONSTRAINT incident_investigations_investigator_id_fkey FOREIGN KEY (investigator_id) REFERENCES auth.users(id);


--
-- Name: incident_reports incident_reports_organization_fk; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.incident_reports
    ADD CONSTRAINT incident_reports_organization_fk FOREIGN KEY (organization_id) REFERENCES public.organizations(id) ON DELETE CASCADE;


--
-- Name: insurance_claims insurance_claims_incident_report_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.insurance_claims
    ADD CONSTRAINT insurance_claims_incident_report_id_fkey FOREIGN KEY (incident_report_id) REFERENCES public.incident_reports(id);


--
-- Name: inventory_items inventory_items_location_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.inventory_items
    ADD CONSTRAINT inventory_items_location_id_fkey FOREIGN KEY (location_id) REFERENCES public.locations(id);


--
-- Name: inventory_items inventory_items_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.inventory_items
    ADD CONSTRAINT inventory_items_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.retail_products(id) ON DELETE CASCADE;


--
-- Name: lead_activities lead_activities_lead_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.lead_activities
    ADD CONSTRAINT lead_activities_lead_id_fkey FOREIGN KEY (lead_id) REFERENCES public.leads(id) ON DELETE CASCADE;


--
-- Name: lead_attribution_disputes lead_attribution_disputes_current_salesperson_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.lead_attribution_disputes
    ADD CONSTRAINT lead_attribution_disputes_current_salesperson_id_fkey FOREIGN KEY (current_salesperson_id) REFERENCES public.profiles(id);


--
-- Name: lead_attribution_disputes lead_attribution_disputes_disputing_salesperson_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.lead_attribution_disputes
    ADD CONSTRAINT lead_attribution_disputes_disputing_salesperson_id_fkey FOREIGN KEY (disputing_salesperson_id) REFERENCES public.profiles(id);


--
-- Name: lead_attribution_disputes lead_attribution_disputes_lead_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.lead_attribution_disputes
    ADD CONSTRAINT lead_attribution_disputes_lead_id_fkey FOREIGN KEY (lead_id) REFERENCES public.leads(id);


--
-- Name: lead_attribution_disputes lead_attribution_disputes_reviewed_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.lead_attribution_disputes
    ADD CONSTRAINT lead_attribution_disputes_reviewed_by_fkey FOREIGN KEY (reviewed_by) REFERENCES public.profiles(id);


--
-- Name: lead_split_commissions lead_split_commissions_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.lead_split_commissions
    ADD CONSTRAINT lead_split_commissions_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.profiles(id);


--
-- Name: lead_split_commissions lead_split_commissions_lead_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.lead_split_commissions
    ADD CONSTRAINT lead_split_commissions_lead_id_fkey FOREIGN KEY (lead_id) REFERENCES public.leads(id) ON DELETE CASCADE;


--
-- Name: lead_split_commissions lead_split_commissions_salesperson_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.lead_split_commissions
    ADD CONSTRAINT lead_split_commissions_salesperson_id_fkey FOREIGN KEY (salesperson_id) REFERENCES public.profiles(id);


--
-- Name: leads leads_assigned_salesperson_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.leads
    ADD CONSTRAINT leads_assigned_salesperson_fkey FOREIGN KEY (assigned_salesperson) REFERENCES public.profiles(id);


--
-- Name: leads leads_entered_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.leads
    ADD CONSTRAINT leads_entered_by_fkey FOREIGN KEY (entered_by) REFERENCES public.profiles(id);


--
-- Name: leads leads_stage_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.leads
    ADD CONSTRAINT leads_stage_id_fkey FOREIGN KEY (stage_id) REFERENCES public.lead_stages(id);


--
-- Name: liability_waivers liability_waivers_visitor_checkin_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.liability_waivers
    ADD CONSTRAINT liability_waivers_visitor_checkin_id_fkey FOREIGN KEY (visitor_checkin_id) REFERENCES public.visitor_checkins(id);


--
-- Name: liability_waivers liability_waivers_witness_staff_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.liability_waivers
    ADD CONSTRAINT liability_waivers_witness_staff_id_fkey FOREIGN KEY (witness_staff_id) REFERENCES auth.users(id);


--
-- Name: lifeguard_schedules lifeguard_schedules_pool_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.lifeguard_schedules
    ADD CONSTRAINT lifeguard_schedules_pool_id_fkey FOREIGN KEY (pool_id) REFERENCES public.pool_facilities(id);


--
-- Name: location_analytics location_analytics_location_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.location_analytics
    ADD CONSTRAINT location_analytics_location_id_fkey FOREIGN KEY (location_id) REFERENCES public.locations(id);


--
-- Name: location_hierarchies location_hierarchies_child_location_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.location_hierarchies
    ADD CONSTRAINT location_hierarchies_child_location_id_fkey FOREIGN KEY (child_location_id) REFERENCES public.locations(id);


--
-- Name: location_hierarchies location_hierarchies_parent_location_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.location_hierarchies
    ADD CONSTRAINT location_hierarchies_parent_location_id_fkey FOREIGN KEY (parent_location_id) REFERENCES public.locations(id);


--
-- Name: locations locations_organization_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.locations
    ADD CONSTRAINT locations_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id) ON DELETE CASCADE;


--
-- Name: locker_access_log locker_access_log_locker_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.locker_access_log
    ADD CONSTRAINT locker_access_log_locker_id_fkey FOREIGN KEY (locker_id) REFERENCES public.lockers(id);


--
-- Name: locker_access_log locker_access_log_staff_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.locker_access_log
    ADD CONSTRAINT locker_access_log_staff_id_fkey FOREIGN KEY (staff_id) REFERENCES auth.users(id);


--
-- Name: locker_maintenance locker_maintenance_locker_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.locker_maintenance
    ADD CONSTRAINT locker_maintenance_locker_id_fkey FOREIGN KEY (locker_id) REFERENCES public.lockers(id);


--
-- Name: locker_maintenance locker_maintenance_performed_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.locker_maintenance
    ADD CONSTRAINT locker_maintenance_performed_by_fkey FOREIGN KEY (performed_by) REFERENCES auth.users(id);


--
-- Name: locker_rentals locker_rentals_locker_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.locker_rentals
    ADD CONSTRAINT locker_rentals_locker_id_fkey FOREIGN KEY (locker_id) REFERENCES public.lockers(id);


--
-- Name: lockers lockers_location_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.lockers
    ADD CONSTRAINT lockers_location_id_fkey FOREIGN KEY (location_id) REFERENCES public.locations(id);


--
-- Name: loyalty_program_rules loyalty_program_rules_organization_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.loyalty_program_rules
    ADD CONSTRAINT loyalty_program_rules_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id) ON DELETE CASCADE;


--
-- Name: loyalty_redemptions loyalty_redemptions_fulfilled_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.loyalty_redemptions
    ADD CONSTRAINT loyalty_redemptions_fulfilled_by_fkey FOREIGN KEY (fulfilled_by) REFERENCES public.profiles(id);


--
-- Name: loyalty_redemptions loyalty_redemptions_member_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.loyalty_redemptions
    ADD CONSTRAINT loyalty_redemptions_member_id_fkey FOREIGN KEY (member_id) REFERENCES public.profiles(id) ON DELETE CASCADE;


--
-- Name: loyalty_redemptions loyalty_redemptions_reward_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.loyalty_redemptions
    ADD CONSTRAINT loyalty_redemptions_reward_id_fkey FOREIGN KEY (reward_id) REFERENCES public.loyalty_rewards(id) ON DELETE CASCADE;


--
-- Name: loyalty_rewards loyalty_rewards_organization_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.loyalty_rewards
    ADD CONSTRAINT loyalty_rewards_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id) ON DELETE CASCADE;


--
-- Name: maintenance_logs maintenance_logs_equipment_fk; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.maintenance_logs
    ADD CONSTRAINT maintenance_logs_equipment_fk FOREIGN KEY (equipment_id) REFERENCES public.equipment(id) ON DELETE CASCADE;


--
-- Name: maintenance_logs maintenance_logs_organization_fk; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.maintenance_logs
    ADD CONSTRAINT maintenance_logs_organization_fk FOREIGN KEY (organization_id) REFERENCES public.organizations(id) ON DELETE CASCADE;


--
-- Name: maintenance_schedules maintenance_schedules_equipment_fk; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.maintenance_schedules
    ADD CONSTRAINT maintenance_schedules_equipment_fk FOREIGN KEY (equipment_id) REFERENCES public.equipment(id) ON DELETE CASCADE;


--
-- Name: maintenance_schedules maintenance_schedules_organization_fk; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.maintenance_schedules
    ADD CONSTRAINT maintenance_schedules_organization_fk FOREIGN KEY (organization_id) REFERENCES public.organizations(id) ON DELETE CASCADE;


--
-- Name: marketing_campaigns marketing_campaigns_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.marketing_campaigns
    ADD CONSTRAINT marketing_campaigns_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.profiles(id);


--
-- Name: marketing_campaigns marketing_campaigns_organization_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.marketing_campaigns
    ADD CONSTRAINT marketing_campaigns_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id) ON DELETE CASCADE;


--
-- Name: member_cards member_cards_member_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.member_cards
    ADD CONSTRAINT member_cards_member_id_fkey FOREIGN KEY (member_id) REFERENCES public.profiles(id) ON DELETE CASCADE;


--
-- Name: member_documents member_documents_member_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.member_documents
    ADD CONSTRAINT member_documents_member_id_fkey FOREIGN KEY (member_id) REFERENCES public.profiles(id) ON DELETE CASCADE;


--
-- Name: member_documents member_documents_uploaded_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.member_documents
    ADD CONSTRAINT member_documents_uploaded_by_fkey FOREIGN KEY (uploaded_by) REFERENCES public.profiles(id);


--
-- Name: member_location_access member_location_access_location_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.member_location_access
    ADD CONSTRAINT member_location_access_location_id_fkey FOREIGN KEY (location_id) REFERENCES public.locations(id);


--
-- Name: member_messages member_messages_recipient_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.member_messages
    ADD CONSTRAINT member_messages_recipient_id_fkey FOREIGN KEY (recipient_id) REFERENCES public.profiles(id) ON DELETE CASCADE;


--
-- Name: member_messages member_messages_sender_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.member_messages
    ADD CONSTRAINT member_messages_sender_id_fkey FOREIGN KEY (sender_id) REFERENCES public.profiles(id) ON DELETE CASCADE;


--
-- Name: member_milestones member_milestones_member_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.member_milestones
    ADD CONSTRAINT member_milestones_member_id_fkey FOREIGN KEY (member_id) REFERENCES public.profiles(id) ON DELETE CASCADE;


--
-- Name: member_orientations member_orientations_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.member_orientations
    ADD CONSTRAINT member_orientations_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.profiles(id);


--
-- Name: member_orientations member_orientations_member_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.member_orientations
    ADD CONSTRAINT member_orientations_member_id_fkey FOREIGN KEY (member_id) REFERENCES public.profiles(id) ON DELETE CASCADE;


--
-- Name: member_segments member_segments_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.member_segments
    ADD CONSTRAINT member_segments_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.profiles(id);


--
-- Name: member_segments member_segments_organization_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.member_segments
    ADD CONSTRAINT member_segments_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id) ON DELETE CASCADE;


--
-- Name: membership_agreements membership_agreements_member_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.membership_agreements
    ADD CONSTRAINT membership_agreements_member_id_fkey FOREIGN KEY (member_id) REFERENCES public.profiles(id) ON DELETE CASCADE;


--
-- Name: membership_agreements membership_agreements_template_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.membership_agreements
    ADD CONSTRAINT membership_agreements_template_id_fkey FOREIGN KEY (template_id) REFERENCES public.membership_agreement_templates(id);


--
-- Name: membership_agreements membership_agreements_witness_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.membership_agreements
    ADD CONSTRAINT membership_agreements_witness_id_fkey FOREIGN KEY (witness_id) REFERENCES public.profiles(id);


--
-- Name: membership_plans membership_plans_organization_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.membership_plans
    ADD CONSTRAINT membership_plans_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id) ON DELETE CASCADE;


--
-- Name: memberships memberships_member_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.memberships
    ADD CONSTRAINT memberships_member_id_fkey FOREIGN KEY (member_id) REFERENCES public.profiles(id) ON DELETE CASCADE;


--
-- Name: memberships memberships_plan_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.memberships
    ADD CONSTRAINT memberships_plan_id_fkey FOREIGN KEY (plan_id) REFERENCES public.membership_plans(id) ON DELETE CASCADE;


--
-- Name: payment_transactions payment_transactions_member_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.payment_transactions
    ADD CONSTRAINT payment_transactions_member_id_fkey FOREIGN KEY (member_id) REFERENCES public.profiles(id) ON DELETE CASCADE;


--
-- Name: payment_transactions payment_transactions_membership_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.payment_transactions
    ADD CONSTRAINT payment_transactions_membership_id_fkey FOREIGN KEY (membership_id) REFERENCES public.memberships(id);


--
-- Name: payment_transactions payment_transactions_processed_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.payment_transactions
    ADD CONSTRAINT payment_transactions_processed_by_fkey FOREIGN KEY (processed_by) REFERENCES public.profiles(id);


--
-- Name: payroll_periods payroll_periods_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.payroll_periods
    ADD CONSTRAINT payroll_periods_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.profiles(id);


--
-- Name: payroll_periods payroll_periods_organization_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.payroll_periods
    ADD CONSTRAINT payroll_periods_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id) ON DELETE CASCADE;


--
-- Name: personal_training_sessions personal_training_sessions_member_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.personal_training_sessions
    ADD CONSTRAINT personal_training_sessions_member_id_fkey FOREIGN KEY (member_id) REFERENCES public.profiles(id);


--
-- Name: personal_training_sessions personal_training_sessions_trainer_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.personal_training_sessions
    ADD CONSTRAINT personal_training_sessions_trainer_id_fkey FOREIGN KEY (trainer_id) REFERENCES public.profiles(id);


--
-- Name: pool_facilities pool_facilities_location_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.pool_facilities
    ADD CONSTRAINT pool_facilities_location_id_fkey FOREIGN KEY (location_id) REFERENCES public.locations(id);


--
-- Name: pool_lane_reservations pool_lane_reservations_pool_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.pool_lane_reservations
    ADD CONSTRAINT pool_lane_reservations_pool_id_fkey FOREIGN KEY (pool_id) REFERENCES public.pool_facilities(id) ON DELETE CASCADE;


--
-- Name: pool_maintenance_logs pool_maintenance_logs_pool_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.pool_maintenance_logs
    ADD CONSTRAINT pool_maintenance_logs_pool_id_fkey FOREIGN KEY (pool_id) REFERENCES public.pool_facilities(id);


--
-- Name: pos_sale_items pos_sale_items_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.pos_sale_items
    ADD CONSTRAINT pos_sale_items_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.pos_products(id);


--
-- Name: pos_sale_items pos_sale_items_sale_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.pos_sale_items
    ADD CONSTRAINT pos_sale_items_sale_id_fkey FOREIGN KEY (sale_id) REFERENCES public.pos_sales(id) ON DELETE CASCADE;


--
-- Name: profiles profiles_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.profiles
    ADD CONSTRAINT profiles_id_fkey FOREIGN KEY (id) REFERENCES auth.users(id) ON DELETE CASCADE;


--
-- Name: profiles profiles_location_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.profiles
    ADD CONSTRAINT profiles_location_id_fkey FOREIGN KEY (location_id) REFERENCES public.locations(id) ON DELETE SET NULL;


--
-- Name: profiles profiles_organization_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.profiles
    ADD CONSTRAINT profiles_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id) ON DELETE CASCADE;


--
-- Name: profiles profiles_parent_member_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.profiles
    ADD CONSTRAINT profiles_parent_member_id_fkey FOREIGN KEY (parent_member_id) REFERENCES public.profiles(id);


--
-- Name: retail_transaction_items retail_transaction_items_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.retail_transaction_items
    ADD CONSTRAINT retail_transaction_items_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.retail_products(id);


--
-- Name: retail_transaction_items retail_transaction_items_transaction_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.retail_transaction_items
    ADD CONSTRAINT retail_transaction_items_transaction_id_fkey FOREIGN KEY (transaction_id) REFERENCES public.retail_transactions(id) ON DELETE CASCADE;


--
-- Name: retail_transactions retail_transactions_location_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.retail_transactions
    ADD CONSTRAINT retail_transactions_location_id_fkey FOREIGN KEY (location_id) REFERENCES public.locations(id);


--
-- Name: salesperson_commissions salesperson_commissions_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.salesperson_commissions
    ADD CONSTRAINT salesperson_commissions_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.profiles(id);


--
-- Name: salesperson_commissions salesperson_commissions_salesperson_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.salesperson_commissions
    ADD CONSTRAINT salesperson_commissions_salesperson_id_fkey FOREIGN KEY (salesperson_id) REFERENCES public.profiles(id);


--
-- Name: salesperson_referral_links salesperson_referral_links_salesperson_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.salesperson_referral_links
    ADD CONSTRAINT salesperson_referral_links_salesperson_id_fkey FOREIGN KEY (salesperson_id) REFERENCES public.profiles(id);


--
-- Name: sms_campaign_recipients sms_campaign_recipients_campaign_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.sms_campaign_recipients
    ADD CONSTRAINT sms_campaign_recipients_campaign_id_fkey FOREIGN KEY (campaign_id) REFERENCES public.sms_campaigns(id) ON DELETE CASCADE;


--
-- Name: social_media_automation_logs social_media_automation_logs_blog_post_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.social_media_automation_logs
    ADD CONSTRAINT social_media_automation_logs_blog_post_id_fkey FOREIGN KEY (blog_post_id) REFERENCES public.blog_posts(id) ON DELETE CASCADE;


--
-- Name: social_media_automation_logs social_media_automation_logs_organization_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.social_media_automation_logs
    ADD CONSTRAINT social_media_automation_logs_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id) ON DELETE CASCADE;


--
-- Name: social_media_automation_settings social_media_automation_settings_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.social_media_automation_settings
    ADD CONSTRAINT social_media_automation_settings_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id);


--
-- Name: social_media_automation_settings social_media_automation_settings_organization_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.social_media_automation_settings
    ADD CONSTRAINT social_media_automation_settings_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id) ON DELETE CASCADE;


--
-- Name: spa_appointments spa_appointments_service_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.spa_appointments
    ADD CONSTRAINT spa_appointments_service_id_fkey FOREIGN KEY (service_id) REFERENCES public.spa_services(id) ON DELETE RESTRICT;


--
-- Name: sports_courts sports_courts_location_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.sports_courts
    ADD CONSTRAINT sports_courts_location_id_fkey FOREIGN KEY (location_id) REFERENCES public.locations(id);


--
-- Name: sports_equipment sports_equipment_location_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.sports_equipment
    ADD CONSTRAINT sports_equipment_location_id_fkey FOREIGN KEY (location_id) REFERENCES public.locations(id);


--
-- Name: staff_schedules staff_schedules_organization_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.staff_schedules
    ADD CONSTRAINT staff_schedules_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id) ON DELETE CASCADE;


--
-- Name: staff_schedules staff_schedules_staff_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.staff_schedules
    ADD CONSTRAINT staff_schedules_staff_id_fkey FOREIGN KEY (staff_id) REFERENCES public.profiles(id) ON DELETE CASCADE;


--
-- Name: stock_movements stock_movements_inventory_item_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.stock_movements
    ADD CONSTRAINT stock_movements_inventory_item_id_fkey FOREIGN KEY (inventory_item_id) REFERENCES public.inventory_items(id) ON DELETE CASCADE;


--
-- Name: stock_movements stock_movements_transaction_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.stock_movements
    ADD CONSTRAINT stock_movements_transaction_id_fkey FOREIGN KEY (transaction_id) REFERENCES public.retail_transactions(id);


--
-- Name: subscribers subscribers_membership_plan_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.subscribers
    ADD CONSTRAINT subscribers_membership_plan_id_fkey FOREIGN KEY (membership_plan_id) REFERENCES public.membership_plans(id);


--
-- Name: subscribers subscribers_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.subscribers
    ADD CONSTRAINT subscribers_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id) ON DELETE CASCADE;


--
-- Name: support_tickets support_tickets_assigned_to_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.support_tickets
    ADD CONSTRAINT support_tickets_assigned_to_fkey FOREIGN KEY (assigned_to) REFERENCES public.profiles(id);


--
-- Name: support_tickets support_tickets_member_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.support_tickets
    ADD CONSTRAINT support_tickets_member_id_fkey FOREIGN KEY (member_id) REFERENCES public.profiles(id) ON DELETE CASCADE;


--
-- Name: support_tickets support_tickets_organization_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.support_tickets
    ADD CONSTRAINT support_tickets_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id) ON DELETE CASCADE;


--
-- Name: swim_lesson_enrollments swim_lesson_enrollments_lesson_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.swim_lesson_enrollments
    ADD CONSTRAINT swim_lesson_enrollments_lesson_id_fkey FOREIGN KEY (lesson_id) REFERENCES public.swim_lessons(id) ON DELETE CASCADE;


--
-- Name: swim_lessons swim_lessons_pool_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.swim_lessons
    ADD CONSTRAINT swim_lessons_pool_id_fkey FOREIGN KEY (pool_id) REFERENCES public.pool_facilities(id);


--
-- Name: time_entries time_entries_approved_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.time_entries
    ADD CONSTRAINT time_entries_approved_by_fkey FOREIGN KEY (approved_by) REFERENCES public.profiles(id);


--
-- Name: time_entries time_entries_organization_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.time_entries
    ADD CONSTRAINT time_entries_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id) ON DELETE CASCADE;


--
-- Name: time_entries time_entries_staff_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.time_entries
    ADD CONSTRAINT time_entries_staff_id_fkey FOREIGN KEY (staff_id) REFERENCES public.profiles(id) ON DELETE CASCADE;


--
-- Name: tournament_participants tournament_participants_tournament_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.tournament_participants
    ADD CONSTRAINT tournament_participants_tournament_id_fkey FOREIGN KEY (tournament_id) REFERENCES public.tournaments(id) ON DELETE CASCADE;


--
-- Name: vendors vendors_organization_fk; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.vendors
    ADD CONSTRAINT vendors_organization_fk FOREIGN KEY (organization_id) REFERENCES public.organizations(id) ON DELETE CASCADE;


--
-- Name: visitor_checkins visitor_checkins_accompanied_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.visitor_checkins
    ADD CONSTRAINT visitor_checkins_accompanied_by_fkey FOREIGN KEY (accompanied_by) REFERENCES auth.users(id);


--
-- Name: visitor_checkins visitor_checkins_guest_pass_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.visitor_checkins
    ADD CONSTRAINT visitor_checkins_guest_pass_id_fkey FOREIGN KEY (guest_pass_id) REFERENCES public.guest_passes(id);


--
-- Name: water_quality_logs water_quality_logs_pool_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.water_quality_logs
    ADD CONSTRAINT water_quality_logs_pool_id_fkey FOREIGN KEY (pool_id) REFERENCES public.pool_facilities(id);


--
-- Name: objects objects_bucketId_fkey; Type: FK CONSTRAINT; Schema: storage; Owner: supabase_storage_admin
--

ALTER TABLE ONLY storage.objects
    ADD CONSTRAINT "objects_bucketId_fkey" FOREIGN KEY (bucket_id) REFERENCES storage.buckets(id);


--
-- Name: prefixes prefixes_bucketId_fkey; Type: FK CONSTRAINT; Schema: storage; Owner: supabase_storage_admin
--

ALTER TABLE ONLY storage.prefixes
    ADD CONSTRAINT "prefixes_bucketId_fkey" FOREIGN KEY (bucket_id) REFERENCES storage.buckets(id);


--
-- Name: s3_multipart_uploads s3_multipart_uploads_bucket_id_fkey; Type: FK CONSTRAINT; Schema: storage; Owner: supabase_storage_admin
--

ALTER TABLE ONLY storage.s3_multipart_uploads
    ADD CONSTRAINT s3_multipart_uploads_bucket_id_fkey FOREIGN KEY (bucket_id) REFERENCES storage.buckets(id);


--
-- Name: s3_multipart_uploads_parts s3_multipart_uploads_parts_bucket_id_fkey; Type: FK CONSTRAINT; Schema: storage; Owner: supabase_storage_admin
--

ALTER TABLE ONLY storage.s3_multipart_uploads_parts
    ADD CONSTRAINT s3_multipart_uploads_parts_bucket_id_fkey FOREIGN KEY (bucket_id) REFERENCES storage.buckets(id);


--
-- Name: s3_multipart_uploads_parts s3_multipart_uploads_parts_upload_id_fkey; Type: FK CONSTRAINT; Schema: storage; Owner: supabase_storage_admin
--

ALTER TABLE ONLY storage.s3_multipart_uploads_parts
    ADD CONSTRAINT s3_multipart_uploads_parts_upload_id_fkey FOREIGN KEY (upload_id) REFERENCES storage.s3_multipart_uploads(id) ON DELETE CASCADE;


--
-- Name: vector_indexes vector_indexes_bucket_id_fkey; Type: FK CONSTRAINT; Schema: storage; Owner: supabase_storage_admin
--

ALTER TABLE ONLY storage.vector_indexes
    ADD CONSTRAINT vector_indexes_bucket_id_fkey FOREIGN KEY (bucket_id) REFERENCES storage.buckets_vectors(id);


--
-- Name: audit_log_entries; Type: ROW SECURITY; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE auth.audit_log_entries ENABLE ROW LEVEL SECURITY;

--
-- Name: flow_state; Type: ROW SECURITY; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE auth.flow_state ENABLE ROW LEVEL SECURITY;

--
-- Name: identities; Type: ROW SECURITY; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE auth.identities ENABLE ROW LEVEL SECURITY;

--
-- Name: instances; Type: ROW SECURITY; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE auth.instances ENABLE ROW LEVEL SECURITY;

--
-- Name: mfa_amr_claims; Type: ROW SECURITY; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE auth.mfa_amr_claims ENABLE ROW LEVEL SECURITY;

--
-- Name: mfa_challenges; Type: ROW SECURITY; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE auth.mfa_challenges ENABLE ROW LEVEL SECURITY;

--
-- Name: mfa_factors; Type: ROW SECURITY; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE auth.mfa_factors ENABLE ROW LEVEL SECURITY;

--
-- Name: one_time_tokens; Type: ROW SECURITY; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE auth.one_time_tokens ENABLE ROW LEVEL SECURITY;

--
-- Name: refresh_tokens; Type: ROW SECURITY; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE auth.refresh_tokens ENABLE ROW LEVEL SECURITY;

--
-- Name: saml_providers; Type: ROW SECURITY; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE auth.saml_providers ENABLE ROW LEVEL SECURITY;

--
-- Name: saml_relay_states; Type: ROW SECURITY; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE auth.saml_relay_states ENABLE ROW LEVEL SECURITY;

--
-- Name: schema_migrations; Type: ROW SECURITY; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE auth.schema_migrations ENABLE ROW LEVEL SECURITY;

--
-- Name: sessions; Type: ROW SECURITY; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE auth.sessions ENABLE ROW LEVEL SECURITY;

--
-- Name: sso_domains; Type: ROW SECURITY; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE auth.sso_domains ENABLE ROW LEVEL SECURITY;

--
-- Name: sso_providers; Type: ROW SECURITY; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE auth.sso_providers ENABLE ROW LEVEL SECURITY;

--
-- Name: users; Type: ROW SECURITY; Schema: auth; Owner: supabase_auth_admin
--

ALTER TABLE auth.users ENABLE ROW LEVEL SECURITY;

--
-- Name: early_access_requests Anyone can submit early access requests; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Anyone can submit early access requests" ON public.early_access_requests FOR INSERT WITH CHECK (true);


--
-- Name: blog_categories Categories are publicly readable; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Categories are publicly readable" ON public.blog_categories FOR SELECT USING (true);


--
-- Name: subscribers Edge functions can insert subscriptions; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Edge functions can insert subscriptions" ON public.subscribers FOR INSERT WITH CHECK (true);


--
-- Name: subscribers Edge functions can update subscriptions; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Edge functions can update subscriptions" ON public.subscribers FOR UPDATE USING (true);


--
-- Name: instructor_availability Instructors can manage their own availability; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Instructors can manage their own availability" ON public.instructor_availability USING (((instructor_id = auth.uid()) OR (EXISTS ( SELECT 1
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])) AND (profiles.organization_id = ( SELECT profiles_1.organization_id
           FROM public.profiles profiles_1
          WHERE (profiles_1.id = instructor_availability.instructor_id))))))));


--
-- Name: lifeguard_schedules Lifeguards can view their schedules; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Lifeguards can view their schedules" ON public.lifeguard_schedules FOR SELECT USING (((lifeguard_id = auth.uid()) OR (organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])))))));


--
-- Name: kpi_metrics Managers can manage KPI metrics; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Managers can manage KPI metrics" ON public.kpi_metrics USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role]))))));


--
-- Name: certification_requirements Managers can manage certification requirements; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Managers can manage certification requirements" ON public.certification_requirements USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role]))))));


--
-- Name: location_analytics Managers can manage location analytics; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Managers can manage location analytics" ON public.location_analytics USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role]))))));


--
-- Name: location_hierarchies Managers can manage location hierarchies; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Managers can manage location hierarchies" ON public.location_hierarchies USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role]))))));


--
-- Name: member_cohorts Managers can manage member cohorts; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Managers can manage member cohorts" ON public.member_cohorts USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role]))))));


--
-- Name: payroll_periods Managers can manage payroll periods; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Managers can manage payroll periods" ON public.payroll_periods USING ((EXISTS ( SELECT 1
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.organization_id = payroll_periods.organization_id) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role]))))));


--
-- Name: cross_location_assignments Managers can manage staff assignments; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Managers can manage staff assignments" ON public.cross_location_assignments USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role]))))));


--
-- Name: staff_performance_analytics Managers can manage staff performance analytics; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Managers can manage staff performance analytics" ON public.staff_performance_analytics USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role]))))));


--
-- Name: cross_location_transfers Managers can manage transfers; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Managers can manage transfers" ON public.cross_location_transfers USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role]))))));


--
-- Name: spa_appointments Members can book spa appointments; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can book spa appointments" ON public.spa_appointments FOR INSERT WITH CHECK (((member_id = auth.uid()) AND (organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE (profiles.id = auth.uid())))));


--
-- Name: personal_training_sessions Members can book training sessions; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can book training sessions" ON public.personal_training_sessions FOR INSERT WITH CHECK (((member_id = auth.uid()) AND (organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE (profiles.id = auth.uid())))));


--
-- Name: member_feedback Members can create and view their own feedback; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can create and view their own feedback" ON public.member_feedback USING (((member_id = auth.uid()) OR (EXISTS ( SELECT 1
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])) AND (profiles.organization_id = ( SELECT profiles_1.organization_id
           FROM public.profiles profiles_1
          WHERE (profiles_1.id = member_feedback.member_id))))))));


--
-- Name: pool_lane_reservations Members can create lane reservations; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can create lane reservations" ON public.pool_lane_reservations FOR INSERT WITH CHECK (((member_id = auth.uid()) AND (organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE (profiles.id = auth.uid())))));


--
-- Name: member_referrals Members can create referrals; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can create referrals" ON public.member_referrals FOR INSERT WITH CHECK ((referrer_id = auth.uid()));


--
-- Name: court_reservations Members can create reservations; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can create reservations" ON public.court_reservations FOR INSERT WITH CHECK (((member_id = auth.uid()) AND (organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE (profiles.id = auth.uid())))));


--
-- Name: fitness_assessments Members can create their own assessments; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can create their own assessments" ON public.fitness_assessments FOR INSERT WITH CHECK ((member_id = auth.uid()));


--
-- Name: member_orientations Members can create their own orientations; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can create their own orientations" ON public.member_orientations FOR INSERT WITH CHECK ((member_id = auth.uid()));


--
-- Name: loyalty_redemptions Members can create their own redemptions; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can create their own redemptions" ON public.loyalty_redemptions FOR INSERT WITH CHECK ((member_id = auth.uid()));


--
-- Name: swim_lesson_enrollments Members can enroll in lessons; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can enroll in lessons" ON public.swim_lesson_enrollments FOR INSERT WITH CHECK ((member_id = auth.uid()));


--
-- Name: class_waitlists Members can join waitlists; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can join waitlists" ON public.class_waitlists FOR INSERT WITH CHECK (((member_id = auth.uid()) AND (EXISTS ( SELECT 1
   FROM public.classes
  WHERE ((classes.id = class_waitlists.class_id) AND (classes.organization_id = ( SELECT profiles.organization_id
           FROM public.profiles
          WHERE (profiles.id = auth.uid()))))))));


--
-- Name: class_bookings Members can manage their own bookings; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can manage their own bookings" ON public.class_bookings USING (((member_id = auth.uid()) OR (( SELECT profiles.organization_id
   FROM public.profiles
  WHERE (profiles.id = class_bookings.member_id)) IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role, 'trainer'::public.user_role])))))));


--
-- Name: notification_preferences Members can manage their own notification preferences; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can manage their own notification preferences" ON public.notification_preferences USING ((member_id = auth.uid()));


--
-- Name: support_tickets Members can manage their own tickets; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can manage their own tickets" ON public.support_tickets USING ((member_id = auth.uid()));


--
-- Name: tournament_participants Members can register for tournaments; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can register for tournaments" ON public.tournament_participants FOR INSERT WITH CHECK (((member_id = auth.uid()) AND (tournament_id IN ( SELECT tournaments.id
   FROM public.tournaments
  WHERE (tournaments.organization_id IN ( SELECT profiles.organization_id
           FROM public.profiles
          WHERE (profiles.id = auth.uid())))))));


--
-- Name: retail_products Members can view active products; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can view active products" ON public.retail_products FOR SELECT USING (((is_active = true) AND (organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE (profiles.id = auth.uid())))));


--
-- Name: spa_service_packages Members can view active spa packages; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can view active spa packages" ON public.spa_service_packages FOR SELECT USING (((is_active = true) AND (organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE (profiles.id = auth.uid())))));


--
-- Name: spa_services Members can view active spa services; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can view active spa services" ON public.spa_services FOR SELECT USING (((is_active = true) AND (organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE (profiles.id = auth.uid())))));


--
-- Name: sports_courts Members can view available courts; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can view available courts" ON public.sports_courts FOR SELECT USING (((is_available = true) AND (is_out_of_order = false) AND (organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE (profiles.id = auth.uid())))));


--
-- Name: sports_equipment Members can view available equipment; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can view available equipment" ON public.sports_equipment FOR SELECT USING (((is_available_for_rental = true) AND (current_condition <> 'out_of_service'::text) AND (organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE (profiles.id = auth.uid())))));


--
-- Name: lockers Members can view available lockers; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can view available lockers" ON public.lockers FOR SELECT USING (((is_available = true) AND (is_out_of_order = false) AND (organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE (profiles.id = auth.uid())))));


--
-- Name: pool_facilities Members can view available pools; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can view available pools" ON public.pool_facilities FOR SELECT USING (((is_available = true) AND (is_closed_for_maintenance = false) AND (organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE (profiles.id = auth.uid())))));


--
-- Name: loyalty_rewards Members can view available rewards; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can view available rewards" ON public.loyalty_rewards FOR SELECT USING (((is_active = true) AND (organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE (profiles.id = auth.uid())))));


--
-- Name: childcare_activities Members can view childcare activities; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can view childcare activities" ON public.childcare_activities FOR SELECT USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE (profiles.id = auth.uid()))));


--
-- Name: guest_passes Members can view passes they purchased; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can view passes they purchased" ON public.guest_passes FOR SELECT USING (((purchased_by = auth.uid()) OR (organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])))))));


--
-- Name: swim_lessons Members can view swim lessons; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can view swim lessons" ON public.swim_lessons FOR SELECT USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE (profiles.id = auth.uid()))));


--
-- Name: campaign_executions Members can view their campaign executions; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can view their campaign executions" ON public.campaign_executions FOR SELECT USING (((member_id = auth.uid()) OR (EXISTS ( SELECT 1
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])) AND (profiles.organization_id = ( SELECT profiles_1.organization_id
           FROM public.profiles profiles_1
          WHERE (profiles_1.id = campaign_executions.member_id))))))));


--
-- Name: corporate_members Members can view their corporate info; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can view their corporate info" ON public.corporate_members FOR SELECT USING ((member_id = auth.uid()));


--
-- Name: member_location_access Members can view their location access; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can view their location access" ON public.member_location_access FOR SELECT USING (((member_id = auth.uid()) OR (organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])))))));


--
-- Name: locker_access_log Members can view their own access logs; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can view their own access logs" ON public.locker_access_log FOR SELECT USING (((member_id = auth.uid()) OR (organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])))))));


--
-- Name: membership_agreements Members can view their own agreements; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can view their own agreements" ON public.membership_agreements FOR SELECT USING (((member_id = auth.uid()) OR (EXISTS ( SELECT 1
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.organization_id = ( SELECT profiles_1.organization_id
           FROM public.profiles profiles_1
          WHERE (profiles_1.id = membership_agreements.member_id))) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])))))));


--
-- Name: fitness_assessments Members can view their own assessments; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can view their own assessments" ON public.fitness_assessments FOR SELECT USING (((member_id = auth.uid()) OR (EXISTS ( SELECT 1
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role, 'trainer'::public.user_role])) AND (profiles.organization_id = ( SELECT profiles_1.organization_id
           FROM public.profiles profiles_1
          WHERE (profiles_1.id = fitness_assessments.member_id))))))));


--
-- Name: member_cards Members can view their own cards; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can view their own cards" ON public.member_cards FOR SELECT USING (((member_id = auth.uid()) OR (EXISTS ( SELECT 1
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.organization_id = ( SELECT profiles_1.organization_id
           FROM public.profiles profiles_1
          WHERE (profiles_1.id = member_cards.member_id))) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])))))));


--
-- Name: check_ins Members can view their own check-ins; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can view their own check-ins" ON public.check_ins FOR SELECT USING ((((member_id = auth.uid()) AND (is_guest = false)) OR (location_id IN ( SELECT locations.id
   FROM public.locations
  WHERE (locations.organization_id IN ( SELECT profiles.organization_id
           FROM public.profiles
          WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])))))))));


--
-- Name: equipment_checkout Members can view their own checkouts; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can view their own checkouts" ON public.equipment_checkout FOR SELECT USING (((member_id = auth.uid()) OR (organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])))))));


--
-- Name: member_documents Members can view their own documents; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can view their own documents" ON public.member_documents FOR SELECT USING (((member_id = auth.uid()) OR (EXISTS ( SELECT 1
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.organization_id = ( SELECT profiles_1.organization_id
           FROM public.profiles profiles_1
          WHERE (profiles_1.id = member_documents.member_id))) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])))))));


--
-- Name: member_engagement_history Members can view their own engagement history; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can view their own engagement history" ON public.member_engagement_history FOR SELECT USING (((member_id = auth.uid()) OR (EXISTS ( SELECT 1
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])) AND (profiles.organization_id = ( SELECT profiles_1.organization_id
           FROM public.profiles profiles_1
          WHERE (profiles_1.id = member_engagement_history.member_id))))))));


--
-- Name: swim_lesson_enrollments Members can view their own enrollments; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can view their own enrollments" ON public.swim_lesson_enrollments FOR SELECT USING (((member_id = auth.uid()) OR (lesson_id IN ( SELECT swim_lessons.id
   FROM public.swim_lessons
  WHERE (swim_lessons.organization_id IN ( SELECT profiles.organization_id
           FROM public.profiles
          WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])))))))));


--
-- Name: loyalty_points Members can view their own loyalty points; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can view their own loyalty points" ON public.loyalty_points FOR SELECT USING (((member_id = auth.uid()) OR (EXISTS ( SELECT 1
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])) AND (profiles.organization_id = ( SELECT profiles_1.organization_id
           FROM public.profiles profiles_1
          WHERE (profiles_1.id = loyalty_points.member_id))))))));


--
-- Name: memberships Members can view their own memberships; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can view their own memberships" ON public.memberships FOR SELECT USING (((member_id = auth.uid()) OR (( SELECT profiles.organization_id
   FROM public.profiles
  WHERE (profiles.id = memberships.member_id)) IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])))))));


--
-- Name: member_milestones Members can view their own milestones; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can view their own milestones" ON public.member_milestones FOR SELECT USING (((member_id = auth.uid()) OR (EXISTS ( SELECT 1
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])) AND (profiles.organization_id = ( SELECT profiles_1.organization_id
           FROM public.profiles profiles_1
          WHERE (profiles_1.id = member_milestones.member_id))))))));


--
-- Name: notifications Members can view their own notifications; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can view their own notifications" ON public.notifications FOR SELECT USING ((member_id = auth.uid()));


--
-- Name: member_orientations Members can view their own orientations; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can view their own orientations" ON public.member_orientations FOR SELECT USING (((member_id = auth.uid()) OR (EXISTS ( SELECT 1
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role, 'trainer'::public.user_role])) AND (profiles.organization_id = ( SELECT profiles_1.organization_id
           FROM public.profiles profiles_1
          WHERE (profiles_1.id = member_orientations.member_id))))))));


--
-- Name: loyalty_redemptions Members can view their own redemptions; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can view their own redemptions" ON public.loyalty_redemptions FOR SELECT USING (((member_id = auth.uid()) OR (EXISTS ( SELECT 1
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])) AND (profiles.organization_id = ( SELECT profiles_1.organization_id
           FROM public.profiles profiles_1
          WHERE (profiles_1.id = loyalty_redemptions.member_id))))))));


--
-- Name: member_referrals Members can view their own referrals; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can view their own referrals" ON public.member_referrals FOR SELECT USING (((referrer_id = auth.uid()) OR (EXISTS ( SELECT 1
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])) AND (profiles.organization_id = ( SELECT profiles_1.organization_id
           FROM public.profiles profiles_1
          WHERE (profiles_1.id = member_referrals.referrer_id))))))));


--
-- Name: locker_rentals Members can view their own rentals; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can view their own rentals" ON public.locker_rentals FOR SELECT USING (((member_id = auth.uid()) OR (organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])))))));


--
-- Name: court_reservations Members can view their own reservations; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can view their own reservations" ON public.court_reservations FOR SELECT USING (((member_id = auth.uid()) OR (organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])))))));


--
-- Name: pool_lane_reservations Members can view their own reservations; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can view their own reservations" ON public.pool_lane_reservations FOR SELECT USING (((member_id = auth.uid()) OR (organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])))))));


--
-- Name: spa_appointments Members can view their own spa appointments; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can view their own spa appointments" ON public.spa_appointments FOR SELECT USING (((member_id = auth.uid()) OR (therapist_id = auth.uid()) OR (organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])))))));


--
-- Name: towel_rentals Members can view their own towel rentals; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can view their own towel rentals" ON public.towel_rentals FOR SELECT USING (((member_id = auth.uid()) OR (organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])))))));


--
-- Name: member_training_packages Members can view their own training packages; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can view their own training packages" ON public.member_training_packages FOR SELECT USING (((member_id = auth.uid()) OR (EXISTS ( SELECT 1
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])) AND (profiles.organization_id = ( SELECT profiles_1.organization_id
           FROM public.profiles profiles_1
          WHERE (profiles_1.id = member_training_packages.member_id))))))));


--
-- Name: personal_training_sessions Members can view their own training sessions; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can view their own training sessions" ON public.personal_training_sessions FOR SELECT USING (((member_id = auth.uid()) OR (trainer_id = auth.uid()) OR (organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])))))));


--
-- Name: payment_transactions Members can view their own transactions; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can view their own transactions" ON public.payment_transactions FOR SELECT USING (((member_id = auth.uid()) OR (EXISTS ( SELECT 1
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.organization_id = ( SELECT profiles_1.organization_id
           FROM public.profiles profiles_1
          WHERE (profiles_1.id = payment_transactions.member_id))) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])))))));


--
-- Name: retail_transactions Members can view their own transactions; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can view their own transactions" ON public.retail_transactions FOR SELECT USING (((member_id = auth.uid()) OR (organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])))))));


--
-- Name: class_waitlists Members can view their own waitlist entries; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can view their own waitlist entries" ON public.class_waitlists FOR SELECT USING (((member_id = auth.uid()) OR (EXISTS ( SELECT 1
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role, 'trainer'::public.user_role])) AND (profiles.organization_id = ( SELECT profiles_1.organization_id
           FROM public.profiles profiles_1
          WHERE (profiles_1.id = class_waitlists.member_id))))))));


--
-- Name: therapist_availability Members can view therapist availability; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can view therapist availability" ON public.therapist_availability FOR SELECT USING (((is_available = true) AND (organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE (profiles.id = auth.uid())))));


--
-- Name: tournament_matches Members can view tournament matches; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can view tournament matches" ON public.tournament_matches FOR SELECT USING ((tournament_id IN ( SELECT tournaments.id
   FROM public.tournaments
  WHERE (tournaments.organization_id IN ( SELECT profiles.organization_id
           FROM public.profiles
          WHERE (profiles.id = auth.uid()))))));


--
-- Name: tournament_participants Members can view tournament participants; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can view tournament participants" ON public.tournament_participants FOR SELECT USING ((tournament_id IN ( SELECT tournaments.id
   FROM public.tournaments
  WHERE (tournaments.organization_id IN ( SELECT profiles.organization_id
           FROM public.profiles
          WHERE (profiles.id = auth.uid()))))));


--
-- Name: tournaments Members can view tournaments; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can view tournaments" ON public.tournaments FOR SELECT USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE (profiles.id = auth.uid()))));


--
-- Name: towel_inventory Members can view towel inventory; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Members can view towel inventory" ON public.towel_inventory FOR SELECT USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE (profiles.id = auth.uid()))));


--
-- Name: ai_model_settings Organization owners can manage AI settings; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Organization owners can manage AI settings" ON public.ai_model_settings USING (((organization_id = public.get_user_organization_id(auth.uid())) AND (EXISTS ( SELECT 1
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'owner'::public.user_role))))));


--
-- Name: blog_generation_queue Organization owners can manage blog queue; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Organization owners can manage blog queue" ON public.blog_generation_queue USING (((organization_id = public.get_user_organization_id(auth.uid())) AND (EXISTS ( SELECT 1
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'owner'::public.user_role))))));


--
-- Name: blog_auto_generation_settings Organization owners can manage blog settings; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Organization owners can manage blog settings" ON public.blog_auto_generation_settings USING (((organization_id = public.get_user_organization_id(auth.uid())) AND (EXISTS ( SELECT 1
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'owner'::public.user_role))))));


--
-- Name: social_media_automation_settings Organization owners can manage social settings; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Organization owners can manage social settings" ON public.social_media_automation_settings USING (((organization_id = public.get_user_organization_id(auth.uid())) AND (EXISTS ( SELECT 1
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'owner'::public.user_role))))));


--
-- Name: ai_model_settings Organizations can view their AI settings; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Organizations can view their AI settings" ON public.ai_model_settings FOR SELECT USING ((organization_id = public.get_user_organization_id(auth.uid())));


--
-- Name: daily_analytics_snapshots Organizations can view their analytics snapshots; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Organizations can view their analytics snapshots" ON public.daily_analytics_snapshots FOR SELECT USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE (profiles.id = auth.uid()))));


--
-- Name: blog_generation_queue Organizations can view their blog queue; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Organizations can view their blog queue" ON public.blog_generation_queue FOR SELECT USING ((organization_id = public.get_user_organization_id(auth.uid())));


--
-- Name: blog_auto_generation_settings Organizations can view their blog settings; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Organizations can view their blog settings" ON public.blog_auto_generation_settings FOR SELECT USING ((organization_id = public.get_user_organization_id(auth.uid())));


--
-- Name: social_media_automation_logs Organizations can view their social logs; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Organizations can view their social logs" ON public.social_media_automation_logs FOR SELECT USING ((organization_id = public.get_user_organization_id(auth.uid())));


--
-- Name: social_media_automation_settings Organizations can view their social settings; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Organizations can view their social settings" ON public.social_media_automation_settings FOR SELECT USING ((organization_id = public.get_user_organization_id(auth.uid())));


--
-- Name: blog_topic_history Organizations can view their topic history; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Organizations can view their topic history" ON public.blog_topic_history FOR SELECT USING ((organization_id = public.get_user_organization_id(auth.uid())));


--
-- Name: email_threads Owners can manage email threads; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Owners can manage email threads" ON public.email_threads USING (((organization_id = ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE (profiles.id = auth.uid()))) AND (( SELECT profiles.role
   FROM public.profiles
  WHERE (profiles.id = auth.uid())) = 'owner'::public.user_role)));


--
-- Name: child_profiles Parents and staff can update child profiles; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Parents and staff can update child profiles" ON public.child_profiles FOR UPDATE USING (((parent_member_id = auth.uid()) OR (organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])))))));


--
-- Name: child_profiles Parents can create child profiles; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Parents can create child profiles" ON public.child_profiles FOR INSERT WITH CHECK (((parent_member_id = auth.uid()) AND (organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE (profiles.id = auth.uid())))));


--
-- Name: childcare_activity_registrations Parents can register their children; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Parents can register their children" ON public.childcare_activity_registrations USING (((parent_member_id = auth.uid()) OR (organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])))))));


--
-- Name: childcare_checkins Parents can view their children check-ins; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Parents can view their children check-ins" ON public.childcare_checkins FOR SELECT USING (((parent_member_id = auth.uid()) OR (organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])))))));


--
-- Name: childcare_daily_reports Parents can view their children reports; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Parents can view their children reports" ON public.childcare_daily_reports FOR SELECT USING (((child_id IN ( SELECT child_profiles.id
   FROM public.child_profiles
  WHERE (child_profiles.parent_member_id = auth.uid()))) OR (organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])))))));


--
-- Name: child_profiles Parents can view their own children profiles; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Parents can view their own children profiles" ON public.child_profiles FOR SELECT USING (((parent_member_id = auth.uid()) OR (organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])))))));


--
-- Name: payroll_periods Payroll periods are viewable by managers; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Payroll periods are viewable by managers" ON public.payroll_periods FOR SELECT USING ((EXISTS ( SELECT 1
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.organization_id = payroll_periods.organization_id) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role]))))));


--
-- Name: blog_post_tags Post tags are publicly readable; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Post tags are publicly readable" ON public.blog_post_tags FOR SELECT USING (true);


--
-- Name: blog_posts Public can view published posts; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Public can view published posts" ON public.blog_posts FOR SELECT USING (((status = 'published'::text) AND (published_at IS NOT NULL) AND (published_at <= now())));


--
-- Name: salesperson_commissions Salespeople can view their own commissions; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Salespeople can view their own commissions" ON public.salesperson_commissions FOR SELECT USING ((salesperson_id = auth.uid()));


--
-- Name: commission_calculations Salespeople can view their own commissions calc; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Salespeople can view their own commissions calc" ON public.commission_calculations FOR SELECT USING ((salesperson_id = auth.uid()));


--
-- Name: salesperson_referral_links Salespeople can view their own referral links; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Salespeople can view their own referral links" ON public.salesperson_referral_links FOR SELECT USING ((salesperson_id = auth.uid()));


--
-- Name: classes Staff and instructors can manage classes; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff and instructors can manage classes" ON public.classes USING (((instructor_id = auth.uid()) OR (organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])))))));


--
-- Name: swim_lessons Staff and instructors can manage swim lessons; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff and instructors can manage swim lessons" ON public.swim_lessons USING (((instructor_id = auth.uid()) OR (organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])))))));


--
-- Name: email_responses Staff can create email responses; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can create email responses" ON public.email_responses FOR INSERT WITH CHECK (((message_id IN ( SELECT em.id
   FROM (public.email_messages em
     JOIN public.email_threads et ON ((em.thread_id = et.id)))
  WHERE (et.organization_id = ( SELECT profiles.organization_id
           FROM public.profiles
          WHERE (profiles.id = auth.uid()))))) AND (( SELECT profiles.role
   FROM public.profiles
  WHERE (profiles.id = auth.uid())) = ANY (ARRAY['owner'::public.user_role, 'staff'::public.user_role]))));


--
-- Name: message_history Staff can create message history; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can create message history" ON public.message_history FOR INSERT WITH CHECK (((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))) AND (sent_by = auth.uid())));


--
-- Name: time_entries Staff can create their own time entries; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can create their own time entries" ON public.time_entries FOR INSERT WITH CHECK (((staff_id = auth.uid()) AND (EXISTS ( SELECT 1
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.organization_id = time_entries.organization_id))))));


--
-- Name: cross_location_transfers Staff can create transfer requests; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can create transfer requests" ON public.cross_location_transfers FOR INSERT WITH CHECK (((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))) AND (initiated_by = auth.uid())));


--
-- Name: profiles Staff can insert profiles; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can insert profiles" ON public.profiles FOR INSERT WITH CHECK ((organization_id IN ( SELECT profiles_1.organization_id
   FROM public.profiles profiles_1
  WHERE ((profiles_1.id = auth.uid()) AND (profiles_1.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: api_keys Staff can manage API keys in their organization; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage API keys in their organization" ON public.api_keys USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: pos_products Staff can manage POS products; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage POS products" ON public.pos_products USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: pos_sales Staff can manage POS sales; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage POS sales" ON public.pos_sales USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: sms_campaigns Staff can manage SMS campaigns; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage SMS campaigns" ON public.sms_campaigns USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: locker_access_log Staff can manage access logs; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage access logs" ON public.locker_access_log USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: membership_agreement_templates Staff can manage agreement templates; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage agreement templates" ON public.membership_agreement_templates USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: membership_agreements Staff can manage agreements; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage agreements" ON public.membership_agreements USING ((EXISTS ( SELECT 1
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.organization_id = ( SELECT profiles_1.organization_id
           FROM public.profiles profiles_1
          WHERE (profiles_1.id = membership_agreements.member_id))) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: check_ins Staff can manage all check-ins; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage all check-ins" ON public.check_ins USING ((location_id IN ( SELECT locations.id
   FROM public.locations
  WHERE (locations.organization_id IN ( SELECT profiles.organization_id
           FROM public.profiles
          WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))))));


--
-- Name: childcare_checkins Staff can manage all check-ins; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage all check-ins" ON public.childcare_checkins USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: member_messages Staff can manage all messages; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage all messages" ON public.member_messages USING ((EXISTS ( SELECT 1
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])) AND (profiles.organization_id IN ( SELECT sender_profile.organization_id
           FROM public.profiles sender_profile
          WHERE (sender_profile.id = member_messages.sender_id)
        UNION
         SELECT recipient_profile.organization_id
           FROM public.profiles recipient_profile
          WHERE (recipient_profile.id = member_messages.recipient_id)))))));


--
-- Name: notifications Staff can manage all notifications in their organization; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage all notifications in their organization" ON public.notifications USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: court_reservations Staff can manage all reservations; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage all reservations" ON public.court_reservations USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: support_tickets Staff can manage all tickets; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage all tickets" ON public.support_tickets USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: daily_analytics_snapshots Staff can manage analytics snapshots; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage analytics snapshots" ON public.daily_analytics_snapshots USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: announcements Staff can manage announcements; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage announcements" ON public.announcements USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: fitness_assessments Staff can manage assessments; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage assessments" ON public.fitness_assessments USING ((EXISTS ( SELECT 1
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role, 'trainer'::public.user_role])) AND (profiles.organization_id = ( SELECT profiles_1.organization_id
           FROM public.profiles profiles_1
          WHERE (profiles_1.id = fitness_assessments.member_id)))))));


--
-- Name: lead_attribution_disputes Staff can manage attribution disputes; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage attribution disputes" ON public.lead_attribution_disputes USING ((lead_id IN ( SELECT leads.id
   FROM public.leads
  WHERE (leads.organization_id IN ( SELECT profiles.organization_id
           FROM public.profiles
          WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))))));


--
-- Name: blog_posts Staff can manage blog posts; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage blog posts" ON public.blog_posts USING ((EXISTS ( SELECT 1
   FROM public.profiles p
  WHERE ((p.id = auth.uid()) AND (p.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])))))) WITH CHECK ((EXISTS ( SELECT 1
   FROM public.profiles p
  WHERE ((p.id = auth.uid()) AND (p.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: bulk_member_operations Staff can manage bulk operations; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage bulk operations" ON public.bulk_member_operations USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: campaign_executions Staff can manage campaign executions; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage campaign executions" ON public.campaign_executions USING ((EXISTS ( SELECT 1
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])) AND (profiles.organization_id = ( SELECT profiles_1.organization_id
           FROM public.profiles profiles_1
          WHERE (profiles_1.id = campaign_executions.member_id)))))));


--
-- Name: blog_categories Staff can manage categories; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage categories" ON public.blog_categories USING ((EXISTS ( SELECT 1
   FROM public.profiles p
  WHERE ((p.id = auth.uid()) AND (p.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])))))) WITH CHECK ((EXISTS ( SELECT 1
   FROM public.profiles p
  WHERE ((p.id = auth.uid()) AND (p.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: inspection_checklist_items Staff can manage checklist items; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage checklist items" ON public.inspection_checklist_items USING ((checklist_id IN ( SELECT inspection_checklists.id
   FROM public.inspection_checklists
  WHERE (inspection_checklists.organization_id IN ( SELECT profiles.organization_id
           FROM public.profiles
          WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))))));


--
-- Name: inspection_checklists Staff can manage checklists in their organization; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage checklists in their organization" ON public.inspection_checklists USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: child_profiles Staff can manage child profiles; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage child profiles" ON public.child_profiles FOR DELETE USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role]))))));


--
-- Name: childcare_activities Staff can manage childcare activities; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage childcare activities" ON public.childcare_activities USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: class_analytics Staff can manage class analytics; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage class analytics" ON public.class_analytics USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role]))))));


--
-- Name: class_categories Staff can manage class categories; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage class categories" ON public.class_categories USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: towel_cleaning_logs Staff can manage cleaning logs; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage cleaning logs" ON public.towel_cleaning_logs USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: cleaning_schedules Staff can manage cleaning schedules; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage cleaning schedules" ON public.cleaning_schedules USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: commission_calculations Staff can manage commission calculations; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage commission calculations" ON public.commission_calculations USING ((lead_id IN ( SELECT leads.id
   FROM public.leads
  WHERE (leads.organization_id IN ( SELECT profiles.organization_id
           FROM public.profiles
          WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))))));


--
-- Name: communication_providers Staff can manage communication providers; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage communication providers" ON public.communication_providers USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: communication_templates Staff can manage communication templates; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage communication templates" ON public.communication_templates USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: corporate_accounts Staff can manage corporate accounts; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage corporate accounts" ON public.corporate_accounts USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: corporate_invoices Staff can manage corporate invoices; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage corporate invoices" ON public.corporate_invoices USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: corporate_members Staff can manage corporate members; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage corporate members" ON public.corporate_members USING ((corporate_account_id IN ( SELECT corporate_accounts.id
   FROM public.corporate_accounts
  WHERE (corporate_accounts.organization_id IN ( SELECT profiles.organization_id
           FROM public.profiles
          WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))))));


--
-- Name: corporate_membership_plans Staff can manage corporate plans; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage corporate plans" ON public.corporate_membership_plans USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: cost_allocations Staff can manage cost allocations; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage cost allocations" ON public.cost_allocations USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: childcare_daily_reports Staff can manage daily reports; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage daily reports" ON public.childcare_daily_reports USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: department_budgets Staff can manage department budgets; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage department budgets" ON public.department_budgets USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: department_revenues Staff can manage department revenues; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage department revenues" ON public.department_revenues USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: early_access_requests Staff can manage early access requests; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage early access requests" ON public.early_access_requests USING ((EXISTS ( SELECT 1
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: email_messages Staff can manage email messages; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage email messages" ON public.email_messages USING (((thread_id IN ( SELECT email_threads.id
   FROM public.email_threads
  WHERE (email_threads.organization_id = ( SELECT profiles.organization_id
           FROM public.profiles
          WHERE (profiles.id = auth.uid()))))) AND (( SELECT profiles.role
   FROM public.profiles
  WHERE (profiles.id = auth.uid())) = ANY (ARRAY['owner'::public.user_role, 'staff'::public.user_role]))));


--
-- Name: email_templates Staff can manage email templates; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage email templates" ON public.email_templates USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: member_engagement_history Staff can manage engagement history; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage engagement history" ON public.member_engagement_history USING ((EXISTS ( SELECT 1
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])) AND (profiles.organization_id = ( SELECT profiles_1.organization_id
           FROM public.profiles profiles_1
          WHERE (profiles_1.id = member_engagement_history.member_id)))))));


--
-- Name: swim_lesson_enrollments Staff can manage enrollments; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage enrollments" ON public.swim_lesson_enrollments USING ((lesson_id IN ( SELECT swim_lessons.id
   FROM public.swim_lessons
  WHERE (swim_lessons.organization_id IN ( SELECT profiles.organization_id
           FROM public.profiles
          WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))))));


--
-- Name: equipment Staff can manage equipment; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage equipment" ON public.equipment USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: equipment_checkout Staff can manage equipment checkouts; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage equipment checkouts" ON public.equipment_checkout USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: expense_categories Staff can manage expense categories; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage expense categories" ON public.expense_categories USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: expense_vendors Staff can manage expense vendors; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage expense vendors" ON public.expense_vendors USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: expenses Staff can manage expenses; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage expenses" ON public.expenses USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: facility_areas Staff can manage facility areas; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage facility areas" ON public.facility_areas USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: facility_tours Staff can manage facility tours; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage facility tours" ON public.facility_tours USING ((lead_id IN ( SELECT leads.id
   FROM public.leads
  WHERE (leads.organization_id IN ( SELECT profiles.organization_id
           FROM public.profiles
          WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))))));


--
-- Name: guest_pass_types Staff can manage guest pass types; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage guest pass types" ON public.guest_pass_types USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: guest_passes Staff can manage guest passes; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage guest passes" ON public.guest_passes USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: incident_follow_ups Staff can manage incident follow-ups; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage incident follow-ups" ON public.incident_follow_ups USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: incident_investigations Staff can manage incident investigations; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage incident investigations" ON public.incident_investigations USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: incident_reports Staff can manage incident reports; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage incident reports" ON public.incident_reports USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: inspection_results Staff can manage inspection results; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage inspection results" ON public.inspection_results USING ((inspection_id IN ( SELECT safety_inspections.id
   FROM public.safety_inspections
  WHERE (safety_inspections.organization_id IN ( SELECT profiles.organization_id
           FROM public.profiles
          WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))))));


--
-- Name: safety_inspections Staff can manage inspections in their organization; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage inspections in their organization" ON public.safety_inspections USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: insurance_claims Staff can manage insurance claims; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage insurance claims" ON public.insurance_claims USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: integrations Staff can manage integrations in their organization; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage integrations in their organization" ON public.integrations USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: inventory_items Staff can manage inventory; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage inventory" ON public.inventory_items USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: corporate_invoice_items Staff can manage invoice items; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage invoice items" ON public.corporate_invoice_items USING ((invoice_id IN ( SELECT corporate_invoices.id
   FROM public.corporate_invoices
  WHERE (corporate_invoices.organization_id IN ( SELECT profiles.organization_id
           FROM public.profiles
          WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))))));


--
-- Name: pool_lane_reservations Staff can manage lane reservations; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage lane reservations" ON public.pool_lane_reservations USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: lead_activities Staff can manage lead activities; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage lead activities" ON public.lead_activities USING ((lead_id IN ( SELECT leads.id
   FROM public.leads
  WHERE (leads.organization_id IN ( SELECT profiles.organization_id
           FROM public.profiles
          WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))))));


--
-- Name: lead_scoring_rules Staff can manage lead scoring rules; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage lead scoring rules" ON public.lead_scoring_rules USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: lead_sources Staff can manage lead sources; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage lead sources" ON public.lead_sources USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: lead_stages Staff can manage lead stages; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage lead stages" ON public.lead_stages USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: leads Staff can manage leads; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage leads" ON public.leads USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: liability_waivers Staff can manage liability waivers; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage liability waivers" ON public.liability_waivers USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: lifeguard_schedules Staff can manage lifeguard schedules; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage lifeguard schedules" ON public.lifeguard_schedules USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: locker_maintenance Staff can manage locker maintenance; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage locker maintenance" ON public.locker_maintenance USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: locker_rentals Staff can manage locker rentals; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage locker rentals" ON public.locker_rentals USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: lockers Staff can manage lockers; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage lockers" ON public.lockers USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: loyalty_points Staff can manage loyalty points; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage loyalty points" ON public.loyalty_points USING ((EXISTS ( SELECT 1
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])) AND (profiles.organization_id = ( SELECT profiles_1.organization_id
           FROM public.profiles profiles_1
          WHERE (profiles_1.id = loyalty_points.member_id)))))));


--
-- Name: loyalty_rewards Staff can manage loyalty rewards; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage loyalty rewards" ON public.loyalty_rewards USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: loyalty_program_rules Staff can manage loyalty rules; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage loyalty rules" ON public.loyalty_program_rules USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: maintenance_logs Staff can manage maintenance logs; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage maintenance logs" ON public.maintenance_logs USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: pool_maintenance_logs Staff can manage maintenance logs; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage maintenance logs" ON public.pool_maintenance_logs USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: maintenance_schedules Staff can manage maintenance schedules; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage maintenance schedules" ON public.maintenance_schedules USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: marketing_analytics Staff can manage marketing analytics; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage marketing analytics" ON public.marketing_analytics USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role]))))));


--
-- Name: marketing_campaigns Staff can manage marketing campaigns; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage marketing campaigns" ON public.marketing_campaigns USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: member_analytics_snapshots Staff can manage member analytics; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage member analytics" ON public.member_analytics_snapshots USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role]))))));


--
-- Name: member_cards Staff can manage member cards; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage member cards" ON public.member_cards USING ((EXISTS ( SELECT 1
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.organization_id = ( SELECT profiles_1.organization_id
           FROM public.profiles profiles_1
          WHERE (profiles_1.id = member_cards.member_id))) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: member_documents Staff can manage member documents; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage member documents" ON public.member_documents USING ((EXISTS ( SELECT 1
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.organization_id = ( SELECT profiles_1.organization_id
           FROM public.profiles profiles_1
          WHERE (profiles_1.id = member_documents.member_id))) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: member_location_access Staff can manage member location access; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage member location access" ON public.member_location_access USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: member_referrals Staff can manage member referrals; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage member referrals" ON public.member_referrals USING ((EXISTS ( SELECT 1
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])) AND (profiles.organization_id = ( SELECT profiles_1.organization_id
           FROM public.profiles profiles_1
          WHERE (profiles_1.id = member_referrals.referrer_id)))))));


--
-- Name: member_segments Staff can manage member segments; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage member segments" ON public.member_segments USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: member_training_packages Staff can manage member training packages; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage member training packages" ON public.member_training_packages USING ((EXISTS ( SELECT 1
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])) AND (profiles.organization_id = ( SELECT profiles_1.organization_id
           FROM public.profiles profiles_1
          WHERE (profiles_1.id = member_training_packages.member_id)))))));


--
-- Name: membership_plans Staff can manage membership plans; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage membership plans" ON public.membership_plans USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: memberships Staff can manage memberships; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage memberships" ON public.memberships USING ((( SELECT profiles.organization_id
   FROM public.profiles
  WHERE (profiles.id = memberships.member_id)) IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: member_milestones Staff can manage milestones; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage milestones" ON public.member_milestones USING ((EXISTS ( SELECT 1
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])) AND (profiles.organization_id = ( SELECT profiles_1.organization_id
           FROM public.profiles profiles_1
          WHERE (profiles_1.id = member_milestones.member_id)))))));


--
-- Name: notification_templates Staff can manage notification templates; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage notification templates" ON public.notification_templates USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: organization_commission_settings Staff can manage org commission settings; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage org commission settings" ON public.organization_commission_settings USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role]))))));


--
-- Name: member_orientations Staff can manage orientations; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage orientations" ON public.member_orientations USING ((EXISTS ( SELECT 1
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role, 'trainer'::public.user_role])) AND (profiles.organization_id = ( SELECT profiles_1.organization_id
           FROM public.profiles profiles_1
          WHERE (profiles_1.id = member_orientations.member_id)))))));


--
-- Name: pool_maintenance_logs Staff can manage pool maintenance logs; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage pool maintenance logs" ON public.pool_maintenance_logs USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: pool_maintenance_schedules Staff can manage pool maintenance schedules; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage pool maintenance schedules" ON public.pool_maintenance_schedules USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: pool_facilities Staff can manage pools; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage pools" ON public.pool_facilities USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: blog_post_tags Staff can manage post tags; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage post tags" ON public.blog_post_tags USING ((EXISTS ( SELECT 1
   FROM public.profiles p
  WHERE ((p.id = auth.uid()) AND (p.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])))))) WITH CHECK ((EXISTS ( SELECT 1
   FROM public.profiles p
  WHERE ((p.id = auth.uid()) AND (p.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: promotions Staff can manage promotions; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage promotions" ON public.promotions USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: quote_line_items Staff can manage quote line items; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage quote line items" ON public.quote_line_items USING ((quote_id IN ( SELECT sales_quotes.id
   FROM public.sales_quotes
  WHERE (sales_quotes.lead_id IN ( SELECT leads.id
           FROM public.leads
          WHERE (leads.organization_id IN ( SELECT profiles.organization_id
                   FROM public.profiles
                  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))))))));


--
-- Name: loyalty_redemptions Staff can manage redemptions; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage redemptions" ON public.loyalty_redemptions USING ((EXISTS ( SELECT 1
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])) AND (profiles.organization_id = ( SELECT profiles_1.organization_id
           FROM public.profiles profiles_1
          WHERE (profiles_1.id = loyalty_redemptions.member_id)))))));


--
-- Name: salesperson_referral_links Staff can manage referral links; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage referral links" ON public.salesperson_referral_links USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: referral_programs Staff can manage referral programs; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage referral programs" ON public.referral_programs USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: retail_products Staff can manage retail products; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage retail products" ON public.retail_products USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: retention_campaigns Staff can manage retention campaigns; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage retention campaigns" ON public.retention_campaigns USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: revenue_analytics Staff can manage revenue analytics; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage revenue analytics" ON public.revenue_analytics USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role]))))));


--
-- Name: sales_quotes Staff can manage sales quotes; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage sales quotes" ON public.sales_quotes USING ((lead_id IN ( SELECT leads.id
   FROM public.leads
  WHERE (leads.organization_id IN ( SELECT profiles.organization_id
           FROM public.profiles
          WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))))));


--
-- Name: salesperson_commissions Staff can manage salesperson commissions; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage salesperson commissions" ON public.salesperson_commissions USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: spa_inventory Staff can manage spa inventory; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage spa inventory" ON public.spa_inventory USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: spa_service_packages Staff can manage spa packages; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage spa packages" ON public.spa_service_packages USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: spa_services Staff can manage spa services; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage spa services" ON public.spa_services USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: lead_split_commissions Staff can manage split commissions; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage split commissions" ON public.lead_split_commissions USING ((lead_id IN ( SELECT leads.id
   FROM public.leads
  WHERE (leads.organization_id IN ( SELECT profiles.organization_id
           FROM public.profiles
          WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))))));


--
-- Name: sports_courts Staff can manage sports courts; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage sports courts" ON public.sports_courts USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: sports_equipment Staff can manage sports equipment; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage sports equipment" ON public.sports_equipment USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: staff_certifications Staff can manage staff certifications; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage staff certifications" ON public.staff_certifications USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: stock_movements Staff can manage stock movements; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage stock movements" ON public.stock_movements USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: blog_tags Staff can manage tags; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage tags" ON public.blog_tags USING ((EXISTS ( SELECT 1
   FROM public.profiles p
  WHERE ((p.id = auth.uid()) AND (p.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])))))) WITH CHECK ((EXISTS ( SELECT 1
   FROM public.profiles p
  WHERE ((p.id = auth.uid()) AND (p.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: childcare_staff_schedules Staff can manage their own schedules; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage their own schedules" ON public.childcare_staff_schedules USING (((staff_id = auth.uid()) OR (organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role])))))));


--
-- Name: staff_schedules Staff can manage their own schedules; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage their own schedules" ON public.staff_schedules USING (((staff_id = auth.uid()) OR (EXISTS ( SELECT 1
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.organization_id = staff_schedules.organization_id) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role])))))));


--
-- Name: tournament_matches Staff can manage tournament matches; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage tournament matches" ON public.tournament_matches USING ((tournament_id IN ( SELECT tournaments.id
   FROM public.tournaments
  WHERE (tournaments.organization_id IN ( SELECT profiles.organization_id
           FROM public.profiles
          WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))))));


--
-- Name: tournament_participants Staff can manage tournament participants; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage tournament participants" ON public.tournament_participants USING ((tournament_id IN ( SELECT tournaments.id
   FROM public.tournaments
  WHERE (tournaments.organization_id IN ( SELECT profiles.organization_id
           FROM public.profiles
          WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))))));


--
-- Name: tournaments Staff can manage tournaments; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage tournaments" ON public.tournaments USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: towel_inventory Staff can manage towel inventory; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage towel inventory" ON public.towel_inventory USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: towel_rentals Staff can manage towel rentals; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage towel rentals" ON public.towel_rentals USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: training_packages Staff can manage training packages; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage training packages" ON public.training_packages USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: retail_transaction_items Staff can manage transaction items; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage transaction items" ON public.retail_transaction_items USING ((transaction_id IN ( SELECT retail_transactions.id
   FROM public.retail_transactions
  WHERE (retail_transactions.organization_id IN ( SELECT profiles.organization_id
           FROM public.profiles
          WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))))));


--
-- Name: payment_transactions Staff can manage transactions; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage transactions" ON public.payment_transactions USING ((EXISTS ( SELECT 1
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.organization_id = ( SELECT profiles_1.organization_id
           FROM public.profiles profiles_1
          WHERE (profiles_1.id = payment_transactions.member_id))) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: retail_transactions Staff can manage transactions; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage transactions" ON public.retail_transactions USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: vendors Staff can manage vendors; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage vendors" ON public.vendors USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: safety_violations Staff can manage violations in their organization; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage violations in their organization" ON public.safety_violations USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: visitor_checkins Staff can manage visitor checkins; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage visitor checkins" ON public.visitor_checkins USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: class_waitlists Staff can manage waitlists; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage waitlists" ON public.class_waitlists USING ((EXISTS ( SELECT 1
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role, 'trainer'::public.user_role])) AND (profiles.organization_id = ( SELECT classes.organization_id
           FROM public.classes
          WHERE (classes.id = class_waitlists.class_id)))))));


--
-- Name: water_quality_logs Staff can manage water quality logs; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage water quality logs" ON public.water_quality_logs USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: webhook_endpoints Staff can manage webhook endpoints in their organization; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can manage webhook endpoints in their organization" ON public.webhook_endpoints USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: time_entries Staff can update their own time entries; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can update their own time entries" ON public.time_entries FOR UPDATE USING (((staff_id = auth.uid()) OR (EXISTS ( SELECT 1
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.organization_id = time_entries.organization_id) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role])))))));


--
-- Name: kpi_metrics Staff can view KPI metrics; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can view KPI metrics" ON public.kpi_metrics FOR SELECT USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: pos_sale_items Staff can view POS sale items; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can view POS sale items" ON public.pos_sale_items FOR SELECT USING ((sale_id IN ( SELECT pos_sales.id
   FROM public.pos_sales
  WHERE (pos_sales.organization_id IN ( SELECT profiles.organization_id
           FROM public.profiles
          WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))))));


--
-- Name: sms_campaign_recipients Staff can view campaign recipients; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can view campaign recipients" ON public.sms_campaign_recipients FOR SELECT USING ((campaign_id IN ( SELECT sms_campaigns.id
   FROM public.sms_campaigns
  WHERE (sms_campaigns.organization_id IN ( SELECT profiles.organization_id
           FROM public.profiles
          WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))))));


--
-- Name: certification_requirements Staff can view certification requirements; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can view certification requirements" ON public.certification_requirements FOR SELECT USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE (profiles.id = auth.uid()))));


--
-- Name: inspection_checklist_items Staff can view checklist items; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can view checklist items" ON public.inspection_checklist_items FOR SELECT USING ((checklist_id IN ( SELECT inspection_checklists.id
   FROM public.inspection_checklists
  WHERE (inspection_checklists.organization_id IN ( SELECT profiles.organization_id
           FROM public.profiles
          WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))))));


--
-- Name: inspection_checklists Staff can view checklists in their organization; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can view checklists in their organization" ON public.inspection_checklists FOR SELECT USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: class_analytics Staff can view class analytics; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can view class analytics" ON public.class_analytics FOR SELECT USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role, 'trainer'::public.user_role]))))));


--
-- Name: inspection_results Staff can view inspection results; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can view inspection results" ON public.inspection_results FOR SELECT USING ((inspection_id IN ( SELECT safety_inspections.id
   FROM public.safety_inspections
  WHERE (safety_inspections.organization_id IN ( SELECT profiles.organization_id
           FROM public.profiles
          WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))))));


--
-- Name: safety_inspections Staff can view inspections in their organization; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can view inspections in their organization" ON public.safety_inspections FOR SELECT USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: integration_logs Staff can view integration logs in their organization; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can view integration logs in their organization" ON public.integration_logs FOR SELECT USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: lead_activities Staff can view lead activities; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can view lead activities" ON public.lead_activities FOR SELECT USING ((lead_id IN ( SELECT leads.id
   FROM public.leads
  WHERE (leads.organization_id IN ( SELECT profiles.organization_id
           FROM public.profiles
          WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))))));


--
-- Name: leads Staff can view leads in their organization; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can view leads in their organization" ON public.leads FOR SELECT USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: location_analytics Staff can view location analytics in their organization; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can view location analytics in their organization" ON public.location_analytics FOR SELECT USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: location_hierarchies Staff can view location hierarchies in their organization; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can view location hierarchies in their organization" ON public.location_hierarchies FOR SELECT USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: marketing_analytics Staff can view marketing analytics; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can view marketing analytics" ON public.marketing_analytics FOR SELECT USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: member_analytics_snapshots Staff can view member analytics; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can view member analytics" ON public.member_analytics_snapshots FOR SELECT USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: member_cohorts Staff can view member cohorts; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can view member cohorts" ON public.member_cohorts FOR SELECT USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: message_history Staff can view message history; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can view message history" ON public.message_history FOR SELECT USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: revenue_analytics Staff can view revenue analytics; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can view revenue analytics" ON public.revenue_analytics FOR SELECT USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: childcare_staff_schedules Staff can view schedules; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can view schedules" ON public.childcare_staff_schedules FOR SELECT USING (((staff_id = auth.uid()) OR (organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])))))));


--
-- Name: staff_performance_analytics Staff can view staff performance analytics; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can view staff performance analytics" ON public.staff_performance_analytics FOR SELECT USING (((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))) OR (staff_id = auth.uid())));


--
-- Name: cross_location_assignments Staff can view their assignments; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can view their assignments" ON public.cross_location_assignments FOR SELECT USING (((staff_id = auth.uid()) OR (organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])))))));


--
-- Name: staff_certifications Staff can view their own certifications; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can view their own certifications" ON public.staff_certifications FOR SELECT USING (((staff_id = auth.uid()) OR (organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])))))));


--
-- Name: cross_location_transfers Staff can view transfers in their organization; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can view transfers in their organization" ON public.cross_location_transfers FOR SELECT USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: safety_violations Staff can view violations in their organization; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can view violations in their organization" ON public.safety_violations FOR SELECT USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: webhook_logs Staff can view webhook logs in their organization; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff can view webhook logs in their organization" ON public.webhook_logs FOR SELECT USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role]))))));


--
-- Name: staff_schedules Staff schedules are viewable by organization members; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Staff schedules are viewable by organization members" ON public.staff_schedules FOR SELECT USING ((EXISTS ( SELECT 1
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.organization_id = staff_schedules.organization_id)))));


--
-- Name: integration_logs System can insert integration logs; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "System can insert integration logs" ON public.integration_logs FOR INSERT WITH CHECK (true);


--
-- Name: social_media_automation_logs System can insert social logs; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "System can insert social logs" ON public.social_media_automation_logs FOR INSERT WITH CHECK (true);


--
-- Name: blog_topic_history System can insert topic history; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "System can insert topic history" ON public.blog_topic_history FOR INSERT WITH CHECK (true);


--
-- Name: webhook_logs System can insert webhook logs; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "System can insert webhook logs" ON public.webhook_logs FOR INSERT WITH CHECK (true);


--
-- Name: blog_tags Tags are publicly readable; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Tags are publicly readable" ON public.blog_tags FOR SELECT USING (true);


--
-- Name: spa_appointments Therapists and staff can manage spa appointments; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Therapists and staff can manage spa appointments" ON public.spa_appointments USING (((therapist_id = auth.uid()) OR (organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])))))));


--
-- Name: therapist_availability Therapists can manage their own availability; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Therapists can manage their own availability" ON public.therapist_availability USING (((therapist_id = auth.uid()) OR (organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])))))));


--
-- Name: time_entries Time entries are viewable by organization members; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Time entries are viewable by organization members" ON public.time_entries FOR SELECT USING (((staff_id = auth.uid()) OR (EXISTS ( SELECT 1
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.organization_id = time_entries.organization_id) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role])))))));


--
-- Name: personal_training_sessions Trainers and staff can manage training sessions; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Trainers and staff can manage training sessions" ON public.personal_training_sessions USING (((trainer_id = auth.uid()) OR (organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])))))));


--
-- Name: trainer_availability Trainers can manage their own availability; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Trainers can manage their own availability" ON public.trainer_availability USING (((trainer_id = auth.uid()) OR (EXISTS ( SELECT 1
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])) AND (profiles.organization_id = ( SELECT profiles_1.organization_id
           FROM public.profiles profiles_1
          WHERE (profiles_1.id = trainer_availability.trainer_id))))))));


--
-- Name: resource_bookings Users can manage their own resource bookings; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Users can manage their own resource bookings" ON public.resource_bookings USING (((booked_by = auth.uid()) OR (EXISTS ( SELECT 1
   FROM public.profiles
  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['owner'::public.user_role, 'manager'::public.user_role, 'staff'::public.user_role])) AND (profiles.organization_id = ( SELECT profiles_1.organization_id
           FROM public.profiles profiles_1
          WHERE (profiles_1.id = resource_bookings.booked_by))))))));


--
-- Name: incident_reports Users can report incidents; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Users can report incidents" ON public.incident_reports FOR INSERT WITH CHECK (((reported_by = auth.uid()) AND (organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE (profiles.id = auth.uid())))));


--
-- Name: member_messages Users can send messages; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Users can send messages" ON public.member_messages FOR INSERT WITH CHECK ((sender_id = auth.uid()));


--
-- Name: messages Users can send messages; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Users can send messages" ON public.messages FOR INSERT WITH CHECK ((sender_id = auth.uid()));


--
-- Name: profiles Users can update their own profile; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Users can update their own profile" ON public.profiles FOR UPDATE USING ((id = auth.uid()));


--
-- Name: messages Users can update their received messages; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Users can update their received messages" ON public.messages FOR UPDATE USING ((recipient_id = auth.uid()));


--
-- Name: guest_pass_types Users can view active guest pass types; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Users can view active guest pass types" ON public.guest_pass_types FOR SELECT USING (((is_active = true) AND (organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE (profiles.id = auth.uid())))));


--
-- Name: class_categories Users can view class categories in their organization; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Users can view class categories in their organization" ON public.class_categories FOR SELECT USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE (profiles.id = auth.uid()))));


--
-- Name: classes Users can view classes in their organization; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Users can view classes in their organization" ON public.classes FOR SELECT USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE (profiles.id = auth.uid()))));


--
-- Name: email_responses Users can view email responses; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Users can view email responses" ON public.email_responses FOR SELECT USING ((message_id IN ( SELECT em.id
   FROM (public.email_messages em
     JOIN public.email_threads et ON ((em.thread_id = et.id)))
  WHERE (et.organization_id = ( SELECT profiles.organization_id
           FROM public.profiles
          WHERE (profiles.id = auth.uid()))))));


--
-- Name: equipment Users can view equipment in their organization; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Users can view equipment in their organization" ON public.equipment FOR SELECT USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE (profiles.id = auth.uid()))));


--
-- Name: facility_areas Users can view facility areas; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Users can view facility areas" ON public.facility_areas FOR SELECT USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE (profiles.id = auth.uid()))));


--
-- Name: instructor_availability Users can view instructor availability; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Users can view instructor availability" ON public.instructor_availability FOR SELECT USING ((EXISTS ( SELECT 1
   FROM public.profiles p1,
    public.profiles p2
  WHERE ((p1.id = auth.uid()) AND (p2.id = instructor_availability.instructor_id) AND (p1.organization_id = p2.organization_id)))));


--
-- Name: lead_stages Users can view lead stages in their organization; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Users can view lead stages in their organization" ON public.lead_stages FOR SELECT USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE (profiles.id = auth.uid()))));


--
-- Name: locations Users can view locations in their organization; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Users can view locations in their organization" ON public.locations FOR SELECT USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE (profiles.id = auth.uid()))));


--
-- Name: membership_plans Users can view membership plans in their organization; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Users can view membership plans in their organization" ON public.membership_plans FOR SELECT USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE (profiles.id = auth.uid()))));


--
-- Name: profiles Users can view profiles in their organization; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Users can view profiles in their organization" ON public.profiles FOR SELECT USING (((auth.uid() = id) OR (organization_id = public.get_user_organization_id(auth.uid()))));


--
-- Name: announcements Users can view published announcements; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Users can view published announcements" ON public.announcements FOR SELECT USING (((is_published = true) AND (organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE (profiles.id = auth.uid())))));


--
-- Name: referral_programs Users can view referral programs in their organization; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Users can view referral programs in their organization" ON public.referral_programs FOR SELECT USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE (profiles.id = auth.uid()))));


--
-- Name: resource_bookings Users can view resource bookings in their organization; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Users can view resource bookings in their organization" ON public.resource_bookings FOR SELECT USING ((EXISTS ( SELECT 1
   FROM public.profiles p1,
    public.profiles p2
  WHERE ((p1.id = auth.uid()) AND (p2.id = resource_bookings.booked_by) AND (p1.organization_id = p2.organization_id)))));


--
-- Name: email_messages Users can view their org's email messages; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Users can view their org's email messages" ON public.email_messages FOR SELECT USING ((thread_id IN ( SELECT email_threads.id
   FROM public.email_threads
  WHERE (email_threads.organization_id = ( SELECT profiles.organization_id
           FROM public.profiles
          WHERE (profiles.id = auth.uid()))))));


--
-- Name: email_threads Users can view their org's email threads; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Users can view their org's email threads" ON public.email_threads FOR SELECT USING ((organization_id = ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE (profiles.id = auth.uid()))));


--
-- Name: organizations Users can view their organization; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Users can view their organization" ON public.organizations FOR SELECT USING ((id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE (profiles.id = auth.uid()))));


--
-- Name: member_messages Users can view their own messages; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Users can view their own messages" ON public.member_messages FOR SELECT USING (((sender_id = auth.uid()) OR (recipient_id = auth.uid())));


--
-- Name: subscribers Users can view their own subscription; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Users can view their own subscription" ON public.subscribers FOR SELECT USING (((user_id = auth.uid()) OR (email = auth.email())));


--
-- Name: messages Users can view their received messages; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Users can view their received messages" ON public.messages FOR SELECT USING ((recipient_id = auth.uid()));


--
-- Name: messages Users can view their sent messages; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Users can view their sent messages" ON public.messages FOR SELECT USING ((sender_id = auth.uid()));


--
-- Name: trainer_availability Users can view trainer availability in their organization; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Users can view trainer availability in their organization" ON public.trainer_availability FOR SELECT USING ((EXISTS ( SELECT 1
   FROM public.profiles p1,
    public.profiles p2
  WHERE ((p1.id = auth.uid()) AND (p2.id = trainer_availability.trainer_id) AND (p1.organization_id = p2.organization_id)))));


--
-- Name: training_packages Users can view training packages in their organization; Type: POLICY; Schema: public; Owner: postgres
--

CREATE POLICY "Users can view training packages in their organization" ON public.training_packages FOR SELECT USING ((organization_id IN ( SELECT profiles.organization_id
   FROM public.profiles
  WHERE (profiles.id = auth.uid()))));


--
-- Name: ai_model_settings; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.ai_model_settings ENABLE ROW LEVEL SECURITY;

--
-- Name: announcements; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.announcements ENABLE ROW LEVEL SECURITY;

--
-- Name: api_keys; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.api_keys ENABLE ROW LEVEL SECURITY;

--
-- Name: blog_auto_generation_settings; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.blog_auto_generation_settings ENABLE ROW LEVEL SECURITY;

--
-- Name: blog_categories; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.blog_categories ENABLE ROW LEVEL SECURITY;

--
-- Name: blog_generation_queue; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.blog_generation_queue ENABLE ROW LEVEL SECURITY;

--
-- Name: blog_post_tags; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.blog_post_tags ENABLE ROW LEVEL SECURITY;

--
-- Name: blog_posts; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.blog_posts ENABLE ROW LEVEL SECURITY;

--
-- Name: blog_tags; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.blog_tags ENABLE ROW LEVEL SECURITY;

--
-- Name: blog_topic_history; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.blog_topic_history ENABLE ROW LEVEL SECURITY;

--
-- Name: bulk_member_operations; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.bulk_member_operations ENABLE ROW LEVEL SECURITY;

--
-- Name: campaign_executions; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.campaign_executions ENABLE ROW LEVEL SECURITY;

--
-- Name: certification_requirements; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.certification_requirements ENABLE ROW LEVEL SECURITY;

--
-- Name: check_ins; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.check_ins ENABLE ROW LEVEL SECURITY;

--
-- Name: child_profiles; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.child_profiles ENABLE ROW LEVEL SECURITY;

--
-- Name: childcare_activities; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.childcare_activities ENABLE ROW LEVEL SECURITY;

--
-- Name: childcare_activity_registrations; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.childcare_activity_registrations ENABLE ROW LEVEL SECURITY;

--
-- Name: childcare_checkins; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.childcare_checkins ENABLE ROW LEVEL SECURITY;

--
-- Name: childcare_daily_reports; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.childcare_daily_reports ENABLE ROW LEVEL SECURITY;

--
-- Name: childcare_staff_schedules; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.childcare_staff_schedules ENABLE ROW LEVEL SECURITY;

--
-- Name: class_analytics; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.class_analytics ENABLE ROW LEVEL SECURITY;

--
-- Name: class_bookings; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.class_bookings ENABLE ROW LEVEL SECURITY;

--
-- Name: class_categories; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.class_categories ENABLE ROW LEVEL SECURITY;

--
-- Name: class_waitlists; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.class_waitlists ENABLE ROW LEVEL SECURITY;

--
-- Name: classes; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.classes ENABLE ROW LEVEL SECURITY;

--
-- Name: cleaning_schedules; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.cleaning_schedules ENABLE ROW LEVEL SECURITY;

--
-- Name: commission_calculations; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.commission_calculations ENABLE ROW LEVEL SECURITY;

--
-- Name: communication_providers; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.communication_providers ENABLE ROW LEVEL SECURITY;

--
-- Name: communication_templates; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.communication_templates ENABLE ROW LEVEL SECURITY;

--
-- Name: corporate_accounts; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.corporate_accounts ENABLE ROW LEVEL SECURITY;

--
-- Name: corporate_invoice_items; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.corporate_invoice_items ENABLE ROW LEVEL SECURITY;

--
-- Name: corporate_invoices; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.corporate_invoices ENABLE ROW LEVEL SECURITY;

--
-- Name: corporate_members; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.corporate_members ENABLE ROW LEVEL SECURITY;

--
-- Name: corporate_membership_plans; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.corporate_membership_plans ENABLE ROW LEVEL SECURITY;

--
-- Name: cost_allocations; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.cost_allocations ENABLE ROW LEVEL SECURITY;

--
-- Name: court_reservations; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.court_reservations ENABLE ROW LEVEL SECURITY;

--
-- Name: cross_location_assignments; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.cross_location_assignments ENABLE ROW LEVEL SECURITY;

--
-- Name: cross_location_transfers; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.cross_location_transfers ENABLE ROW LEVEL SECURITY;

--
-- Name: daily_analytics_snapshots; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.daily_analytics_snapshots ENABLE ROW LEVEL SECURITY;

--
-- Name: department_budgets; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.department_budgets ENABLE ROW LEVEL SECURITY;

--
-- Name: department_revenues; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.department_revenues ENABLE ROW LEVEL SECURITY;

--
-- Name: early_access_requests; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.early_access_requests ENABLE ROW LEVEL SECURITY;

--
-- Name: email_messages; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.email_messages ENABLE ROW LEVEL SECURITY;

--
-- Name: email_responses; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.email_responses ENABLE ROW LEVEL SECURITY;

--
-- Name: email_templates; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.email_templates ENABLE ROW LEVEL SECURITY;

--
-- Name: email_threads; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.email_threads ENABLE ROW LEVEL SECURITY;

--
-- Name: equipment; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.equipment ENABLE ROW LEVEL SECURITY;

--
-- Name: equipment_checkout; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.equipment_checkout ENABLE ROW LEVEL SECURITY;

--
-- Name: expense_categories; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.expense_categories ENABLE ROW LEVEL SECURITY;

--
-- Name: expense_vendors; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.expense_vendors ENABLE ROW LEVEL SECURITY;

--
-- Name: expenses; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.expenses ENABLE ROW LEVEL SECURITY;

--
-- Name: facility_areas; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.facility_areas ENABLE ROW LEVEL SECURITY;

--
-- Name: facility_tours; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.facility_tours ENABLE ROW LEVEL SECURITY;

--
-- Name: fitness_assessments; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.fitness_assessments ENABLE ROW LEVEL SECURITY;

--
-- Name: guest_pass_types; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.guest_pass_types ENABLE ROW LEVEL SECURITY;

--
-- Name: guest_passes; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.guest_passes ENABLE ROW LEVEL SECURITY;

--
-- Name: incident_follow_ups; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.incident_follow_ups ENABLE ROW LEVEL SECURITY;

--
-- Name: incident_investigations; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.incident_investigations ENABLE ROW LEVEL SECURITY;

--
-- Name: incident_reports; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.incident_reports ENABLE ROW LEVEL SECURITY;

--
-- Name: inspection_checklist_items; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.inspection_checklist_items ENABLE ROW LEVEL SECURITY;

--
-- Name: inspection_checklists; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.inspection_checklists ENABLE ROW LEVEL SECURITY;

--
-- Name: inspection_results; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.inspection_results ENABLE ROW LEVEL SECURITY;

--
-- Name: instructor_availability; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.instructor_availability ENABLE ROW LEVEL SECURITY;

--
-- Name: insurance_claims; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.insurance_claims ENABLE ROW LEVEL SECURITY;

--
-- Name: integration_logs; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.integration_logs ENABLE ROW LEVEL SECURITY;

--
-- Name: integrations; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.integrations ENABLE ROW LEVEL SECURITY;

--
-- Name: inventory_items; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.inventory_items ENABLE ROW LEVEL SECURITY;

--
-- Name: kpi_metrics; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.kpi_metrics ENABLE ROW LEVEL SECURITY;

--
-- Name: lead_activities; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.lead_activities ENABLE ROW LEVEL SECURITY;

--
-- Name: lead_attribution_disputes; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.lead_attribution_disputes ENABLE ROW LEVEL SECURITY;

--
-- Name: lead_scoring_rules; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.lead_scoring_rules ENABLE ROW LEVEL SECURITY;

--
-- Name: lead_sources; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.lead_sources ENABLE ROW LEVEL SECURITY;

--
-- Name: lead_split_commissions; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.lead_split_commissions ENABLE ROW LEVEL SECURITY;

--
-- Name: lead_stages; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.lead_stages ENABLE ROW LEVEL SECURITY;

--
-- Name: leads; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.leads ENABLE ROW LEVEL SECURITY;

--
-- Name: liability_waivers; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.liability_waivers ENABLE ROW LEVEL SECURITY;

--
-- Name: lifeguard_schedules; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.lifeguard_schedules ENABLE ROW LEVEL SECURITY;

--
-- Name: location_analytics; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.location_analytics ENABLE ROW LEVEL SECURITY;

--
-- Name: location_hierarchies; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.location_hierarchies ENABLE ROW LEVEL SECURITY;

--
-- Name: locations; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.locations ENABLE ROW LEVEL SECURITY;

--
-- Name: locker_access_log; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.locker_access_log ENABLE ROW LEVEL SECURITY;

--
-- Name: locker_maintenance; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.locker_maintenance ENABLE ROW LEVEL SECURITY;

--
-- Name: locker_rentals; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.locker_rentals ENABLE ROW LEVEL SECURITY;

--
-- Name: lockers; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.lockers ENABLE ROW LEVEL SECURITY;

--
-- Name: loyalty_points; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.loyalty_points ENABLE ROW LEVEL SECURITY;

--
-- Name: loyalty_program_rules; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.loyalty_program_rules ENABLE ROW LEVEL SECURITY;

--
-- Name: loyalty_redemptions; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.loyalty_redemptions ENABLE ROW LEVEL SECURITY;

--
-- Name: loyalty_rewards; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.loyalty_rewards ENABLE ROW LEVEL SECURITY;

--
-- Name: maintenance_logs; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.maintenance_logs ENABLE ROW LEVEL SECURITY;

--
-- Name: maintenance_schedules; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.maintenance_schedules ENABLE ROW LEVEL SECURITY;

--
-- Name: marketing_analytics; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.marketing_analytics ENABLE ROW LEVEL SECURITY;

--
-- Name: marketing_campaigns; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.marketing_campaigns ENABLE ROW LEVEL SECURITY;

--
-- Name: member_analytics_snapshots; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.member_analytics_snapshots ENABLE ROW LEVEL SECURITY;

--
-- Name: member_cards; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.member_cards ENABLE ROW LEVEL SECURITY;

--
-- Name: member_cohorts; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.member_cohorts ENABLE ROW LEVEL SECURITY;

--
-- Name: member_documents; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.member_documents ENABLE ROW LEVEL SECURITY;

--
-- Name: member_engagement_history; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.member_engagement_history ENABLE ROW LEVEL SECURITY;

--
-- Name: member_feedback; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.member_feedback ENABLE ROW LEVEL SECURITY;

--
-- Name: member_location_access; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.member_location_access ENABLE ROW LEVEL SECURITY;

--
-- Name: member_messages; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.member_messages ENABLE ROW LEVEL SECURITY;

--
-- Name: member_milestones; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.member_milestones ENABLE ROW LEVEL SECURITY;

--
-- Name: member_orientations; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.member_orientations ENABLE ROW LEVEL SECURITY;

--
-- Name: member_referrals; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.member_referrals ENABLE ROW LEVEL SECURITY;

--
-- Name: member_segments; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.member_segments ENABLE ROW LEVEL SECURITY;

--
-- Name: member_training_packages; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.member_training_packages ENABLE ROW LEVEL SECURITY;

--
-- Name: membership_agreement_templates; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.membership_agreement_templates ENABLE ROW LEVEL SECURITY;

--
-- Name: membership_agreements; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.membership_agreements ENABLE ROW LEVEL SECURITY;

--
-- Name: membership_plans; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.membership_plans ENABLE ROW LEVEL SECURITY;

--
-- Name: memberships; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.memberships ENABLE ROW LEVEL SECURITY;

--
-- Name: message_history; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.message_history ENABLE ROW LEVEL SECURITY;

--
-- Name: messages; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.messages ENABLE ROW LEVEL SECURITY;

--
-- Name: notification_preferences; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.notification_preferences ENABLE ROW LEVEL SECURITY;

--
-- Name: notification_templates; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.notification_templates ENABLE ROW LEVEL SECURITY;

--
-- Name: notifications; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.notifications ENABLE ROW LEVEL SECURITY;

--
-- Name: organization_commission_settings; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.organization_commission_settings ENABLE ROW LEVEL SECURITY;

--
-- Name: organizations; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.organizations ENABLE ROW LEVEL SECURITY;

--
-- Name: payment_transactions; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.payment_transactions ENABLE ROW LEVEL SECURITY;

--
-- Name: payroll_periods; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.payroll_periods ENABLE ROW LEVEL SECURITY;

--
-- Name: personal_training_sessions; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.personal_training_sessions ENABLE ROW LEVEL SECURITY;

--
-- Name: pool_facilities; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.pool_facilities ENABLE ROW LEVEL SECURITY;

--
-- Name: pool_lane_reservations; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.pool_lane_reservations ENABLE ROW LEVEL SECURITY;

--
-- Name: pool_maintenance_logs; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.pool_maintenance_logs ENABLE ROW LEVEL SECURITY;

--
-- Name: pool_maintenance_schedules; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.pool_maintenance_schedules ENABLE ROW LEVEL SECURITY;

--
-- Name: pos_products; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.pos_products ENABLE ROW LEVEL SECURITY;

--
-- Name: pos_sale_items; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.pos_sale_items ENABLE ROW LEVEL SECURITY;

--
-- Name: pos_sales; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.pos_sales ENABLE ROW LEVEL SECURITY;

--
-- Name: profiles; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.profiles ENABLE ROW LEVEL SECURITY;

--
-- Name: promotions; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.promotions ENABLE ROW LEVEL SECURITY;

--
-- Name: quote_line_items; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.quote_line_items ENABLE ROW LEVEL SECURITY;

--
-- Name: referral_programs; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.referral_programs ENABLE ROW LEVEL SECURITY;

--
-- Name: resource_bookings; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.resource_bookings ENABLE ROW LEVEL SECURITY;

--
-- Name: retail_products; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.retail_products ENABLE ROW LEVEL SECURITY;

--
-- Name: retail_transaction_items; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.retail_transaction_items ENABLE ROW LEVEL SECURITY;

--
-- Name: retail_transactions; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.retail_transactions ENABLE ROW LEVEL SECURITY;

--
-- Name: retention_campaigns; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.retention_campaigns ENABLE ROW LEVEL SECURITY;

--
-- Name: revenue_analytics; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.revenue_analytics ENABLE ROW LEVEL SECURITY;

--
-- Name: safety_inspections; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.safety_inspections ENABLE ROW LEVEL SECURITY;

--
-- Name: safety_violations; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.safety_violations ENABLE ROW LEVEL SECURITY;

--
-- Name: sales_quotes; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.sales_quotes ENABLE ROW LEVEL SECURITY;

--
-- Name: salesperson_commissions; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.salesperson_commissions ENABLE ROW LEVEL SECURITY;

--
-- Name: salesperson_referral_links; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.salesperson_referral_links ENABLE ROW LEVEL SECURITY;

--
-- Name: sms_campaign_recipients; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.sms_campaign_recipients ENABLE ROW LEVEL SECURITY;

--
-- Name: sms_campaigns; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.sms_campaigns ENABLE ROW LEVEL SECURITY;

--
-- Name: social_media_automation_logs; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.social_media_automation_logs ENABLE ROW LEVEL SECURITY;

--
-- Name: social_media_automation_settings; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.social_media_automation_settings ENABLE ROW LEVEL SECURITY;

--
-- Name: spa_appointments; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.spa_appointments ENABLE ROW LEVEL SECURITY;

--
-- Name: spa_inventory; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.spa_inventory ENABLE ROW LEVEL SECURITY;

--
-- Name: spa_service_packages; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.spa_service_packages ENABLE ROW LEVEL SECURITY;

--
-- Name: spa_services; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.spa_services ENABLE ROW LEVEL SECURITY;

--
-- Name: sports_courts; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.sports_courts ENABLE ROW LEVEL SECURITY;

--
-- Name: sports_equipment; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.sports_equipment ENABLE ROW LEVEL SECURITY;

--
-- Name: staff_certifications; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.staff_certifications ENABLE ROW LEVEL SECURITY;

--
-- Name: staff_performance_analytics; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.staff_performance_analytics ENABLE ROW LEVEL SECURITY;

--
-- Name: staff_schedules; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.staff_schedules ENABLE ROW LEVEL SECURITY;

--
-- Name: stock_movements; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.stock_movements ENABLE ROW LEVEL SECURITY;

--
-- Name: subscribers; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.subscribers ENABLE ROW LEVEL SECURITY;

--
-- Name: support_tickets; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.support_tickets ENABLE ROW LEVEL SECURITY;

--
-- Name: swim_lesson_enrollments; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.swim_lesson_enrollments ENABLE ROW LEVEL SECURITY;

--
-- Name: swim_lessons; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.swim_lessons ENABLE ROW LEVEL SECURITY;

--
-- Name: therapist_availability; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.therapist_availability ENABLE ROW LEVEL SECURITY;

--
-- Name: time_entries; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.time_entries ENABLE ROW LEVEL SECURITY;

--
-- Name: tournament_matches; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.tournament_matches ENABLE ROW LEVEL SECURITY;

--
-- Name: tournament_participants; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.tournament_participants ENABLE ROW LEVEL SECURITY;

--
-- Name: tournaments; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.tournaments ENABLE ROW LEVEL SECURITY;

--
-- Name: towel_cleaning_logs; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.towel_cleaning_logs ENABLE ROW LEVEL SECURITY;

--
-- Name: towel_inventory; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.towel_inventory ENABLE ROW LEVEL SECURITY;

--
-- Name: towel_rentals; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.towel_rentals ENABLE ROW LEVEL SECURITY;

--
-- Name: trainer_availability; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.trainer_availability ENABLE ROW LEVEL SECURITY;

--
-- Name: training_packages; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.training_packages ENABLE ROW LEVEL SECURITY;

--
-- Name: vendors; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.vendors ENABLE ROW LEVEL SECURITY;

--
-- Name: visitor_checkins; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.visitor_checkins ENABLE ROW LEVEL SECURITY;

--
-- Name: water_quality_logs; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.water_quality_logs ENABLE ROW LEVEL SECURITY;

--
-- Name: webhook_endpoints; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.webhook_endpoints ENABLE ROW LEVEL SECURITY;

--
-- Name: webhook_logs; Type: ROW SECURITY; Schema: public; Owner: postgres
--

ALTER TABLE public.webhook_logs ENABLE ROW LEVEL SECURITY;

--
-- Name: messages; Type: ROW SECURITY; Schema: realtime; Owner: supabase_realtime_admin
--

ALTER TABLE realtime.messages ENABLE ROW LEVEL SECURITY;

--
-- Name: buckets; Type: ROW SECURITY; Schema: storage; Owner: supabase_storage_admin
--

ALTER TABLE storage.buckets ENABLE ROW LEVEL SECURITY;

--
-- Name: buckets_analytics; Type: ROW SECURITY; Schema: storage; Owner: supabase_storage_admin
--

ALTER TABLE storage.buckets_analytics ENABLE ROW LEVEL SECURITY;

--
-- Name: buckets_vectors; Type: ROW SECURITY; Schema: storage; Owner: supabase_storage_admin
--

ALTER TABLE storage.buckets_vectors ENABLE ROW LEVEL SECURITY;

--
-- Name: migrations; Type: ROW SECURITY; Schema: storage; Owner: supabase_storage_admin
--

ALTER TABLE storage.migrations ENABLE ROW LEVEL SECURITY;

--
-- Name: objects; Type: ROW SECURITY; Schema: storage; Owner: supabase_storage_admin
--

ALTER TABLE storage.objects ENABLE ROW LEVEL SECURITY;

--
-- Name: prefixes; Type: ROW SECURITY; Schema: storage; Owner: supabase_storage_admin
--

ALTER TABLE storage.prefixes ENABLE ROW LEVEL SECURITY;

--
-- Name: s3_multipart_uploads; Type: ROW SECURITY; Schema: storage; Owner: supabase_storage_admin
--

ALTER TABLE storage.s3_multipart_uploads ENABLE ROW LEVEL SECURITY;

--
-- Name: s3_multipart_uploads_parts; Type: ROW SECURITY; Schema: storage; Owner: supabase_storage_admin
--

ALTER TABLE storage.s3_multipart_uploads_parts ENABLE ROW LEVEL SECURITY;

--
-- Name: vector_indexes; Type: ROW SECURITY; Schema: storage; Owner: supabase_storage_admin
--

ALTER TABLE storage.vector_indexes ENABLE ROW LEVEL SECURITY;

--
-- Name: supabase_realtime; Type: PUBLICATION; Schema: -; Owner: postgres
--

CREATE PUBLICATION supabase_realtime WITH (publish = 'insert, update, delete, truncate');


ALTER PUBLICATION supabase_realtime OWNER TO postgres;

--
-- Name: SCHEMA auth; Type: ACL; Schema: -; Owner: supabase_admin
--

GRANT USAGE ON SCHEMA auth TO anon;
GRANT USAGE ON SCHEMA auth TO authenticated;
GRANT USAGE ON SCHEMA auth TO service_role;
GRANT ALL ON SCHEMA auth TO supabase_auth_admin;
GRANT ALL ON SCHEMA auth TO dashboard_user;
GRANT USAGE ON SCHEMA auth TO postgres;


--
-- Name: SCHEMA extensions; Type: ACL; Schema: -; Owner: postgres
--

GRANT USAGE ON SCHEMA extensions TO anon;
GRANT USAGE ON SCHEMA extensions TO authenticated;
GRANT USAGE ON SCHEMA extensions TO service_role;
GRANT ALL ON SCHEMA extensions TO dashboard_user;


--
-- Name: SCHEMA public; Type: ACL; Schema: -; Owner: pg_database_owner
--

GRANT USAGE ON SCHEMA public TO postgres;
GRANT USAGE ON SCHEMA public TO anon;
GRANT USAGE ON SCHEMA public TO authenticated;
GRANT USAGE ON SCHEMA public TO service_role;


--
-- Name: SCHEMA realtime; Type: ACL; Schema: -; Owner: supabase_admin
--

GRANT USAGE ON SCHEMA realtime TO postgres;
GRANT USAGE ON SCHEMA realtime TO anon;
GRANT USAGE ON SCHEMA realtime TO authenticated;
GRANT USAGE ON SCHEMA realtime TO service_role;
GRANT ALL ON SCHEMA realtime TO supabase_realtime_admin;


--
-- Name: SCHEMA storage; Type: ACL; Schema: -; Owner: supabase_admin
--

GRANT USAGE ON SCHEMA storage TO postgres WITH GRANT OPTION;
GRANT USAGE ON SCHEMA storage TO anon;
GRANT USAGE ON SCHEMA storage TO authenticated;
GRANT USAGE ON SCHEMA storage TO service_role;
GRANT ALL ON SCHEMA storage TO supabase_storage_admin;
GRANT ALL ON SCHEMA storage TO dashboard_user;


--
-- Name: SCHEMA vault; Type: ACL; Schema: -; Owner: supabase_admin
--

GRANT USAGE ON SCHEMA vault TO postgres WITH GRANT OPTION;
GRANT USAGE ON SCHEMA vault TO service_role;


--
-- Name: FUNCTION email(); Type: ACL; Schema: auth; Owner: supabase_auth_admin
--

GRANT ALL ON FUNCTION auth.email() TO dashboard_user;


--
-- Name: FUNCTION jwt(); Type: ACL; Schema: auth; Owner: supabase_auth_admin
--

GRANT ALL ON FUNCTION auth.jwt() TO postgres;
GRANT ALL ON FUNCTION auth.jwt() TO dashboard_user;


--
-- Name: FUNCTION role(); Type: ACL; Schema: auth; Owner: supabase_auth_admin
--

GRANT ALL ON FUNCTION auth.role() TO dashboard_user;


--
-- Name: FUNCTION uid(); Type: ACL; Schema: auth; Owner: supabase_auth_admin
--

GRANT ALL ON FUNCTION auth.uid() TO dashboard_user;


--
-- Name: FUNCTION armor(bytea); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.armor(bytea) FROM postgres;
GRANT ALL ON FUNCTION extensions.armor(bytea) TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.armor(bytea) TO dashboard_user;


--
-- Name: FUNCTION armor(bytea, text[], text[]); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.armor(bytea, text[], text[]) FROM postgres;
GRANT ALL ON FUNCTION extensions.armor(bytea, text[], text[]) TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.armor(bytea, text[], text[]) TO dashboard_user;


--
-- Name: FUNCTION crypt(text, text); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.crypt(text, text) FROM postgres;
GRANT ALL ON FUNCTION extensions.crypt(text, text) TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.crypt(text, text) TO dashboard_user;


--
-- Name: FUNCTION dearmor(text); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.dearmor(text) FROM postgres;
GRANT ALL ON FUNCTION extensions.dearmor(text) TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.dearmor(text) TO dashboard_user;


--
-- Name: FUNCTION decrypt(bytea, bytea, text); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.decrypt(bytea, bytea, text) FROM postgres;
GRANT ALL ON FUNCTION extensions.decrypt(bytea, bytea, text) TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.decrypt(bytea, bytea, text) TO dashboard_user;


--
-- Name: FUNCTION decrypt_iv(bytea, bytea, bytea, text); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.decrypt_iv(bytea, bytea, bytea, text) FROM postgres;
GRANT ALL ON FUNCTION extensions.decrypt_iv(bytea, bytea, bytea, text) TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.decrypt_iv(bytea, bytea, bytea, text) TO dashboard_user;


--
-- Name: FUNCTION digest(bytea, text); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.digest(bytea, text) FROM postgres;
GRANT ALL ON FUNCTION extensions.digest(bytea, text) TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.digest(bytea, text) TO dashboard_user;


--
-- Name: FUNCTION digest(text, text); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.digest(text, text) FROM postgres;
GRANT ALL ON FUNCTION extensions.digest(text, text) TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.digest(text, text) TO dashboard_user;


--
-- Name: FUNCTION encrypt(bytea, bytea, text); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.encrypt(bytea, bytea, text) FROM postgres;
GRANT ALL ON FUNCTION extensions.encrypt(bytea, bytea, text) TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.encrypt(bytea, bytea, text) TO dashboard_user;


--
-- Name: FUNCTION encrypt_iv(bytea, bytea, bytea, text); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.encrypt_iv(bytea, bytea, bytea, text) FROM postgres;
GRANT ALL ON FUNCTION extensions.encrypt_iv(bytea, bytea, bytea, text) TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.encrypt_iv(bytea, bytea, bytea, text) TO dashboard_user;


--
-- Name: FUNCTION gen_random_bytes(integer); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.gen_random_bytes(integer) FROM postgres;
GRANT ALL ON FUNCTION extensions.gen_random_bytes(integer) TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.gen_random_bytes(integer) TO dashboard_user;


--
-- Name: FUNCTION gen_random_uuid(); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.gen_random_uuid() FROM postgres;
GRANT ALL ON FUNCTION extensions.gen_random_uuid() TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.gen_random_uuid() TO dashboard_user;


--
-- Name: FUNCTION gen_salt(text); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.gen_salt(text) FROM postgres;
GRANT ALL ON FUNCTION extensions.gen_salt(text) TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.gen_salt(text) TO dashboard_user;


--
-- Name: FUNCTION gen_salt(text, integer); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.gen_salt(text, integer) FROM postgres;
GRANT ALL ON FUNCTION extensions.gen_salt(text, integer) TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.gen_salt(text, integer) TO dashboard_user;


--
-- Name: FUNCTION grant_pg_cron_access(); Type: ACL; Schema: extensions; Owner: supabase_admin
--

REVOKE ALL ON FUNCTION extensions.grant_pg_cron_access() FROM supabase_admin;
GRANT ALL ON FUNCTION extensions.grant_pg_cron_access() TO supabase_admin WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.grant_pg_cron_access() TO dashboard_user;


--
-- Name: FUNCTION grant_pg_graphql_access(); Type: ACL; Schema: extensions; Owner: supabase_admin
--

GRANT ALL ON FUNCTION extensions.grant_pg_graphql_access() TO postgres WITH GRANT OPTION;


--
-- Name: FUNCTION grant_pg_net_access(); Type: ACL; Schema: extensions; Owner: supabase_admin
--

REVOKE ALL ON FUNCTION extensions.grant_pg_net_access() FROM supabase_admin;
GRANT ALL ON FUNCTION extensions.grant_pg_net_access() TO supabase_admin WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.grant_pg_net_access() TO dashboard_user;


--
-- Name: FUNCTION hmac(bytea, bytea, text); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.hmac(bytea, bytea, text) FROM postgres;
GRANT ALL ON FUNCTION extensions.hmac(bytea, bytea, text) TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.hmac(bytea, bytea, text) TO dashboard_user;


--
-- Name: FUNCTION hmac(text, text, text); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.hmac(text, text, text) FROM postgres;
GRANT ALL ON FUNCTION extensions.hmac(text, text, text) TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.hmac(text, text, text) TO dashboard_user;


--
-- Name: FUNCTION pg_stat_statements(showtext boolean, OUT userid oid, OUT dbid oid, OUT toplevel boolean, OUT queryid bigint, OUT query text, OUT plans bigint, OUT total_plan_time double precision, OUT min_plan_time double precision, OUT max_plan_time double precision, OUT mean_plan_time double precision, OUT stddev_plan_time double precision, OUT calls bigint, OUT total_exec_time double precision, OUT min_exec_time double precision, OUT max_exec_time double precision, OUT mean_exec_time double precision, OUT stddev_exec_time double precision, OUT rows bigint, OUT shared_blks_hit bigint, OUT shared_blks_read bigint, OUT shared_blks_dirtied bigint, OUT shared_blks_written bigint, OUT local_blks_hit bigint, OUT local_blks_read bigint, OUT local_blks_dirtied bigint, OUT local_blks_written bigint, OUT temp_blks_read bigint, OUT temp_blks_written bigint, OUT shared_blk_read_time double precision, OUT shared_blk_write_time double precision, OUT local_blk_read_time double precision, OUT local_blk_write_time double precision, OUT temp_blk_read_time double precision, OUT temp_blk_write_time double precision, OUT wal_records bigint, OUT wal_fpi bigint, OUT wal_bytes numeric, OUT jit_functions bigint, OUT jit_generation_time double precision, OUT jit_inlining_count bigint, OUT jit_inlining_time double precision, OUT jit_optimization_count bigint, OUT jit_optimization_time double precision, OUT jit_emission_count bigint, OUT jit_emission_time double precision, OUT jit_deform_count bigint, OUT jit_deform_time double precision, OUT stats_since timestamp with time zone, OUT minmax_stats_since timestamp with time zone); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.pg_stat_statements(showtext boolean, OUT userid oid, OUT dbid oid, OUT toplevel boolean, OUT queryid bigint, OUT query text, OUT plans bigint, OUT total_plan_time double precision, OUT min_plan_time double precision, OUT max_plan_time double precision, OUT mean_plan_time double precision, OUT stddev_plan_time double precision, OUT calls bigint, OUT total_exec_time double precision, OUT min_exec_time double precision, OUT max_exec_time double precision, OUT mean_exec_time double precision, OUT stddev_exec_time double precision, OUT rows bigint, OUT shared_blks_hit bigint, OUT shared_blks_read bigint, OUT shared_blks_dirtied bigint, OUT shared_blks_written bigint, OUT local_blks_hit bigint, OUT local_blks_read bigint, OUT local_blks_dirtied bigint, OUT local_blks_written bigint, OUT temp_blks_read bigint, OUT temp_blks_written bigint, OUT shared_blk_read_time double precision, OUT shared_blk_write_time double precision, OUT local_blk_read_time double precision, OUT local_blk_write_time double precision, OUT temp_blk_read_time double precision, OUT temp_blk_write_time double precision, OUT wal_records bigint, OUT wal_fpi bigint, OUT wal_bytes numeric, OUT jit_functions bigint, OUT jit_generation_time double precision, OUT jit_inlining_count bigint, OUT jit_inlining_time double precision, OUT jit_optimization_count bigint, OUT jit_optimization_time double precision, OUT jit_emission_count bigint, OUT jit_emission_time double precision, OUT jit_deform_count bigint, OUT jit_deform_time double precision, OUT stats_since timestamp with time zone, OUT minmax_stats_since timestamp with time zone) FROM postgres;
GRANT ALL ON FUNCTION extensions.pg_stat_statements(showtext boolean, OUT userid oid, OUT dbid oid, OUT toplevel boolean, OUT queryid bigint, OUT query text, OUT plans bigint, OUT total_plan_time double precision, OUT min_plan_time double precision, OUT max_plan_time double precision, OUT mean_plan_time double precision, OUT stddev_plan_time double precision, OUT calls bigint, OUT total_exec_time double precision, OUT min_exec_time double precision, OUT max_exec_time double precision, OUT mean_exec_time double precision, OUT stddev_exec_time double precision, OUT rows bigint, OUT shared_blks_hit bigint, OUT shared_blks_read bigint, OUT shared_blks_dirtied bigint, OUT shared_blks_written bigint, OUT local_blks_hit bigint, OUT local_blks_read bigint, OUT local_blks_dirtied bigint, OUT local_blks_written bigint, OUT temp_blks_read bigint, OUT temp_blks_written bigint, OUT shared_blk_read_time double precision, OUT shared_blk_write_time double precision, OUT local_blk_read_time double precision, OUT local_blk_write_time double precision, OUT temp_blk_read_time double precision, OUT temp_blk_write_time double precision, OUT wal_records bigint, OUT wal_fpi bigint, OUT wal_bytes numeric, OUT jit_functions bigint, OUT jit_generation_time double precision, OUT jit_inlining_count bigint, OUT jit_inlining_time double precision, OUT jit_optimization_count bigint, OUT jit_optimization_time double precision, OUT jit_emission_count bigint, OUT jit_emission_time double precision, OUT jit_deform_count bigint, OUT jit_deform_time double precision, OUT stats_since timestamp with time zone, OUT minmax_stats_since timestamp with time zone) TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.pg_stat_statements(showtext boolean, OUT userid oid, OUT dbid oid, OUT toplevel boolean, OUT queryid bigint, OUT query text, OUT plans bigint, OUT total_plan_time double precision, OUT min_plan_time double precision, OUT max_plan_time double precision, OUT mean_plan_time double precision, OUT stddev_plan_time double precision, OUT calls bigint, OUT total_exec_time double precision, OUT min_exec_time double precision, OUT max_exec_time double precision, OUT mean_exec_time double precision, OUT stddev_exec_time double precision, OUT rows bigint, OUT shared_blks_hit bigint, OUT shared_blks_read bigint, OUT shared_blks_dirtied bigint, OUT shared_blks_written bigint, OUT local_blks_hit bigint, OUT local_blks_read bigint, OUT local_blks_dirtied bigint, OUT local_blks_written bigint, OUT temp_blks_read bigint, OUT temp_blks_written bigint, OUT shared_blk_read_time double precision, OUT shared_blk_write_time double precision, OUT local_blk_read_time double precision, OUT local_blk_write_time double precision, OUT temp_blk_read_time double precision, OUT temp_blk_write_time double precision, OUT wal_records bigint, OUT wal_fpi bigint, OUT wal_bytes numeric, OUT jit_functions bigint, OUT jit_generation_time double precision, OUT jit_inlining_count bigint, OUT jit_inlining_time double precision, OUT jit_optimization_count bigint, OUT jit_optimization_time double precision, OUT jit_emission_count bigint, OUT jit_emission_time double precision, OUT jit_deform_count bigint, OUT jit_deform_time double precision, OUT stats_since timestamp with time zone, OUT minmax_stats_since timestamp with time zone) TO dashboard_user;


--
-- Name: FUNCTION pg_stat_statements_info(OUT dealloc bigint, OUT stats_reset timestamp with time zone); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.pg_stat_statements_info(OUT dealloc bigint, OUT stats_reset timestamp with time zone) FROM postgres;
GRANT ALL ON FUNCTION extensions.pg_stat_statements_info(OUT dealloc bigint, OUT stats_reset timestamp with time zone) TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.pg_stat_statements_info(OUT dealloc bigint, OUT stats_reset timestamp with time zone) TO dashboard_user;


--
-- Name: FUNCTION pg_stat_statements_reset(userid oid, dbid oid, queryid bigint, minmax_only boolean); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.pg_stat_statements_reset(userid oid, dbid oid, queryid bigint, minmax_only boolean) FROM postgres;
GRANT ALL ON FUNCTION extensions.pg_stat_statements_reset(userid oid, dbid oid, queryid bigint, minmax_only boolean) TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.pg_stat_statements_reset(userid oid, dbid oid, queryid bigint, minmax_only boolean) TO dashboard_user;


--
-- Name: FUNCTION pgp_armor_headers(text, OUT key text, OUT value text); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.pgp_armor_headers(text, OUT key text, OUT value text) FROM postgres;
GRANT ALL ON FUNCTION extensions.pgp_armor_headers(text, OUT key text, OUT value text) TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.pgp_armor_headers(text, OUT key text, OUT value text) TO dashboard_user;


--
-- Name: FUNCTION pgp_key_id(bytea); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.pgp_key_id(bytea) FROM postgres;
GRANT ALL ON FUNCTION extensions.pgp_key_id(bytea) TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.pgp_key_id(bytea) TO dashboard_user;


--
-- Name: FUNCTION pgp_pub_decrypt(bytea, bytea); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.pgp_pub_decrypt(bytea, bytea) FROM postgres;
GRANT ALL ON FUNCTION extensions.pgp_pub_decrypt(bytea, bytea) TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.pgp_pub_decrypt(bytea, bytea) TO dashboard_user;


--
-- Name: FUNCTION pgp_pub_decrypt(bytea, bytea, text); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.pgp_pub_decrypt(bytea, bytea, text) FROM postgres;
GRANT ALL ON FUNCTION extensions.pgp_pub_decrypt(bytea, bytea, text) TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.pgp_pub_decrypt(bytea, bytea, text) TO dashboard_user;


--
-- Name: FUNCTION pgp_pub_decrypt(bytea, bytea, text, text); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.pgp_pub_decrypt(bytea, bytea, text, text) FROM postgres;
GRANT ALL ON FUNCTION extensions.pgp_pub_decrypt(bytea, bytea, text, text) TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.pgp_pub_decrypt(bytea, bytea, text, text) TO dashboard_user;


--
-- Name: FUNCTION pgp_pub_decrypt_bytea(bytea, bytea); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.pgp_pub_decrypt_bytea(bytea, bytea) FROM postgres;
GRANT ALL ON FUNCTION extensions.pgp_pub_decrypt_bytea(bytea, bytea) TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.pgp_pub_decrypt_bytea(bytea, bytea) TO dashboard_user;


--
-- Name: FUNCTION pgp_pub_decrypt_bytea(bytea, bytea, text); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.pgp_pub_decrypt_bytea(bytea, bytea, text) FROM postgres;
GRANT ALL ON FUNCTION extensions.pgp_pub_decrypt_bytea(bytea, bytea, text) TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.pgp_pub_decrypt_bytea(bytea, bytea, text) TO dashboard_user;


--
-- Name: FUNCTION pgp_pub_decrypt_bytea(bytea, bytea, text, text); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.pgp_pub_decrypt_bytea(bytea, bytea, text, text) FROM postgres;
GRANT ALL ON FUNCTION extensions.pgp_pub_decrypt_bytea(bytea, bytea, text, text) TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.pgp_pub_decrypt_bytea(bytea, bytea, text, text) TO dashboard_user;


--
-- Name: FUNCTION pgp_pub_encrypt(text, bytea); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.pgp_pub_encrypt(text, bytea) FROM postgres;
GRANT ALL ON FUNCTION extensions.pgp_pub_encrypt(text, bytea) TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.pgp_pub_encrypt(text, bytea) TO dashboard_user;


--
-- Name: FUNCTION pgp_pub_encrypt(text, bytea, text); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.pgp_pub_encrypt(text, bytea, text) FROM postgres;
GRANT ALL ON FUNCTION extensions.pgp_pub_encrypt(text, bytea, text) TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.pgp_pub_encrypt(text, bytea, text) TO dashboard_user;


--
-- Name: FUNCTION pgp_pub_encrypt_bytea(bytea, bytea); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.pgp_pub_encrypt_bytea(bytea, bytea) FROM postgres;
GRANT ALL ON FUNCTION extensions.pgp_pub_encrypt_bytea(bytea, bytea) TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.pgp_pub_encrypt_bytea(bytea, bytea) TO dashboard_user;


--
-- Name: FUNCTION pgp_pub_encrypt_bytea(bytea, bytea, text); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.pgp_pub_encrypt_bytea(bytea, bytea, text) FROM postgres;
GRANT ALL ON FUNCTION extensions.pgp_pub_encrypt_bytea(bytea, bytea, text) TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.pgp_pub_encrypt_bytea(bytea, bytea, text) TO dashboard_user;


--
-- Name: FUNCTION pgp_sym_decrypt(bytea, text); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.pgp_sym_decrypt(bytea, text) FROM postgres;
GRANT ALL ON FUNCTION extensions.pgp_sym_decrypt(bytea, text) TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.pgp_sym_decrypt(bytea, text) TO dashboard_user;


--
-- Name: FUNCTION pgp_sym_decrypt(bytea, text, text); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.pgp_sym_decrypt(bytea, text, text) FROM postgres;
GRANT ALL ON FUNCTION extensions.pgp_sym_decrypt(bytea, text, text) TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.pgp_sym_decrypt(bytea, text, text) TO dashboard_user;


--
-- Name: FUNCTION pgp_sym_decrypt_bytea(bytea, text); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.pgp_sym_decrypt_bytea(bytea, text) FROM postgres;
GRANT ALL ON FUNCTION extensions.pgp_sym_decrypt_bytea(bytea, text) TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.pgp_sym_decrypt_bytea(bytea, text) TO dashboard_user;


--
-- Name: FUNCTION pgp_sym_decrypt_bytea(bytea, text, text); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.pgp_sym_decrypt_bytea(bytea, text, text) FROM postgres;
GRANT ALL ON FUNCTION extensions.pgp_sym_decrypt_bytea(bytea, text, text) TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.pgp_sym_decrypt_bytea(bytea, text, text) TO dashboard_user;


--
-- Name: FUNCTION pgp_sym_encrypt(text, text); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.pgp_sym_encrypt(text, text) FROM postgres;
GRANT ALL ON FUNCTION extensions.pgp_sym_encrypt(text, text) TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.pgp_sym_encrypt(text, text) TO dashboard_user;


--
-- Name: FUNCTION pgp_sym_encrypt(text, text, text); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.pgp_sym_encrypt(text, text, text) FROM postgres;
GRANT ALL ON FUNCTION extensions.pgp_sym_encrypt(text, text, text) TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.pgp_sym_encrypt(text, text, text) TO dashboard_user;


--
-- Name: FUNCTION pgp_sym_encrypt_bytea(bytea, text); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.pgp_sym_encrypt_bytea(bytea, text) FROM postgres;
GRANT ALL ON FUNCTION extensions.pgp_sym_encrypt_bytea(bytea, text) TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.pgp_sym_encrypt_bytea(bytea, text) TO dashboard_user;


--
-- Name: FUNCTION pgp_sym_encrypt_bytea(bytea, text, text); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.pgp_sym_encrypt_bytea(bytea, text, text) FROM postgres;
GRANT ALL ON FUNCTION extensions.pgp_sym_encrypt_bytea(bytea, text, text) TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.pgp_sym_encrypt_bytea(bytea, text, text) TO dashboard_user;


--
-- Name: FUNCTION pgrst_ddl_watch(); Type: ACL; Schema: extensions; Owner: supabase_admin
--

GRANT ALL ON FUNCTION extensions.pgrst_ddl_watch() TO postgres WITH GRANT OPTION;


--
-- Name: FUNCTION pgrst_drop_watch(); Type: ACL; Schema: extensions; Owner: supabase_admin
--

GRANT ALL ON FUNCTION extensions.pgrst_drop_watch() TO postgres WITH GRANT OPTION;


--
-- Name: FUNCTION set_graphql_placeholder(); Type: ACL; Schema: extensions; Owner: supabase_admin
--

GRANT ALL ON FUNCTION extensions.set_graphql_placeholder() TO postgres WITH GRANT OPTION;


--
-- Name: FUNCTION uuid_generate_v1(); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.uuid_generate_v1() FROM postgres;
GRANT ALL ON FUNCTION extensions.uuid_generate_v1() TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.uuid_generate_v1() TO dashboard_user;


--
-- Name: FUNCTION uuid_generate_v1mc(); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.uuid_generate_v1mc() FROM postgres;
GRANT ALL ON FUNCTION extensions.uuid_generate_v1mc() TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.uuid_generate_v1mc() TO dashboard_user;


--
-- Name: FUNCTION uuid_generate_v3(namespace uuid, name text); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.uuid_generate_v3(namespace uuid, name text) FROM postgres;
GRANT ALL ON FUNCTION extensions.uuid_generate_v3(namespace uuid, name text) TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.uuid_generate_v3(namespace uuid, name text) TO dashboard_user;


--
-- Name: FUNCTION uuid_generate_v4(); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.uuid_generate_v4() FROM postgres;
GRANT ALL ON FUNCTION extensions.uuid_generate_v4() TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.uuid_generate_v4() TO dashboard_user;


--
-- Name: FUNCTION uuid_generate_v5(namespace uuid, name text); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.uuid_generate_v5(namespace uuid, name text) FROM postgres;
GRANT ALL ON FUNCTION extensions.uuid_generate_v5(namespace uuid, name text) TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.uuid_generate_v5(namespace uuid, name text) TO dashboard_user;


--
-- Name: FUNCTION uuid_nil(); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.uuid_nil() FROM postgres;
GRANT ALL ON FUNCTION extensions.uuid_nil() TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.uuid_nil() TO dashboard_user;


--
-- Name: FUNCTION uuid_ns_dns(); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.uuid_ns_dns() FROM postgres;
GRANT ALL ON FUNCTION extensions.uuid_ns_dns() TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.uuid_ns_dns() TO dashboard_user;


--
-- Name: FUNCTION uuid_ns_oid(); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.uuid_ns_oid() FROM postgres;
GRANT ALL ON FUNCTION extensions.uuid_ns_oid() TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.uuid_ns_oid() TO dashboard_user;


--
-- Name: FUNCTION uuid_ns_url(); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.uuid_ns_url() FROM postgres;
GRANT ALL ON FUNCTION extensions.uuid_ns_url() TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.uuid_ns_url() TO dashboard_user;


--
-- Name: FUNCTION uuid_ns_x500(); Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON FUNCTION extensions.uuid_ns_x500() FROM postgres;
GRANT ALL ON FUNCTION extensions.uuid_ns_x500() TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION extensions.uuid_ns_x500() TO dashboard_user;


--
-- Name: FUNCTION graphql("operationName" text, query text, variables jsonb, extensions jsonb); Type: ACL; Schema: graphql_public; Owner: supabase_admin
--

GRANT ALL ON FUNCTION graphql_public.graphql("operationName" text, query text, variables jsonb, extensions jsonb) TO postgres;
GRANT ALL ON FUNCTION graphql_public.graphql("operationName" text, query text, variables jsonb, extensions jsonb) TO anon;
GRANT ALL ON FUNCTION graphql_public.graphql("operationName" text, query text, variables jsonb, extensions jsonb) TO authenticated;
GRANT ALL ON FUNCTION graphql_public.graphql("operationName" text, query text, variables jsonb, extensions jsonb) TO service_role;


--
-- Name: FUNCTION get_auth(p_usename text); Type: ACL; Schema: pgbouncer; Owner: supabase_admin
--

REVOKE ALL ON FUNCTION pgbouncer.get_auth(p_usename text) FROM PUBLIC;
GRANT ALL ON FUNCTION pgbouncer.get_auth(p_usename text) TO pgbouncer;


--
-- Name: FUNCTION calculate_child_age_months(birth_date date); Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON FUNCTION public.calculate_child_age_months(birth_date date) TO anon;
GRANT ALL ON FUNCTION public.calculate_child_age_months(birth_date date) TO authenticated;
GRANT ALL ON FUNCTION public.calculate_child_age_months(birth_date date) TO service_role;


--
-- Name: FUNCTION calculate_next_payment_due(); Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON FUNCTION public.calculate_next_payment_due() TO anon;
GRANT ALL ON FUNCTION public.calculate_next_payment_due() TO authenticated;
GRANT ALL ON FUNCTION public.calculate_next_payment_due() TO service_role;


--
-- Name: FUNCTION create_class_reminder_notifications(); Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON FUNCTION public.create_class_reminder_notifications() TO anon;
GRANT ALL ON FUNCTION public.create_class_reminder_notifications() TO authenticated;
GRANT ALL ON FUNCTION public.create_class_reminder_notifications() TO service_role;


--
-- Name: FUNCTION create_default_notification_preferences(); Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON FUNCTION public.create_default_notification_preferences() TO anon;
GRANT ALL ON FUNCTION public.create_default_notification_preferences() TO authenticated;
GRANT ALL ON FUNCTION public.create_default_notification_preferences() TO service_role;


--
-- Name: FUNCTION create_waitlist_promotion_notification(); Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON FUNCTION public.create_waitlist_promotion_notification() TO anon;
GRANT ALL ON FUNCTION public.create_waitlist_promotion_notification() TO authenticated;
GRANT ALL ON FUNCTION public.create_waitlist_promotion_notification() TO service_role;


--
-- Name: FUNCTION generate_corporate_invoice_number(); Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON FUNCTION public.generate_corporate_invoice_number() TO anon;
GRANT ALL ON FUNCTION public.generate_corporate_invoice_number() TO authenticated;
GRANT ALL ON FUNCTION public.generate_corporate_invoice_number() TO service_role;


--
-- Name: FUNCTION generate_member_barcode(); Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON FUNCTION public.generate_member_barcode() TO anon;
GRANT ALL ON FUNCTION public.generate_member_barcode() TO authenticated;
GRANT ALL ON FUNCTION public.generate_member_barcode() TO service_role;


--
-- Name: FUNCTION generate_member_card_number(); Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON FUNCTION public.generate_member_card_number() TO anon;
GRANT ALL ON FUNCTION public.generate_member_card_number() TO authenticated;
GRANT ALL ON FUNCTION public.generate_member_card_number() TO service_role;


--
-- Name: FUNCTION generate_pos_sale_number(); Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON FUNCTION public.generate_pos_sale_number() TO anon;
GRANT ALL ON FUNCTION public.generate_pos_sale_number() TO authenticated;
GRANT ALL ON FUNCTION public.generate_pos_sale_number() TO service_role;


--
-- Name: FUNCTION generate_referral_code(); Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON FUNCTION public.generate_referral_code() TO anon;
GRANT ALL ON FUNCTION public.generate_referral_code() TO authenticated;
GRANT ALL ON FUNCTION public.generate_referral_code() TO service_role;


--
-- Name: FUNCTION generate_transaction_number(); Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON FUNCTION public.generate_transaction_number() TO anon;
GRANT ALL ON FUNCTION public.generate_transaction_number() TO authenticated;
GRANT ALL ON FUNCTION public.generate_transaction_number() TO service_role;


--
-- Name: FUNCTION get_user_organization_id(user_id uuid); Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON FUNCTION public.get_user_organization_id(user_id uuid) TO anon;
GRANT ALL ON FUNCTION public.get_user_organization_id(user_id uuid) TO authenticated;
GRANT ALL ON FUNCTION public.get_user_organization_id(user_id uuid) TO service_role;


--
-- Name: FUNCTION handle_cleaning_completion(); Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON FUNCTION public.handle_cleaning_completion() TO anon;
GRANT ALL ON FUNCTION public.handle_cleaning_completion() TO authenticated;
GRANT ALL ON FUNCTION public.handle_cleaning_completion() TO service_role;


--
-- Name: FUNCTION handle_member_barcode_generation(); Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON FUNCTION public.handle_member_barcode_generation() TO anon;
GRANT ALL ON FUNCTION public.handle_member_barcode_generation() TO authenticated;
GRANT ALL ON FUNCTION public.handle_member_barcode_generation() TO service_role;


--
-- Name: FUNCTION handle_new_user(); Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON FUNCTION public.handle_new_user() TO anon;
GRANT ALL ON FUNCTION public.handle_new_user() TO authenticated;
GRANT ALL ON FUNCTION public.handle_new_user() TO service_role;


--
-- Name: FUNCTION promote_from_waitlist(); Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON FUNCTION public.promote_from_waitlist() TO anon;
GRANT ALL ON FUNCTION public.promote_from_waitlist() TO authenticated;
GRANT ALL ON FUNCTION public.promote_from_waitlist() TO service_role;


--
-- Name: FUNCTION recalculate_lead_scores(org_id uuid); Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON FUNCTION public.recalculate_lead_scores(org_id uuid) TO anon;
GRANT ALL ON FUNCTION public.recalculate_lead_scores(org_id uuid) TO authenticated;
GRANT ALL ON FUNCTION public.recalculate_lead_scores(org_id uuid) TO service_role;


--
-- Name: FUNCTION schedule_next_inspection(); Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON FUNCTION public.schedule_next_inspection() TO anon;
GRANT ALL ON FUNCTION public.schedule_next_inspection() TO authenticated;
GRANT ALL ON FUNCTION public.schedule_next_inspection() TO service_role;


--
-- Name: FUNCTION set_corporate_invoice_number(); Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON FUNCTION public.set_corporate_invoice_number() TO anon;
GRANT ALL ON FUNCTION public.set_corporate_invoice_number() TO authenticated;
GRANT ALL ON FUNCTION public.set_corporate_invoice_number() TO service_role;


--
-- Name: FUNCTION set_pos_sale_number(); Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON FUNCTION public.set_pos_sale_number() TO anon;
GRANT ALL ON FUNCTION public.set_pos_sale_number() TO authenticated;
GRANT ALL ON FUNCTION public.set_pos_sale_number() TO service_role;


--
-- Name: FUNCTION set_transaction_number(); Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON FUNCTION public.set_transaction_number() TO anon;
GRANT ALL ON FUNCTION public.set_transaction_number() TO authenticated;
GRANT ALL ON FUNCTION public.set_transaction_number() TO service_role;


--
-- Name: FUNCTION setup_default_lead_stages(org_id uuid); Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON FUNCTION public.setup_default_lead_stages(org_id uuid) TO anon;
GRANT ALL ON FUNCTION public.setup_default_lead_stages(org_id uuid) TO authenticated;
GRANT ALL ON FUNCTION public.setup_default_lead_stages(org_id uuid) TO service_role;


--
-- Name: FUNCTION trigger_setup_lead_stages(); Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON FUNCTION public.trigger_setup_lead_stages() TO anon;
GRANT ALL ON FUNCTION public.trigger_setup_lead_stages() TO authenticated;
GRANT ALL ON FUNCTION public.trigger_setup_lead_stages() TO service_role;


--
-- Name: FUNCTION update_ai_automation_updated_at(); Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON FUNCTION public.update_ai_automation_updated_at() TO anon;
GRANT ALL ON FUNCTION public.update_ai_automation_updated_at() TO authenticated;
GRANT ALL ON FUNCTION public.update_ai_automation_updated_at() TO service_role;


--
-- Name: FUNCTION update_corporate_member_allocation(); Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON FUNCTION public.update_corporate_member_allocation() TO anon;
GRANT ALL ON FUNCTION public.update_corporate_member_allocation() TO authenticated;
GRANT ALL ON FUNCTION public.update_corporate_member_allocation() TO service_role;


--
-- Name: FUNCTION update_equipment_maintenance_schedule(); Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON FUNCTION public.update_equipment_maintenance_schedule() TO anon;
GRANT ALL ON FUNCTION public.update_equipment_maintenance_schedule() TO authenticated;
GRANT ALL ON FUNCTION public.update_equipment_maintenance_schedule() TO service_role;


--
-- Name: FUNCTION update_inspection_statistics(); Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON FUNCTION public.update_inspection_statistics() TO anon;
GRANT ALL ON FUNCTION public.update_inspection_statistics() TO authenticated;
GRANT ALL ON FUNCTION public.update_inspection_statistics() TO service_role;


--
-- Name: FUNCTION update_integration_updated_at(); Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON FUNCTION public.update_integration_updated_at() TO anon;
GRANT ALL ON FUNCTION public.update_integration_updated_at() TO authenticated;
GRANT ALL ON FUNCTION public.update_integration_updated_at() TO service_role;


--
-- Name: FUNCTION update_inventory_on_transaction(); Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON FUNCTION public.update_inventory_on_transaction() TO anon;
GRANT ALL ON FUNCTION public.update_inventory_on_transaction() TO authenticated;
GRANT ALL ON FUNCTION public.update_inventory_on_transaction() TO service_role;


--
-- Name: FUNCTION update_towel_inventory_quantities(); Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON FUNCTION public.update_towel_inventory_quantities() TO anon;
GRANT ALL ON FUNCTION public.update_towel_inventory_quantities() TO authenticated;
GRANT ALL ON FUNCTION public.update_towel_inventory_quantities() TO service_role;


--
-- Name: FUNCTION update_updated_at_column(); Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON FUNCTION public.update_updated_at_column() TO anon;
GRANT ALL ON FUNCTION public.update_updated_at_column() TO authenticated;
GRANT ALL ON FUNCTION public.update_updated_at_column() TO service_role;


--
-- Name: FUNCTION update_waitlist_priority(); Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON FUNCTION public.update_waitlist_priority() TO anon;
GRANT ALL ON FUNCTION public.update_waitlist_priority() TO authenticated;
GRANT ALL ON FUNCTION public.update_waitlist_priority() TO service_role;


--
-- Name: FUNCTION apply_rls(wal jsonb, max_record_bytes integer); Type: ACL; Schema: realtime; Owner: supabase_admin
--

GRANT ALL ON FUNCTION realtime.apply_rls(wal jsonb, max_record_bytes integer) TO postgres;
GRANT ALL ON FUNCTION realtime.apply_rls(wal jsonb, max_record_bytes integer) TO dashboard_user;
GRANT ALL ON FUNCTION realtime.apply_rls(wal jsonb, max_record_bytes integer) TO anon;
GRANT ALL ON FUNCTION realtime.apply_rls(wal jsonb, max_record_bytes integer) TO authenticated;
GRANT ALL ON FUNCTION realtime.apply_rls(wal jsonb, max_record_bytes integer) TO service_role;
GRANT ALL ON FUNCTION realtime.apply_rls(wal jsonb, max_record_bytes integer) TO supabase_realtime_admin;


--
-- Name: FUNCTION broadcast_changes(topic_name text, event_name text, operation text, table_name text, table_schema text, new record, old record, level text); Type: ACL; Schema: realtime; Owner: supabase_admin
--

GRANT ALL ON FUNCTION realtime.broadcast_changes(topic_name text, event_name text, operation text, table_name text, table_schema text, new record, old record, level text) TO postgres;
GRANT ALL ON FUNCTION realtime.broadcast_changes(topic_name text, event_name text, operation text, table_name text, table_schema text, new record, old record, level text) TO dashboard_user;


--
-- Name: FUNCTION build_prepared_statement_sql(prepared_statement_name text, entity regclass, columns realtime.wal_column[]); Type: ACL; Schema: realtime; Owner: supabase_admin
--

GRANT ALL ON FUNCTION realtime.build_prepared_statement_sql(prepared_statement_name text, entity regclass, columns realtime.wal_column[]) TO postgres;
GRANT ALL ON FUNCTION realtime.build_prepared_statement_sql(prepared_statement_name text, entity regclass, columns realtime.wal_column[]) TO dashboard_user;
GRANT ALL ON FUNCTION realtime.build_prepared_statement_sql(prepared_statement_name text, entity regclass, columns realtime.wal_column[]) TO anon;
GRANT ALL ON FUNCTION realtime.build_prepared_statement_sql(prepared_statement_name text, entity regclass, columns realtime.wal_column[]) TO authenticated;
GRANT ALL ON FUNCTION realtime.build_prepared_statement_sql(prepared_statement_name text, entity regclass, columns realtime.wal_column[]) TO service_role;
GRANT ALL ON FUNCTION realtime.build_prepared_statement_sql(prepared_statement_name text, entity regclass, columns realtime.wal_column[]) TO supabase_realtime_admin;


--
-- Name: FUNCTION "cast"(val text, type_ regtype); Type: ACL; Schema: realtime; Owner: supabase_admin
--

GRANT ALL ON FUNCTION realtime."cast"(val text, type_ regtype) TO postgres;
GRANT ALL ON FUNCTION realtime."cast"(val text, type_ regtype) TO dashboard_user;
GRANT ALL ON FUNCTION realtime."cast"(val text, type_ regtype) TO anon;
GRANT ALL ON FUNCTION realtime."cast"(val text, type_ regtype) TO authenticated;
GRANT ALL ON FUNCTION realtime."cast"(val text, type_ regtype) TO service_role;
GRANT ALL ON FUNCTION realtime."cast"(val text, type_ regtype) TO supabase_realtime_admin;


--
-- Name: FUNCTION check_equality_op(op realtime.equality_op, type_ regtype, val_1 text, val_2 text); Type: ACL; Schema: realtime; Owner: supabase_admin
--

GRANT ALL ON FUNCTION realtime.check_equality_op(op realtime.equality_op, type_ regtype, val_1 text, val_2 text) TO postgres;
GRANT ALL ON FUNCTION realtime.check_equality_op(op realtime.equality_op, type_ regtype, val_1 text, val_2 text) TO dashboard_user;
GRANT ALL ON FUNCTION realtime.check_equality_op(op realtime.equality_op, type_ regtype, val_1 text, val_2 text) TO anon;
GRANT ALL ON FUNCTION realtime.check_equality_op(op realtime.equality_op, type_ regtype, val_1 text, val_2 text) TO authenticated;
GRANT ALL ON FUNCTION realtime.check_equality_op(op realtime.equality_op, type_ regtype, val_1 text, val_2 text) TO service_role;
GRANT ALL ON FUNCTION realtime.check_equality_op(op realtime.equality_op, type_ regtype, val_1 text, val_2 text) TO supabase_realtime_admin;


--
-- Name: FUNCTION is_visible_through_filters(columns realtime.wal_column[], filters realtime.user_defined_filter[]); Type: ACL; Schema: realtime; Owner: supabase_admin
--

GRANT ALL ON FUNCTION realtime.is_visible_through_filters(columns realtime.wal_column[], filters realtime.user_defined_filter[]) TO postgres;
GRANT ALL ON FUNCTION realtime.is_visible_through_filters(columns realtime.wal_column[], filters realtime.user_defined_filter[]) TO dashboard_user;
GRANT ALL ON FUNCTION realtime.is_visible_through_filters(columns realtime.wal_column[], filters realtime.user_defined_filter[]) TO anon;
GRANT ALL ON FUNCTION realtime.is_visible_through_filters(columns realtime.wal_column[], filters realtime.user_defined_filter[]) TO authenticated;
GRANT ALL ON FUNCTION realtime.is_visible_through_filters(columns realtime.wal_column[], filters realtime.user_defined_filter[]) TO service_role;
GRANT ALL ON FUNCTION realtime.is_visible_through_filters(columns realtime.wal_column[], filters realtime.user_defined_filter[]) TO supabase_realtime_admin;


--
-- Name: FUNCTION list_changes(publication name, slot_name name, max_changes integer, max_record_bytes integer); Type: ACL; Schema: realtime; Owner: supabase_admin
--

GRANT ALL ON FUNCTION realtime.list_changes(publication name, slot_name name, max_changes integer, max_record_bytes integer) TO postgres;
GRANT ALL ON FUNCTION realtime.list_changes(publication name, slot_name name, max_changes integer, max_record_bytes integer) TO dashboard_user;
GRANT ALL ON FUNCTION realtime.list_changes(publication name, slot_name name, max_changes integer, max_record_bytes integer) TO anon;
GRANT ALL ON FUNCTION realtime.list_changes(publication name, slot_name name, max_changes integer, max_record_bytes integer) TO authenticated;
GRANT ALL ON FUNCTION realtime.list_changes(publication name, slot_name name, max_changes integer, max_record_bytes integer) TO service_role;
GRANT ALL ON FUNCTION realtime.list_changes(publication name, slot_name name, max_changes integer, max_record_bytes integer) TO supabase_realtime_admin;


--
-- Name: FUNCTION quote_wal2json(entity regclass); Type: ACL; Schema: realtime; Owner: supabase_admin
--

GRANT ALL ON FUNCTION realtime.quote_wal2json(entity regclass) TO postgres;
GRANT ALL ON FUNCTION realtime.quote_wal2json(entity regclass) TO dashboard_user;
GRANT ALL ON FUNCTION realtime.quote_wal2json(entity regclass) TO anon;
GRANT ALL ON FUNCTION realtime.quote_wal2json(entity regclass) TO authenticated;
GRANT ALL ON FUNCTION realtime.quote_wal2json(entity regclass) TO service_role;
GRANT ALL ON FUNCTION realtime.quote_wal2json(entity regclass) TO supabase_realtime_admin;


--
-- Name: FUNCTION send(payload jsonb, event text, topic text, private boolean); Type: ACL; Schema: realtime; Owner: supabase_admin
--

GRANT ALL ON FUNCTION realtime.send(payload jsonb, event text, topic text, private boolean) TO postgres;
GRANT ALL ON FUNCTION realtime.send(payload jsonb, event text, topic text, private boolean) TO dashboard_user;


--
-- Name: FUNCTION subscription_check_filters(); Type: ACL; Schema: realtime; Owner: supabase_admin
--

GRANT ALL ON FUNCTION realtime.subscription_check_filters() TO postgres;
GRANT ALL ON FUNCTION realtime.subscription_check_filters() TO dashboard_user;
GRANT ALL ON FUNCTION realtime.subscription_check_filters() TO anon;
GRANT ALL ON FUNCTION realtime.subscription_check_filters() TO authenticated;
GRANT ALL ON FUNCTION realtime.subscription_check_filters() TO service_role;
GRANT ALL ON FUNCTION realtime.subscription_check_filters() TO supabase_realtime_admin;


--
-- Name: FUNCTION to_regrole(role_name text); Type: ACL; Schema: realtime; Owner: supabase_admin
--

GRANT ALL ON FUNCTION realtime.to_regrole(role_name text) TO postgres;
GRANT ALL ON FUNCTION realtime.to_regrole(role_name text) TO dashboard_user;
GRANT ALL ON FUNCTION realtime.to_regrole(role_name text) TO anon;
GRANT ALL ON FUNCTION realtime.to_regrole(role_name text) TO authenticated;
GRANT ALL ON FUNCTION realtime.to_regrole(role_name text) TO service_role;
GRANT ALL ON FUNCTION realtime.to_regrole(role_name text) TO supabase_realtime_admin;


--
-- Name: FUNCTION topic(); Type: ACL; Schema: realtime; Owner: supabase_realtime_admin
--

GRANT ALL ON FUNCTION realtime.topic() TO postgres;
GRANT ALL ON FUNCTION realtime.topic() TO dashboard_user;


--
-- Name: FUNCTION _crypto_aead_det_decrypt(message bytea, additional bytea, key_id bigint, context bytea, nonce bytea); Type: ACL; Schema: vault; Owner: supabase_admin
--

GRANT ALL ON FUNCTION vault._crypto_aead_det_decrypt(message bytea, additional bytea, key_id bigint, context bytea, nonce bytea) TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION vault._crypto_aead_det_decrypt(message bytea, additional bytea, key_id bigint, context bytea, nonce bytea) TO service_role;


--
-- Name: FUNCTION create_secret(new_secret text, new_name text, new_description text, new_key_id uuid); Type: ACL; Schema: vault; Owner: supabase_admin
--

GRANT ALL ON FUNCTION vault.create_secret(new_secret text, new_name text, new_description text, new_key_id uuid) TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION vault.create_secret(new_secret text, new_name text, new_description text, new_key_id uuid) TO service_role;


--
-- Name: FUNCTION update_secret(secret_id uuid, new_secret text, new_name text, new_description text, new_key_id uuid); Type: ACL; Schema: vault; Owner: supabase_admin
--

GRANT ALL ON FUNCTION vault.update_secret(secret_id uuid, new_secret text, new_name text, new_description text, new_key_id uuid) TO postgres WITH GRANT OPTION;
GRANT ALL ON FUNCTION vault.update_secret(secret_id uuid, new_secret text, new_name text, new_description text, new_key_id uuid) TO service_role;


--
-- Name: TABLE audit_log_entries; Type: ACL; Schema: auth; Owner: supabase_auth_admin
--

GRANT ALL ON TABLE auth.audit_log_entries TO dashboard_user;
GRANT INSERT,REFERENCES,DELETE,TRIGGER,TRUNCATE,MAINTAIN,UPDATE ON TABLE auth.audit_log_entries TO postgres;
GRANT SELECT ON TABLE auth.audit_log_entries TO postgres WITH GRANT OPTION;


--
-- Name: TABLE flow_state; Type: ACL; Schema: auth; Owner: supabase_auth_admin
--

GRANT INSERT,REFERENCES,DELETE,TRIGGER,TRUNCATE,MAINTAIN,UPDATE ON TABLE auth.flow_state TO postgres;
GRANT SELECT ON TABLE auth.flow_state TO postgres WITH GRANT OPTION;
GRANT ALL ON TABLE auth.flow_state TO dashboard_user;


--
-- Name: TABLE identities; Type: ACL; Schema: auth; Owner: supabase_auth_admin
--

GRANT INSERT,REFERENCES,DELETE,TRIGGER,TRUNCATE,MAINTAIN,UPDATE ON TABLE auth.identities TO postgres;
GRANT SELECT ON TABLE auth.identities TO postgres WITH GRANT OPTION;
GRANT ALL ON TABLE auth.identities TO dashboard_user;


--
-- Name: TABLE instances; Type: ACL; Schema: auth; Owner: supabase_auth_admin
--

GRANT ALL ON TABLE auth.instances TO dashboard_user;
GRANT INSERT,REFERENCES,DELETE,TRIGGER,TRUNCATE,MAINTAIN,UPDATE ON TABLE auth.instances TO postgres;
GRANT SELECT ON TABLE auth.instances TO postgres WITH GRANT OPTION;


--
-- Name: TABLE mfa_amr_claims; Type: ACL; Schema: auth; Owner: supabase_auth_admin
--

GRANT INSERT,REFERENCES,DELETE,TRIGGER,TRUNCATE,MAINTAIN,UPDATE ON TABLE auth.mfa_amr_claims TO postgres;
GRANT SELECT ON TABLE auth.mfa_amr_claims TO postgres WITH GRANT OPTION;
GRANT ALL ON TABLE auth.mfa_amr_claims TO dashboard_user;


--
-- Name: TABLE mfa_challenges; Type: ACL; Schema: auth; Owner: supabase_auth_admin
--

GRANT INSERT,REFERENCES,DELETE,TRIGGER,TRUNCATE,MAINTAIN,UPDATE ON TABLE auth.mfa_challenges TO postgres;
GRANT SELECT ON TABLE auth.mfa_challenges TO postgres WITH GRANT OPTION;
GRANT ALL ON TABLE auth.mfa_challenges TO dashboard_user;


--
-- Name: TABLE mfa_factors; Type: ACL; Schema: auth; Owner: supabase_auth_admin
--

GRANT INSERT,REFERENCES,DELETE,TRIGGER,TRUNCATE,MAINTAIN,UPDATE ON TABLE auth.mfa_factors TO postgres;
GRANT SELECT ON TABLE auth.mfa_factors TO postgres WITH GRANT OPTION;
GRANT ALL ON TABLE auth.mfa_factors TO dashboard_user;


--
-- Name: TABLE oauth_authorizations; Type: ACL; Schema: auth; Owner: supabase_auth_admin
--

GRANT ALL ON TABLE auth.oauth_authorizations TO postgres;
GRANT ALL ON TABLE auth.oauth_authorizations TO dashboard_user;


--
-- Name: TABLE oauth_client_states; Type: ACL; Schema: auth; Owner: supabase_auth_admin
--

GRANT ALL ON TABLE auth.oauth_client_states TO postgres;
GRANT ALL ON TABLE auth.oauth_client_states TO dashboard_user;


--
-- Name: TABLE oauth_clients; Type: ACL; Schema: auth; Owner: supabase_auth_admin
--

GRANT ALL ON TABLE auth.oauth_clients TO postgres;
GRANT ALL ON TABLE auth.oauth_clients TO dashboard_user;


--
-- Name: TABLE oauth_consents; Type: ACL; Schema: auth; Owner: supabase_auth_admin
--

GRANT ALL ON TABLE auth.oauth_consents TO postgres;
GRANT ALL ON TABLE auth.oauth_consents TO dashboard_user;


--
-- Name: TABLE one_time_tokens; Type: ACL; Schema: auth; Owner: supabase_auth_admin
--

GRANT INSERT,REFERENCES,DELETE,TRIGGER,TRUNCATE,MAINTAIN,UPDATE ON TABLE auth.one_time_tokens TO postgres;
GRANT SELECT ON TABLE auth.one_time_tokens TO postgres WITH GRANT OPTION;
GRANT ALL ON TABLE auth.one_time_tokens TO dashboard_user;


--
-- Name: TABLE refresh_tokens; Type: ACL; Schema: auth; Owner: supabase_auth_admin
--

GRANT ALL ON TABLE auth.refresh_tokens TO dashboard_user;
GRANT INSERT,REFERENCES,DELETE,TRIGGER,TRUNCATE,MAINTAIN,UPDATE ON TABLE auth.refresh_tokens TO postgres;
GRANT SELECT ON TABLE auth.refresh_tokens TO postgres WITH GRANT OPTION;


--
-- Name: SEQUENCE refresh_tokens_id_seq; Type: ACL; Schema: auth; Owner: supabase_auth_admin
--

GRANT ALL ON SEQUENCE auth.refresh_tokens_id_seq TO dashboard_user;
GRANT ALL ON SEQUENCE auth.refresh_tokens_id_seq TO postgres;


--
-- Name: TABLE saml_providers; Type: ACL; Schema: auth; Owner: supabase_auth_admin
--

GRANT INSERT,REFERENCES,DELETE,TRIGGER,TRUNCATE,MAINTAIN,UPDATE ON TABLE auth.saml_providers TO postgres;
GRANT SELECT ON TABLE auth.saml_providers TO postgres WITH GRANT OPTION;
GRANT ALL ON TABLE auth.saml_providers TO dashboard_user;


--
-- Name: TABLE saml_relay_states; Type: ACL; Schema: auth; Owner: supabase_auth_admin
--

GRANT INSERT,REFERENCES,DELETE,TRIGGER,TRUNCATE,MAINTAIN,UPDATE ON TABLE auth.saml_relay_states TO postgres;
GRANT SELECT ON TABLE auth.saml_relay_states TO postgres WITH GRANT OPTION;
GRANT ALL ON TABLE auth.saml_relay_states TO dashboard_user;


--
-- Name: TABLE sessions; Type: ACL; Schema: auth; Owner: supabase_auth_admin
--

GRANT INSERT,REFERENCES,DELETE,TRIGGER,TRUNCATE,MAINTAIN,UPDATE ON TABLE auth.sessions TO postgres;
GRANT SELECT ON TABLE auth.sessions TO postgres WITH GRANT OPTION;
GRANT ALL ON TABLE auth.sessions TO dashboard_user;


--
-- Name: TABLE sso_domains; Type: ACL; Schema: auth; Owner: supabase_auth_admin
--

GRANT INSERT,REFERENCES,DELETE,TRIGGER,TRUNCATE,MAINTAIN,UPDATE ON TABLE auth.sso_domains TO postgres;
GRANT SELECT ON TABLE auth.sso_domains TO postgres WITH GRANT OPTION;
GRANT ALL ON TABLE auth.sso_domains TO dashboard_user;


--
-- Name: TABLE sso_providers; Type: ACL; Schema: auth; Owner: supabase_auth_admin
--

GRANT INSERT,REFERENCES,DELETE,TRIGGER,TRUNCATE,MAINTAIN,UPDATE ON TABLE auth.sso_providers TO postgres;
GRANT SELECT ON TABLE auth.sso_providers TO postgres WITH GRANT OPTION;
GRANT ALL ON TABLE auth.sso_providers TO dashboard_user;


--
-- Name: TABLE users; Type: ACL; Schema: auth; Owner: supabase_auth_admin
--

GRANT ALL ON TABLE auth.users TO dashboard_user;
GRANT INSERT,REFERENCES,DELETE,TRIGGER,TRUNCATE,MAINTAIN,UPDATE ON TABLE auth.users TO postgres;
GRANT SELECT ON TABLE auth.users TO postgres WITH GRANT OPTION;


--
-- Name: TABLE pg_stat_statements; Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON TABLE extensions.pg_stat_statements FROM postgres;
GRANT ALL ON TABLE extensions.pg_stat_statements TO postgres WITH GRANT OPTION;
GRANT ALL ON TABLE extensions.pg_stat_statements TO dashboard_user;


--
-- Name: TABLE pg_stat_statements_info; Type: ACL; Schema: extensions; Owner: postgres
--

REVOKE ALL ON TABLE extensions.pg_stat_statements_info FROM postgres;
GRANT ALL ON TABLE extensions.pg_stat_statements_info TO postgres WITH GRANT OPTION;
GRANT ALL ON TABLE extensions.pg_stat_statements_info TO dashboard_user;


--
-- Name: TABLE ai_model_settings; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.ai_model_settings TO anon;
GRANT ALL ON TABLE public.ai_model_settings TO authenticated;
GRANT ALL ON TABLE public.ai_model_settings TO service_role;


--
-- Name: TABLE announcements; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.announcements TO anon;
GRANT ALL ON TABLE public.announcements TO authenticated;
GRANT ALL ON TABLE public.announcements TO service_role;


--
-- Name: TABLE api_keys; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.api_keys TO anon;
GRANT ALL ON TABLE public.api_keys TO authenticated;
GRANT ALL ON TABLE public.api_keys TO service_role;


--
-- Name: TABLE blog_auto_generation_settings; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.blog_auto_generation_settings TO anon;
GRANT ALL ON TABLE public.blog_auto_generation_settings TO authenticated;
GRANT ALL ON TABLE public.blog_auto_generation_settings TO service_role;


--
-- Name: TABLE blog_categories; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.blog_categories TO anon;
GRANT ALL ON TABLE public.blog_categories TO authenticated;
GRANT ALL ON TABLE public.blog_categories TO service_role;


--
-- Name: TABLE blog_generation_queue; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.blog_generation_queue TO anon;
GRANT ALL ON TABLE public.blog_generation_queue TO authenticated;
GRANT ALL ON TABLE public.blog_generation_queue TO service_role;


--
-- Name: TABLE blog_post_tags; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.blog_post_tags TO anon;
GRANT ALL ON TABLE public.blog_post_tags TO authenticated;
GRANT ALL ON TABLE public.blog_post_tags TO service_role;


--
-- Name: TABLE blog_posts; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.blog_posts TO anon;
GRANT ALL ON TABLE public.blog_posts TO authenticated;
GRANT ALL ON TABLE public.blog_posts TO service_role;


--
-- Name: TABLE blog_tags; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.blog_tags TO anon;
GRANT ALL ON TABLE public.blog_tags TO authenticated;
GRANT ALL ON TABLE public.blog_tags TO service_role;


--
-- Name: TABLE blog_topic_history; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.blog_topic_history TO anon;
GRANT ALL ON TABLE public.blog_topic_history TO authenticated;
GRANT ALL ON TABLE public.blog_topic_history TO service_role;


--
-- Name: TABLE bulk_member_operations; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.bulk_member_operations TO anon;
GRANT ALL ON TABLE public.bulk_member_operations TO authenticated;
GRANT ALL ON TABLE public.bulk_member_operations TO service_role;


--
-- Name: TABLE campaign_executions; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.campaign_executions TO anon;
GRANT ALL ON TABLE public.campaign_executions TO authenticated;
GRANT ALL ON TABLE public.campaign_executions TO service_role;


--
-- Name: TABLE certification_requirements; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.certification_requirements TO anon;
GRANT ALL ON TABLE public.certification_requirements TO authenticated;
GRANT ALL ON TABLE public.certification_requirements TO service_role;


--
-- Name: TABLE check_ins; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.check_ins TO anon;
GRANT ALL ON TABLE public.check_ins TO authenticated;
GRANT ALL ON TABLE public.check_ins TO service_role;


--
-- Name: TABLE child_profiles; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.child_profiles TO anon;
GRANT ALL ON TABLE public.child_profiles TO authenticated;
GRANT ALL ON TABLE public.child_profiles TO service_role;


--
-- Name: TABLE childcare_activities; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.childcare_activities TO anon;
GRANT ALL ON TABLE public.childcare_activities TO authenticated;
GRANT ALL ON TABLE public.childcare_activities TO service_role;


--
-- Name: TABLE childcare_activity_registrations; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.childcare_activity_registrations TO anon;
GRANT ALL ON TABLE public.childcare_activity_registrations TO authenticated;
GRANT ALL ON TABLE public.childcare_activity_registrations TO service_role;


--
-- Name: TABLE childcare_checkins; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.childcare_checkins TO anon;
GRANT ALL ON TABLE public.childcare_checkins TO authenticated;
GRANT ALL ON TABLE public.childcare_checkins TO service_role;


--
-- Name: TABLE childcare_daily_reports; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.childcare_daily_reports TO anon;
GRANT ALL ON TABLE public.childcare_daily_reports TO authenticated;
GRANT ALL ON TABLE public.childcare_daily_reports TO service_role;


--
-- Name: TABLE childcare_staff_schedules; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.childcare_staff_schedules TO anon;
GRANT ALL ON TABLE public.childcare_staff_schedules TO authenticated;
GRANT ALL ON TABLE public.childcare_staff_schedules TO service_role;


--
-- Name: TABLE class_analytics; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.class_analytics TO anon;
GRANT ALL ON TABLE public.class_analytics TO authenticated;
GRANT ALL ON TABLE public.class_analytics TO service_role;


--
-- Name: TABLE class_bookings; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.class_bookings TO anon;
GRANT ALL ON TABLE public.class_bookings TO authenticated;
GRANT ALL ON TABLE public.class_bookings TO service_role;


--
-- Name: TABLE class_categories; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.class_categories TO anon;
GRANT ALL ON TABLE public.class_categories TO authenticated;
GRANT ALL ON TABLE public.class_categories TO service_role;


--
-- Name: TABLE class_waitlists; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.class_waitlists TO anon;
GRANT ALL ON TABLE public.class_waitlists TO authenticated;
GRANT ALL ON TABLE public.class_waitlists TO service_role;


--
-- Name: TABLE classes; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.classes TO anon;
GRANT ALL ON TABLE public.classes TO authenticated;
GRANT ALL ON TABLE public.classes TO service_role;


--
-- Name: TABLE cleaning_schedules; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.cleaning_schedules TO anon;
GRANT ALL ON TABLE public.cleaning_schedules TO authenticated;
GRANT ALL ON TABLE public.cleaning_schedules TO service_role;


--
-- Name: TABLE commission_calculations; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.commission_calculations TO anon;
GRANT ALL ON TABLE public.commission_calculations TO authenticated;
GRANT ALL ON TABLE public.commission_calculations TO service_role;


--
-- Name: TABLE communication_providers; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.communication_providers TO anon;
GRANT ALL ON TABLE public.communication_providers TO authenticated;
GRANT ALL ON TABLE public.communication_providers TO service_role;


--
-- Name: TABLE communication_templates; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.communication_templates TO anon;
GRANT ALL ON TABLE public.communication_templates TO authenticated;
GRANT ALL ON TABLE public.communication_templates TO service_role;


--
-- Name: TABLE corporate_accounts; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.corporate_accounts TO anon;
GRANT ALL ON TABLE public.corporate_accounts TO authenticated;
GRANT ALL ON TABLE public.corporate_accounts TO service_role;


--
-- Name: TABLE corporate_invoice_items; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.corporate_invoice_items TO anon;
GRANT ALL ON TABLE public.corporate_invoice_items TO authenticated;
GRANT ALL ON TABLE public.corporate_invoice_items TO service_role;


--
-- Name: TABLE corporate_invoices; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.corporate_invoices TO anon;
GRANT ALL ON TABLE public.corporate_invoices TO authenticated;
GRANT ALL ON TABLE public.corporate_invoices TO service_role;


--
-- Name: TABLE corporate_members; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.corporate_members TO anon;
GRANT ALL ON TABLE public.corporate_members TO authenticated;
GRANT ALL ON TABLE public.corporate_members TO service_role;


--
-- Name: TABLE corporate_membership_plans; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.corporate_membership_plans TO anon;
GRANT ALL ON TABLE public.corporate_membership_plans TO authenticated;
GRANT ALL ON TABLE public.corporate_membership_plans TO service_role;


--
-- Name: TABLE cost_allocations; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.cost_allocations TO anon;
GRANT ALL ON TABLE public.cost_allocations TO authenticated;
GRANT ALL ON TABLE public.cost_allocations TO service_role;


--
-- Name: TABLE court_reservations; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.court_reservations TO anon;
GRANT ALL ON TABLE public.court_reservations TO authenticated;
GRANT ALL ON TABLE public.court_reservations TO service_role;


--
-- Name: TABLE cross_location_assignments; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.cross_location_assignments TO anon;
GRANT ALL ON TABLE public.cross_location_assignments TO authenticated;
GRANT ALL ON TABLE public.cross_location_assignments TO service_role;


--
-- Name: TABLE cross_location_transfers; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.cross_location_transfers TO anon;
GRANT ALL ON TABLE public.cross_location_transfers TO authenticated;
GRANT ALL ON TABLE public.cross_location_transfers TO service_role;


--
-- Name: TABLE daily_analytics_snapshots; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.daily_analytics_snapshots TO anon;
GRANT ALL ON TABLE public.daily_analytics_snapshots TO authenticated;
GRANT ALL ON TABLE public.daily_analytics_snapshots TO service_role;


--
-- Name: TABLE department_budgets; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.department_budgets TO anon;
GRANT ALL ON TABLE public.department_budgets TO authenticated;
GRANT ALL ON TABLE public.department_budgets TO service_role;


--
-- Name: TABLE department_revenues; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.department_revenues TO anon;
GRANT ALL ON TABLE public.department_revenues TO authenticated;
GRANT ALL ON TABLE public.department_revenues TO service_role;


--
-- Name: TABLE early_access_requests; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.early_access_requests TO anon;
GRANT ALL ON TABLE public.early_access_requests TO authenticated;
GRANT ALL ON TABLE public.early_access_requests TO service_role;


--
-- Name: TABLE email_messages; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.email_messages TO anon;
GRANT ALL ON TABLE public.email_messages TO authenticated;
GRANT ALL ON TABLE public.email_messages TO service_role;


--
-- Name: TABLE email_responses; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.email_responses TO anon;
GRANT ALL ON TABLE public.email_responses TO authenticated;
GRANT ALL ON TABLE public.email_responses TO service_role;


--
-- Name: TABLE email_templates; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.email_templates TO anon;
GRANT ALL ON TABLE public.email_templates TO authenticated;
GRANT ALL ON TABLE public.email_templates TO service_role;


--
-- Name: TABLE email_threads; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.email_threads TO anon;
GRANT ALL ON TABLE public.email_threads TO authenticated;
GRANT ALL ON TABLE public.email_threads TO service_role;


--
-- Name: TABLE equipment; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.equipment TO anon;
GRANT ALL ON TABLE public.equipment TO authenticated;
GRANT ALL ON TABLE public.equipment TO service_role;


--
-- Name: TABLE equipment_checkout; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.equipment_checkout TO anon;
GRANT ALL ON TABLE public.equipment_checkout TO authenticated;
GRANT ALL ON TABLE public.equipment_checkout TO service_role;


--
-- Name: TABLE expense_categories; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.expense_categories TO anon;
GRANT ALL ON TABLE public.expense_categories TO authenticated;
GRANT ALL ON TABLE public.expense_categories TO service_role;


--
-- Name: TABLE expense_vendors; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.expense_vendors TO anon;
GRANT ALL ON TABLE public.expense_vendors TO authenticated;
GRANT ALL ON TABLE public.expense_vendors TO service_role;


--
-- Name: TABLE expenses; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.expenses TO anon;
GRANT ALL ON TABLE public.expenses TO authenticated;
GRANT ALL ON TABLE public.expenses TO service_role;


--
-- Name: TABLE facility_areas; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.facility_areas TO anon;
GRANT ALL ON TABLE public.facility_areas TO authenticated;
GRANT ALL ON TABLE public.facility_areas TO service_role;


--
-- Name: TABLE facility_tours; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.facility_tours TO anon;
GRANT ALL ON TABLE public.facility_tours TO authenticated;
GRANT ALL ON TABLE public.facility_tours TO service_role;


--
-- Name: TABLE fitness_assessments; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.fitness_assessments TO anon;
GRANT ALL ON TABLE public.fitness_assessments TO authenticated;
GRANT ALL ON TABLE public.fitness_assessments TO service_role;


--
-- Name: TABLE guest_pass_types; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.guest_pass_types TO anon;
GRANT ALL ON TABLE public.guest_pass_types TO authenticated;
GRANT ALL ON TABLE public.guest_pass_types TO service_role;


--
-- Name: TABLE guest_passes; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.guest_passes TO anon;
GRANT ALL ON TABLE public.guest_passes TO authenticated;
GRANT ALL ON TABLE public.guest_passes TO service_role;


--
-- Name: TABLE incident_follow_ups; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.incident_follow_ups TO anon;
GRANT ALL ON TABLE public.incident_follow_ups TO authenticated;
GRANT ALL ON TABLE public.incident_follow_ups TO service_role;


--
-- Name: TABLE incident_investigations; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.incident_investigations TO anon;
GRANT ALL ON TABLE public.incident_investigations TO authenticated;
GRANT ALL ON TABLE public.incident_investigations TO service_role;


--
-- Name: TABLE incident_reports; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.incident_reports TO anon;
GRANT ALL ON TABLE public.incident_reports TO authenticated;
GRANT ALL ON TABLE public.incident_reports TO service_role;


--
-- Name: TABLE inspection_checklist_items; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.inspection_checklist_items TO anon;
GRANT ALL ON TABLE public.inspection_checklist_items TO authenticated;
GRANT ALL ON TABLE public.inspection_checklist_items TO service_role;


--
-- Name: TABLE inspection_checklists; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.inspection_checklists TO anon;
GRANT ALL ON TABLE public.inspection_checklists TO authenticated;
GRANT ALL ON TABLE public.inspection_checklists TO service_role;


--
-- Name: TABLE inspection_results; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.inspection_results TO anon;
GRANT ALL ON TABLE public.inspection_results TO authenticated;
GRANT ALL ON TABLE public.inspection_results TO service_role;


--
-- Name: TABLE instructor_availability; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.instructor_availability TO anon;
GRANT ALL ON TABLE public.instructor_availability TO authenticated;
GRANT ALL ON TABLE public.instructor_availability TO service_role;


--
-- Name: TABLE insurance_claims; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.insurance_claims TO anon;
GRANT ALL ON TABLE public.insurance_claims TO authenticated;
GRANT ALL ON TABLE public.insurance_claims TO service_role;


--
-- Name: TABLE integration_logs; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.integration_logs TO anon;
GRANT ALL ON TABLE public.integration_logs TO authenticated;
GRANT ALL ON TABLE public.integration_logs TO service_role;


--
-- Name: TABLE integrations; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.integrations TO anon;
GRANT ALL ON TABLE public.integrations TO authenticated;
GRANT ALL ON TABLE public.integrations TO service_role;


--
-- Name: TABLE inventory_items; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.inventory_items TO anon;
GRANT ALL ON TABLE public.inventory_items TO authenticated;
GRANT ALL ON TABLE public.inventory_items TO service_role;


--
-- Name: TABLE kpi_metrics; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.kpi_metrics TO anon;
GRANT ALL ON TABLE public.kpi_metrics TO authenticated;
GRANT ALL ON TABLE public.kpi_metrics TO service_role;


--
-- Name: TABLE lead_activities; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.lead_activities TO anon;
GRANT ALL ON TABLE public.lead_activities TO authenticated;
GRANT ALL ON TABLE public.lead_activities TO service_role;


--
-- Name: TABLE lead_attribution_disputes; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.lead_attribution_disputes TO anon;
GRANT ALL ON TABLE public.lead_attribution_disputes TO authenticated;
GRANT ALL ON TABLE public.lead_attribution_disputes TO service_role;


--
-- Name: TABLE lead_scoring_rules; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.lead_scoring_rules TO anon;
GRANT ALL ON TABLE public.lead_scoring_rules TO authenticated;
GRANT ALL ON TABLE public.lead_scoring_rules TO service_role;


--
-- Name: TABLE lead_sources; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.lead_sources TO anon;
GRANT ALL ON TABLE public.lead_sources TO authenticated;
GRANT ALL ON TABLE public.lead_sources TO service_role;


--
-- Name: TABLE lead_split_commissions; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.lead_split_commissions TO anon;
GRANT ALL ON TABLE public.lead_split_commissions TO authenticated;
GRANT ALL ON TABLE public.lead_split_commissions TO service_role;


--
-- Name: TABLE lead_stages; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.lead_stages TO anon;
GRANT ALL ON TABLE public.lead_stages TO authenticated;
GRANT ALL ON TABLE public.lead_stages TO service_role;


--
-- Name: TABLE leads; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.leads TO anon;
GRANT ALL ON TABLE public.leads TO authenticated;
GRANT ALL ON TABLE public.leads TO service_role;


--
-- Name: TABLE liability_waivers; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.liability_waivers TO anon;
GRANT ALL ON TABLE public.liability_waivers TO authenticated;
GRANT ALL ON TABLE public.liability_waivers TO service_role;


--
-- Name: TABLE lifeguard_schedules; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.lifeguard_schedules TO anon;
GRANT ALL ON TABLE public.lifeguard_schedules TO authenticated;
GRANT ALL ON TABLE public.lifeguard_schedules TO service_role;


--
-- Name: TABLE location_analytics; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.location_analytics TO anon;
GRANT ALL ON TABLE public.location_analytics TO authenticated;
GRANT ALL ON TABLE public.location_analytics TO service_role;


--
-- Name: TABLE location_hierarchies; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.location_hierarchies TO anon;
GRANT ALL ON TABLE public.location_hierarchies TO authenticated;
GRANT ALL ON TABLE public.location_hierarchies TO service_role;


--
-- Name: TABLE locations; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.locations TO anon;
GRANT ALL ON TABLE public.locations TO authenticated;
GRANT ALL ON TABLE public.locations TO service_role;


--
-- Name: TABLE locker_access_log; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.locker_access_log TO anon;
GRANT ALL ON TABLE public.locker_access_log TO authenticated;
GRANT ALL ON TABLE public.locker_access_log TO service_role;


--
-- Name: TABLE locker_maintenance; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.locker_maintenance TO anon;
GRANT ALL ON TABLE public.locker_maintenance TO authenticated;
GRANT ALL ON TABLE public.locker_maintenance TO service_role;


--
-- Name: TABLE locker_rentals; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.locker_rentals TO anon;
GRANT ALL ON TABLE public.locker_rentals TO authenticated;
GRANT ALL ON TABLE public.locker_rentals TO service_role;


--
-- Name: TABLE lockers; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.lockers TO anon;
GRANT ALL ON TABLE public.lockers TO authenticated;
GRANT ALL ON TABLE public.lockers TO service_role;


--
-- Name: TABLE loyalty_points; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.loyalty_points TO anon;
GRANT ALL ON TABLE public.loyalty_points TO authenticated;
GRANT ALL ON TABLE public.loyalty_points TO service_role;


--
-- Name: TABLE loyalty_program_rules; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.loyalty_program_rules TO anon;
GRANT ALL ON TABLE public.loyalty_program_rules TO authenticated;
GRANT ALL ON TABLE public.loyalty_program_rules TO service_role;


--
-- Name: TABLE loyalty_redemptions; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.loyalty_redemptions TO anon;
GRANT ALL ON TABLE public.loyalty_redemptions TO authenticated;
GRANT ALL ON TABLE public.loyalty_redemptions TO service_role;


--
-- Name: TABLE loyalty_rewards; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.loyalty_rewards TO anon;
GRANT ALL ON TABLE public.loyalty_rewards TO authenticated;
GRANT ALL ON TABLE public.loyalty_rewards TO service_role;


--
-- Name: TABLE maintenance_logs; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.maintenance_logs TO anon;
GRANT ALL ON TABLE public.maintenance_logs TO authenticated;
GRANT ALL ON TABLE public.maintenance_logs TO service_role;


--
-- Name: TABLE maintenance_schedules; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.maintenance_schedules TO anon;
GRANT ALL ON TABLE public.maintenance_schedules TO authenticated;
GRANT ALL ON TABLE public.maintenance_schedules TO service_role;


--
-- Name: TABLE marketing_analytics; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.marketing_analytics TO anon;
GRANT ALL ON TABLE public.marketing_analytics TO authenticated;
GRANT ALL ON TABLE public.marketing_analytics TO service_role;


--
-- Name: TABLE marketing_campaigns; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.marketing_campaigns TO anon;
GRANT ALL ON TABLE public.marketing_campaigns TO authenticated;
GRANT ALL ON TABLE public.marketing_campaigns TO service_role;


--
-- Name: TABLE member_analytics_snapshots; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.member_analytics_snapshots TO anon;
GRANT ALL ON TABLE public.member_analytics_snapshots TO authenticated;
GRANT ALL ON TABLE public.member_analytics_snapshots TO service_role;


--
-- Name: TABLE profiles; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.profiles TO anon;
GRANT ALL ON TABLE public.profiles TO authenticated;
GRANT ALL ON TABLE public.profiles TO service_role;


--
-- Name: TABLE member_attendance_summary; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.member_attendance_summary TO anon;
GRANT ALL ON TABLE public.member_attendance_summary TO authenticated;
GRANT ALL ON TABLE public.member_attendance_summary TO service_role;


--
-- Name: TABLE member_cards; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.member_cards TO anon;
GRANT ALL ON TABLE public.member_cards TO authenticated;
GRANT ALL ON TABLE public.member_cards TO service_role;


--
-- Name: TABLE member_cohorts; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.member_cohorts TO anon;
GRANT ALL ON TABLE public.member_cohorts TO authenticated;
GRANT ALL ON TABLE public.member_cohorts TO service_role;


--
-- Name: TABLE member_documents; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.member_documents TO anon;
GRANT ALL ON TABLE public.member_documents TO authenticated;
GRANT ALL ON TABLE public.member_documents TO service_role;


--
-- Name: TABLE member_engagement_history; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.member_engagement_history TO anon;
GRANT ALL ON TABLE public.member_engagement_history TO authenticated;
GRANT ALL ON TABLE public.member_engagement_history TO service_role;


--
-- Name: TABLE member_engagement_summary; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.member_engagement_summary TO anon;
GRANT ALL ON TABLE public.member_engagement_summary TO authenticated;
GRANT ALL ON TABLE public.member_engagement_summary TO service_role;


--
-- Name: TABLE member_feedback; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.member_feedback TO anon;
GRANT ALL ON TABLE public.member_feedback TO authenticated;
GRANT ALL ON TABLE public.member_feedback TO service_role;


--
-- Name: TABLE member_location_access; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.member_location_access TO anon;
GRANT ALL ON TABLE public.member_location_access TO authenticated;
GRANT ALL ON TABLE public.member_location_access TO service_role;


--
-- Name: TABLE member_messages; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.member_messages TO anon;
GRANT ALL ON TABLE public.member_messages TO authenticated;
GRANT ALL ON TABLE public.member_messages TO service_role;


--
-- Name: TABLE member_milestones; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.member_milestones TO anon;
GRANT ALL ON TABLE public.member_milestones TO authenticated;
GRANT ALL ON TABLE public.member_milestones TO service_role;


--
-- Name: TABLE member_orientations; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.member_orientations TO anon;
GRANT ALL ON TABLE public.member_orientations TO authenticated;
GRANT ALL ON TABLE public.member_orientations TO service_role;


--
-- Name: TABLE member_referrals; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.member_referrals TO anon;
GRANT ALL ON TABLE public.member_referrals TO authenticated;
GRANT ALL ON TABLE public.member_referrals TO service_role;


--
-- Name: TABLE member_segments; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.member_segments TO anon;
GRANT ALL ON TABLE public.member_segments TO authenticated;
GRANT ALL ON TABLE public.member_segments TO service_role;


--
-- Name: TABLE member_training_packages; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.member_training_packages TO anon;
GRANT ALL ON TABLE public.member_training_packages TO authenticated;
GRANT ALL ON TABLE public.member_training_packages TO service_role;


--
-- Name: TABLE membership_agreement_templates; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.membership_agreement_templates TO anon;
GRANT ALL ON TABLE public.membership_agreement_templates TO authenticated;
GRANT ALL ON TABLE public.membership_agreement_templates TO service_role;


--
-- Name: TABLE membership_agreements; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.membership_agreements TO anon;
GRANT ALL ON TABLE public.membership_agreements TO authenticated;
GRANT ALL ON TABLE public.membership_agreements TO service_role;


--
-- Name: TABLE membership_plans; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.membership_plans TO anon;
GRANT ALL ON TABLE public.membership_plans TO authenticated;
GRANT ALL ON TABLE public.membership_plans TO service_role;


--
-- Name: TABLE memberships; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.memberships TO anon;
GRANT ALL ON TABLE public.memberships TO authenticated;
GRANT ALL ON TABLE public.memberships TO service_role;


--
-- Name: TABLE message_history; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.message_history TO anon;
GRANT ALL ON TABLE public.message_history TO authenticated;
GRANT ALL ON TABLE public.message_history TO service_role;


--
-- Name: TABLE messages; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.messages TO anon;
GRANT ALL ON TABLE public.messages TO authenticated;
GRANT ALL ON TABLE public.messages TO service_role;


--
-- Name: TABLE notification_preferences; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.notification_preferences TO anon;
GRANT ALL ON TABLE public.notification_preferences TO authenticated;
GRANT ALL ON TABLE public.notification_preferences TO service_role;


--
-- Name: TABLE notification_templates; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.notification_templates TO anon;
GRANT ALL ON TABLE public.notification_templates TO authenticated;
GRANT ALL ON TABLE public.notification_templates TO service_role;


--
-- Name: TABLE notifications; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.notifications TO anon;
GRANT ALL ON TABLE public.notifications TO authenticated;
GRANT ALL ON TABLE public.notifications TO service_role;


--
-- Name: TABLE organization_commission_settings; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.organization_commission_settings TO anon;
GRANT ALL ON TABLE public.organization_commission_settings TO authenticated;
GRANT ALL ON TABLE public.organization_commission_settings TO service_role;


--
-- Name: TABLE organizations; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.organizations TO anon;
GRANT ALL ON TABLE public.organizations TO authenticated;
GRANT ALL ON TABLE public.organizations TO service_role;


--
-- Name: TABLE payment_transactions; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.payment_transactions TO anon;
GRANT ALL ON TABLE public.payment_transactions TO authenticated;
GRANT ALL ON TABLE public.payment_transactions TO service_role;


--
-- Name: TABLE payroll_periods; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.payroll_periods TO anon;
GRANT ALL ON TABLE public.payroll_periods TO authenticated;
GRANT ALL ON TABLE public.payroll_periods TO service_role;


--
-- Name: TABLE personal_training_sessions; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.personal_training_sessions TO anon;
GRANT ALL ON TABLE public.personal_training_sessions TO authenticated;
GRANT ALL ON TABLE public.personal_training_sessions TO service_role;


--
-- Name: TABLE pool_facilities; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.pool_facilities TO anon;
GRANT ALL ON TABLE public.pool_facilities TO authenticated;
GRANT ALL ON TABLE public.pool_facilities TO service_role;


--
-- Name: TABLE pool_lane_reservations; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.pool_lane_reservations TO anon;
GRANT ALL ON TABLE public.pool_lane_reservations TO authenticated;
GRANT ALL ON TABLE public.pool_lane_reservations TO service_role;


--
-- Name: TABLE pool_maintenance_logs; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.pool_maintenance_logs TO anon;
GRANT ALL ON TABLE public.pool_maintenance_logs TO authenticated;
GRANT ALL ON TABLE public.pool_maintenance_logs TO service_role;


--
-- Name: TABLE pool_maintenance_schedules; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.pool_maintenance_schedules TO anon;
GRANT ALL ON TABLE public.pool_maintenance_schedules TO authenticated;
GRANT ALL ON TABLE public.pool_maintenance_schedules TO service_role;


--
-- Name: TABLE pos_products; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.pos_products TO anon;
GRANT ALL ON TABLE public.pos_products TO authenticated;
GRANT ALL ON TABLE public.pos_products TO service_role;


--
-- Name: TABLE pos_sale_items; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.pos_sale_items TO anon;
GRANT ALL ON TABLE public.pos_sale_items TO authenticated;
GRANT ALL ON TABLE public.pos_sale_items TO service_role;


--
-- Name: TABLE pos_sales; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.pos_sales TO anon;
GRANT ALL ON TABLE public.pos_sales TO authenticated;
GRANT ALL ON TABLE public.pos_sales TO service_role;


--
-- Name: TABLE promotions; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.promotions TO anon;
GRANT ALL ON TABLE public.promotions TO authenticated;
GRANT ALL ON TABLE public.promotions TO service_role;


--
-- Name: TABLE quote_line_items; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.quote_line_items TO anon;
GRANT ALL ON TABLE public.quote_line_items TO authenticated;
GRANT ALL ON TABLE public.quote_line_items TO service_role;


--
-- Name: TABLE referral_programs; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.referral_programs TO anon;
GRANT ALL ON TABLE public.referral_programs TO authenticated;
GRANT ALL ON TABLE public.referral_programs TO service_role;


--
-- Name: TABLE resource_bookings; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.resource_bookings TO anon;
GRANT ALL ON TABLE public.resource_bookings TO authenticated;
GRANT ALL ON TABLE public.resource_bookings TO service_role;


--
-- Name: TABLE retail_products; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.retail_products TO anon;
GRANT ALL ON TABLE public.retail_products TO authenticated;
GRANT ALL ON TABLE public.retail_products TO service_role;


--
-- Name: TABLE retail_transaction_items; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.retail_transaction_items TO anon;
GRANT ALL ON TABLE public.retail_transaction_items TO authenticated;
GRANT ALL ON TABLE public.retail_transaction_items TO service_role;


--
-- Name: TABLE retail_transactions; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.retail_transactions TO anon;
GRANT ALL ON TABLE public.retail_transactions TO authenticated;
GRANT ALL ON TABLE public.retail_transactions TO service_role;


--
-- Name: TABLE retention_campaigns; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.retention_campaigns TO anon;
GRANT ALL ON TABLE public.retention_campaigns TO authenticated;
GRANT ALL ON TABLE public.retention_campaigns TO service_role;


--
-- Name: TABLE revenue_analytics; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.revenue_analytics TO anon;
GRANT ALL ON TABLE public.revenue_analytics TO authenticated;
GRANT ALL ON TABLE public.revenue_analytics TO service_role;


--
-- Name: TABLE safety_inspections; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.safety_inspections TO anon;
GRANT ALL ON TABLE public.safety_inspections TO authenticated;
GRANT ALL ON TABLE public.safety_inspections TO service_role;


--
-- Name: TABLE safety_violations; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.safety_violations TO anon;
GRANT ALL ON TABLE public.safety_violations TO authenticated;
GRANT ALL ON TABLE public.safety_violations TO service_role;


--
-- Name: TABLE sales_quotes; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.sales_quotes TO anon;
GRANT ALL ON TABLE public.sales_quotes TO authenticated;
GRANT ALL ON TABLE public.sales_quotes TO service_role;


--
-- Name: TABLE salesperson_commissions; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.salesperson_commissions TO anon;
GRANT ALL ON TABLE public.salesperson_commissions TO authenticated;
GRANT ALL ON TABLE public.salesperson_commissions TO service_role;


--
-- Name: TABLE salesperson_referral_links; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.salesperson_referral_links TO anon;
GRANT ALL ON TABLE public.salesperson_referral_links TO authenticated;
GRANT ALL ON TABLE public.salesperson_referral_links TO service_role;


--
-- Name: TABLE sms_campaign_recipients; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.sms_campaign_recipients TO anon;
GRANT ALL ON TABLE public.sms_campaign_recipients TO authenticated;
GRANT ALL ON TABLE public.sms_campaign_recipients TO service_role;


--
-- Name: TABLE sms_campaigns; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.sms_campaigns TO anon;
GRANT ALL ON TABLE public.sms_campaigns TO authenticated;
GRANT ALL ON TABLE public.sms_campaigns TO service_role;


--
-- Name: TABLE social_media_automation_logs; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.social_media_automation_logs TO anon;
GRANT ALL ON TABLE public.social_media_automation_logs TO authenticated;
GRANT ALL ON TABLE public.social_media_automation_logs TO service_role;


--
-- Name: TABLE social_media_automation_settings; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.social_media_automation_settings TO anon;
GRANT ALL ON TABLE public.social_media_automation_settings TO authenticated;
GRANT ALL ON TABLE public.social_media_automation_settings TO service_role;


--
-- Name: TABLE spa_appointments; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.spa_appointments TO anon;
GRANT ALL ON TABLE public.spa_appointments TO authenticated;
GRANT ALL ON TABLE public.spa_appointments TO service_role;


--
-- Name: TABLE spa_inventory; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.spa_inventory TO anon;
GRANT ALL ON TABLE public.spa_inventory TO authenticated;
GRANT ALL ON TABLE public.spa_inventory TO service_role;


--
-- Name: TABLE spa_service_packages; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.spa_service_packages TO anon;
GRANT ALL ON TABLE public.spa_service_packages TO authenticated;
GRANT ALL ON TABLE public.spa_service_packages TO service_role;


--
-- Name: TABLE spa_services; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.spa_services TO anon;
GRANT ALL ON TABLE public.spa_services TO authenticated;
GRANT ALL ON TABLE public.spa_services TO service_role;


--
-- Name: TABLE sports_courts; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.sports_courts TO anon;
GRANT ALL ON TABLE public.sports_courts TO authenticated;
GRANT ALL ON TABLE public.sports_courts TO service_role;


--
-- Name: TABLE sports_equipment; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.sports_equipment TO anon;
GRANT ALL ON TABLE public.sports_equipment TO authenticated;
GRANT ALL ON TABLE public.sports_equipment TO service_role;


--
-- Name: TABLE staff_certifications; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.staff_certifications TO anon;
GRANT ALL ON TABLE public.staff_certifications TO authenticated;
GRANT ALL ON TABLE public.staff_certifications TO service_role;


--
-- Name: TABLE staff_performance_analytics; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.staff_performance_analytics TO anon;
GRANT ALL ON TABLE public.staff_performance_analytics TO authenticated;
GRANT ALL ON TABLE public.staff_performance_analytics TO service_role;


--
-- Name: TABLE staff_schedules; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.staff_schedules TO anon;
GRANT ALL ON TABLE public.staff_schedules TO authenticated;
GRANT ALL ON TABLE public.staff_schedules TO service_role;


--
-- Name: TABLE stock_movements; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.stock_movements TO anon;
GRANT ALL ON TABLE public.stock_movements TO authenticated;
GRANT ALL ON TABLE public.stock_movements TO service_role;


--
-- Name: TABLE subscribers; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.subscribers TO anon;
GRANT ALL ON TABLE public.subscribers TO authenticated;
GRANT ALL ON TABLE public.subscribers TO service_role;


--
-- Name: TABLE support_tickets; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.support_tickets TO anon;
GRANT ALL ON TABLE public.support_tickets TO authenticated;
GRANT ALL ON TABLE public.support_tickets TO service_role;


--
-- Name: TABLE swim_lesson_enrollments; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.swim_lesson_enrollments TO anon;
GRANT ALL ON TABLE public.swim_lesson_enrollments TO authenticated;
GRANT ALL ON TABLE public.swim_lesson_enrollments TO service_role;


--
-- Name: TABLE swim_lessons; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.swim_lessons TO anon;
GRANT ALL ON TABLE public.swim_lessons TO authenticated;
GRANT ALL ON TABLE public.swim_lessons TO service_role;


--
-- Name: TABLE therapist_availability; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.therapist_availability TO anon;
GRANT ALL ON TABLE public.therapist_availability TO authenticated;
GRANT ALL ON TABLE public.therapist_availability TO service_role;


--
-- Name: TABLE time_entries; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.time_entries TO anon;
GRANT ALL ON TABLE public.time_entries TO authenticated;
GRANT ALL ON TABLE public.time_entries TO service_role;


--
-- Name: TABLE tournament_matches; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.tournament_matches TO anon;
GRANT ALL ON TABLE public.tournament_matches TO authenticated;
GRANT ALL ON TABLE public.tournament_matches TO service_role;


--
-- Name: TABLE tournament_participants; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.tournament_participants TO anon;
GRANT ALL ON TABLE public.tournament_participants TO authenticated;
GRANT ALL ON TABLE public.tournament_participants TO service_role;


--
-- Name: TABLE tournaments; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.tournaments TO anon;
GRANT ALL ON TABLE public.tournaments TO authenticated;
GRANT ALL ON TABLE public.tournaments TO service_role;


--
-- Name: TABLE towel_cleaning_logs; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.towel_cleaning_logs TO anon;
GRANT ALL ON TABLE public.towel_cleaning_logs TO authenticated;
GRANT ALL ON TABLE public.towel_cleaning_logs TO service_role;


--
-- Name: TABLE towel_inventory; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.towel_inventory TO anon;
GRANT ALL ON TABLE public.towel_inventory TO authenticated;
GRANT ALL ON TABLE public.towel_inventory TO service_role;


--
-- Name: TABLE towel_rentals; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.towel_rentals TO anon;
GRANT ALL ON TABLE public.towel_rentals TO authenticated;
GRANT ALL ON TABLE public.towel_rentals TO service_role;


--
-- Name: TABLE trainer_availability; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.trainer_availability TO anon;
GRANT ALL ON TABLE public.trainer_availability TO authenticated;
GRANT ALL ON TABLE public.trainer_availability TO service_role;


--
-- Name: TABLE training_packages; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.training_packages TO anon;
GRANT ALL ON TABLE public.training_packages TO authenticated;
GRANT ALL ON TABLE public.training_packages TO service_role;


--
-- Name: TABLE vendors; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.vendors TO anon;
GRANT ALL ON TABLE public.vendors TO authenticated;
GRANT ALL ON TABLE public.vendors TO service_role;


--
-- Name: TABLE visitor_checkins; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.visitor_checkins TO anon;
GRANT ALL ON TABLE public.visitor_checkins TO authenticated;
GRANT ALL ON TABLE public.visitor_checkins TO service_role;


--
-- Name: TABLE water_quality_logs; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.water_quality_logs TO anon;
GRANT ALL ON TABLE public.water_quality_logs TO authenticated;
GRANT ALL ON TABLE public.water_quality_logs TO service_role;


--
-- Name: TABLE webhook_endpoints; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.webhook_endpoints TO anon;
GRANT ALL ON TABLE public.webhook_endpoints TO authenticated;
GRANT ALL ON TABLE public.webhook_endpoints TO service_role;


--
-- Name: TABLE webhook_logs; Type: ACL; Schema: public; Owner: postgres
--

GRANT ALL ON TABLE public.webhook_logs TO anon;
GRANT ALL ON TABLE public.webhook_logs TO authenticated;
GRANT ALL ON TABLE public.webhook_logs TO service_role;


--
-- Name: TABLE messages; Type: ACL; Schema: realtime; Owner: supabase_realtime_admin
--

GRANT ALL ON TABLE realtime.messages TO postgres;
GRANT ALL ON TABLE realtime.messages TO dashboard_user;
GRANT SELECT,INSERT,UPDATE ON TABLE realtime.messages TO anon;
GRANT SELECT,INSERT,UPDATE ON TABLE realtime.messages TO authenticated;
GRANT SELECT,INSERT,UPDATE ON TABLE realtime.messages TO service_role;


--
-- Name: TABLE schema_migrations; Type: ACL; Schema: realtime; Owner: supabase_admin
--

GRANT ALL ON TABLE realtime.schema_migrations TO postgres;
GRANT ALL ON TABLE realtime.schema_migrations TO dashboard_user;
GRANT SELECT ON TABLE realtime.schema_migrations TO anon;
GRANT SELECT ON TABLE realtime.schema_migrations TO authenticated;
GRANT SELECT ON TABLE realtime.schema_migrations TO service_role;
GRANT ALL ON TABLE realtime.schema_migrations TO supabase_realtime_admin;


--
-- Name: TABLE subscription; Type: ACL; Schema: realtime; Owner: supabase_admin
--

GRANT ALL ON TABLE realtime.subscription TO postgres;
GRANT ALL ON TABLE realtime.subscription TO dashboard_user;
GRANT SELECT ON TABLE realtime.subscription TO anon;
GRANT SELECT ON TABLE realtime.subscription TO authenticated;
GRANT SELECT ON TABLE realtime.subscription TO service_role;
GRANT ALL ON TABLE realtime.subscription TO supabase_realtime_admin;


--
-- Name: SEQUENCE subscription_id_seq; Type: ACL; Schema: realtime; Owner: supabase_admin
--

GRANT ALL ON SEQUENCE realtime.subscription_id_seq TO postgres;
GRANT ALL ON SEQUENCE realtime.subscription_id_seq TO dashboard_user;
GRANT USAGE ON SEQUENCE realtime.subscription_id_seq TO anon;
GRANT USAGE ON SEQUENCE realtime.subscription_id_seq TO authenticated;
GRANT USAGE ON SEQUENCE realtime.subscription_id_seq TO service_role;
GRANT ALL ON SEQUENCE realtime.subscription_id_seq TO supabase_realtime_admin;


--
-- Name: TABLE buckets; Type: ACL; Schema: storage; Owner: supabase_storage_admin
--

REVOKE ALL ON TABLE storage.buckets FROM supabase_storage_admin;
GRANT ALL ON TABLE storage.buckets TO supabase_storage_admin WITH GRANT OPTION;
GRANT ALL ON TABLE storage.buckets TO anon;
GRANT ALL ON TABLE storage.buckets TO authenticated;
GRANT ALL ON TABLE storage.buckets TO service_role;
GRANT ALL ON TABLE storage.buckets TO postgres WITH GRANT OPTION;


--
-- Name: TABLE buckets_analytics; Type: ACL; Schema: storage; Owner: supabase_storage_admin
--

GRANT ALL ON TABLE storage.buckets_analytics TO service_role;
GRANT ALL ON TABLE storage.buckets_analytics TO authenticated;
GRANT ALL ON TABLE storage.buckets_analytics TO anon;


--
-- Name: TABLE buckets_vectors; Type: ACL; Schema: storage; Owner: supabase_storage_admin
--

GRANT SELECT ON TABLE storage.buckets_vectors TO service_role;
GRANT SELECT ON TABLE storage.buckets_vectors TO authenticated;
GRANT SELECT ON TABLE storage.buckets_vectors TO anon;


--
-- Name: TABLE objects; Type: ACL; Schema: storage; Owner: supabase_storage_admin
--

REVOKE ALL ON TABLE storage.objects FROM supabase_storage_admin;
GRANT ALL ON TABLE storage.objects TO supabase_storage_admin WITH GRANT OPTION;
GRANT ALL ON TABLE storage.objects TO anon;
GRANT ALL ON TABLE storage.objects TO authenticated;
GRANT ALL ON TABLE storage.objects TO service_role;
GRANT ALL ON TABLE storage.objects TO postgres WITH GRANT OPTION;


--
-- Name: TABLE prefixes; Type: ACL; Schema: storage; Owner: supabase_storage_admin
--

GRANT ALL ON TABLE storage.prefixes TO service_role;
GRANT ALL ON TABLE storage.prefixes TO authenticated;
GRANT ALL ON TABLE storage.prefixes TO anon;


--
-- Name: TABLE s3_multipart_uploads; Type: ACL; Schema: storage; Owner: supabase_storage_admin
--

GRANT ALL ON TABLE storage.s3_multipart_uploads TO service_role;
GRANT SELECT ON TABLE storage.s3_multipart_uploads TO authenticated;
GRANT SELECT ON TABLE storage.s3_multipart_uploads TO anon;


--
-- Name: TABLE s3_multipart_uploads_parts; Type: ACL; Schema: storage; Owner: supabase_storage_admin
--

GRANT ALL ON TABLE storage.s3_multipart_uploads_parts TO service_role;
GRANT SELECT ON TABLE storage.s3_multipart_uploads_parts TO authenticated;
GRANT SELECT ON TABLE storage.s3_multipart_uploads_parts TO anon;


--
-- Name: TABLE vector_indexes; Type: ACL; Schema: storage; Owner: supabase_storage_admin
--

GRANT SELECT ON TABLE storage.vector_indexes TO service_role;
GRANT SELECT ON TABLE storage.vector_indexes TO authenticated;
GRANT SELECT ON TABLE storage.vector_indexes TO anon;


--
-- Name: TABLE secrets; Type: ACL; Schema: vault; Owner: supabase_admin
--

GRANT SELECT,REFERENCES,DELETE,TRUNCATE ON TABLE vault.secrets TO postgres WITH GRANT OPTION;
GRANT SELECT,DELETE ON TABLE vault.secrets TO service_role;


--
-- Name: TABLE decrypted_secrets; Type: ACL; Schema: vault; Owner: supabase_admin
--

GRANT SELECT,REFERENCES,DELETE,TRUNCATE ON TABLE vault.decrypted_secrets TO postgres WITH GRANT OPTION;
GRANT SELECT,DELETE ON TABLE vault.decrypted_secrets TO service_role;


--
-- Name: DEFAULT PRIVILEGES FOR SEQUENCES; Type: DEFAULT ACL; Schema: auth; Owner: supabase_auth_admin
--

ALTER DEFAULT PRIVILEGES FOR ROLE supabase_auth_admin IN SCHEMA auth GRANT ALL ON SEQUENCES TO postgres;
ALTER DEFAULT PRIVILEGES FOR ROLE supabase_auth_admin IN SCHEMA auth GRANT ALL ON SEQUENCES TO dashboard_user;


--
-- Name: DEFAULT PRIVILEGES FOR FUNCTIONS; Type: DEFAULT ACL; Schema: auth; Owner: supabase_auth_admin
--

ALTER DEFAULT PRIVILEGES FOR ROLE supabase_auth_admin IN SCHEMA auth GRANT ALL ON FUNCTIONS TO postgres;
ALTER DEFAULT PRIVILEGES FOR ROLE supabase_auth_admin IN SCHEMA auth GRANT ALL ON FUNCTIONS TO dashboard_user;


--
-- Name: DEFAULT PRIVILEGES FOR TABLES; Type: DEFAULT ACL; Schema: auth; Owner: supabase_auth_admin
--

ALTER DEFAULT PRIVILEGES FOR ROLE supabase_auth_admin IN SCHEMA auth GRANT ALL ON TABLES TO postgres;
ALTER DEFAULT PRIVILEGES FOR ROLE supabase_auth_admin IN SCHEMA auth GRANT ALL ON TABLES TO dashboard_user;


--
-- Name: DEFAULT PRIVILEGES FOR SEQUENCES; Type: DEFAULT ACL; Schema: extensions; Owner: supabase_admin
--

ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA extensions GRANT ALL ON SEQUENCES TO postgres WITH GRANT OPTION;


--
-- Name: DEFAULT PRIVILEGES FOR FUNCTIONS; Type: DEFAULT ACL; Schema: extensions; Owner: supabase_admin
--

ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA extensions GRANT ALL ON FUNCTIONS TO postgres WITH GRANT OPTION;


--
-- Name: DEFAULT PRIVILEGES FOR TABLES; Type: DEFAULT ACL; Schema: extensions; Owner: supabase_admin
--

ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA extensions GRANT ALL ON TABLES TO postgres WITH GRANT OPTION;


--
-- Name: DEFAULT PRIVILEGES FOR SEQUENCES; Type: DEFAULT ACL; Schema: graphql; Owner: supabase_admin
--

ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA graphql GRANT ALL ON SEQUENCES TO postgres;
ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA graphql GRANT ALL ON SEQUENCES TO anon;
ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA graphql GRANT ALL ON SEQUENCES TO authenticated;
ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA graphql GRANT ALL ON SEQUENCES TO service_role;


--
-- Name: DEFAULT PRIVILEGES FOR FUNCTIONS; Type: DEFAULT ACL; Schema: graphql; Owner: supabase_admin
--

ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA graphql GRANT ALL ON FUNCTIONS TO postgres;
ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA graphql GRANT ALL ON FUNCTIONS TO anon;
ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA graphql GRANT ALL ON FUNCTIONS TO authenticated;
ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA graphql GRANT ALL ON FUNCTIONS TO service_role;


--
-- Name: DEFAULT PRIVILEGES FOR TABLES; Type: DEFAULT ACL; Schema: graphql; Owner: supabase_admin
--

ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA graphql GRANT ALL ON TABLES TO postgres;
ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA graphql GRANT ALL ON TABLES TO anon;
ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA graphql GRANT ALL ON TABLES TO authenticated;
ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA graphql GRANT ALL ON TABLES TO service_role;


--
-- Name: DEFAULT PRIVILEGES FOR SEQUENCES; Type: DEFAULT ACL; Schema: graphql_public; Owner: supabase_admin
--

ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA graphql_public GRANT ALL ON SEQUENCES TO postgres;
ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA graphql_public GRANT ALL ON SEQUENCES TO anon;
ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA graphql_public GRANT ALL ON SEQUENCES TO authenticated;
ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA graphql_public GRANT ALL ON SEQUENCES TO service_role;


--
-- Name: DEFAULT PRIVILEGES FOR FUNCTIONS; Type: DEFAULT ACL; Schema: graphql_public; Owner: supabase_admin
--

ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA graphql_public GRANT ALL ON FUNCTIONS TO postgres;
ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA graphql_public GRANT ALL ON FUNCTIONS TO anon;
ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA graphql_public GRANT ALL ON FUNCTIONS TO authenticated;
ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA graphql_public GRANT ALL ON FUNCTIONS TO service_role;


--
-- Name: DEFAULT PRIVILEGES FOR TABLES; Type: DEFAULT ACL; Schema: graphql_public; Owner: supabase_admin
--

ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA graphql_public GRANT ALL ON TABLES TO postgres;
ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA graphql_public GRANT ALL ON TABLES TO anon;
ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA graphql_public GRANT ALL ON TABLES TO authenticated;
ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA graphql_public GRANT ALL ON TABLES TO service_role;


--
-- Name: DEFAULT PRIVILEGES FOR SEQUENCES; Type: DEFAULT ACL; Schema: public; Owner: postgres
--

ALTER DEFAULT PRIVILEGES FOR ROLE postgres IN SCHEMA public GRANT ALL ON SEQUENCES TO postgres;
ALTER DEFAULT PRIVILEGES FOR ROLE postgres IN SCHEMA public GRANT ALL ON SEQUENCES TO anon;
ALTER DEFAULT PRIVILEGES FOR ROLE postgres IN SCHEMA public GRANT ALL ON SEQUENCES TO authenticated;
ALTER DEFAULT PRIVILEGES FOR ROLE postgres IN SCHEMA public GRANT ALL ON SEQUENCES TO service_role;


--
-- Name: DEFAULT PRIVILEGES FOR SEQUENCES; Type: DEFAULT ACL; Schema: public; Owner: supabase_admin
--

ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA public GRANT ALL ON SEQUENCES TO postgres;
ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA public GRANT ALL ON SEQUENCES TO anon;
ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA public GRANT ALL ON SEQUENCES TO authenticated;
ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA public GRANT ALL ON SEQUENCES TO service_role;


--
-- Name: DEFAULT PRIVILEGES FOR FUNCTIONS; Type: DEFAULT ACL; Schema: public; Owner: postgres
--

ALTER DEFAULT PRIVILEGES FOR ROLE postgres IN SCHEMA public GRANT ALL ON FUNCTIONS TO postgres;
ALTER DEFAULT PRIVILEGES FOR ROLE postgres IN SCHEMA public GRANT ALL ON FUNCTIONS TO anon;
ALTER DEFAULT PRIVILEGES FOR ROLE postgres IN SCHEMA public GRANT ALL ON FUNCTIONS TO authenticated;
ALTER DEFAULT PRIVILEGES FOR ROLE postgres IN SCHEMA public GRANT ALL ON FUNCTIONS TO service_role;


--
-- Name: DEFAULT PRIVILEGES FOR FUNCTIONS; Type: DEFAULT ACL; Schema: public; Owner: supabase_admin
--

ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA public GRANT ALL ON FUNCTIONS TO postgres;
ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA public GRANT ALL ON FUNCTIONS TO anon;
ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA public GRANT ALL ON FUNCTIONS TO authenticated;
ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA public GRANT ALL ON FUNCTIONS TO service_role;


--
-- Name: DEFAULT PRIVILEGES FOR TABLES; Type: DEFAULT ACL; Schema: public; Owner: postgres
--

ALTER DEFAULT PRIVILEGES FOR ROLE postgres IN SCHEMA public GRANT ALL ON TABLES TO postgres;
ALTER DEFAULT PRIVILEGES FOR ROLE postgres IN SCHEMA public GRANT ALL ON TABLES TO anon;
ALTER DEFAULT PRIVILEGES FOR ROLE postgres IN SCHEMA public GRANT ALL ON TABLES TO authenticated;
ALTER DEFAULT PRIVILEGES FOR ROLE postgres IN SCHEMA public GRANT ALL ON TABLES TO service_role;


--
-- Name: DEFAULT PRIVILEGES FOR TABLES; Type: DEFAULT ACL; Schema: public; Owner: supabase_admin
--

ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA public GRANT ALL ON TABLES TO postgres;
ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA public GRANT ALL ON TABLES TO anon;
ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA public GRANT ALL ON TABLES TO authenticated;
ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA public GRANT ALL ON TABLES TO service_role;


--
-- Name: DEFAULT PRIVILEGES FOR SEQUENCES; Type: DEFAULT ACL; Schema: realtime; Owner: supabase_admin
--

ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA realtime GRANT ALL ON SEQUENCES TO postgres;
ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA realtime GRANT ALL ON SEQUENCES TO dashboard_user;


--
-- Name: DEFAULT PRIVILEGES FOR FUNCTIONS; Type: DEFAULT ACL; Schema: realtime; Owner: supabase_admin
--

ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA realtime GRANT ALL ON FUNCTIONS TO postgres;
ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA realtime GRANT ALL ON FUNCTIONS TO dashboard_user;


--
-- Name: DEFAULT PRIVILEGES FOR TABLES; Type: DEFAULT ACL; Schema: realtime; Owner: supabase_admin
--

ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA realtime GRANT ALL ON TABLES TO postgres;
ALTER DEFAULT PRIVILEGES FOR ROLE supabase_admin IN SCHEMA realtime GRANT ALL ON TABLES TO dashboard_user;


--
-- Name: DEFAULT PRIVILEGES FOR SEQUENCES; Type: DEFAULT ACL; Schema: storage; Owner: postgres
--

ALTER DEFAULT PRIVILEGES FOR ROLE postgres IN SCHEMA storage GRANT ALL ON SEQUENCES TO postgres;
ALTER DEFAULT PRIVILEGES FOR ROLE postgres IN SCHEMA storage GRANT ALL ON SEQUENCES TO anon;
ALTER DEFAULT PRIVILEGES FOR ROLE postgres IN SCHEMA storage GRANT ALL ON SEQUENCES TO authenticated;
ALTER DEFAULT PRIVILEGES FOR ROLE postgres IN SCHEMA storage GRANT ALL ON SEQUENCES TO service_role;


--
-- Name: DEFAULT PRIVILEGES FOR FUNCTIONS; Type: DEFAULT ACL; Schema: storage; Owner: postgres
--

ALTER DEFAULT PRIVILEGES FOR ROLE postgres IN SCHEMA storage GRANT ALL ON FUNCTIONS TO postgres;
ALTER DEFAULT PRIVILEGES FOR ROLE postgres IN SCHEMA storage GRANT ALL ON FUNCTIONS TO anon;
ALTER DEFAULT PRIVILEGES FOR ROLE postgres IN SCHEMA storage GRANT ALL ON FUNCTIONS TO authenticated;
ALTER DEFAULT PRIVILEGES FOR ROLE postgres IN SCHEMA storage GRANT ALL ON FUNCTIONS TO service_role;


--
-- Name: DEFAULT PRIVILEGES FOR TABLES; Type: DEFAULT ACL; Schema: storage; Owner: postgres
--

ALTER DEFAULT PRIVILEGES FOR ROLE postgres IN SCHEMA storage GRANT ALL ON TABLES TO postgres;
ALTER DEFAULT PRIVILEGES FOR ROLE postgres IN SCHEMA storage GRANT ALL ON TABLES TO anon;
ALTER DEFAULT PRIVILEGES FOR ROLE postgres IN SCHEMA storage GRANT ALL ON TABLES TO authenticated;
ALTER DEFAULT PRIVILEGES FOR ROLE postgres IN SCHEMA storage GRANT ALL ON TABLES TO service_role;


--
-- Name: issue_graphql_placeholder; Type: EVENT TRIGGER; Schema: -; Owner: supabase_admin
--

CREATE EVENT TRIGGER issue_graphql_placeholder ON sql_drop
         WHEN TAG IN ('DROP EXTENSION')
   EXECUTE FUNCTION extensions.set_graphql_placeholder();


ALTER EVENT TRIGGER issue_graphql_placeholder OWNER TO supabase_admin;

--
-- Name: issue_pg_cron_access; Type: EVENT TRIGGER; Schema: -; Owner: supabase_admin
--

CREATE EVENT TRIGGER issue_pg_cron_access ON ddl_command_end
         WHEN TAG IN ('CREATE EXTENSION')
   EXECUTE FUNCTION extensions.grant_pg_cron_access();


ALTER EVENT TRIGGER issue_pg_cron_access OWNER TO supabase_admin;

--
-- Name: issue_pg_graphql_access; Type: EVENT TRIGGER; Schema: -; Owner: supabase_admin
--

CREATE EVENT TRIGGER issue_pg_graphql_access ON ddl_command_end
         WHEN TAG IN ('CREATE FUNCTION')
   EXECUTE FUNCTION extensions.grant_pg_graphql_access();


ALTER EVENT TRIGGER issue_pg_graphql_access OWNER TO supabase_admin;

--
-- Name: issue_pg_net_access; Type: EVENT TRIGGER; Schema: -; Owner: supabase_admin
--

CREATE EVENT TRIGGER issue_pg_net_access ON ddl_command_end
         WHEN TAG IN ('CREATE EXTENSION')
   EXECUTE FUNCTION extensions.grant_pg_net_access();


ALTER EVENT TRIGGER issue_pg_net_access OWNER TO supabase_admin;

--
-- Name: pgrst_ddl_watch; Type: EVENT TRIGGER; Schema: -; Owner: supabase_admin
--

CREATE EVENT TRIGGER pgrst_ddl_watch ON ddl_command_end
   EXECUTE FUNCTION extensions.pgrst_ddl_watch();


ALTER EVENT TRIGGER pgrst_ddl_watch OWNER TO supabase_admin;

--
-- Name: pgrst_drop_watch; Type: EVENT TRIGGER; Schema: -; Owner: supabase_admin
--

CREATE EVENT TRIGGER pgrst_drop_watch ON sql_drop
   EXECUTE FUNCTION extensions.pgrst_drop_watch();


ALTER EVENT TRIGGER pgrst_drop_watch OWNER TO supabase_admin;

--
-- PostgreSQL database dump complete
--

\unrestrict CleUPxhcCZthHjtTkWu6qWEdD6cSwofYKP74xy8BLTAw1If4p6blDQITGBtBOVo

--
-- PostgreSQL database cluster dump complete
--

